//////////////////////////////////////////////////////////////////////////
//                                                                      //
// This is a generated file. You can view the original                  //
// source in your browser if your browser supports source maps.         //
//                                                                      //
// If you are using Chrome, open the Developer Tools and click the gear //
// icon in its lower right corner. In the General Settings panel, turn  //
// on 'Enable source maps'.                                             //
//                                                                      //
// If you are using Firefox 23, go to `about:config` and set the        //
// `devtools.debugger.source-maps-enabled` preference to true.          //
// (The preference should be on by default in Firefox 24; versions      //
// older than 23 do not support source maps.)                           //
//                                                                      //
//////////////////////////////////////////////////////////////////////////


(function () {

/* Imports */
var Meteor = Package.meteor.Meteor;
var Session = Package.session.Session;
var Template = Package.templating.Template;
var Blaze = Package.blaze.Blaze;
var UI = Package.blaze.UI;
var Handlebars = Package.blaze.Handlebars;
var _ = Package.underscore._;
var ShareIt = Package['lovetostrike:shareit'].ShareIt;
var Notifications = Package['gfk:notifications'].Notifications;
var Tracker = Package.tracker.Tracker;
var Deps = Package.tracker.Deps;
var Router = Package['iron:router'].Router;
var RouteController = Package['iron:router'].RouteController;
var Accounts = Package['accounts-base'].Accounts;
var moment = Package['mrt:moment'].moment;
var FileCollection = Package['vsivsi:file-collection'].FileCollection;
var Roles = Package['alanning:roles'].Roles;
var FastRender = Package['meteorhacks:fast-render'].FastRender;
var __init_fast_render = Package['meteorhacks:fast-render'].__init_fast_render;
var SubsManager = Package['meteorhacks:subs-manager'].SubsManager;
var Spiderable = Package.spiderable.Spiderable;
var Iron = Package['iron:core'].Iron;
var FS = Package['cfs:base-package'].FS;
var HTML = Package.htmljs.HTML;

/* Package-scope variables */
var __coffeescriptShare, k, Handlebars, wrapperNode, input_char;

(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/boot.coffee.js                                                                             //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
var Blog;

Blog = {
  settings: {
    title: '',
    blogIndexTemplate: null,
    blogShowTemplate: null,
    blogNotFoundTemplate: null,
    blogAdminTemplate: null,
    blogAdminEditTemplate: null,
    pageSize: 20,
    publicDrafts: true,
    excerptFunction: null,
    syntaxHighlighting: false,
    syntaxHighlightingTheme: 'github',
    cdnFontAwesome: true,
    comments: {
      allowAnonymous: false,
      useSideComments: false,
      defaultImg: '/packages/blog/public/default-user.png',
      userImg: 'avatar',
      disqusShortname: null
    }
  },
  config: function(appConfig) {
    if (appConfig.comments) {
      this.settings.comments = _.extend(this.settings.comments, appConfig.comments);
      delete appConfig.comments;
    }
    this.settings = _.extend(this.settings, appConfig);
    if (this.settings.syntaxHighlightingTheme) {
      return $('<link>', {
        href: '//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/' + this.settings.syntaxHighlightingTheme + '.min.css',
        rel: 'stylesheet'
      }).appendTo('head');
    }
  }
};

this.Blog = Blog;

Meteor.startup(function() {
  if (Blog.settings.cdnFontAwesome) {
    $('<link>', {
      href: '//netdna.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.css',
      rel: 'stylesheet'
    }).appendTo('head');
  }
  $('body').on('click', '.blog-load-more', function(e) {
    e.preventDefault();
    if (Session.get('postLimit')) {
      return Session.set('postLimit', Session.get('postLimit') + Blog.settings.pageSize);
    }
  });
  return _.extend(Notifications.defaultOptions, {
    timeout: 5000
  });
});

UI.registerHelper("blogFormatDate", function(date) {
  return moment(new Date(date)).format("MMM Do, YYYY");
});

UI.registerHelper("blogFormatTags", function(tags) {
  var path, str, tag, _i, _len;
  if (tags == null) {
    return;
  }
  for (_i = 0, _len = tags.length; _i < _len; _i++) {
    tag = tags[_i];
    path = Router.path('blogTagged', {
      tag: tag
    });
    if (typeof str !== "undefined" && str !== null) {
      str += ", <a href=\"" + path + "\">" + tag + "</a>";
    } else {
      str = "<a href=\"" + path + "\">" + tag + "</a>";
    }
  }
  return new Spacebars.SafeString(str);
});

UI.registerHelper("joinTags", function(list) {
  if (list) {
    return list.join(', ');
  }
});

UI.registerHelper("blogPager", function() {
  if (Post.count() === Session.get('postLimit')) {
    return new Spacebars.SafeString('<a class="blog-load-more btn" href="#">Load More</a>');
  }
});

UI.registerHelper("session", function(key) {
  return Session.get(key);
});
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/compatibility/side-comments.js                                                             //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
/**                                                                                                                    // 1
 * Require the given path.                                                                                             // 2
 *                                                                                                                     // 3
 * @param {String} path                                                                                                // 4
 * @return {Object} exports                                                                                            // 5
 * @api public                                                                                                         // 6
 */                                                                                                                    // 7
                                                                                                                       // 8
/*                                                                                                                     // 9
 * Wrapped to work with Meteor                                                                                         // 10
*/                                                                                                                     // 11
                                                                                                                       // 12
function requireClass(path, parent, orig) {                                                                            // 13
  var resolved = require.resolve(path);                                                                                // 14
                                                                                                                       // 15
  // lookup failed                                                                                                     // 16
  if (null == resolved) {                                                                                              // 17
    orig = orig || path;                                                                                               // 18
    parent = parent || 'root';                                                                                         // 19
    var err = new Error('Failed to require "' + orig + '" from "' + parent + '"');                                     // 20
    err.path = orig;                                                                                                   // 21
    err.parent = parent;                                                                                               // 22
    err.require = true;                                                                                                // 23
    throw err;                                                                                                         // 24
  }                                                                                                                    // 25
                                                                                                                       // 26
  var module = require.modules[resolved];                                                                              // 27
                                                                                                                       // 28
  // perform real require()                                                                                            // 29
  // by invoking the module's                                                                                          // 30
  // registered function                                                                                               // 31
  if (!module._resolving && !module.exports) {                                                                         // 32
    var mod = {};                                                                                                      // 33
    mod.exports = {};                                                                                                  // 34
    mod.client = mod.component = true;                                                                                 // 35
    module._resolving = true;                                                                                          // 36
    module.call(this, mod.exports, require.relative(resolved), mod);                                                   // 37
    delete module._resolving;                                                                                          // 38
    module.exports = mod.exports;                                                                                      // 39
  }                                                                                                                    // 40
                                                                                                                       // 41
  return module.exports;                                                                                               // 42
}                                                                                                                      // 43
                                                                                                                       // 44
window.require = requireClass                                                                                          // 45
                                                                                                                       // 46
/**                                                                                                                    // 47
 * Registered modules.                                                                                                 // 48
 */                                                                                                                    // 49
                                                                                                                       // 50
require.modules = {};                                                                                                  // 51
                                                                                                                       // 52
/**                                                                                                                    // 53
 * Registered aliases.                                                                                                 // 54
 */                                                                                                                    // 55
                                                                                                                       // 56
require.aliases = {};                                                                                                  // 57
                                                                                                                       // 58
/**                                                                                                                    // 59
 * Resolve `path`.                                                                                                     // 60
 *                                                                                                                     // 61
 * Lookup:                                                                                                             // 62
 *                                                                                                                     // 63
 *   - PATH/index.js                                                                                                   // 64
 *   - PATH.js                                                                                                         // 65
 *   - PATH                                                                                                            // 66
 *                                                                                                                     // 67
 * @param {String} path                                                                                                // 68
 * @return {String} path or null                                                                                       // 69
 * @api private                                                                                                        // 70
 */                                                                                                                    // 71
                                                                                                                       // 72
require.resolve = function(path) {                                                                                     // 73
  if (path.charAt(0) === '/') path = path.slice(1);                                                                    // 74
                                                                                                                       // 75
  var paths = [                                                                                                        // 76
    path,                                                                                                              // 77
    path + '.js',                                                                                                      // 78
    path + '.json',                                                                                                    // 79
    path + '/index.js',                                                                                                // 80
    path + '/index.json'                                                                                               // 81
  ];                                                                                                                   // 82
                                                                                                                       // 83
  for (var i = 0; i < paths.length; i++) {                                                                             // 84
    var path = paths[i];                                                                                               // 85
    if (require.modules.hasOwnProperty(path)) return path;                                                             // 86
    if (require.aliases.hasOwnProperty(path)) return require.aliases[path];                                            // 87
  }                                                                                                                    // 88
};                                                                                                                     // 89
                                                                                                                       // 90
/**                                                                                                                    // 91
 * Normalize `path` relative to the current path.                                                                      // 92
 *                                                                                                                     // 93
 * @param {String} curr                                                                                                // 94
 * @param {String} path                                                                                                // 95
 * @return {String}                                                                                                    // 96
 * @api private                                                                                                        // 97
 */                                                                                                                    // 98
                                                                                                                       // 99
require.normalize = function(curr, path) {                                                                             // 100
  var segs = [];                                                                                                       // 101
                                                                                                                       // 102
  if ('.' != path.charAt(0)) return path;                                                                              // 103
                                                                                                                       // 104
  curr = curr.split('/');                                                                                              // 105
  path = path.split('/');                                                                                              // 106
                                                                                                                       // 107
  for (var i = 0; i < path.length; ++i) {                                                                              // 108
    if ('..' == path[i]) {                                                                                             // 109
      curr.pop();                                                                                                      // 110
    } else if ('.' != path[i] && '' != path[i]) {                                                                      // 111
      segs.push(path[i]);                                                                                              // 112
    }                                                                                                                  // 113
  }                                                                                                                    // 114
                                                                                                                       // 115
  return curr.concat(segs).join('/');                                                                                  // 116
};                                                                                                                     // 117
                                                                                                                       // 118
/**                                                                                                                    // 119
 * Register module at `path` with callback `definition`.                                                               // 120
 *                                                                                                                     // 121
 * @param {String} path                                                                                                // 122
 * @param {Function} definition                                                                                        // 123
 * @api private                                                                                                        // 124
 */                                                                                                                    // 125
                                                                                                                       // 126
require.register = function(path, definition) {                                                                        // 127
  require.modules[path] = definition;                                                                                  // 128
};                                                                                                                     // 129
                                                                                                                       // 130
/**                                                                                                                    // 131
 * Alias a module definition.                                                                                          // 132
 *                                                                                                                     // 133
 * @param {String} from                                                                                                // 134
 * @param {String} to                                                                                                  // 135
 * @api private                                                                                                        // 136
 */                                                                                                                    // 137
                                                                                                                       // 138
require.alias = function(from, to) {                                                                                   // 139
  if (!require.modules.hasOwnProperty(from)) {                                                                         // 140
    throw new Error('Failed to alias "' + from + '", it does not exist');                                              // 141
  }                                                                                                                    // 142
  require.aliases[to] = from;                                                                                          // 143
};                                                                                                                     // 144
                                                                                                                       // 145
/**                                                                                                                    // 146
 * Return a require function relative to the `parent` path.                                                            // 147
 *                                                                                                                     // 148
 * @param {String} parent                                                                                              // 149
 * @return {Function}                                                                                                  // 150
 * @api private                                                                                                        // 151
 */                                                                                                                    // 152
                                                                                                                       // 153
require.relative = function(parent) {                                                                                  // 154
  var p = require.normalize(parent, '..');                                                                             // 155
                                                                                                                       // 156
  /**                                                                                                                  // 157
   * lastIndexOf helper.                                                                                               // 158
   */                                                                                                                  // 159
                                                                                                                       // 160
  function lastIndexOf(arr, obj) {                                                                                     // 161
    var i = arr.length;                                                                                                // 162
    while (i--) {                                                                                                      // 163
      if (arr[i] === obj) return i;                                                                                    // 164
    }                                                                                                                  // 165
    return -1;                                                                                                         // 166
  }                                                                                                                    // 167
                                                                                                                       // 168
  /**                                                                                                                  // 169
   * The relative require() itself.                                                                                    // 170
   */                                                                                                                  // 171
                                                                                                                       // 172
  function localRequire(path) {                                                                                        // 173
    var resolved = localRequire.resolve(path);                                                                         // 174
    return require(resolved, parent, path);                                                                            // 175
  }                                                                                                                    // 176
                                                                                                                       // 177
  /**                                                                                                                  // 178
   * Resolve relative to the parent.                                                                                   // 179
   */                                                                                                                  // 180
                                                                                                                       // 181
  localRequire.resolve = function(path) {                                                                              // 182
    var c = path.charAt(0);                                                                                            // 183
    if ('/' == c) return path.slice(1);                                                                                // 184
    if ('.' == c) return require.normalize(p, path);                                                                   // 185
                                                                                                                       // 186
    // resolve deps by returning                                                                                       // 187
    // the dep in the nearest "deps"                                                                                   // 188
    // directory                                                                                                       // 189
    var segs = parent.split('/');                                                                                      // 190
    var i = lastIndexOf(segs, 'deps') + 1;                                                                             // 191
    if (!i) i = 0;                                                                                                     // 192
    path = segs.slice(0, i + 1).join('/') + '/deps/' + path;                                                           // 193
    return path;                                                                                                       // 194
  };                                                                                                                   // 195
                                                                                                                       // 196
  /**                                                                                                                  // 197
   * Check if module is defined at `path`.                                                                             // 198
   */                                                                                                                  // 199
                                                                                                                       // 200
  localRequire.exists = function(path) {                                                                               // 201
    return require.modules.hasOwnProperty(localRequire.resolve(path));                                                 // 202
  };                                                                                                                   // 203
                                                                                                                       // 204
  return localRequire;                                                                                                 // 205
};                                                                                                                     // 206
require.register("component-emitter/index.js", function(exports, require, module){                                     // 207
                                                                                                                       // 208
/**                                                                                                                    // 209
 * Expose `Emitter`.                                                                                                   // 210
 */                                                                                                                    // 211
                                                                                                                       // 212
module.exports = Emitter;                                                                                              // 213
                                                                                                                       // 214
/**                                                                                                                    // 215
 * Initialize a new `Emitter`.                                                                                         // 216
 *                                                                                                                     // 217
 * @api public                                                                                                         // 218
 */                                                                                                                    // 219
                                                                                                                       // 220
function Emitter(obj) {                                                                                                // 221
  if (obj) return mixin(obj);                                                                                          // 222
};                                                                                                                     // 223
                                                                                                                       // 224
/**                                                                                                                    // 225
 * Mixin the emitter properties.                                                                                       // 226
 *                                                                                                                     // 227
 * @param {Object} obj                                                                                                 // 228
 * @return {Object}                                                                                                    // 229
 * @api private                                                                                                        // 230
 */                                                                                                                    // 231
                                                                                                                       // 232
function mixin(obj) {                                                                                                  // 233
  for (var key in Emitter.prototype) {                                                                                 // 234
    obj[key] = Emitter.prototype[key];                                                                                 // 235
  }                                                                                                                    // 236
  return obj;                                                                                                          // 237
}                                                                                                                      // 238
                                                                                                                       // 239
/**                                                                                                                    // 240
 * Listen on the given `event` with `fn`.                                                                              // 241
 *                                                                                                                     // 242
 * @param {String} event                                                                                               // 243
 * @param {Function} fn                                                                                                // 244
 * @return {Emitter}                                                                                                   // 245
 * @api public                                                                                                         // 246
 */                                                                                                                    // 247
                                                                                                                       // 248
Emitter.prototype.on =                                                                                                 // 249
Emitter.prototype.addEventListener = function(event, fn){                                                              // 250
  this._callbacks = this._callbacks || {};                                                                             // 251
  (this._callbacks[event] = this._callbacks[event] || [])                                                              // 252
    .push(fn);                                                                                                         // 253
  return this;                                                                                                         // 254
};                                                                                                                     // 255
                                                                                                                       // 256
/**                                                                                                                    // 257
 * Adds an `event` listener that will be invoked a single                                                              // 258
 * time then automatically removed.                                                                                    // 259
 *                                                                                                                     // 260
 * @param {String} event                                                                                               // 261
 * @param {Function} fn                                                                                                // 262
 * @return {Emitter}                                                                                                   // 263
 * @api public                                                                                                         // 264
 */                                                                                                                    // 265
                                                                                                                       // 266
Emitter.prototype.once = function(event, fn){                                                                          // 267
  var self = this;                                                                                                     // 268
  this._callbacks = this._callbacks || {};                                                                             // 269
                                                                                                                       // 270
  function on() {                                                                                                      // 271
    self.off(event, on);                                                                                               // 272
    fn.apply(this, arguments);                                                                                         // 273
  }                                                                                                                    // 274
                                                                                                                       // 275
  on.fn = fn;                                                                                                          // 276
  this.on(event, on);                                                                                                  // 277
  return this;                                                                                                         // 278
};                                                                                                                     // 279
                                                                                                                       // 280
/**                                                                                                                    // 281
 * Remove the given callback for `event` or all                                                                        // 282
 * registered callbacks.                                                                                               // 283
 *                                                                                                                     // 284
 * @param {String} event                                                                                               // 285
 * @param {Function} fn                                                                                                // 286
 * @return {Emitter}                                                                                                   // 287
 * @api public                                                                                                         // 288
 */                                                                                                                    // 289
                                                                                                                       // 290
Emitter.prototype.off =                                                                                                // 291
Emitter.prototype.removeListener =                                                                                     // 292
Emitter.prototype.removeAllListeners =                                                                                 // 293
Emitter.prototype.removeEventListener = function(event, fn){                                                           // 294
  this._callbacks = this._callbacks || {};                                                                             // 295
                                                                                                                       // 296
  // all                                                                                                               // 297
  if (0 == arguments.length) {                                                                                         // 298
    this._callbacks = {};                                                                                              // 299
    return this;                                                                                                       // 300
  }                                                                                                                    // 301
                                                                                                                       // 302
  // specific event                                                                                                    // 303
  var callbacks = this._callbacks[event];                                                                              // 304
  if (!callbacks) return this;                                                                                         // 305
                                                                                                                       // 306
  // remove all handlers                                                                                               // 307
  if (1 == arguments.length) {                                                                                         // 308
    delete this._callbacks[event];                                                                                     // 309
    return this;                                                                                                       // 310
  }                                                                                                                    // 311
                                                                                                                       // 312
  // remove specific handler                                                                                           // 313
  var cb;                                                                                                              // 314
  for (var i = 0; i < callbacks.length; i++) {                                                                         // 315
    cb = callbacks[i];                                                                                                 // 316
    if (cb === fn || cb.fn === fn) {                                                                                   // 317
      callbacks.splice(i, 1);                                                                                          // 318
      break;                                                                                                           // 319
    }                                                                                                                  // 320
  }                                                                                                                    // 321
  return this;                                                                                                         // 322
};                                                                                                                     // 323
                                                                                                                       // 324
/**                                                                                                                    // 325
 * Emit `event` with the given args.                                                                                   // 326
 *                                                                                                                     // 327
 * @param {String} event                                                                                               // 328
 * @param {Mixed} ...                                                                                                  // 329
 * @return {Emitter}                                                                                                   // 330
 */                                                                                                                    // 331
                                                                                                                       // 332
Emitter.prototype.emit = function(event){                                                                              // 333
  this._callbacks = this._callbacks || {};                                                                             // 334
  var args = [].slice.call(arguments, 1)                                                                               // 335
    , callbacks = this._callbacks[event];                                                                              // 336
                                                                                                                       // 337
  if (callbacks) {                                                                                                     // 338
    callbacks = callbacks.slice(0);                                                                                    // 339
    for (var i = 0, len = callbacks.length; i < len; ++i) {                                                            // 340
      callbacks[i].apply(this, args);                                                                                  // 341
    }                                                                                                                  // 342
  }                                                                                                                    // 343
                                                                                                                       // 344
  return this;                                                                                                         // 345
};                                                                                                                     // 346
                                                                                                                       // 347
/**                                                                                                                    // 348
 * Return array of callbacks for `event`.                                                                              // 349
 *                                                                                                                     // 350
 * @param {String} event                                                                                               // 351
 * @return {Array}                                                                                                     // 352
 * @api public                                                                                                         // 353
 */                                                                                                                    // 354
                                                                                                                       // 355
Emitter.prototype.listeners = function(event){                                                                         // 356
  this._callbacks = this._callbacks || {};                                                                             // 357
  return this._callbacks[event] || [];                                                                                 // 358
};                                                                                                                     // 359
                                                                                                                       // 360
/**                                                                                                                    // 361
 * Check if this emitter has `event` handlers.                                                                         // 362
 *                                                                                                                     // 363
 * @param {String} event                                                                                               // 364
 * @return {Boolean}                                                                                                   // 365
 * @api public                                                                                                         // 366
 */                                                                                                                    // 367
                                                                                                                       // 368
Emitter.prototype.hasListeners = function(event){                                                                      // 369
  return !! this.listeners(event).length;                                                                              // 370
};                                                                                                                     // 371
                                                                                                                       // 372
});                                                                                                                    // 373
require.register("side-comments/js/main.js", function(exports, require, module){                                       // 374
var _ = require('./vendor/lodash-custom.js');                                                                          // 375
var Section = require('./section.js');                                                                                 // 376
var Emitter = require('emitter');                                                                                      // 377
var eventPipe = new Emitter;                                                                                           // 378
                                                                                                                       // 379
/**                                                                                                                    // 380
 * Creates a new SideComments instance.                                                                                // 381
 * @param {Object} el               The selector for the element for                                                   // 382
 *                                  which side comments need to be initialized                                         // 383
 * @param {Object} currentUser      An object defining the current user. Used                                          // 384
 *                                  for posting new comments and deciding                                              // 385
 *                                  whether existing ones can be deleted                                               // 386
 *                                  or not.                                                                            // 387
 * @param {Array} existingComments An array of existing comments, in                                                   // 388
 *                                 the proper structure.                                                               // 389
 *                                                                                                                     // 390
 * TODO: **GIVE EXAMPLE OF STRUCTURE HERE***                                                                           // 391
 */                                                                                                                    // 392
function SideComments( el, currentUser, existingComments ) {                                                           // 393
  this.$el = $(el);                                                                                                    // 394
  this.$body = $('body');                                                                                              // 395
  this.eventPipe = eventPipe;                                                                                          // 396
                                                                                                                       // 397
  this.currentUser = _.clone(currentUser) || null;                                                                     // 398
  this.existingComments = _.cloneDeep(existingComments) || [];                                                         // 399
  this.sections = [];                                                                                                  // 400
  this.activeSection = null;                                                                                           // 401
                                                                                                                       // 402
  // Event bindings                                                                                                    // 403
  this.eventPipe.on('showComments', _.bind(this.showComments, this));                                                  // 404
  this.eventPipe.on('hideComments', _.bind(this.hideComments, this));                                                  // 405
  this.eventPipe.on('sectionSelected', _.bind(this.sectionSelected, this));                                            // 406
  this.eventPipe.on('sectionDeselected', _.bind(this.sectionDeselected, this));                                        // 407
  this.eventPipe.on('commentPosted', _.bind(this.commentPosted, this));                                                // 408
  this.eventPipe.on('commentDeleted', _.bind(this.commentDeleted, this));                                              // 409
  this.eventPipe.on('addCommentAttempted', _.bind(this.addCommentAttempted, this));                                    // 410
  this.$body.on('click', _.bind(this.bodyClick, this));                                                                // 411
                                                                                                                       // 412
  this.initialize(this.existingComments);                                                                              // 413
}                                                                                                                      // 414
                                                                                                                       // 415
// Mix in Emitter                                                                                                      // 416
Emitter(SideComments.prototype);                                                                                       // 417
                                                                                                                       // 418
/**                                                                                                                    // 419
 * Adds the comments beside each commentable section.                                                                  // 420
 */                                                                                                                    // 421
SideComments.prototype.initialize = function( existingComments ) {                                                     // 422
  _.each(this.$el.find('.commentable-section'), function( section ){                                                   // 423
    var $section = $(section);                                                                                         // 424
    var sectionId = $section.data('section-id').toString();                                                            // 425
    var sectionComments = _.find(this.existingComments, { sectionId: sectionId });                                     // 426
                                                                                                                       // 427
    this.sections.push(new Section(this.eventPipe, $section, this.currentUser, sectionComments));                      // 428
  }, this);                                                                                                            // 429
};                                                                                                                     // 430
                                                                                                                       // 431
/**                                                                                                                    // 432
 * Shows the side comments.                                                                                            // 433
 */                                                                                                                    // 434
SideComments.prototype.showComments = function() {                                                                     // 435
  this.$el.addClass('side-comments-open');                                                                             // 436
};                                                                                                                     // 437
                                                                                                                       // 438
/**                                                                                                                    // 439
 * Hide the comments.                                                                                                  // 440
 */                                                                                                                    // 441
SideComments.prototype.hideComments = function() {                                                                     // 442
  if (this.activeSection) {                                                                                            // 443
    this.activeSection.deselect();                                                                                     // 444
    this.activeSection = null;                                                                                         // 445
  }                                                                                                                    // 446
                                                                                                                       // 447
  this.$el.removeClass('side-comments-open');                                                                          // 448
};                                                                                                                     // 449
                                                                                                                       // 450
/**                                                                                                                    // 451
 * Callback after a section has been selected.                                                                         // 452
 * @param  {Object} section The Section object to be selected.                                                         // 453
 */                                                                                                                    // 454
SideComments.prototype.sectionSelected = function( section ) {                                                         // 455
  this.showComments();                                                                                                 // 456
                                                                                                                       // 457
  if (this.activeSection) {                                                                                            // 458
    this.activeSection.deselect();                                                                                     // 459
  }                                                                                                                    // 460
                                                                                                                       // 461
  this.activeSection = section;                                                                                        // 462
};                                                                                                                     // 463
                                                                                                                       // 464
/**                                                                                                                    // 465
 * Callback after a section has been deselected.                                                                       // 466
 * @param  {Object} section The Section object to be selected.                                                         // 467
 */                                                                                                                    // 468
SideComments.prototype.sectionDeselected = function( section ) {                                                       // 469
  this.hideComments();                                                                                                 // 470
  this.activeSection = null;                                                                                           // 471
};                                                                                                                     // 472
                                                                                                                       // 473
/**                                                                                                                    // 474
 * Fired when the commentPosted event is triggered.                                                                    // 475
 * @param  {Object} comment  The comment object to be posted.                                                          // 476
 */                                                                                                                    // 477
SideComments.prototype.commentPosted = function( comment ) {                                                           // 478
  this.emit('commentPosted', comment);                                                                                 // 479
};                                                                                                                     // 480
                                                                                                                       // 481
/**                                                                                                                    // 482
 * Fired when the commentDeleted event is triggered.                                                                   // 483
 * @param  {Object} comment  The commentId of the deleted comment.                                                     // 484
 */                                                                                                                    // 485
SideComments.prototype.commentDeleted = function( comment ) {                                                          // 486
  this.emit('commentDeleted', comment);                                                                                // 487
};                                                                                                                     // 488
                                                                                                                       // 489
/**                                                                                                                    // 490
 * Fire an event to to signal that a comment as attempted to be added without                                          // 491
 * a currentUser.                                                                                                      // 492
 */                                                                                                                    // 493
SideComments.prototype.addCommentAttempted = function() {                                                              // 494
  this.emit('addCommentAttempted');                                                                                    // 495
};                                                                                                                     // 496
                                                                                                                       // 497
/**                                                                                                                    // 498
 * Inserts the given comment into the right section.                                                                   // 499
 * @param  {Object} comment A comment to be inserted.                                                                  // 500
 */                                                                                                                    // 501
SideComments.prototype.insertComment = function( comment ) {                                                           // 502
  var section = _.find(this.sections, { id: comment.sectionId });                                                      // 503
  section.insertComment(comment);                                                                                      // 504
};                                                                                                                     // 505
                                                                                                                       // 506
/**                                                                                                                    // 507
 * Removes the given comment from the right section.                                                                   // 508
 * @param sectionId The ID of the section where the comment exists.                                                    // 509
 * @param commentId The ID of the comment to be removed.                                                               // 510
 */                                                                                                                    // 511
SideComments.prototype.removeComment = function( sectionId, commentId ) {                                              // 512
  var section = _.find(this.sections, { id: sectionId });                                                              // 513
  section.removeComment(commentId);                                                                                    // 514
};                                                                                                                     // 515
                                                                                                                       // 516
/**                                                                                                                    // 517
 * Delete the comment specified by the given sectionID and commentID.                                                  // 518
 * @param sectionId The section the comment belongs to.                                                                // 519
 * @param commentId The comment's ID                                                                                   // 520
 */                                                                                                                    // 521
SideComments.prototype.deleteComment = function( sectionId, commentId ) {                                              // 522
  var section = _.find(this.sections, { id: sectionId });                                                              // 523
  section.deleteComment(commentId);                                                                                    // 524
};                                                                                                                     // 525
                                                                                                                       // 526
/**                                                                                                                    // 527
 * Checks if comments are visible or not.                                                                              // 528
 * @return {Boolean} Whether or not the comments are visible.                                                          // 529
 */                                                                                                                    // 530
SideComments.prototype.commentsAreVisible = function() {                                                               // 531
  return this.$el.hasClass('side-comments-open');                                                                      // 532
};                                                                                                                     // 533
                                                                                                                       // 534
/**                                                                                                                    // 535
 * Callback for body clicks. We hide the comments if someone clicks outside of the comments section.                   // 536
 * @param  {Object} event The event object.                                                                            // 537
 */                                                                                                                    // 538
SideComments.prototype.bodyClick = function( event ) {                                                                 // 539
  var $target = $(event.target);                                                                                       // 540
                                                                                                                       // 541
  // We do a check on $('body') existing here because if the $target has                                               // 542
  // no parent body then it's because it belongs to a deleted comment and                                              // 543
  // we should NOT hide the SideComments.                                                                              // 544
  if ($target.closest('.side-comment').length < 1 && $target.closest('body').length > 0) {                             // 545
    if (this.activeSection) {                                                                                          // 546
      this.activeSection.deselect();                                                                                   // 547
    }                                                                                                                  // 548
    this.hideComments();                                                                                               // 549
  }                                                                                                                    // 550
};                                                                                                                     // 551
                                                                                                                       // 552
/**                                                                                                                    // 553
 * Set the currentUser and update the UI as necessary.                                                                 // 554
 * @param {Object} currentUser The currentUser to be used.                                                             // 555
 */                                                                                                                    // 556
SideComments.prototype.setCurrentUser = function( currentUser ) {                                                      // 557
  this.hideComments();                                                                                                 // 558
  this.currentUser = currentUser;                                                                                      // 559
  _.each(this.sections, function( section ) {                                                                          // 560
    section.currentUser = this.currentUser;                                                                            // 561
    section.render();                                                                                                  // 562
  });                                                                                                                  // 563
};                                                                                                                     // 564
                                                                                                                       // 565
/**                                                                                                                    // 566
 * Remove the currentUser and update the UI as necessary.                                                              // 567
 */                                                                                                                    // 568
SideComments.prototype.removeCurrentUser = function() {                                                                // 569
  this.hideComments();                                                                                                 // 570
  this.currentUser = null;                                                                                             // 571
  _.each(this.sections, function( section ) {                                                                          // 572
    section.currentUser = null;                                                                                        // 573
    section.render();                                                                                                  // 574
  });                                                                                                                  // 575
};                                                                                                                     // 576
                                                                                                                       // 577
/**                                                                                                                    // 578
 * Destroys the instance of SideComments, including unbinding from DOM events.                                         // 579
 */                                                                                                                    // 580
SideComments.prototype.destroy = function() {                                                                          // 581
  this.hideComments();                                                                                                 // 582
  this.$el.off();                                                                                                      // 583
};                                                                                                                     // 584
                                                                                                                       // 585
module.exports = SideComments;                                                                                         // 586
});                                                                                                                    // 587
require.register("side-comments/js/section.js", function(exports, require, module){                                    // 588
var _ = require('./vendor/lodash-custom.js');                                                                          // 589
var Template = require('../templates/section.html');                                                                   // 590
var CommentTemplate = require('../templates/comment.html');                                                            // 591
                                                                                                                       // 592
/**                                                                                                                    // 593
 * Creates a new Section object, which is responsible for managing a                                                   // 594
 * single comment section.                                                                                             // 595
 * @param {Object} eventPipe The Emitter object used for passing around events.                                        // 596
 * @param {Array} comments   The array of comments for this section. Optional.                                         // 597
 */                                                                                                                    // 598
function Section( eventPipe, $el, currentUser, comments ) {                                                            // 599
	this.eventPipe = eventPipe;                                                                                           // 600
	this.$el = $el;                                                                                                       // 601
	this.comments = comments ? comments.comments : [];                                                                    // 602
	this.currentUser = currentUser || null;                                                                               // 603
                                                                                                                       // 604
	this.id = $el.data('section-id');                                                                                     // 605
                                                                                                                       // 606
	this.$el.on('click', '.side-comment .marker', _.bind(this.markerClick, this));                                        // 607
	this.$el.on('click', '.side-comment .add-comment', _.bind(this.addCommentClick, this));                               // 608
	this.$el.on('click', '.side-comment .post', _.bind(this.postCommentClick, this));                                     // 609
	this.$el.on('click', '.side-comment .cancel', _.bind(this.cancelCommentClick, this));                                 // 610
	this.$el.on('click', '.side-comment .delete', _.bind(this.deleteCommentClick, this));                                 // 611
                                                                                                                       // 612
	this.render();                                                                                                        // 613
}                                                                                                                      // 614
                                                                                                                       // 615
/**                                                                                                                    // 616
 * Click callback event on markers.                                                                                    // 617
 * @param  {Object} event The event object.                                                                            // 618
 */                                                                                                                    // 619
Section.prototype.markerClick = function( event ) {                                                                    // 620
	event.preventDefault();                                                                                               // 621
                                                                                                                       // 622
	if (this.isSelected()) {                                                                                              // 623
		this.deselect();                                                                                                     // 624
		this.eventPipe.emit('sectionDeselected', this);                                                                      // 625
	} else {                                                                                                              // 626
		this.select();                                                                                                       // 627
		this.eventPipe.emit('sectionSelected', this);                                                                        // 628
	}                                                                                                                     // 629
}                                                                                                                      // 630
                                                                                                                       // 631
/**                                                                                                                    // 632
 * Callback for the comment button click event.                                                                        // 633
 * @param {Object} event The event object.                                                                             // 634
 */                                                                                                                    // 635
Section.prototype.addCommentClick = function( event ) {                                                                // 636
  event.preventDefault();                                                                                              // 637
  if (this.currentUser) {                                                                                              // 638
  	this.showCommentForm();                                                                                             // 639
  } else {                                                                                                             // 640
  	this.eventPipe.emit('addCommentAttempted');                                                                         // 641
  }                                                                                                                    // 642
};                                                                                                                     // 643
                                                                                                                       // 644
/**                                                                                                                    // 645
 * Show the comment form for this section.                                                                             // 646
 */                                                                                                                    // 647
Section.prototype.showCommentForm = function() {                                                                       // 648
  if (this.comments.length > 0) {                                                                                      // 649
    this.$el.find('.add-comment').addClass('hide');                                                                    // 650
    this.$el.find('.comment-form').addClass('active');                                                                 // 651
  }                                                                                                                    // 652
                                                                                                                       // 653
  this.focusCommentBox();                                                                                              // 654
};                                                                                                                     // 655
                                                                                                                       // 656
/**                                                                                                                    // 657
 * Hides the comment form for this section.                                                                            // 658
 */                                                                                                                    // 659
Section.prototype.hideCommentForm = function() {                                                                       // 660
  if (this.comments.length > 0) {                                                                                      // 661
    this.$el.find('.add-comment').removeClass('hide');                                                                 // 662
    this.$el.find('.comment-form').removeClass('active');                                                              // 663
  }                                                                                                                    // 664
                                                                                                                       // 665
  this.$el.find('.comment-box').empty();                                                                               // 666
};                                                                                                                     // 667
                                                                                                                       // 668
/**                                                                                                                    // 669
 * Focus on the comment box in the comment form.                                                                       // 670
 */                                                                                                                    // 671
Section.prototype.focusCommentBox = function() {                                                                       // 672
	this.$el.find('.comment-box').get(0).focus();                                                                         // 673
};                                                                                                                     // 674
                                                                                                                       // 675
/**                                                                                                                    // 676
 * Cancel comment callback.                                                                                            // 677
 * @param  {Object} event The event object.                                                                            // 678
 */                                                                                                                    // 679
Section.prototype.cancelCommentClick = function( event ) {                                                             // 680
  event.preventDefault();                                                                                              // 681
  this.cancelComment();                                                                                                // 682
};                                                                                                                     // 683
                                                                                                                       // 684
/**                                                                                                                    // 685
 * Cancel adding of a comment.                                                                                         // 686
 */                                                                                                                    // 687
Section.prototype.cancelComment = function() {                                                                         // 688
  if (this.comments.length > 0) {                                                                                      // 689
    this.hideCommentForm();                                                                                            // 690
  } else {                                                                                                             // 691
  	this.deselect();                                                                                                    // 692
    this.eventPipe.emit('hideComments');                                                                               // 693
  }                                                                                                                    // 694
};                                                                                                                     // 695
                                                                                                                       // 696
/**                                                                                                                    // 697
 * Post comment callback.                                                                                              // 698
 * @param  {Object} event The event object.                                                                            // 699
 */                                                                                                                    // 700
Section.prototype.postCommentClick = function( event ) {                                                               // 701
  event.preventDefault();                                                                                              // 702
  this.postComment();                                                                                                  // 703
};                                                                                                                     // 704
                                                                                                                       // 705
/**                                                                                                                    // 706
 * Post a comment to this section.                                                                                     // 707
 */                                                                                                                    // 708
Section.prototype.postComment = function() {                                                                           // 709
	this.$el.find(".comment-box").children().not("br").each(function() {                                                  // 710
		$(this).replaceWith(this.innerHTML);                                                                                 // 711
	});                                                                                                                   // 712
  var commentBody = this.$el.find('.comment-box').html();                                                              // 713
  var comment = {                                                                                                      // 714
  	sectionId: this.id,                                                                                                 // 715
  	comment: commentBody,                                                                                               // 716
  	authorAvatarUrl: this.currentUser.avatarUrl,                                                                        // 717
  	authorName: this.currentUser.name,                                                                                  // 718
  	authorId: this.currentUser.id                                                                                       // 719
  };                                                                                                                   // 720
  this.eventPipe.emit('commentPosted', comment);                                                                       // 721
};                                                                                                                     // 722
                                                                                                                       // 723
/**                                                                                                                    // 724
 * Insert a comment into this sections comment list.                                                                   // 725
 * @param  {Object} comment A comment object.                                                                          // 726
 */                                                                                                                    // 727
Section.prototype.insertComment = function( comment ) {                                                                // 728
	this.comments.push(comment);                                                                                          // 729
	var newCommentHtml = _.template(CommentTemplate, {                                                                    // 730
		comment: comment,                                                                                                    // 731
		currentUser: this.currentUser                                                                                        // 732
	});                                                                                                                   // 733
	this.$el.find('.comments').append(newCommentHtml);                                                                    // 734
	this.$el.find('.side-comment').addClass('has-comments');                                                              // 735
	this.updateCommentCount();                                                                                            // 736
	this.hideCommentForm();                                                                                               // 737
};                                                                                                                     // 738
                                                                                                                       // 739
/**                                                                                                                    // 740
 * Increments the comment count for a given section.                                                                   // 741
 */                                                                                                                    // 742
Section.prototype.updateCommentCount = function() {                                                                    // 743
	this.$el.find('.marker span').text(this.comments.length);                                                             // 744
};                                                                                                                     // 745
                                                                                                                       // 746
/**                                                                                                                    // 747
 * Event handler for delete comment clicks.                                                                            // 748
 * @param  {Object} event The event object.                                                                            // 749
 */                                                                                                                    // 750
Section.prototype.deleteCommentClick = function( event ) {                                                             // 751
	event.preventDefault();                                                                                               // 752
	var commentId = $(event.target).closest('li').data('comment-id');                                                     // 753
                                                                                                                       // 754
	if (window.confirm("Are you sure you want to delete this comment?")) {                                                // 755
		this.deleteComment(commentId);                                                                                       // 756
	}                                                                                                                     // 757
};                                                                                                                     // 758
                                                                                                                       // 759
/**                                                                                                                    // 760
 * Finds the comment and emits an event with the comment to be deleted.                                                // 761
 */                                                                                                                    // 762
Section.prototype.deleteComment = function( commentId ) {                                                              // 763
	var comment = _.find(this.comments, { id: commentId });                                                               // 764
	comment.sectionId = this.id;                                                                                          // 765
	this.eventPipe.emit('commentDeleted', comment);                                                                       // 766
};                                                                                                                     // 767
                                                                                                                       // 768
/**                                                                                                                    // 769
 * Removes the comment from the list of comments and the comment array.                                                // 770
 * @param commentId The ID of the comment to be removed from this section.                                             // 771
 */                                                                                                                    // 772
Section.prototype.removeComment = function( commentId ) {                                                              // 773
	this.comments = _.reject(this.comments, { id: commentId });                                                           // 774
	this.$el.find('.side-comment .comments li[data-comment-id="'+commentId+'"]').remove();                                // 775
	this.updateCommentCount();                                                                                            // 776
	if (this.comments.length < 1) {                                                                                       // 777
		this.$el.find('.side-comment').removeClass('has-comments');                                                          // 778
	}                                                                                                                     // 779
};                                                                                                                     // 780
                                                                                                                       // 781
/**                                                                                                                    // 782
 * Mark this section as selected.                                                                                      // 783
 */                                                                                                                    // 784
Section.prototype.select = function() {                                                                                // 785
	this.$el.find('.side-comment').addClass('active');                                                                    // 786
                                                                                                                       // 787
	if (this.comments.length === 0 && this.currentUser) {                                                                 // 788
	  this.focusCommentBox();                                                                                             // 789
	}                                                                                                                     // 790
};                                                                                                                     // 791
                                                                                                                       // 792
/**                                                                                                                    // 793
 * Deselect this section.                                                                                              // 794
 */                                                                                                                    // 795
Section.prototype.deselect = function() {                                                                              // 796
	this.$el.find('.side-comment').removeClass('active');                                                                 // 797
	this.hideCommentForm();                                                                                               // 798
};                                                                                                                     // 799
                                                                                                                       // 800
Section.prototype.isSelected = function() {                                                                            // 801
	return this.$el.find('.side-comment').hasClass('active');                                                             // 802
};                                                                                                                     // 803
                                                                                                                       // 804
/**                                                                                                                    // 805
 * Get the class to be used on the side comment section wrapper.                                                       // 806
 * @return {String} The class names to use.                                                                            // 807
 */                                                                                                                    // 808
Section.prototype.sectionClasses = function() {                                                                        // 809
	var classes = '';                                                                                                     // 810
                                                                                                                       // 811
	if (this.comments.length > 0) {                                                                                       // 812
		classes = classes + ' has-comments';                                                                                 // 813
	}                                                                                                                     // 814
	if (!this.currentUser) {                                                                                              // 815
		classes = classes + ' no-current-user'                                                                               // 816
	}                                                                                                                     // 817
                                                                                                                       // 818
	return classes;                                                                                                       // 819
};                                                                                                                     // 820
                                                                                                                       // 821
/**                                                                                                                    // 822
 * Render this section into the DOM.                                                                                   // 823
 */                                                                                                                    // 824
Section.prototype.render = function() {                                                                                // 825
	this.$el.find('.side-comment').remove();                                                                              // 826
	$(_.template(Template, {                                                                                              // 827
	  commentTemplate: CommentTemplate,                                                                                   // 828
	  comments: this.comments,                                                                                            // 829
	  sectionClasses: this.sectionClasses(),                                                                              // 830
	  currentUser: this.currentUser                                                                                       // 831
	})).appendTo(this.$el);                                                                                               // 832
};                                                                                                                     // 833
                                                                                                                       // 834
/**                                                                                                                    // 835
 * Desttroy this Section object. Generally meaning unbind events.                                                      // 836
 */                                                                                                                    // 837
Section.prototype.destroy = function() {                                                                               // 838
	this.$el.off();                                                                                                       // 839
}                                                                                                                      // 840
                                                                                                                       // 841
module.exports = Section;                                                                                              // 842
});                                                                                                                    // 843
require.register("side-comments/js/vendor/lodash-custom.js", function(exports, require, module){                       // 844
/**                                                                                                                    // 845
 * @license                                                                                                            // 846
 * Lo-Dash 2.4.1 (Custom Build) <http://lodash.com/>                                                                   // 847
 * Build: `lodash exports="node,commonjs" include="each,bind,find,template,reject,clone,cloneDeep"`                    // 848
 * Copyright 2012-2013 The Dojo Foundation <http://dojofoundation.org/>                                                // 849
 * Based on Underscore.js 1.5.2 <http://underscorejs.org/LICENSE>                                                      // 850
 * Copyright 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors                            // 851
 * Available under MIT license <http://lodash.com/license>                                                             // 852
 */                                                                                                                    // 853
;(function() {                                                                                                         // 854
                                                                                                                       // 855
  /** Used as a safe reference for `undefined` in pre ES5 environments */                                              // 856
  var undefined;                                                                                                       // 857
                                                                                                                       // 858
  /** Used to pool arrays and objects used internally */                                                               // 859
  var arrayPool = [];                                                                                                  // 860
                                                                                                                       // 861
  /** Used internally to indicate various things */                                                                    // 862
  var indicatorObject = {};                                                                                            // 863
                                                                                                                       // 864
  /** Used as the max size of the `arrayPool` and `objectPool` */                                                      // 865
  var maxPoolSize = 40;                                                                                                // 866
                                                                                                                       // 867
  /** Used to match empty string literals in compiled template source */                                               // 868
  var reEmptyStringLeading = /\b__p \+= '';/g,                                                                         // 869
      reEmptyStringMiddle = /\b(__p \+=) '' \+/g,                                                                      // 870
      reEmptyStringTrailing = /(__e\(.*?\)|\b__t\)) \+\n'';/g;                                                         // 871
                                                                                                                       // 872
  /**                                                                                                                  // 873
   * Used to match ES6 template delimiters                                                                             // 874
   * http://people.mozilla.org/~jorendorff/es6-draft.html#sec-literals-string-literals                                 // 875
   */                                                                                                                  // 876
  var reEsTemplate = /\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;                                                                // 877
                                                                                                                       // 878
  /** Used to match regexp flags from their coerced string values */                                                   // 879
  var reFlags = /\w*$/;                                                                                                // 880
                                                                                                                       // 881
  /** Used to detected named functions */                                                                              // 882
  var reFuncName = /^\s*function[ \n\r\t]+\w/;                                                                         // 883
                                                                                                                       // 884
  /** Used to match "interpolate" template delimiters */                                                               // 885
  var reInterpolate = /<%=([\s\S]+?)%>/g;                                                                              // 886
                                                                                                                       // 887
  /** Used to ensure capturing order of template delimiters */                                                         // 888
  var reNoMatch = /($^)/;                                                                                              // 889
                                                                                                                       // 890
  /** Used to detect functions containing a `this` reference */                                                        // 891
  var reThis = /\bthis\b/;                                                                                             // 892
                                                                                                                       // 893
  /** Used to match unescaped characters in compiled string literals */                                                // 894
  var reUnescapedString = /['\n\r\t\u2028\u2029\\]/g;                                                                  // 895
                                                                                                                       // 896
  /** Used to fix the JScript [[DontEnum]] bug */                                                                      // 897
  var shadowedProps = [                                                                                                // 898
    'constructor', 'hasOwnProperty', 'isPrototypeOf', 'propertyIsEnumerable',                                          // 899
    'toLocaleString', 'toString', 'valueOf'                                                                            // 900
  ];                                                                                                                   // 901
                                                                                                                       // 902
  /** Used to make template sourceURLs easier to identify */                                                           // 903
  var templateCounter = 0;                                                                                             // 904
                                                                                                                       // 905
  /** `Object#toString` result shortcuts */                                                                            // 906
  var argsClass = '[object Arguments]',                                                                                // 907
      arrayClass = '[object Array]',                                                                                   // 908
      boolClass = '[object Boolean]',                                                                                  // 909
      dateClass = '[object Date]',                                                                                     // 910
      errorClass = '[object Error]',                                                                                   // 911
      funcClass = '[object Function]',                                                                                 // 912
      numberClass = '[object Number]',                                                                                 // 913
      objectClass = '[object Object]',                                                                                 // 914
      regexpClass = '[object RegExp]',                                                                                 // 915
      stringClass = '[object String]';                                                                                 // 916
                                                                                                                       // 917
  /** Used to identify object classifications that `_.clone` supports */                                               // 918
  var cloneableClasses = {};                                                                                           // 919
  cloneableClasses[funcClass] = false;                                                                                 // 920
  cloneableClasses[argsClass] = cloneableClasses[arrayClass] =                                                         // 921
  cloneableClasses[boolClass] = cloneableClasses[dateClass] =                                                          // 922
  cloneableClasses[numberClass] = cloneableClasses[objectClass] =                                                      // 923
  cloneableClasses[regexpClass] = cloneableClasses[stringClass] = true;                                                // 924
                                                                                                                       // 925
  /** Used as the property descriptor for `__bindData__` */                                                            // 926
  var descriptor = {                                                                                                   // 927
    'configurable': false,                                                                                             // 928
    'enumerable': false,                                                                                               // 929
    'value': null,                                                                                                     // 930
    'writable': false                                                                                                  // 931
  };                                                                                                                   // 932
                                                                                                                       // 933
  /** Used as the data object for `iteratorTemplate` */                                                                // 934
  var iteratorData = {                                                                                                 // 935
    'args': '',                                                                                                        // 936
    'array': null,                                                                                                     // 937
    'bottom': '',                                                                                                      // 938
    'firstArg': '',                                                                                                    // 939
    'init': '',                                                                                                        // 940
    'keys': null,                                                                                                      // 941
    'loop': '',                                                                                                        // 942
    'shadowedProps': null,                                                                                             // 943
    'support': null,                                                                                                   // 944
    'top': '',                                                                                                         // 945
    'useHas': false                                                                                                    // 946
  };                                                                                                                   // 947
                                                                                                                       // 948
  /** Used to determine if values are of the language type Object */                                                   // 949
  var objectTypes = {                                                                                                  // 950
    'boolean': false,                                                                                                  // 951
    'function': true,                                                                                                  // 952
    'object': true,                                                                                                    // 953
    'number': false,                                                                                                   // 954
    'string': false,                                                                                                   // 955
    'undefined': false                                                                                                 // 956
  };                                                                                                                   // 957
                                                                                                                       // 958
  /** Used to escape characters for inclusion in compiled string literals */                                           // 959
  var stringEscapes = {                                                                                                // 960
    '\\': '\\',                                                                                                        // 961
    "'": "'",                                                                                                          // 962
    '\n': 'n',                                                                                                         // 963
    '\r': 'r',                                                                                                         // 964
    '\t': 't',                                                                                                         // 965
    '\u2028': 'u2028',                                                                                                 // 966
    '\u2029': 'u2029'                                                                                                  // 967
  };                                                                                                                   // 968
                                                                                                                       // 969
  /** Used as a reference to the global object */                                                                      // 970
  var root = (objectTypes[typeof window] && window) || this;                                                           // 971
                                                                                                                       // 972
  /** Detect free variable `exports` */                                                                                // 973
  var freeExports = objectTypes[typeof exports] && exports && !exports.nodeType && exports;                            // 974
                                                                                                                       // 975
  /** Detect free variable `module` */                                                                                 // 976
  var freeModule = objectTypes[typeof module] && module && !module.nodeType && module;                                 // 977
                                                                                                                       // 978
  /** Detect the popular CommonJS extension `module.exports` */                                                        // 979
  var moduleExports = freeModule && freeModule.exports === freeExports && freeExports;                                 // 980
                                                                                                                       // 981
  /** Detect free variable `global` from Node.js or Browserified code and use it as `root` */                          // 982
  var freeGlobal = objectTypes[typeof global] && global;                                                               // 983
  if (freeGlobal && (freeGlobal.global === freeGlobal || freeGlobal.window === freeGlobal)) {                          // 984
    root = freeGlobal;                                                                                                 // 985
  }                                                                                                                    // 986
                                                                                                                       // 987
  /*--------------------------------------------------------------------------*/                                       // 988
                                                                                                                       // 989
  /**                                                                                                                  // 990
   * Used by `template` to escape characters for inclusion in compiled                                                 // 991
   * string literals.                                                                                                  // 992
   *                                                                                                                   // 993
   * @private                                                                                                          // 994
   * @param {string} match The matched character to escape.                                                            // 995
   * @returns {string} Returns the escaped character.                                                                  // 996
   */                                                                                                                  // 997
  function escapeStringChar(match) {                                                                                   // 998
    return '\\' + stringEscapes[match];                                                                                // 999
  }                                                                                                                    // 1000
                                                                                                                       // 1001
  /**                                                                                                                  // 1002
   * Gets an array from the array pool or creates a new one if the pool is empty.                                      // 1003
   *                                                                                                                   // 1004
   * @private                                                                                                          // 1005
   * @returns {Array} The array from the pool.                                                                         // 1006
   */                                                                                                                  // 1007
  function getArray() {                                                                                                // 1008
    return arrayPool.pop() || [];                                                                                      // 1009
  }                                                                                                                    // 1010
                                                                                                                       // 1011
  /**                                                                                                                  // 1012
   * Checks if `value` is a DOM node in IE < 9.                                                                        // 1013
   *                                                                                                                   // 1014
   * @private                                                                                                          // 1015
   * @param {*} value The value to check.                                                                              // 1016
   * @returns {boolean} Returns `true` if the `value` is a DOM node, else `false`.                                     // 1017
   */                                                                                                                  // 1018
  function isNode(value) {                                                                                             // 1019
    // IE < 9 presents DOM nodes as `Object` objects except they have `toString`                                       // 1020
    // methods that are `typeof` "string" and still can coerce nodes to strings                                        // 1021
    return typeof value.toString != 'function' && typeof (value + '') == 'string';                                     // 1022
  }                                                                                                                    // 1023
                                                                                                                       // 1024
  /**                                                                                                                  // 1025
   * Releases the given array back to the array pool.                                                                  // 1026
   *                                                                                                                   // 1027
   * @private                                                                                                          // 1028
   * @param {Array} [array] The array to release.                                                                      // 1029
   */                                                                                                                  // 1030
  function releaseArray(array) {                                                                                       // 1031
    array.length = 0;                                                                                                  // 1032
    if (arrayPool.length < maxPoolSize) {                                                                              // 1033
      arrayPool.push(array);                                                                                           // 1034
    }                                                                                                                  // 1035
  }                                                                                                                    // 1036
                                                                                                                       // 1037
  /**                                                                                                                  // 1038
   * Slices the `collection` from the `start` index up to, but not including,                                          // 1039
   * the `end` index.                                                                                                  // 1040
   *                                                                                                                   // 1041
   * Note: This function is used instead of `Array#slice` to support node lists                                        // 1042
   * in IE < 9 and to ensure dense arrays are returned.                                                                // 1043
   *                                                                                                                   // 1044
   * @private                                                                                                          // 1045
   * @param {Array|Object|string} collection The collection to slice.                                                  // 1046
   * @param {number} start The start index.                                                                            // 1047
   * @param {number} end The end index.                                                                                // 1048
   * @returns {Array} Returns the new array.                                                                           // 1049
   */                                                                                                                  // 1050
  function slice(array, start, end) {                                                                                  // 1051
    start || (start = 0);                                                                                              // 1052
    if (typeof end == 'undefined') {                                                                                   // 1053
      end = array ? array.length : 0;                                                                                  // 1054
    }                                                                                                                  // 1055
    var index = -1,                                                                                                    // 1056
        length = end - start || 0,                                                                                     // 1057
        result = Array(length < 0 ? 0 : length);                                                                       // 1058
                                                                                                                       // 1059
    while (++index < length) {                                                                                         // 1060
      result[index] = array[start + index];                                                                            // 1061
    }                                                                                                                  // 1062
    return result;                                                                                                     // 1063
  }                                                                                                                    // 1064
                                                                                                                       // 1065
  /*--------------------------------------------------------------------------*/                                       // 1066
                                                                                                                       // 1067
  /**                                                                                                                  // 1068
   * Used for `Array` method references.                                                                               // 1069
   *                                                                                                                   // 1070
   * Normally `Array.prototype` would suffice, however, using an array literal                                         // 1071
   * avoids issues in Narwhal.                                                                                         // 1072
   */                                                                                                                  // 1073
  var arrayRef = [];                                                                                                   // 1074
                                                                                                                       // 1075
  /** Used for native method references */                                                                             // 1076
  var errorProto = Error.prototype,                                                                                    // 1077
      objectProto = Object.prototype,                                                                                  // 1078
      stringProto = String.prototype;                                                                                  // 1079
                                                                                                                       // 1080
  /** Used to resolve the internal [[Class]] of values */                                                              // 1081
  var toString = objectProto.toString;                                                                                 // 1082
                                                                                                                       // 1083
  /** Used to detect if a method is native */                                                                          // 1084
  var reNative = RegExp('^' +                                                                                          // 1085
    String(toString)                                                                                                   // 1086
      .replace(/[.*+?^${}()|[\]\\]/g, '\\$&')                                                                          // 1087
      .replace(/toString| for [^\]]+/g, '.*?') + '$'                                                                   // 1088
  );                                                                                                                   // 1089
                                                                                                                       // 1090
  /** Native method shortcuts */                                                                                       // 1091
  var fnToString = Function.prototype.toString,                                                                        // 1092
      hasOwnProperty = objectProto.hasOwnProperty,                                                                     // 1093
      push = arrayRef.push,                                                                                            // 1094
      propertyIsEnumerable = objectProto.propertyIsEnumerable,                                                         // 1095
      unshift = arrayRef.unshift;                                                                                      // 1096
                                                                                                                       // 1097
  /** Used to set meta data on functions */                                                                            // 1098
  var defineProperty = (function() {                                                                                   // 1099
    // IE 8 only accepts DOM elements                                                                                  // 1100
    try {                                                                                                              // 1101
      var o = {},                                                                                                      // 1102
          func = isNative(func = Object.defineProperty) && func,                                                       // 1103
          result = func(o, o, o) && func;                                                                              // 1104
    } catch(e) { }                                                                                                     // 1105
    return result;                                                                                                     // 1106
  }());                                                                                                                // 1107
                                                                                                                       // 1108
  /* Native method shortcuts for methods with the same name as other `lodash` methods */                               // 1109
  var nativeCreate = isNative(nativeCreate = Object.create) && nativeCreate,                                           // 1110
      nativeIsArray = isNative(nativeIsArray = Array.isArray) && nativeIsArray,                                        // 1111
      nativeKeys = isNative(nativeKeys = Object.keys) && nativeKeys;                                                   // 1112
                                                                                                                       // 1113
  /** Used to lookup a built-in constructor by [[Class]] */                                                            // 1114
  var ctorByClass = {};                                                                                                // 1115
  ctorByClass[arrayClass] = Array;                                                                                     // 1116
  ctorByClass[boolClass] = Boolean;                                                                                    // 1117
  ctorByClass[dateClass] = Date;                                                                                       // 1118
  ctorByClass[funcClass] = Function;                                                                                   // 1119
  ctorByClass[objectClass] = Object;                                                                                   // 1120
  ctorByClass[numberClass] = Number;                                                                                   // 1121
  ctorByClass[regexpClass] = RegExp;                                                                                   // 1122
  ctorByClass[stringClass] = String;                                                                                   // 1123
                                                                                                                       // 1124
  /** Used to avoid iterating non-enumerable properties in IE < 9 */                                                   // 1125
  var nonEnumProps = {};                                                                                               // 1126
  nonEnumProps[arrayClass] = nonEnumProps[dateClass] = nonEnumProps[numberClass] = { 'constructor': true, 'toLocaleString': true, 'toString': true, 'valueOf': true };
  nonEnumProps[boolClass] = nonEnumProps[stringClass] = { 'constructor': true, 'toString': true, 'valueOf': true };    // 1128
  nonEnumProps[errorClass] = nonEnumProps[funcClass] = nonEnumProps[regexpClass] = { 'constructor': true, 'toString': true };
  nonEnumProps[objectClass] = { 'constructor': true };                                                                 // 1130
                                                                                                                       // 1131
  (function() {                                                                                                        // 1132
    var length = shadowedProps.length;                                                                                 // 1133
    while (length--) {                                                                                                 // 1134
      var key = shadowedProps[length];                                                                                 // 1135
      for (var className in nonEnumProps) {                                                                            // 1136
        if (hasOwnProperty.call(nonEnumProps, className) && !hasOwnProperty.call(nonEnumProps[className], key)) {      // 1137
          nonEnumProps[className][key] = false;                                                                        // 1138
        }                                                                                                              // 1139
      }                                                                                                                // 1140
    }                                                                                                                  // 1141
  }());                                                                                                                // 1142
                                                                                                                       // 1143
  /*--------------------------------------------------------------------------*/                                       // 1144
                                                                                                                       // 1145
  /**                                                                                                                  // 1146
   * Creates a `lodash` object which wraps the given value to enable intuitive                                         // 1147
   * method chaining.                                                                                                  // 1148
   *                                                                                                                   // 1149
   * In addition to Lo-Dash methods, wrappers also have the following `Array` methods:                                 // 1150
   * `concat`, `join`, `pop`, `push`, `reverse`, `shift`, `slice`, `sort`, `splice`,                                   // 1151
   * and `unshift`                                                                                                     // 1152
   *                                                                                                                   // 1153
   * Chaining is supported in custom builds as long as the `value` method is                                           // 1154
   * implicitly or explicitly included in the build.                                                                   // 1155
   *                                                                                                                   // 1156
   * The chainable wrapper functions are:                                                                              // 1157
   * `after`, `assign`, `bind`, `bindAll`, `bindKey`, `chain`, `compact`,                                              // 1158
   * `compose`, `concat`, `countBy`, `create`, `createCallback`, `curry`,                                              // 1159
   * `debounce`, `defaults`, `defer`, `delay`, `difference`, `filter`, `flatten`,                                      // 1160
   * `forEach`, `forEachRight`, `forIn`, `forInRight`, `forOwn`, `forOwnRight`,                                        // 1161
   * `functions`, `groupBy`, `indexBy`, `initial`, `intersection`, `invert`,                                           // 1162
   * `invoke`, `keys`, `map`, `max`, `memoize`, `merge`, `min`, `object`, `omit`,                                      // 1163
   * `once`, `pairs`, `partial`, `partialRight`, `pick`, `pluck`, `pull`, `push`,                                      // 1164
   * `range`, `reject`, `remove`, `rest`, `reverse`, `shuffle`, `slice`, `sort`,                                       // 1165
   * `sortBy`, `splice`, `tap`, `throttle`, `times`, `toArray`, `transform`,                                           // 1166
   * `union`, `uniq`, `unshift`, `unzip`, `values`, `where`, `without`, `wrap`,                                        // 1167
   * and `zip`                                                                                                         // 1168
   *                                                                                                                   // 1169
   * The non-chainable wrapper functions are:                                                                          // 1170
   * `clone`, `cloneDeep`, `contains`, `escape`, `every`, `find`, `findIndex`,                                         // 1171
   * `findKey`, `findLast`, `findLastIndex`, `findLastKey`, `has`, `identity`,                                         // 1172
   * `indexOf`, `isArguments`, `isArray`, `isBoolean`, `isDate`, `isElement`,                                          // 1173
   * `isEmpty`, `isEqual`, `isFinite`, `isFunction`, `isNaN`, `isNull`, `isNumber`,                                    // 1174
   * `isObject`, `isPlainObject`, `isRegExp`, `isString`, `isUndefined`, `join`,                                       // 1175
   * `lastIndexOf`, `mixin`, `noConflict`, `parseInt`, `pop`, `random`, `reduce`,                                      // 1176
   * `reduceRight`, `result`, `shift`, `size`, `some`, `sortedIndex`, `runInContext`,                                  // 1177
   * `template`, `unescape`, `uniqueId`, and `value`                                                                   // 1178
   *                                                                                                                   // 1179
   * The wrapper functions `first` and `last` return wrapped values when `n` is                                        // 1180
   * provided, otherwise they return unwrapped values.                                                                 // 1181
   *                                                                                                                   // 1182
   * Explicit chaining can be enabled by using the `_.chain` method.                                                   // 1183
   *                                                                                                                   // 1184
   * @name _                                                                                                           // 1185
   * @constructor                                                                                                      // 1186
   * @category Chaining                                                                                                // 1187
   * @param {*} value The value to wrap in a `lodash` instance.                                                        // 1188
   * @returns {Object} Returns a `lodash` instance.                                                                    // 1189
   * @example                                                                                                          // 1190
   *                                                                                                                   // 1191
   * var wrapped = _([1, 2, 3]);                                                                                       // 1192
   *                                                                                                                   // 1193
   * // returns an unwrapped value                                                                                     // 1194
   * wrapped.reduce(function(sum, num) {                                                                               // 1195
   *   return sum + num;                                                                                               // 1196
   * });                                                                                                               // 1197
   * // => 6                                                                                                           // 1198
   *                                                                                                                   // 1199
   * // returns a wrapped value                                                                                        // 1200
   * var squares = wrapped.map(function(num) {                                                                         // 1201
   *   return num * num;                                                                                               // 1202
   * });                                                                                                               // 1203
   *                                                                                                                   // 1204
   * _.isArray(squares);                                                                                               // 1205
   * // => false                                                                                                       // 1206
   *                                                                                                                   // 1207
   * _.isArray(squares.value());                                                                                       // 1208
   * // => true                                                                                                        // 1209
   */                                                                                                                  // 1210
  function lodash() {                                                                                                  // 1211
    // no operation performed                                                                                          // 1212
  }                                                                                                                    // 1213
                                                                                                                       // 1214
  /**                                                                                                                  // 1215
   * An object used to flag environments features.                                                                     // 1216
   *                                                                                                                   // 1217
   * @static                                                                                                           // 1218
   * @memberOf _                                                                                                       // 1219
   * @type Object                                                                                                      // 1220
   */                                                                                                                  // 1221
  var support = lodash.support = {};                                                                                   // 1222
                                                                                                                       // 1223
  (function() {                                                                                                        // 1224
    var ctor = function() { this.x = 1; },                                                                             // 1225
        object = { '0': 1, 'length': 1 },                                                                              // 1226
        props = [];                                                                                                    // 1227
                                                                                                                       // 1228
    ctor.prototype = { 'valueOf': 1, 'y': 1 };                                                                         // 1229
    for (var key in new ctor) { props.push(key); }                                                                     // 1230
    for (key in arguments) { }                                                                                         // 1231
                                                                                                                       // 1232
    /**                                                                                                                // 1233
     * Detect if an `arguments` object's [[Class]] is resolvable (all but Firefox < 4, IE < 9).                        // 1234
     *                                                                                                                 // 1235
     * @memberOf _.support                                                                                             // 1236
     * @type boolean                                                                                                   // 1237
     */                                                                                                                // 1238
    support.argsClass = toString.call(arguments) == argsClass;                                                         // 1239
                                                                                                                       // 1240
    /**                                                                                                                // 1241
     * Detect if `arguments` objects are `Object` objects (all but Narwhal and Opera < 10.5).                          // 1242
     *                                                                                                                 // 1243
     * @memberOf _.support                                                                                             // 1244
     * @type boolean                                                                                                   // 1245
     */                                                                                                                // 1246
    support.argsObject = arguments.constructor == Object && !(arguments instanceof Array);                             // 1247
                                                                                                                       // 1248
    /**                                                                                                                // 1249
     * Detect if `name` or `message` properties of `Error.prototype` are                                               // 1250
     * enumerable by default. (IE < 9, Safari < 5.1)                                                                   // 1251
     *                                                                                                                 // 1252
     * @memberOf _.support                                                                                             // 1253
     * @type boolean                                                                                                   // 1254
     */                                                                                                                // 1255
    support.enumErrorProps = propertyIsEnumerable.call(errorProto, 'message') || propertyIsEnumerable.call(errorProto, 'name');
                                                                                                                       // 1257
    /**                                                                                                                // 1258
     * Detect if `prototype` properties are enumerable by default.                                                     // 1259
     *                                                                                                                 // 1260
     * Firefox < 3.6, Opera > 9.50 - Opera < 11.60, and Safari < 5.1                                                   // 1261
     * (if the prototype or a property on the prototype has been set)                                                  // 1262
     * incorrectly sets a function's `prototype` property [[Enumerable]]                                               // 1263
     * value to `true`.                                                                                                // 1264
     *                                                                                                                 // 1265
     * @memberOf _.support                                                                                             // 1266
     * @type boolean                                                                                                   // 1267
     */                                                                                                                // 1268
    support.enumPrototypes = propertyIsEnumerable.call(ctor, 'prototype');                                             // 1269
                                                                                                                       // 1270
    /**                                                                                                                // 1271
     * Detect if functions can be decompiled by `Function#toString`                                                    // 1272
     * (all but PS3 and older Opera mobile browsers & avoided in Windows 8 apps).                                      // 1273
     *                                                                                                                 // 1274
     * @memberOf _.support                                                                                             // 1275
     * @type boolean                                                                                                   // 1276
     */                                                                                                                // 1277
    support.funcDecomp = !isNative(root.WinRTError) && reThis.test(function() { return this; });                       // 1278
                                                                                                                       // 1279
    /**                                                                                                                // 1280
     * Detect if `Function#name` is supported (all but IE).                                                            // 1281
     *                                                                                                                 // 1282
     * @memberOf _.support                                                                                             // 1283
     * @type boolean                                                                                                   // 1284
     */                                                                                                                // 1285
    support.funcNames = typeof Function.name == 'string';                                                              // 1286
                                                                                                                       // 1287
    /**                                                                                                                // 1288
     * Detect if `arguments` object indexes are non-enumerable                                                         // 1289
     * (Firefox < 4, IE < 9, PhantomJS, Safari < 5.1).                                                                 // 1290
     *                                                                                                                 // 1291
     * @memberOf _.support                                                                                             // 1292
     * @type boolean                                                                                                   // 1293
     */                                                                                                                // 1294
    support.nonEnumArgs = key != 0;                                                                                    // 1295
                                                                                                                       // 1296
    /**                                                                                                                // 1297
     * Detect if properties shadowing those on `Object.prototype` are non-enumerable.                                  // 1298
     *                                                                                                                 // 1299
     * In IE < 9 an objects own properties, shadowing non-enumerable ones, are                                         // 1300
     * made non-enumerable as well (a.k.a the JScript [[DontEnum]] bug).                                               // 1301
     *                                                                                                                 // 1302
     * @memberOf _.support                                                                                             // 1303
     * @type boolean                                                                                                   // 1304
     */                                                                                                                // 1305
    support.nonEnumShadows = !/valueOf/.test(props);                                                                   // 1306
                                                                                                                       // 1307
    /**                                                                                                                // 1308
     * Detect if `Array#shift` and `Array#splice` augment array-like objects correctly.                                // 1309
     *                                                                                                                 // 1310
     * Firefox < 10, IE compatibility mode, and IE < 9 have buggy Array `shift()`                                      // 1311
     * and `splice()` functions that fail to remove the last element, `value[0]`,                                      // 1312
     * of array-like objects even though the `length` property is set to `0`.                                          // 1313
     * The `shift()` method is buggy in IE 8 compatibility mode, while `splice()`                                      // 1314
     * is buggy regardless of mode in IE < 9 and buggy in compatibility mode in IE 9.                                  // 1315
     *                                                                                                                 // 1316
     * @memberOf _.support                                                                                             // 1317
     * @type boolean                                                                                                   // 1318
     */                                                                                                                // 1319
    support.spliceObjects = (arrayRef.splice.call(object, 0, 1), !object[0]);                                          // 1320
                                                                                                                       // 1321
    /**                                                                                                                // 1322
     * Detect lack of support for accessing string characters by index.                                                // 1323
     *                                                                                                                 // 1324
     * IE < 8 can't access characters by index and IE 8 can only access                                                // 1325
     * characters by index on string literals.                                                                         // 1326
     *                                                                                                                 // 1327
     * @memberOf _.support                                                                                             // 1328
     * @type boolean                                                                                                   // 1329
     */                                                                                                                // 1330
    support.unindexedChars = ('x'[0] + Object('x')[0]) != 'xx';                                                        // 1331
                                                                                                                       // 1332
    /**                                                                                                                // 1333
     * Detect if a DOM node's [[Class]] is resolvable (all but IE < 9)                                                 // 1334
     * and that the JS engine errors when attempting to coerce an object to                                            // 1335
     * a string without a `toString` function.                                                                         // 1336
     *                                                                                                                 // 1337
     * @memberOf _.support                                                                                             // 1338
     * @type boolean                                                                                                   // 1339
     */                                                                                                                // 1340
    try {                                                                                                              // 1341
      support.nodeClass = !(toString.call(document) == objectClass && !({ 'toString': 0 } + ''));                      // 1342
    } catch(e) {                                                                                                       // 1343
      support.nodeClass = true;                                                                                        // 1344
    }                                                                                                                  // 1345
  }(1));                                                                                                               // 1346
                                                                                                                       // 1347
  /**                                                                                                                  // 1348
   * By default, the template delimiters used by Lo-Dash are similar to those in                                       // 1349
   * embedded Ruby (ERB). Change the following template settings to use alternative                                    // 1350
   * delimiters.                                                                                                       // 1351
   *                                                                                                                   // 1352
   * @static                                                                                                           // 1353
   * @memberOf _                                                                                                       // 1354
   * @type Object                                                                                                      // 1355
   */                                                                                                                  // 1356
  lodash.templateSettings = {                                                                                          // 1357
                                                                                                                       // 1358
    /**                                                                                                                // 1359
     * Used to detect `data` property values to be HTML-escaped.                                                       // 1360
     *                                                                                                                 // 1361
     * @memberOf _.templateSettings                                                                                    // 1362
     * @type RegExp                                                                                                    // 1363
     */                                                                                                                // 1364
    'escape': /<%-([\s\S]+?)%>/g,                                                                                      // 1365
                                                                                                                       // 1366
    /**                                                                                                                // 1367
     * Used to detect code to be evaluated.                                                                            // 1368
     *                                                                                                                 // 1369
     * @memberOf _.templateSettings                                                                                    // 1370
     * @type RegExp                                                                                                    // 1371
     */                                                                                                                // 1372
    'evaluate': /<%([\s\S]+?)%>/g,                                                                                     // 1373
                                                                                                                       // 1374
    /**                                                                                                                // 1375
     * Used to detect `data` property values to inject.                                                                // 1376
     *                                                                                                                 // 1377
     * @memberOf _.templateSettings                                                                                    // 1378
     * @type RegExp                                                                                                    // 1379
     */                                                                                                                // 1380
    'interpolate': reInterpolate,                                                                                      // 1381
                                                                                                                       // 1382
    /**                                                                                                                // 1383
     * Used to reference the data object in the template text.                                                         // 1384
     *                                                                                                                 // 1385
     * @memberOf _.templateSettings                                                                                    // 1386
     * @type string                                                                                                    // 1387
     */                                                                                                                // 1388
    'variable': '',                                                                                                    // 1389
                                                                                                                       // 1390
    /**                                                                                                                // 1391
     * Used to import variables into the compiled template.                                                            // 1392
     *                                                                                                                 // 1393
     * @memberOf _.templateSettings                                                                                    // 1394
     * @type Object                                                                                                    // 1395
     */                                                                                                                // 1396
    'imports': {                                                                                                       // 1397
                                                                                                                       // 1398
      /**                                                                                                              // 1399
       * A reference to the `lodash` function.                                                                         // 1400
       *                                                                                                               // 1401
       * @memberOf _.templateSettings.imports                                                                          // 1402
       * @type Function                                                                                                // 1403
       */                                                                                                              // 1404
      '_': lodash                                                                                                      // 1405
    }                                                                                                                  // 1406
  };                                                                                                                   // 1407
                                                                                                                       // 1408
  /*--------------------------------------------------------------------------*/                                       // 1409
                                                                                                                       // 1410
  /**                                                                                                                  // 1411
   * The template used to create iterator functions.                                                                   // 1412
   *                                                                                                                   // 1413
   * @private                                                                                                          // 1414
   * @param {Object} data The data object used to populate the text.                                                   // 1415
   * @returns {string} Returns the interpolated text.                                                                  // 1416
   */                                                                                                                  // 1417
  var iteratorTemplate = function(obj) {                                                                               // 1418
                                                                                                                       // 1419
    var __p = 'var index, iterable = ' +                                                                               // 1420
    (obj.firstArg) +                                                                                                   // 1421
    ', result = ' +                                                                                                    // 1422
    (obj.init) +                                                                                                       // 1423
    ';\nif (!iterable) return result;\n' +                                                                             // 1424
    (obj.top) +                                                                                                        // 1425
    ';';                                                                                                               // 1426
     if (obj.array) {                                                                                                  // 1427
    __p += '\nvar length = iterable.length; index = -1;\nif (' +                                                       // 1428
    (obj.array) +                                                                                                      // 1429
    ') {  ';                                                                                                           // 1430
     if (support.unindexedChars) {                                                                                     // 1431
    __p += '\n  if (isString(iterable)) {\n    iterable = iterable.split(\'\')\n  }  ';                                // 1432
     }                                                                                                                 // 1433
    __p += '\n  while (++index < length) {\n    ' +                                                                    // 1434
    (obj.loop) +                                                                                                       // 1435
    ';\n  }\n}\nelse {  ';                                                                                             // 1436
     } else if (support.nonEnumArgs) {                                                                                 // 1437
    __p += '\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += \'\';\n      ' +
    (obj.loop) +                                                                                                       // 1439
    ';\n    }\n  } else {  ';                                                                                          // 1440
     }                                                                                                                 // 1441
                                                                                                                       // 1442
     if (support.enumPrototypes) {                                                                                     // 1443
    __p += '\n  var skipProto = typeof iterable == \'function\';\n  ';                                                 // 1444
     }                                                                                                                 // 1445
                                                                                                                       // 1446
     if (support.enumErrorProps) {                                                                                     // 1447
    __p += '\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ';                       // 1448
     }                                                                                                                 // 1449
                                                                                                                       // 1450
        var conditions = [];    if (support.enumPrototypes) { conditions.push('!(skipProto && index == "prototype")'); }    if (support.enumErrorProps)  { conditions.push('!(skipErrorProps && (index == "message" || index == "name"))'); }
                                                                                                                       // 1452
     if (obj.useHas && obj.keys) {                                                                                     // 1453
    __p += '\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n';
        if (conditions.length) {                                                                                       // 1455
    __p += '    if (' +                                                                                                // 1456
    (conditions.join(' && ')) +                                                                                        // 1457
    ') {\n  ';                                                                                                         // 1458
     }                                                                                                                 // 1459
    __p +=                                                                                                             // 1460
    (obj.loop) +                                                                                                       // 1461
    ';    ';                                                                                                           // 1462
     if (conditions.length) {                                                                                          // 1463
    __p += '\n    }';                                                                                                  // 1464
     }                                                                                                                 // 1465
    __p += '\n  }  ';                                                                                                  // 1466
     } else {                                                                                                          // 1467
    __p += '\n  for (index in iterable) {\n';                                                                          // 1468
        if (obj.useHas) { conditions.push("hasOwnProperty.call(iterable, index)"); }    if (conditions.length) {       // 1469
    __p += '    if (' +                                                                                                // 1470
    (conditions.join(' && ')) +                                                                                        // 1471
    ') {\n  ';                                                                                                         // 1472
     }                                                                                                                 // 1473
    __p +=                                                                                                             // 1474
    (obj.loop) +                                                                                                       // 1475
    ';    ';                                                                                                           // 1476
     if (conditions.length) {                                                                                          // 1477
    __p += '\n    }';                                                                                                  // 1478
     }                                                                                                                 // 1479
    __p += '\n  }    ';                                                                                                // 1480
     if (support.nonEnumShadows) {                                                                                     // 1481
    __p += '\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ';
     for (k = 0; k < 7; k++) {                                                                                         // 1483
    __p += '\n    index = \'' +                                                                                        // 1484
    (obj.shadowedProps[k]) +                                                                                           // 1485
    '\';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))';                             // 1486
            if (!obj.useHas) {                                                                                         // 1487
    __p += ' || (!nonEnum[index] && iterable[index] !== objectProto[index])';                                          // 1488
     }                                                                                                                 // 1489
    __p += ') {\n      ' +                                                                                             // 1490
    (obj.loop) +                                                                                                       // 1491
    ';\n    }      ';                                                                                                  // 1492
     }                                                                                                                 // 1493
    __p += '\n  }    ';                                                                                                // 1494
     }                                                                                                                 // 1495
                                                                                                                       // 1496
     }                                                                                                                 // 1497
                                                                                                                       // 1498
     if (obj.array || support.nonEnumArgs) {                                                                           // 1499
    __p += '\n}';                                                                                                      // 1500
     }                                                                                                                 // 1501
    __p +=                                                                                                             // 1502
    (obj.bottom) +                                                                                                     // 1503
    ';\nreturn result';                                                                                                // 1504
                                                                                                                       // 1505
    return __p                                                                                                         // 1506
  };                                                                                                                   // 1507
                                                                                                                       // 1508
  /*--------------------------------------------------------------------------*/                                       // 1509
                                                                                                                       // 1510
  /**                                                                                                                  // 1511
   * The base implementation of `_.bind` that creates the bound function and                                           // 1512
   * sets its meta data.                                                                                               // 1513
   *                                                                                                                   // 1514
   * @private                                                                                                          // 1515
   * @param {Array} bindData The bind data array.                                                                      // 1516
   * @returns {Function} Returns the new bound function.                                                               // 1517
   */                                                                                                                  // 1518
  function baseBind(bindData) {                                                                                        // 1519
    var func = bindData[0],                                                                                            // 1520
        partialArgs = bindData[2],                                                                                     // 1521
        thisArg = bindData[4];                                                                                         // 1522
                                                                                                                       // 1523
    function bound() {                                                                                                 // 1524
      // `Function#bind` spec                                                                                          // 1525
      // http://es5.github.io/#x15.3.4.5                                                                               // 1526
      if (partialArgs) {                                                                                               // 1527
        // avoid `arguments` object deoptimizations by using `slice` instead                                           // 1528
        // of `Array.prototype.slice.call` and not assigning `arguments` to a                                          // 1529
        // variable as a ternary expression                                                                            // 1530
        var args = slice(partialArgs);                                                                                 // 1531
        push.apply(args, arguments);                                                                                   // 1532
      }                                                                                                                // 1533
      // mimic the constructor's `return` behavior                                                                     // 1534
      // http://es5.github.io/#x13.2.2                                                                                 // 1535
      if (this instanceof bound) {                                                                                     // 1536
        // ensure `new bound` is an instance of `func`                                                                 // 1537
        var thisBinding = baseCreate(func.prototype),                                                                  // 1538
            result = func.apply(thisBinding, args || arguments);                                                       // 1539
        return isObject(result) ? result : thisBinding;                                                                // 1540
      }                                                                                                                // 1541
      return func.apply(thisArg, args || arguments);                                                                   // 1542
    }                                                                                                                  // 1543
    setBindData(bound, bindData);                                                                                      // 1544
    return bound;                                                                                                      // 1545
  }                                                                                                                    // 1546
                                                                                                                       // 1547
  /**                                                                                                                  // 1548
   * The base implementation of `_.clone` without argument juggling or support                                         // 1549
   * for `thisArg` binding.                                                                                            // 1550
   *                                                                                                                   // 1551
   * @private                                                                                                          // 1552
   * @param {*} value The value to clone.                                                                              // 1553
   * @param {boolean} [isDeep=false] Specify a deep clone.                                                             // 1554
   * @param {Function} [callback] The function to customize cloning values.                                            // 1555
   * @param {Array} [stackA=[]] Tracks traversed source objects.                                                       // 1556
   * @param {Array} [stackB=[]] Associates clones with source counterparts.                                            // 1557
   * @returns {*} Returns the cloned value.                                                                            // 1558
   */                                                                                                                  // 1559
  function baseClone(value, isDeep, callback, stackA, stackB) {                                                        // 1560
    if (callback) {                                                                                                    // 1561
      var result = callback(value);                                                                                    // 1562
      if (typeof result != 'undefined') {                                                                              // 1563
        return result;                                                                                                 // 1564
      }                                                                                                                // 1565
    }                                                                                                                  // 1566
    // inspect [[Class]]                                                                                               // 1567
    var isObj = isObject(value);                                                                                       // 1568
    if (isObj) {                                                                                                       // 1569
      var className = toString.call(value);                                                                            // 1570
      if (!cloneableClasses[className] || (!support.nodeClass && isNode(value))) {                                     // 1571
        return value;                                                                                                  // 1572
      }                                                                                                                // 1573
      var ctor = ctorByClass[className];                                                                               // 1574
      switch (className) {                                                                                             // 1575
        case boolClass:                                                                                                // 1576
        case dateClass:                                                                                                // 1577
          return new ctor(+value);                                                                                     // 1578
                                                                                                                       // 1579
        case numberClass:                                                                                              // 1580
        case stringClass:                                                                                              // 1581
          return new ctor(value);                                                                                      // 1582
                                                                                                                       // 1583
        case regexpClass:                                                                                              // 1584
          result = ctor(value.source, reFlags.exec(value));                                                            // 1585
          result.lastIndex = value.lastIndex;                                                                          // 1586
          return result;                                                                                               // 1587
      }                                                                                                                // 1588
    } else {                                                                                                           // 1589
      return value;                                                                                                    // 1590
    }                                                                                                                  // 1591
    var isArr = isArray(value);                                                                                        // 1592
    if (isDeep) {                                                                                                      // 1593
      // check for circular references and return corresponding clone                                                  // 1594
      var initedStack = !stackA;                                                                                       // 1595
      stackA || (stackA = getArray());                                                                                 // 1596
      stackB || (stackB = getArray());                                                                                 // 1597
                                                                                                                       // 1598
      var length = stackA.length;                                                                                      // 1599
      while (length--) {                                                                                               // 1600
        if (stackA[length] == value) {                                                                                 // 1601
          return stackB[length];                                                                                       // 1602
        }                                                                                                              // 1603
      }                                                                                                                // 1604
      result = isArr ? ctor(value.length) : {};                                                                        // 1605
    }                                                                                                                  // 1606
    else {                                                                                                             // 1607
      result = isArr ? slice(value) : assign({}, value);                                                               // 1608
    }                                                                                                                  // 1609
    // add array properties assigned by `RegExp#exec`                                                                  // 1610
    if (isArr) {                                                                                                       // 1611
      if (hasOwnProperty.call(value, 'index')) {                                                                       // 1612
        result.index = value.index;                                                                                    // 1613
      }                                                                                                                // 1614
      if (hasOwnProperty.call(value, 'input')) {                                                                       // 1615
        result.input = value.input;                                                                                    // 1616
      }                                                                                                                // 1617
    }                                                                                                                  // 1618
    // exit for shallow clone                                                                                          // 1619
    if (!isDeep) {                                                                                                     // 1620
      return result;                                                                                                   // 1621
    }                                                                                                                  // 1622
    // add the source value to the stack of traversed objects                                                          // 1623
    // and associate it with its clone                                                                                 // 1624
    stackA.push(value);                                                                                                // 1625
    stackB.push(result);                                                                                               // 1626
                                                                                                                       // 1627
    // recursively populate clone (susceptible to call stack limits)                                                   // 1628
    (isArr ? baseEach : forOwn)(value, function(objValue, key) {                                                       // 1629
      result[key] = baseClone(objValue, isDeep, callback, stackA, stackB);                                             // 1630
    });                                                                                                                // 1631
                                                                                                                       // 1632
    if (initedStack) {                                                                                                 // 1633
      releaseArray(stackA);                                                                                            // 1634
      releaseArray(stackB);                                                                                            // 1635
    }                                                                                                                  // 1636
    return result;                                                                                                     // 1637
  }                                                                                                                    // 1638
                                                                                                                       // 1639
  /**                                                                                                                  // 1640
   * The base implementation of `_.create` without support for assigning                                               // 1641
   * properties to the created object.                                                                                 // 1642
   *                                                                                                                   // 1643
   * @private                                                                                                          // 1644
   * @param {Object} prototype The object to inherit from.                                                             // 1645
   * @returns {Object} Returns the new object.                                                                         // 1646
   */                                                                                                                  // 1647
  function baseCreate(prototype, properties) {                                                                         // 1648
    return isObject(prototype) ? nativeCreate(prototype) : {};                                                         // 1649
  }                                                                                                                    // 1650
  // fallback for browsers without `Object.create`                                                                     // 1651
  if (!nativeCreate) {                                                                                                 // 1652
    baseCreate = (function() {                                                                                         // 1653
      function Object() {}                                                                                             // 1654
      return function(prototype) {                                                                                     // 1655
        if (isObject(prototype)) {                                                                                     // 1656
          Object.prototype = prototype;                                                                                // 1657
          var result = new Object;                                                                                     // 1658
          Object.prototype = null;                                                                                     // 1659
        }                                                                                                              // 1660
        return result || root.Object();                                                                                // 1661
      };                                                                                                               // 1662
    }());                                                                                                              // 1663
  }                                                                                                                    // 1664
                                                                                                                       // 1665
  /**                                                                                                                  // 1666
   * The base implementation of `_.createCallback` without support for creating                                        // 1667
   * "_.pluck" or "_.where" style callbacks.                                                                           // 1668
   *                                                                                                                   // 1669
   * @private                                                                                                          // 1670
   * @param {*} [func=identity] The value to convert to a callback.                                                    // 1671
   * @param {*} [thisArg] The `this` binding of the created callback.                                                  // 1672
   * @param {number} [argCount] The number of arguments the callback accepts.                                          // 1673
   * @returns {Function} Returns a callback function.                                                                  // 1674
   */                                                                                                                  // 1675
  function baseCreateCallback(func, thisArg, argCount) {                                                               // 1676
    if (typeof func != 'function') {                                                                                   // 1677
      return identity;                                                                                                 // 1678
    }                                                                                                                  // 1679
    // exit early for no `thisArg` or already bound by `Function#bind`                                                 // 1680
    if (typeof thisArg == 'undefined' || !('prototype' in func)) {                                                     // 1681
      return func;                                                                                                     // 1682
    }                                                                                                                  // 1683
    var bindData = func.__bindData__;                                                                                  // 1684
    if (typeof bindData == 'undefined') {                                                                              // 1685
      if (support.funcNames) {                                                                                         // 1686
        bindData = !func.name;                                                                                         // 1687
      }                                                                                                                // 1688
      bindData = bindData || !support.funcDecomp;                                                                      // 1689
      if (!bindData) {                                                                                                 // 1690
        var source = fnToString.call(func);                                                                            // 1691
        if (!support.funcNames) {                                                                                      // 1692
          bindData = !reFuncName.test(source);                                                                         // 1693
        }                                                                                                              // 1694
        if (!bindData) {                                                                                               // 1695
          // checks if `func` references the `this` keyword and stores the result                                      // 1696
          bindData = reThis.test(source);                                                                              // 1697
          setBindData(func, bindData);                                                                                 // 1698
        }                                                                                                              // 1699
      }                                                                                                                // 1700
    }                                                                                                                  // 1701
    // exit early if there are no `this` references or `func` is bound                                                 // 1702
    if (bindData === false || (bindData !== true && bindData[1] & 1)) {                                                // 1703
      return func;                                                                                                     // 1704
    }                                                                                                                  // 1705
    switch (argCount) {                                                                                                // 1706
      case 1: return function(value) {                                                                                 // 1707
        return func.call(thisArg, value);                                                                              // 1708
      };                                                                                                               // 1709
      case 2: return function(a, b) {                                                                                  // 1710
        return func.call(thisArg, a, b);                                                                               // 1711
      };                                                                                                               // 1712
      case 3: return function(value, index, collection) {                                                              // 1713
        return func.call(thisArg, value, index, collection);                                                           // 1714
      };                                                                                                               // 1715
      case 4: return function(accumulator, value, index, collection) {                                                 // 1716
        return func.call(thisArg, accumulator, value, index, collection);                                              // 1717
      };                                                                                                               // 1718
    }                                                                                                                  // 1719
    return bind(func, thisArg);                                                                                        // 1720
  }                                                                                                                    // 1721
                                                                                                                       // 1722
  /**                                                                                                                  // 1723
   * The base implementation of `createWrapper` that creates the wrapper and                                           // 1724
   * sets its meta data.                                                                                               // 1725
   *                                                                                                                   // 1726
   * @private                                                                                                          // 1727
   * @param {Array} bindData The bind data array.                                                                      // 1728
   * @returns {Function} Returns the new function.                                                                     // 1729
   */                                                                                                                  // 1730
  function baseCreateWrapper(bindData) {                                                                               // 1731
    var func = bindData[0],                                                                                            // 1732
        bitmask = bindData[1],                                                                                         // 1733
        partialArgs = bindData[2],                                                                                     // 1734
        partialRightArgs = bindData[3],                                                                                // 1735
        thisArg = bindData[4],                                                                                         // 1736
        arity = bindData[5];                                                                                           // 1737
                                                                                                                       // 1738
    var isBind = bitmask & 1,                                                                                          // 1739
        isBindKey = bitmask & 2,                                                                                       // 1740
        isCurry = bitmask & 4,                                                                                         // 1741
        isCurryBound = bitmask & 8,                                                                                    // 1742
        key = func;                                                                                                    // 1743
                                                                                                                       // 1744
    function bound() {                                                                                                 // 1745
      var thisBinding = isBind ? thisArg : this;                                                                       // 1746
      if (partialArgs) {                                                                                               // 1747
        var args = slice(partialArgs);                                                                                 // 1748
        push.apply(args, arguments);                                                                                   // 1749
      }                                                                                                                // 1750
      if (partialRightArgs || isCurry) {                                                                               // 1751
        args || (args = slice(arguments));                                                                             // 1752
        if (partialRightArgs) {                                                                                        // 1753
          push.apply(args, partialRightArgs);                                                                          // 1754
        }                                                                                                              // 1755
        if (isCurry && args.length < arity) {                                                                          // 1756
          bitmask |= 16 & ~32;                                                                                         // 1757
          return baseCreateWrapper([func, (isCurryBound ? bitmask : bitmask & ~3), args, null, thisArg, arity]);       // 1758
        }                                                                                                              // 1759
      }                                                                                                                // 1760
      args || (args = arguments);                                                                                      // 1761
      if (isBindKey) {                                                                                                 // 1762
        func = thisBinding[key];                                                                                       // 1763
      }                                                                                                                // 1764
      if (this instanceof bound) {                                                                                     // 1765
        thisBinding = baseCreate(func.prototype);                                                                      // 1766
        var result = func.apply(thisBinding, args);                                                                    // 1767
        return isObject(result) ? result : thisBinding;                                                                // 1768
      }                                                                                                                // 1769
      return func.apply(thisBinding, args);                                                                            // 1770
    }                                                                                                                  // 1771
    setBindData(bound, bindData);                                                                                      // 1772
    return bound;                                                                                                      // 1773
  }                                                                                                                    // 1774
                                                                                                                       // 1775
  /**                                                                                                                  // 1776
   * The base implementation of `_.isEqual`, without support for `thisArg` binding,                                    // 1777
   * that allows partial "_.where" style comparisons.                                                                  // 1778
   *                                                                                                                   // 1779
   * @private                                                                                                          // 1780
   * @param {*} a The value to compare.                                                                                // 1781
   * @param {*} b The other value to compare.                                                                          // 1782
   * @param {Function} [callback] The function to customize comparing values.                                          // 1783
   * @param {Function} [isWhere=false] A flag to indicate performing partial comparisons.                              // 1784
   * @param {Array} [stackA=[]] Tracks traversed `a` objects.                                                          // 1785
   * @param {Array} [stackB=[]] Tracks traversed `b` objects.                                                          // 1786
   * @returns {boolean} Returns `true` if the values are equivalent, else `false`.                                     // 1787
   */                                                                                                                  // 1788
  function baseIsEqual(a, b, callback, isWhere, stackA, stackB) {                                                      // 1789
    // used to indicate that when comparing objects, `a` has at least the properties of `b`                            // 1790
    if (callback) {                                                                                                    // 1791
      var result = callback(a, b);                                                                                     // 1792
      if (typeof result != 'undefined') {                                                                              // 1793
        return !!result;                                                                                               // 1794
      }                                                                                                                // 1795
    }                                                                                                                  // 1796
    // exit early for identical values                                                                                 // 1797
    if (a === b) {                                                                                                     // 1798
      // treat `+0` vs. `-0` as not equal                                                                              // 1799
      return a !== 0 || (1 / a == 1 / b);                                                                              // 1800
    }                                                                                                                  // 1801
    var type = typeof a,                                                                                               // 1802
        otherType = typeof b;                                                                                          // 1803
                                                                                                                       // 1804
    // exit early for unlike primitive values                                                                          // 1805
    if (a === a &&                                                                                                     // 1806
        !(a && objectTypes[type]) &&                                                                                   // 1807
        !(b && objectTypes[otherType])) {                                                                              // 1808
      return false;                                                                                                    // 1809
    }                                                                                                                  // 1810
    // exit early for `null` and `undefined` avoiding ES3's Function#call behavior                                     // 1811
    // http://es5.github.io/#x15.3.4.4                                                                                 // 1812
    if (a == null || b == null) {                                                                                      // 1813
      return a === b;                                                                                                  // 1814
    }                                                                                                                  // 1815
    // compare [[Class]] names                                                                                         // 1816
    var className = toString.call(a),                                                                                  // 1817
        otherClass = toString.call(b);                                                                                 // 1818
                                                                                                                       // 1819
    if (className == argsClass) {                                                                                      // 1820
      className = objectClass;                                                                                         // 1821
    }                                                                                                                  // 1822
    if (otherClass == argsClass) {                                                                                     // 1823
      otherClass = objectClass;                                                                                        // 1824
    }                                                                                                                  // 1825
    if (className != otherClass) {                                                                                     // 1826
      return false;                                                                                                    // 1827
    }                                                                                                                  // 1828
    switch (className) {                                                                                               // 1829
      case boolClass:                                                                                                  // 1830
      case dateClass:                                                                                                  // 1831
        // coerce dates and booleans to numbers, dates to milliseconds and booleans                                    // 1832
        // to `1` or `0` treating invalid dates coerced to `NaN` as not equal                                          // 1833
        return +a == +b;                                                                                               // 1834
                                                                                                                       // 1835
      case numberClass:                                                                                                // 1836
        // treat `NaN` vs. `NaN` as equal                                                                              // 1837
        return (a != +a)                                                                                               // 1838
          ? b != +b                                                                                                    // 1839
          // but treat `+0` vs. `-0` as not equal                                                                      // 1840
          : (a == 0 ? (1 / a == 1 / b) : a == +b);                                                                     // 1841
                                                                                                                       // 1842
      case regexpClass:                                                                                                // 1843
      case stringClass:                                                                                                // 1844
        // coerce regexes to strings (http://es5.github.io/#x15.10.6.4)                                                // 1845
        // treat string primitives and their corresponding object instances as equal                                   // 1846
        return a == String(b);                                                                                         // 1847
    }                                                                                                                  // 1848
    var isArr = className == arrayClass;                                                                               // 1849
    if (!isArr) {                                                                                                      // 1850
      // unwrap any `lodash` wrapped values                                                                            // 1851
      var aWrapped = hasOwnProperty.call(a, '__wrapped__'),                                                            // 1852
          bWrapped = hasOwnProperty.call(b, '__wrapped__');                                                            // 1853
                                                                                                                       // 1854
      if (aWrapped || bWrapped) {                                                                                      // 1855
        return baseIsEqual(aWrapped ? a.__wrapped__ : a, bWrapped ? b.__wrapped__ : b, callback, isWhere, stackA, stackB);
      }                                                                                                                // 1857
      // exit for functions and DOM nodes                                                                              // 1858
      if (className != objectClass || (!support.nodeClass && (isNode(a) || isNode(b)))) {                              // 1859
        return false;                                                                                                  // 1860
      }                                                                                                                // 1861
      // in older versions of Opera, `arguments` objects have `Array` constructors                                     // 1862
      var ctorA = !support.argsObject && isArguments(a) ? Object : a.constructor,                                      // 1863
          ctorB = !support.argsObject && isArguments(b) ? Object : b.constructor;                                      // 1864
                                                                                                                       // 1865
      // non `Object` object instances with different constructors are not equal                                       // 1866
      if (ctorA != ctorB &&                                                                                            // 1867
            !(isFunction(ctorA) && ctorA instanceof ctorA && isFunction(ctorB) && ctorB instanceof ctorB) &&           // 1868
            ('constructor' in a && 'constructor' in b)                                                                 // 1869
          ) {                                                                                                          // 1870
        return false;                                                                                                  // 1871
      }                                                                                                                // 1872
    }                                                                                                                  // 1873
    // assume cyclic structures are equal                                                                              // 1874
    // the algorithm for detecting cyclic structures is adapted from ES 5.1                                            // 1875
    // section 15.12.3, abstract operation `JO` (http://es5.github.io/#x15.12.3)                                       // 1876
    var initedStack = !stackA;                                                                                         // 1877
    stackA || (stackA = getArray());                                                                                   // 1878
    stackB || (stackB = getArray());                                                                                   // 1879
                                                                                                                       // 1880
    var length = stackA.length;                                                                                        // 1881
    while (length--) {                                                                                                 // 1882
      if (stackA[length] == a) {                                                                                       // 1883
        return stackB[length] == b;                                                                                    // 1884
      }                                                                                                                // 1885
    }                                                                                                                  // 1886
    var size = 0;                                                                                                      // 1887
    result = true;                                                                                                     // 1888
                                                                                                                       // 1889
    // add `a` and `b` to the stack of traversed objects                                                               // 1890
    stackA.push(a);                                                                                                    // 1891
    stackB.push(b);                                                                                                    // 1892
                                                                                                                       // 1893
    // recursively compare objects and arrays (susceptible to call stack limits)                                       // 1894
    if (isArr) {                                                                                                       // 1895
      // compare lengths to determine if a deep comparison is necessary                                                // 1896
      length = a.length;                                                                                               // 1897
      size = b.length;                                                                                                 // 1898
      result = size == length;                                                                                         // 1899
                                                                                                                       // 1900
      if (result || isWhere) {                                                                                         // 1901
        // deep compare the contents, ignoring non-numeric properties                                                  // 1902
        while (size--) {                                                                                               // 1903
          var index = length,                                                                                          // 1904
              value = b[size];                                                                                         // 1905
                                                                                                                       // 1906
          if (isWhere) {                                                                                               // 1907
            while (index--) {                                                                                          // 1908
              if ((result = baseIsEqual(a[index], value, callback, isWhere, stackA, stackB))) {                        // 1909
                break;                                                                                                 // 1910
              }                                                                                                        // 1911
            }                                                                                                          // 1912
          } else if (!(result = baseIsEqual(a[size], value, callback, isWhere, stackA, stackB))) {                     // 1913
            break;                                                                                                     // 1914
          }                                                                                                            // 1915
        }                                                                                                              // 1916
      }                                                                                                                // 1917
    }                                                                                                                  // 1918
    else {                                                                                                             // 1919
      // deep compare objects using `forIn`, instead of `forOwn`, to avoid `Object.keys`                               // 1920
      // which, in this case, is more costly                                                                           // 1921
      forIn(b, function(value, key, b) {                                                                               // 1922
        if (hasOwnProperty.call(b, key)) {                                                                             // 1923
          // count the number of properties.                                                                           // 1924
          size++;                                                                                                      // 1925
          // deep compare each property value.                                                                         // 1926
          return (result = hasOwnProperty.call(a, key) && baseIsEqual(a[key], value, callback, isWhere, stackA, stackB));
        }                                                                                                              // 1928
      });                                                                                                              // 1929
                                                                                                                       // 1930
      if (result && !isWhere) {                                                                                        // 1931
        // ensure both objects have the same number of properties                                                      // 1932
        forIn(a, function(value, key, a) {                                                                             // 1933
          if (hasOwnProperty.call(a, key)) {                                                                           // 1934
            // `size` will be `-1` if `a` has more properties than `b`                                                 // 1935
            return (result = --size > -1);                                                                             // 1936
          }                                                                                                            // 1937
        });                                                                                                            // 1938
      }                                                                                                                // 1939
    }                                                                                                                  // 1940
    stackA.pop();                                                                                                      // 1941
    stackB.pop();                                                                                                      // 1942
                                                                                                                       // 1943
    if (initedStack) {                                                                                                 // 1944
      releaseArray(stackA);                                                                                            // 1945
      releaseArray(stackB);                                                                                            // 1946
    }                                                                                                                  // 1947
    return result;                                                                                                     // 1948
  }                                                                                                                    // 1949
                                                                                                                       // 1950
  /**                                                                                                                  // 1951
   * Creates a function that, when called, either curries or invokes `func`                                            // 1952
   * with an optional `this` binding and partially applied arguments.                                                  // 1953
   *                                                                                                                   // 1954
   * @private                                                                                                          // 1955
   * @param {Function|string} func The function or method name to reference.                                           // 1956
   * @param {number} bitmask The bitmask of method flags to compose.                                                   // 1957
   *  The bitmask may be composed of the following flags:                                                              // 1958
   *  1 - `_.bind`                                                                                                     // 1959
   *  2 - `_.bindKey`                                                                                                  // 1960
   *  4 - `_.curry`                                                                                                    // 1961
   *  8 - `_.curry` (bound)                                                                                            // 1962
   *  16 - `_.partial`                                                                                                 // 1963
   *  32 - `_.partialRight`                                                                                            // 1964
   * @param {Array} [partialArgs] An array of arguments to prepend to those                                            // 1965
   *  provided to the new function.                                                                                    // 1966
   * @param {Array} [partialRightArgs] An array of arguments to append to those                                        // 1967
   *  provided to the new function.                                                                                    // 1968
   * @param {*} [thisArg] The `this` binding of `func`.                                                                // 1969
   * @param {number} [arity] The arity of `func`.                                                                      // 1970
   * @returns {Function} Returns the new function.                                                                     // 1971
   */                                                                                                                  // 1972
  function createWrapper(func, bitmask, partialArgs, partialRightArgs, thisArg, arity) {                               // 1973
    var isBind = bitmask & 1,                                                                                          // 1974
        isBindKey = bitmask & 2,                                                                                       // 1975
        isCurry = bitmask & 4,                                                                                         // 1976
        isCurryBound = bitmask & 8,                                                                                    // 1977
        isPartial = bitmask & 16,                                                                                      // 1978
        isPartialRight = bitmask & 32;                                                                                 // 1979
                                                                                                                       // 1980
    if (!isBindKey && !isFunction(func)) {                                                                             // 1981
      throw new TypeError;                                                                                             // 1982
    }                                                                                                                  // 1983
    if (isPartial && !partialArgs.length) {                                                                            // 1984
      bitmask &= ~16;                                                                                                  // 1985
      isPartial = partialArgs = false;                                                                                 // 1986
    }                                                                                                                  // 1987
    if (isPartialRight && !partialRightArgs.length) {                                                                  // 1988
      bitmask &= ~32;                                                                                                  // 1989
      isPartialRight = partialRightArgs = false;                                                                       // 1990
    }                                                                                                                  // 1991
    var bindData = func && func.__bindData__;                                                                          // 1992
    if (bindData && bindData !== true) {                                                                               // 1993
      // clone `bindData`                                                                                              // 1994
      bindData = slice(bindData);                                                                                      // 1995
      if (bindData[2]) {                                                                                               // 1996
        bindData[2] = slice(bindData[2]);                                                                              // 1997
      }                                                                                                                // 1998
      if (bindData[3]) {                                                                                               // 1999
        bindData[3] = slice(bindData[3]);                                                                              // 2000
      }                                                                                                                // 2001
      // set `thisBinding` is not previously bound                                                                     // 2002
      if (isBind && !(bindData[1] & 1)) {                                                                              // 2003
        bindData[4] = thisArg;                                                                                         // 2004
      }                                                                                                                // 2005
      // set if previously bound but not currently (subsequent curried functions)                                      // 2006
      if (!isBind && bindData[1] & 1) {                                                                                // 2007
        bitmask |= 8;                                                                                                  // 2008
      }                                                                                                                // 2009
      // set curried arity if not yet set                                                                              // 2010
      if (isCurry && !(bindData[1] & 4)) {                                                                             // 2011
        bindData[5] = arity;                                                                                           // 2012
      }                                                                                                                // 2013
      // append partial left arguments                                                                                 // 2014
      if (isPartial) {                                                                                                 // 2015
        push.apply(bindData[2] || (bindData[2] = []), partialArgs);                                                    // 2016
      }                                                                                                                // 2017
      // append partial right arguments                                                                                // 2018
      if (isPartialRight) {                                                                                            // 2019
        unshift.apply(bindData[3] || (bindData[3] = []), partialRightArgs);                                            // 2020
      }                                                                                                                // 2021
      // merge flags                                                                                                   // 2022
      bindData[1] |= bitmask;                                                                                          // 2023
      return createWrapper.apply(null, bindData);                                                                      // 2024
    }                                                                                                                  // 2025
    // fast path for `_.bind`                                                                                          // 2026
    var creater = (bitmask == 1 || bitmask === 17) ? baseBind : baseCreateWrapper;                                     // 2027
    return creater([func, bitmask, partialArgs, partialRightArgs, thisArg, arity]);                                    // 2028
  }                                                                                                                    // 2029
                                                                                                                       // 2030
  /**                                                                                                                  // 2031
   * Creates compiled iteration functions.                                                                             // 2032
   *                                                                                                                   // 2033
   * @private                                                                                                          // 2034
   * @param {...Object} [options] The compile options object(s).                                                       // 2035
   * @param {string} [options.array] Code to determine if the iterable is an array or array-like.                      // 2036
   * @param {boolean} [options.useHas] Specify using `hasOwnProperty` checks in the object loop.                       // 2037
   * @param {Function} [options.keys] A reference to `_.keys` for use in own property iteration.                       // 2038
   * @param {string} [options.args] A comma separated string of iteration function arguments.                          // 2039
   * @param {string} [options.top] Code to execute before the iteration branches.                                      // 2040
   * @param {string} [options.loop] Code to execute in the object loop.                                                // 2041
   * @param {string} [options.bottom] Code to execute after the iteration branches.                                    // 2042
   * @returns {Function} Returns the compiled function.                                                                // 2043
   */                                                                                                                  // 2044
  function createIterator() {                                                                                          // 2045
    // data properties                                                                                                 // 2046
    iteratorData.shadowedProps = shadowedProps;                                                                        // 2047
                                                                                                                       // 2048
    // iterator options                                                                                                // 2049
    iteratorData.array = iteratorData.bottom = iteratorData.loop = iteratorData.top = '';                              // 2050
    iteratorData.init = 'iterable';                                                                                    // 2051
    iteratorData.useHas = true;                                                                                        // 2052
                                                                                                                       // 2053
    // merge options into a template data object                                                                       // 2054
    for (var object, index = 0; object = arguments[index]; index++) {                                                  // 2055
      for (var key in object) {                                                                                        // 2056
        iteratorData[key] = object[key];                                                                               // 2057
      }                                                                                                                // 2058
    }                                                                                                                  // 2059
    var args = iteratorData.args;                                                                                      // 2060
    iteratorData.firstArg = /^[^,]+/.exec(args)[0];                                                                    // 2061
                                                                                                                       // 2062
    // create the function factory                                                                                     // 2063
    var factory = Function(                                                                                            // 2064
        'baseCreateCallback, errorClass, errorProto, hasOwnProperty, ' +                                               // 2065
        'indicatorObject, isArguments, isArray, isString, keys, objectProto, ' +                                       // 2066
        'objectTypes, nonEnumProps, stringClass, stringProto, toString',                                               // 2067
      'return function(' + args + ') {\n' + iteratorTemplate(iteratorData) + '\n}'                                     // 2068
    );                                                                                                                 // 2069
                                                                                                                       // 2070
    // return the compiled function                                                                                    // 2071
    return factory(                                                                                                    // 2072
      baseCreateCallback, errorClass, errorProto, hasOwnProperty,                                                      // 2073
      indicatorObject, isArguments, isArray, isString, iteratorData.keys, objectProto,                                 // 2074
      objectTypes, nonEnumProps, stringClass, stringProto, toString                                                    // 2075
    );                                                                                                                 // 2076
  }                                                                                                                    // 2077
                                                                                                                       // 2078
  /**                                                                                                                  // 2079
   * Used by `escape` to convert characters to HTML entities.                                                          // 2080
   *                                                                                                                   // 2081
   * @private                                                                                                          // 2082
   * @param {string} match The matched character to escape.                                                            // 2083
   * @returns {string} Returns the escaped character.                                                                  // 2084
   */                                                                                                                  // 2085
  function escapeHtmlChar(match) {                                                                                     // 2086
    return htmlEscapes[match];                                                                                         // 2087
  }                                                                                                                    // 2088
                                                                                                                       // 2089
  /**                                                                                                                  // 2090
   * Checks if `value` is a native function.                                                                           // 2091
   *                                                                                                                   // 2092
   * @private                                                                                                          // 2093
   * @param {*} value The value to check.                                                                              // 2094
   * @returns {boolean} Returns `true` if the `value` is a native function, else `false`.                              // 2095
   */                                                                                                                  // 2096
  function isNative(value) {                                                                                           // 2097
    return typeof value == 'function' && reNative.test(value);                                                         // 2098
  }                                                                                                                    // 2099
                                                                                                                       // 2100
  /**                                                                                                                  // 2101
   * Sets `this` binding data on a given function.                                                                     // 2102
   *                                                                                                                   // 2103
   * @private                                                                                                          // 2104
   * @param {Function} func The function to set data on.                                                               // 2105
   * @param {Array} value The data array to set.                                                                       // 2106
   */                                                                                                                  // 2107
  var setBindData = !defineProperty ? noop : function(func, value) {                                                   // 2108
    descriptor.value = value;                                                                                          // 2109
    defineProperty(func, '__bindData__', descriptor);                                                                  // 2110
  };                                                                                                                   // 2111
                                                                                                                       // 2112
  /*--------------------------------------------------------------------------*/                                       // 2113
                                                                                                                       // 2114
  /**                                                                                                                  // 2115
   * Checks if `value` is an `arguments` object.                                                                       // 2116
   *                                                                                                                   // 2117
   * @static                                                                                                           // 2118
   * @memberOf _                                                                                                       // 2119
   * @category Objects                                                                                                 // 2120
   * @param {*} value The value to check.                                                                              // 2121
   * @returns {boolean} Returns `true` if the `value` is an `arguments` object, else `false`.                          // 2122
   * @example                                                                                                          // 2123
   *                                                                                                                   // 2124
   * (function() { return _.isArguments(arguments); })(1, 2, 3);                                                       // 2125
   * // => true                                                                                                        // 2126
   *                                                                                                                   // 2127
   * _.isArguments([1, 2, 3]);                                                                                         // 2128
   * // => false                                                                                                       // 2129
   */                                                                                                                  // 2130
  function isArguments(value) {                                                                                        // 2131
    return value && typeof value == 'object' && typeof value.length == 'number' &&                                     // 2132
      toString.call(value) == argsClass || false;                                                                      // 2133
  }                                                                                                                    // 2134
  // fallback for browsers that can't detect `arguments` objects by [[Class]]                                          // 2135
  if (!support.argsClass) {                                                                                            // 2136
    isArguments = function(value) {                                                                                    // 2137
      return value && typeof value == 'object' && typeof value.length == 'number' &&                                   // 2138
        hasOwnProperty.call(value, 'callee') && !propertyIsEnumerable.call(value, 'callee') || false;                  // 2139
    };                                                                                                                 // 2140
  }                                                                                                                    // 2141
                                                                                                                       // 2142
  /**                                                                                                                  // 2143
   * Checks if `value` is an array.                                                                                    // 2144
   *                                                                                                                   // 2145
   * @static                                                                                                           // 2146
   * @memberOf _                                                                                                       // 2147
   * @type Function                                                                                                    // 2148
   * @category Objects                                                                                                 // 2149
   * @param {*} value The value to check.                                                                              // 2150
   * @returns {boolean} Returns `true` if the `value` is an array, else `false`.                                       // 2151
   * @example                                                                                                          // 2152
   *                                                                                                                   // 2153
   * (function() { return _.isArray(arguments); })();                                                                  // 2154
   * // => false                                                                                                       // 2155
   *                                                                                                                   // 2156
   * _.isArray([1, 2, 3]);                                                                                             // 2157
   * // => true                                                                                                        // 2158
   */                                                                                                                  // 2159
  var isArray = nativeIsArray || function(value) {                                                                     // 2160
    return value && typeof value == 'object' && typeof value.length == 'number' &&                                     // 2161
      toString.call(value) == arrayClass || false;                                                                     // 2162
  };                                                                                                                   // 2163
                                                                                                                       // 2164
  /**                                                                                                                  // 2165
   * A fallback implementation of `Object.keys` which produces an array of the                                         // 2166
   * given object's own enumerable property names.                                                                     // 2167
   *                                                                                                                   // 2168
   * @private                                                                                                          // 2169
   * @type Function                                                                                                    // 2170
   * @param {Object} object The object to inspect.                                                                     // 2171
   * @returns {Array} Returns an array of property names.                                                              // 2172
   */                                                                                                                  // 2173
  var shimKeys = createIterator({                                                                                      // 2174
    'args': 'object',                                                                                                  // 2175
    'init': '[]',                                                                                                      // 2176
    'top': 'if (!(objectTypes[typeof object])) return result',                                                         // 2177
    'loop': 'result.push(index)'                                                                                       // 2178
  });                                                                                                                  // 2179
                                                                                                                       // 2180
  /**                                                                                                                  // 2181
   * Creates an array composed of the own enumerable property names of an object.                                      // 2182
   *                                                                                                                   // 2183
   * @static                                                                                                           // 2184
   * @memberOf _                                                                                                       // 2185
   * @category Objects                                                                                                 // 2186
   * @param {Object} object The object to inspect.                                                                     // 2187
   * @returns {Array} Returns an array of property names.                                                              // 2188
   * @example                                                                                                          // 2189
   *                                                                                                                   // 2190
   * _.keys({ 'one': 1, 'two': 2, 'three': 3 });                                                                       // 2191
   * // => ['one', 'two', 'three'] (property order is not guaranteed across environments)                              // 2192
   */                                                                                                                  // 2193
  var keys = !nativeKeys ? shimKeys : function(object) {                                                               // 2194
    if (!isObject(object)) {                                                                                           // 2195
      return [];                                                                                                       // 2196
    }                                                                                                                  // 2197
    if ((support.enumPrototypes && typeof object == 'function') ||                                                     // 2198
        (support.nonEnumArgs && object.length && isArguments(object))) {                                               // 2199
      return shimKeys(object);                                                                                         // 2200
    }                                                                                                                  // 2201
    return nativeKeys(object);                                                                                         // 2202
  };                                                                                                                   // 2203
                                                                                                                       // 2204
  /** Reusable iterator options shared by `each`, `forIn`, and `forOwn` */                                             // 2205
  var eachIteratorOptions = {                                                                                          // 2206
    'args': 'collection, callback, thisArg',                                                                           // 2207
    'top': "callback = callback && typeof thisArg == 'undefined' ? callback : baseCreateCallback(callback, thisArg, 3)",
    'array': "typeof length == 'number'",                                                                              // 2209
    'keys': keys,                                                                                                      // 2210
    'loop': 'if (callback(iterable[index], index, collection) === false) return result'                                // 2211
  };                                                                                                                   // 2212
                                                                                                                       // 2213
  /** Reusable iterator options for `assign` and `defaults` */                                                         // 2214
  var defaultsIteratorOptions = {                                                                                      // 2215
    'args': 'object, source, guard',                                                                                   // 2216
    'top':                                                                                                             // 2217
      'var args = arguments,\n' +                                                                                      // 2218
      '    argsIndex = 0,\n' +                                                                                         // 2219
      "    argsLength = typeof guard == 'number' ? 2 : args.length;\n" +                                               // 2220
      'while (++argsIndex < argsLength) {\n' +                                                                         // 2221
      '  iterable = args[argsIndex];\n' +                                                                              // 2222
      '  if (iterable && objectTypes[typeof iterable]) {',                                                             // 2223
    'keys': keys,                                                                                                      // 2224
    'loop': "if (typeof result[index] == 'undefined') result[index] = iterable[index]",                                // 2225
    'bottom': '  }\n}'                                                                                                 // 2226
  };                                                                                                                   // 2227
                                                                                                                       // 2228
  /** Reusable iterator options for `forIn` and `forOwn` */                                                            // 2229
  var forOwnIteratorOptions = {                                                                                        // 2230
    'top': 'if (!objectTypes[typeof iterable]) return result;\n' + eachIteratorOptions.top,                            // 2231
    'array': false                                                                                                     // 2232
  };                                                                                                                   // 2233
                                                                                                                       // 2234
  /**                                                                                                                  // 2235
   * Used to convert characters to HTML entities:                                                                      // 2236
   *                                                                                                                   // 2237
   * Though the `>` character is escaped for symmetry, characters like `>` and `/`                                     // 2238
   * don't require escaping in HTML and have no special meaning unless they're part                                    // 2239
   * of a tag or an unquoted attribute value.                                                                          // 2240
   * http://mathiasbynens.be/notes/ambiguous-ampersands (under "semi-related fun fact")                                // 2241
   */                                                                                                                  // 2242
  var htmlEscapes = {                                                                                                  // 2243
    '&': '&amp;',                                                                                                      // 2244
    '<': '&lt;',                                                                                                       // 2245
    '>': '&gt;',                                                                                                       // 2246
    '"': '&quot;',                                                                                                     // 2247
    "'": '&#39;'                                                                                                       // 2248
  };                                                                                                                   // 2249
                                                                                                                       // 2250
  /** Used to match HTML entities and HTML characters */                                                               // 2251
  var reUnescapedHtml = RegExp('[' + keys(htmlEscapes).join('') + ']', 'g');                                           // 2252
                                                                                                                       // 2253
  /**                                                                                                                  // 2254
   * A function compiled to iterate `arguments` objects, arrays, objects, and                                          // 2255
   * strings consistenly across environments, executing the callback for each                                          // 2256
   * element in the collection. The callback is bound to `thisArg` and invoked                                         // 2257
   * with three arguments; (value, index|key, collection). Callbacks may exit                                          // 2258
   * iteration early by explicitly returning `false`.                                                                  // 2259
   *                                                                                                                   // 2260
   * @private                                                                                                          // 2261
   * @type Function                                                                                                    // 2262
   * @param {Array|Object|string} collection The collection to iterate over.                                           // 2263
   * @param {Function} [callback=identity] The function called per iteration.                                          // 2264
   * @param {*} [thisArg] The `this` binding of `callback`.                                                            // 2265
   * @returns {Array|Object|string} Returns `collection`.                                                              // 2266
   */                                                                                                                  // 2267
  var baseEach = createIterator(eachIteratorOptions);                                                                  // 2268
                                                                                                                       // 2269
  /*--------------------------------------------------------------------------*/                                       // 2270
                                                                                                                       // 2271
  /**                                                                                                                  // 2272
   * Assigns own enumerable properties of source object(s) to the destination                                          // 2273
   * object. Subsequent sources will overwrite property assignments of previous                                        // 2274
   * sources. If a callback is provided it will be executed to produce the                                             // 2275
   * assigned values. The callback is bound to `thisArg` and invoked with two                                          // 2276
   * arguments; (objectValue, sourceValue).                                                                            // 2277
   *                                                                                                                   // 2278
   * @static                                                                                                           // 2279
   * @memberOf _                                                                                                       // 2280
   * @type Function                                                                                                    // 2281
   * @alias extend                                                                                                     // 2282
   * @category Objects                                                                                                 // 2283
   * @param {Object} object The destination object.                                                                    // 2284
   * @param {...Object} [source] The source objects.                                                                   // 2285
   * @param {Function} [callback] The function to customize assigning values.                                          // 2286
   * @param {*} [thisArg] The `this` binding of `callback`.                                                            // 2287
   * @returns {Object} Returns the destination object.                                                                 // 2288
   * @example                                                                                                          // 2289
   *                                                                                                                   // 2290
   * _.assign({ 'name': 'fred' }, { 'employer': 'slate' });                                                            // 2291
   * // => { 'name': 'fred', 'employer': 'slate' }                                                                     // 2292
   *                                                                                                                   // 2293
   * var defaults = _.partialRight(_.assign, function(a, b) {                                                          // 2294
   *   return typeof a == 'undefined' ? b : a;                                                                         // 2295
   * });                                                                                                               // 2296
   *                                                                                                                   // 2297
   * var object = { 'name': 'barney' };                                                                                // 2298
   * defaults(object, { 'name': 'fred', 'employer': 'slate' });                                                        // 2299
   * // => { 'name': 'barney', 'employer': 'slate' }                                                                   // 2300
   */                                                                                                                  // 2301
  var assign = createIterator(defaultsIteratorOptions, {                                                               // 2302
    'top':                                                                                                             // 2303
      defaultsIteratorOptions.top.replace(';',                                                                         // 2304
        ';\n' +                                                                                                        // 2305
        "if (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n" +                                       // 2306
        '  var callback = baseCreateCallback(args[--argsLength - 1], args[argsLength--], 2);\n' +                      // 2307
        "} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n" +                                // 2308
        '  callback = args[--argsLength];\n' +                                                                         // 2309
        '}'                                                                                                            // 2310
      ),                                                                                                               // 2311
    'loop': 'result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]'                    // 2312
  });                                                                                                                  // 2313
                                                                                                                       // 2314
  /**                                                                                                                  // 2315
   * Creates a clone of `value`. If `isDeep` is `true` nested objects will also                                        // 2316
   * be cloned, otherwise they will be assigned by reference. If a callback                                            // 2317
   * is provided it will be executed to produce the cloned values. If the                                              // 2318
   * callback returns `undefined` cloning will be handled by the method instead.                                       // 2319
   * The callback is bound to `thisArg` and invoked with one argument; (value).                                        // 2320
   *                                                                                                                   // 2321
   * @static                                                                                                           // 2322
   * @memberOf _                                                                                                       // 2323
   * @category Objects                                                                                                 // 2324
   * @param {*} value The value to clone.                                                                              // 2325
   * @param {boolean} [isDeep=false] Specify a deep clone.                                                             // 2326
   * @param {Function} [callback] The function to customize cloning values.                                            // 2327
   * @param {*} [thisArg] The `this` binding of `callback`.                                                            // 2328
   * @returns {*} Returns the cloned value.                                                                            // 2329
   * @example                                                                                                          // 2330
   *                                                                                                                   // 2331
   * var characters = [                                                                                                // 2332
   *   { 'name': 'barney', 'age': 36 },                                                                                // 2333
   *   { 'name': 'fred',   'age': 40 }                                                                                 // 2334
   * ];                                                                                                                // 2335
   *                                                                                                                   // 2336
   * var shallow = _.clone(characters);                                                                                // 2337
   * shallow[0] === characters[0];                                                                                     // 2338
   * // => true                                                                                                        // 2339
   *                                                                                                                   // 2340
   * var deep = _.clone(characters, true);                                                                             // 2341
   * deep[0] === characters[0];                                                                                        // 2342
   * // => false                                                                                                       // 2343
   *                                                                                                                   // 2344
   * _.mixin({                                                                                                         // 2345
   *   'clone': _.partialRight(_.clone, function(value) {                                                              // 2346
   *     return _.isElement(value) ? value.cloneNode(false) : undefined;                                               // 2347
   *   })                                                                                                              // 2348
   * });                                                                                                               // 2349
   *                                                                                                                   // 2350
   * var clone = _.clone(document.body);                                                                               // 2351
   * clone.childNodes.length;                                                                                          // 2352
   * // => 0                                                                                                           // 2353
   */                                                                                                                  // 2354
  function clone(value, isDeep, callback, thisArg) {                                                                   // 2355
    // allows working with "Collections" methods without using their `index`                                           // 2356
    // and `collection` arguments for `isDeep` and `callback`                                                          // 2357
    if (typeof isDeep != 'boolean' && isDeep != null) {                                                                // 2358
      thisArg = callback;                                                                                              // 2359
      callback = isDeep;                                                                                               // 2360
      isDeep = false;                                                                                                  // 2361
    }                                                                                                                  // 2362
    return baseClone(value, isDeep, typeof callback == 'function' && baseCreateCallback(callback, thisArg, 1));        // 2363
  }                                                                                                                    // 2364
                                                                                                                       // 2365
  /**                                                                                                                  // 2366
   * Creates a deep clone of `value`. If a callback is provided it will be                                             // 2367
   * executed to produce the cloned values. If the callback returns `undefined`                                        // 2368
   * cloning will be handled by the method instead. The callback is bound to                                           // 2369
   * `thisArg` and invoked with one argument; (value).                                                                 // 2370
   *                                                                                                                   // 2371
   * Note: This method is loosely based on the structured clone algorithm. Functions                                   // 2372
   * and DOM nodes are **not** cloned. The enumerable properties of `arguments` objects and                            // 2373
   * objects created by constructors other than `Object` are cloned to plain `Object` objects.                         // 2374
   * See http://www.w3.org/TR/html5/infrastructure.html#internal-structured-cloning-algorithm.                         // 2375
   *                                                                                                                   // 2376
   * @static                                                                                                           // 2377
   * @memberOf _                                                                                                       // 2378
   * @category Objects                                                                                                 // 2379
   * @param {*} value The value to deep clone.                                                                         // 2380
   * @param {Function} [callback] The function to customize cloning values.                                            // 2381
   * @param {*} [thisArg] The `this` binding of `callback`.                                                            // 2382
   * @returns {*} Returns the deep cloned value.                                                                       // 2383
   * @example                                                                                                          // 2384
   *                                                                                                                   // 2385
   * var characters = [                                                                                                // 2386
   *   { 'name': 'barney', 'age': 36 },                                                                                // 2387
   *   { 'name': 'fred',   'age': 40 }                                                                                 // 2388
   * ];                                                                                                                // 2389
   *                                                                                                                   // 2390
   * var deep = _.cloneDeep(characters);                                                                               // 2391
   * deep[0] === characters[0];                                                                                        // 2392
   * // => false                                                                                                       // 2393
   *                                                                                                                   // 2394
   * var view = {                                                                                                      // 2395
   *   'label': 'docs',                                                                                                // 2396
   *   'node': element                                                                                                 // 2397
   * };                                                                                                                // 2398
   *                                                                                                                   // 2399
   * var clone = _.cloneDeep(view, function(value) {                                                                   // 2400
   *   return _.isElement(value) ? value.cloneNode(true) : undefined;                                                  // 2401
   * });                                                                                                               // 2402
   *                                                                                                                   // 2403
   * clone.node == view.node;                                                                                          // 2404
   * // => false                                                                                                       // 2405
   */                                                                                                                  // 2406
  function cloneDeep(value, callback, thisArg) {                                                                       // 2407
    return baseClone(value, true, typeof callback == 'function' && baseCreateCallback(callback, thisArg, 1));          // 2408
  }                                                                                                                    // 2409
                                                                                                                       // 2410
  /**                                                                                                                  // 2411
   * Assigns own enumerable properties of source object(s) to the destination                                          // 2412
   * object for all destination properties that resolve to `undefined`. Once a                                         // 2413
   * property is set, additional defaults of the same property will be ignored.                                        // 2414
   *                                                                                                                   // 2415
   * @static                                                                                                           // 2416
   * @memberOf _                                                                                                       // 2417
   * @type Function                                                                                                    // 2418
   * @category Objects                                                                                                 // 2419
   * @param {Object} object The destination object.                                                                    // 2420
   * @param {...Object} [source] The source objects.                                                                   // 2421
   * @param- {Object} [guard] Allows working with `_.reduce` without using its                                         // 2422
   *  `key` and `object` arguments as sources.                                                                         // 2423
   * @returns {Object} Returns the destination object.                                                                 // 2424
   * @example                                                                                                          // 2425
   *                                                                                                                   // 2426
   * var object = { 'name': 'barney' };                                                                                // 2427
   * _.defaults(object, { 'name': 'fred', 'employer': 'slate' });                                                      // 2428
   * // => { 'name': 'barney', 'employer': 'slate' }                                                                   // 2429
   */                                                                                                                  // 2430
  var defaults = createIterator(defaultsIteratorOptions);                                                              // 2431
                                                                                                                       // 2432
  /**                                                                                                                  // 2433
   * Iterates over own and inherited enumerable properties of an object,                                               // 2434
   * executing the callback for each property. The callback is bound to `thisArg`                                      // 2435
   * and invoked with three arguments; (value, key, object). Callbacks may exit                                        // 2436
   * iteration early by explicitly returning `false`.                                                                  // 2437
   *                                                                                                                   // 2438
   * @static                                                                                                           // 2439
   * @memberOf _                                                                                                       // 2440
   * @type Function                                                                                                    // 2441
   * @category Objects                                                                                                 // 2442
   * @param {Object} object The object to iterate over.                                                                // 2443
   * @param {Function} [callback=identity] The function called per iteration.                                          // 2444
   * @param {*} [thisArg] The `this` binding of `callback`.                                                            // 2445
   * @returns {Object} Returns `object`.                                                                               // 2446
   * @example                                                                                                          // 2447
   *                                                                                                                   // 2448
   * function Shape() {                                                                                                // 2449
   *   this.x = 0;                                                                                                     // 2450
   *   this.y = 0;                                                                                                     // 2451
   * }                                                                                                                 // 2452
   *                                                                                                                   // 2453
   * Shape.prototype.move = function(x, y) {                                                                           // 2454
   *   this.x += x;                                                                                                    // 2455
   *   this.y += y;                                                                                                    // 2456
   * };                                                                                                                // 2457
   *                                                                                                                   // 2458
   * _.forIn(new Shape, function(value, key) {                                                                         // 2459
   *   console.log(key);                                                                                               // 2460
   * });                                                                                                               // 2461
   * // => logs 'x', 'y', and 'move' (property order is not guaranteed across environments)                            // 2462
   */                                                                                                                  // 2463
  var forIn = createIterator(eachIteratorOptions, forOwnIteratorOptions, {                                             // 2464
    'useHas': false                                                                                                    // 2465
  });                                                                                                                  // 2466
                                                                                                                       // 2467
  /**                                                                                                                  // 2468
   * Iterates over own enumerable properties of an object, executing the callback                                      // 2469
   * for each property. The callback is bound to `thisArg` and invoked with three                                      // 2470
   * arguments; (value, key, object). Callbacks may exit iteration early by                                            // 2471
   * explicitly returning `false`.                                                                                     // 2472
   *                                                                                                                   // 2473
   * @static                                                                                                           // 2474
   * @memberOf _                                                                                                       // 2475
   * @type Function                                                                                                    // 2476
   * @category Objects                                                                                                 // 2477
   * @param {Object} object The object to iterate over.                                                                // 2478
   * @param {Function} [callback=identity] The function called per iteration.                                          // 2479
   * @param {*} [thisArg] The `this` binding of `callback`.                                                            // 2480
   * @returns {Object} Returns `object`.                                                                               // 2481
   * @example                                                                                                          // 2482
   *                                                                                                                   // 2483
   * _.forOwn({ '0': 'zero', '1': 'one', 'length': 2 }, function(num, key) {                                           // 2484
   *   console.log(key);                                                                                               // 2485
   * });                                                                                                               // 2486
   * // => logs '0', '1', and 'length' (property order is not guaranteed across environments)                          // 2487
   */                                                                                                                  // 2488
  var forOwn = createIterator(eachIteratorOptions, forOwnIteratorOptions);                                             // 2489
                                                                                                                       // 2490
  /**                                                                                                                  // 2491
   * Checks if `value` is a function.                                                                                  // 2492
   *                                                                                                                   // 2493
   * @static                                                                                                           // 2494
   * @memberOf _                                                                                                       // 2495
   * @category Objects                                                                                                 // 2496
   * @param {*} value The value to check.                                                                              // 2497
   * @returns {boolean} Returns `true` if the `value` is a function, else `false`.                                     // 2498
   * @example                                                                                                          // 2499
   *                                                                                                                   // 2500
   * _.isFunction(_);                                                                                                  // 2501
   * // => true                                                                                                        // 2502
   */                                                                                                                  // 2503
  function isFunction(value) {                                                                                         // 2504
    return typeof value == 'function';                                                                                 // 2505
  }                                                                                                                    // 2506
  // fallback for older versions of Chrome and Safari                                                                  // 2507
  if (isFunction(/x/)) {                                                                                               // 2508
    isFunction = function(value) {                                                                                     // 2509
      return typeof value == 'function' && toString.call(value) == funcClass;                                          // 2510
    };                                                                                                                 // 2511
  }                                                                                                                    // 2512
                                                                                                                       // 2513
  /**                                                                                                                  // 2514
   * Checks if `value` is the language type of Object.                                                                 // 2515
   * (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)                                 // 2516
   *                                                                                                                   // 2517
   * @static                                                                                                           // 2518
   * @memberOf _                                                                                                       // 2519
   * @category Objects                                                                                                 // 2520
   * @param {*} value The value to check.                                                                              // 2521
   * @returns {boolean} Returns `true` if the `value` is an object, else `false`.                                      // 2522
   * @example                                                                                                          // 2523
   *                                                                                                                   // 2524
   * _.isObject({});                                                                                                   // 2525
   * // => true                                                                                                        // 2526
   *                                                                                                                   // 2527
   * _.isObject([1, 2, 3]);                                                                                            // 2528
   * // => true                                                                                                        // 2529
   *                                                                                                                   // 2530
   * _.isObject(1);                                                                                                    // 2531
   * // => false                                                                                                       // 2532
   */                                                                                                                  // 2533
  function isObject(value) {                                                                                           // 2534
    // check if the value is the ECMAScript language type of Object                                                    // 2535
    // http://es5.github.io/#x8                                                                                        // 2536
    // and avoid a V8 bug                                                                                              // 2537
    // http://code.google.com/p/v8/issues/detail?id=2291                                                               // 2538
    return !!(value && objectTypes[typeof value]);                                                                     // 2539
  }                                                                                                                    // 2540
                                                                                                                       // 2541
  /**                                                                                                                  // 2542
   * Checks if `value` is a string.                                                                                    // 2543
   *                                                                                                                   // 2544
   * @static                                                                                                           // 2545
   * @memberOf _                                                                                                       // 2546
   * @category Objects                                                                                                 // 2547
   * @param {*} value The value to check.                                                                              // 2548
   * @returns {boolean} Returns `true` if the `value` is a string, else `false`.                                       // 2549
   * @example                                                                                                          // 2550
   *                                                                                                                   // 2551
   * _.isString('fred');                                                                                               // 2552
   * // => true                                                                                                        // 2553
   */                                                                                                                  // 2554
  function isString(value) {                                                                                           // 2555
    return typeof value == 'string' ||                                                                                 // 2556
      value && typeof value == 'object' && toString.call(value) == stringClass || false;                               // 2557
  }                                                                                                                    // 2558
                                                                                                                       // 2559
  /**                                                                                                                  // 2560
   * Creates an array composed of the own enumerable property values of `object`.                                      // 2561
   *                                                                                                                   // 2562
   * @static                                                                                                           // 2563
   * @memberOf _                                                                                                       // 2564
   * @category Objects                                                                                                 // 2565
   * @param {Object} object The object to inspect.                                                                     // 2566
   * @returns {Array} Returns an array of property values.                                                             // 2567
   * @example                                                                                                          // 2568
   *                                                                                                                   // 2569
   * _.values({ 'one': 1, 'two': 2, 'three': 3 });                                                                     // 2570
   * // => [1, 2, 3] (property order is not guaranteed across environments)                                            // 2571
   */                                                                                                                  // 2572
  function values(object) {                                                                                            // 2573
    var index = -1,                                                                                                    // 2574
        props = keys(object),                                                                                          // 2575
        length = props.length,                                                                                         // 2576
        result = Array(length);                                                                                        // 2577
                                                                                                                       // 2578
    while (++index < length) {                                                                                         // 2579
      result[index] = object[props[index]];                                                                            // 2580
    }                                                                                                                  // 2581
    return result;                                                                                                     // 2582
  }                                                                                                                    // 2583
                                                                                                                       // 2584
  /*--------------------------------------------------------------------------*/                                       // 2585
                                                                                                                       // 2586
  /**                                                                                                                  // 2587
   * Iterates over elements of a collection, returning an array of all elements                                        // 2588
   * the callback returns truey for. The callback is bound to `thisArg` and                                            // 2589
   * invoked with three arguments; (value, index|key, collection).                                                     // 2590
   *                                                                                                                   // 2591
   * If a property name is provided for `callback` the created "_.pluck" style                                         // 2592
   * callback will return the property value of the given element.                                                     // 2593
   *                                                                                                                   // 2594
   * If an object is provided for `callback` the created "_.where" style callback                                      // 2595
   * will return `true` for elements that have the properties of the given object,                                     // 2596
   * else `false`.                                                                                                     // 2597
   *                                                                                                                   // 2598
   * @static                                                                                                           // 2599
   * @memberOf _                                                                                                       // 2600
   * @alias select                                                                                                     // 2601
   * @category Collections                                                                                             // 2602
   * @param {Array|Object|string} collection The collection to iterate over.                                           // 2603
   * @param {Function|Object|string} [callback=identity] The function called                                           // 2604
   *  per iteration. If a property name or object is provided it will be used                                          // 2605
   *  to create a "_.pluck" or "_.where" style callback, respectively.                                                 // 2606
   * @param {*} [thisArg] The `this` binding of `callback`.                                                            // 2607
   * @returns {Array} Returns a new array of elements that passed the callback check.                                  // 2608
   * @example                                                                                                          // 2609
   *                                                                                                                   // 2610
   * var evens = _.filter([1, 2, 3, 4, 5, 6], function(num) { return num % 2 == 0; });                                 // 2611
   * // => [2, 4, 6]                                                                                                   // 2612
   *                                                                                                                   // 2613
   * var characters = [                                                                                                // 2614
   *   { 'name': 'barney', 'age': 36, 'blocked': false },                                                              // 2615
   *   { 'name': 'fred',   'age': 40, 'blocked': true }                                                                // 2616
   * ];                                                                                                                // 2617
   *                                                                                                                   // 2618
   * // using "_.pluck" callback shorthand                                                                             // 2619
   * _.filter(characters, 'blocked');                                                                                  // 2620
   * // => [{ 'name': 'fred', 'age': 40, 'blocked': true }]                                                            // 2621
   *                                                                                                                   // 2622
   * // using "_.where" callback shorthand                                                                             // 2623
   * _.filter(characters, { 'age': 36 });                                                                              // 2624
   * // => [{ 'name': 'barney', 'age': 36, 'blocked': false }]                                                         // 2625
   */                                                                                                                  // 2626
  function filter(collection, callback, thisArg) {                                                                     // 2627
    var result = [];                                                                                                   // 2628
    callback = lodash.createCallback(callback, thisArg, 3);                                                            // 2629
                                                                                                                       // 2630
    if (isArray(collection)) {                                                                                         // 2631
      var index = -1,                                                                                                  // 2632
          length = collection.length;                                                                                  // 2633
                                                                                                                       // 2634
      while (++index < length) {                                                                                       // 2635
        var value = collection[index];                                                                                 // 2636
        if (callback(value, index, collection)) {                                                                      // 2637
          result.push(value);                                                                                          // 2638
        }                                                                                                              // 2639
      }                                                                                                                // 2640
    } else {                                                                                                           // 2641
      baseEach(collection, function(value, index, collection) {                                                        // 2642
        if (callback(value, index, collection)) {                                                                      // 2643
          result.push(value);                                                                                          // 2644
        }                                                                                                              // 2645
      });                                                                                                              // 2646
    }                                                                                                                  // 2647
    return result;                                                                                                     // 2648
  }                                                                                                                    // 2649
                                                                                                                       // 2650
  /**                                                                                                                  // 2651
   * Iterates over elements of a collection, returning the first element that                                          // 2652
   * the callback returns truey for. The callback is bound to `thisArg` and                                            // 2653
   * invoked with three arguments; (value, index|key, collection).                                                     // 2654
   *                                                                                                                   // 2655
   * If a property name is provided for `callback` the created "_.pluck" style                                         // 2656
   * callback will return the property value of the given element.                                                     // 2657
   *                                                                                                                   // 2658
   * If an object is provided for `callback` the created "_.where" style callback                                      // 2659
   * will return `true` for elements that have the properties of the given object,                                     // 2660
   * else `false`.                                                                                                     // 2661
   *                                                                                                                   // 2662
   * @static                                                                                                           // 2663
   * @memberOf _                                                                                                       // 2664
   * @alias detect, findWhere                                                                                          // 2665
   * @category Collections                                                                                             // 2666
   * @param {Array|Object|string} collection The collection to iterate over.                                           // 2667
   * @param {Function|Object|string} [callback=identity] The function called                                           // 2668
   *  per iteration. If a property name or object is provided it will be used                                          // 2669
   *  to create a "_.pluck" or "_.where" style callback, respectively.                                                 // 2670
   * @param {*} [thisArg] The `this` binding of `callback`.                                                            // 2671
   * @returns {*} Returns the found element, else `undefined`.                                                         // 2672
   * @example                                                                                                          // 2673
   *                                                                                                                   // 2674
   * var characters = [                                                                                                // 2675
   *   { 'name': 'barney',  'age': 36, 'blocked': false },                                                             // 2676
   *   { 'name': 'fred',    'age': 40, 'blocked': true },                                                              // 2677
   *   { 'name': 'pebbles', 'age': 1,  'blocked': false }                                                              // 2678
   * ];                                                                                                                // 2679
   *                                                                                                                   // 2680
   * _.find(characters, function(chr) {                                                                                // 2681
   *   return chr.age < 40;                                                                                            // 2682
   * });                                                                                                               // 2683
   * // => { 'name': 'barney', 'age': 36, 'blocked': false }                                                           // 2684
   *                                                                                                                   // 2685
   * // using "_.where" callback shorthand                                                                             // 2686
   * _.find(characters, { 'age': 1 });                                                                                 // 2687
   * // =>  { 'name': 'pebbles', 'age': 1, 'blocked': false }                                                          // 2688
   *                                                                                                                   // 2689
   * // using "_.pluck" callback shorthand                                                                             // 2690
   * _.find(characters, 'blocked');                                                                                    // 2691
   * // => { 'name': 'fred', 'age': 40, 'blocked': true }                                                              // 2692
   */                                                                                                                  // 2693
  function find(collection, callback, thisArg) {                                                                       // 2694
    callback = lodash.createCallback(callback, thisArg, 3);                                                            // 2695
                                                                                                                       // 2696
    if (isArray(collection)) {                                                                                         // 2697
      var index = -1,                                                                                                  // 2698
          length = collection.length;                                                                                  // 2699
                                                                                                                       // 2700
      while (++index < length) {                                                                                       // 2701
        var value = collection[index];                                                                                 // 2702
        if (callback(value, index, collection)) {                                                                      // 2703
          return value;                                                                                                // 2704
        }                                                                                                              // 2705
      }                                                                                                                // 2706
    } else {                                                                                                           // 2707
      var result;                                                                                                      // 2708
      baseEach(collection, function(value, index, collection) {                                                        // 2709
        if (callback(value, index, collection)) {                                                                      // 2710
          result = value;                                                                                              // 2711
          return false;                                                                                                // 2712
        }                                                                                                              // 2713
      });                                                                                                              // 2714
      return result;                                                                                                   // 2715
    }                                                                                                                  // 2716
  }                                                                                                                    // 2717
                                                                                                                       // 2718
  /**                                                                                                                  // 2719
   * Iterates over elements of a collection, executing the callback for each                                           // 2720
   * element. The callback is bound to `thisArg` and invoked with three arguments;                                     // 2721
   * (value, index|key, collection). Callbacks may exit iteration early by                                             // 2722
   * explicitly returning `false`.                                                                                     // 2723
   *                                                                                                                   // 2724
   * Note: As with other "Collections" methods, objects with a `length` property                                       // 2725
   * are iterated like arrays. To avoid this behavior `_.forIn` or `_.forOwn`                                          // 2726
   * may be used for object iteration.                                                                                 // 2727
   *                                                                                                                   // 2728
   * @static                                                                                                           // 2729
   * @memberOf _                                                                                                       // 2730
   * @alias each                                                                                                       // 2731
   * @category Collections                                                                                             // 2732
   * @param {Array|Object|string} collection The collection to iterate over.                                           // 2733
   * @param {Function} [callback=identity] The function called per iteration.                                          // 2734
   * @param {*} [thisArg] The `this` binding of `callback`.                                                            // 2735
   * @returns {Array|Object|string} Returns `collection`.                                                              // 2736
   * @example                                                                                                          // 2737
   *                                                                                                                   // 2738
   * _([1, 2, 3]).forEach(function(num) { console.log(num); }).join(',');                                              // 2739
   * // => logs each number and returns '1,2,3'                                                                        // 2740
   *                                                                                                                   // 2741
   * _.forEach({ 'one': 1, 'two': 2, 'three': 3 }, function(num) { console.log(num); });                               // 2742
   * // => logs each number and returns the object (property order is not guaranteed across environments)              // 2743
   */                                                                                                                  // 2744
  function forEach(collection, callback, thisArg) {                                                                    // 2745
    if (callback && typeof thisArg == 'undefined' && isArray(collection)) {                                            // 2746
      var index = -1,                                                                                                  // 2747
          length = collection.length;                                                                                  // 2748
                                                                                                                       // 2749
      while (++index < length) {                                                                                       // 2750
        if (callback(collection[index], index, collection) === false) {                                                // 2751
          break;                                                                                                       // 2752
        }                                                                                                              // 2753
      }                                                                                                                // 2754
    } else {                                                                                                           // 2755
      baseEach(collection, callback, thisArg);                                                                         // 2756
    }                                                                                                                  // 2757
    return collection;                                                                                                 // 2758
  }                                                                                                                    // 2759
                                                                                                                       // 2760
  /**                                                                                                                  // 2761
   * The opposite of `_.filter` this method returns the elements of a                                                  // 2762
   * collection that the callback does **not** return truey for.                                                       // 2763
   *                                                                                                                   // 2764
   * If a property name is provided for `callback` the created "_.pluck" style                                         // 2765
   * callback will return the property value of the given element.                                                     // 2766
   *                                                                                                                   // 2767
   * If an object is provided for `callback` the created "_.where" style callback                                      // 2768
   * will return `true` for elements that have the properties of the given object,                                     // 2769
   * else `false`.                                                                                                     // 2770
   *                                                                                                                   // 2771
   * @static                                                                                                           // 2772
   * @memberOf _                                                                                                       // 2773
   * @category Collections                                                                                             // 2774
   * @param {Array|Object|string} collection The collection to iterate over.                                           // 2775
   * @param {Function|Object|string} [callback=identity] The function called                                           // 2776
   *  per iteration. If a property name or object is provided it will be used                                          // 2777
   *  to create a "_.pluck" or "_.where" style callback, respectively.                                                 // 2778
   * @param {*} [thisArg] The `this` binding of `callback`.                                                            // 2779
   * @returns {Array} Returns a new array of elements that failed the callback check.                                  // 2780
   * @example                                                                                                          // 2781
   *                                                                                                                   // 2782
   * var odds = _.reject([1, 2, 3, 4, 5, 6], function(num) { return num % 2 == 0; });                                  // 2783
   * // => [1, 3, 5]                                                                                                   // 2784
   *                                                                                                                   // 2785
   * var characters = [                                                                                                // 2786
   *   { 'name': 'barney', 'age': 36, 'blocked': false },                                                              // 2787
   *   { 'name': 'fred',   'age': 40, 'blocked': true }                                                                // 2788
   * ];                                                                                                                // 2789
   *                                                                                                                   // 2790
   * // using "_.pluck" callback shorthand                                                                             // 2791
   * _.reject(characters, 'blocked');                                                                                  // 2792
   * // => [{ 'name': 'barney', 'age': 36, 'blocked': false }]                                                         // 2793
   *                                                                                                                   // 2794
   * // using "_.where" callback shorthand                                                                             // 2795
   * _.reject(characters, { 'age': 36 });                                                                              // 2796
   * // => [{ 'name': 'fred', 'age': 40, 'blocked': true }]                                                            // 2797
   */                                                                                                                  // 2798
  function reject(collection, callback, thisArg) {                                                                     // 2799
    callback = lodash.createCallback(callback, thisArg, 3);                                                            // 2800
    return filter(collection, function(value, index, collection) {                                                     // 2801
      return !callback(value, index, collection);                                                                      // 2802
    });                                                                                                                // 2803
  }                                                                                                                    // 2804
                                                                                                                       // 2805
  /*--------------------------------------------------------------------------*/                                       // 2806
                                                                                                                       // 2807
  /**                                                                                                                  // 2808
   * Creates a function that, when called, invokes `func` with the `this`                                              // 2809
   * binding of `thisArg` and prepends any additional `bind` arguments to those                                        // 2810
   * provided to the bound function.                                                                                   // 2811
   *                                                                                                                   // 2812
   * @static                                                                                                           // 2813
   * @memberOf _                                                                                                       // 2814
   * @category Functions                                                                                               // 2815
   * @param {Function} func The function to bind.                                                                      // 2816
   * @param {*} [thisArg] The `this` binding of `func`.                                                                // 2817
   * @param {...*} [arg] Arguments to be partially applied.                                                            // 2818
   * @returns {Function} Returns the new bound function.                                                               // 2819
   * @example                                                                                                          // 2820
   *                                                                                                                   // 2821
   * var func = function(greeting) {                                                                                   // 2822
   *   return greeting + ' ' + this.name;                                                                              // 2823
   * };                                                                                                                // 2824
   *                                                                                                                   // 2825
   * func = _.bind(func, { 'name': 'fred' }, 'hi');                                                                    // 2826
   * func();                                                                                                           // 2827
   * // => 'hi fred'                                                                                                   // 2828
   */                                                                                                                  // 2829
  function bind(func, thisArg) {                                                                                       // 2830
    return arguments.length > 2                                                                                        // 2831
      ? createWrapper(func, 17, slice(arguments, 2), null, thisArg)                                                    // 2832
      : createWrapper(func, 1, null, null, thisArg);                                                                   // 2833
  }                                                                                                                    // 2834
                                                                                                                       // 2835
  /*--------------------------------------------------------------------------*/                                       // 2836
                                                                                                                       // 2837
  /**                                                                                                                  // 2838
   * Produces a callback bound to an optional `thisArg`. If `func` is a property                                       // 2839
   * name the created callback will return the property value for a given element.                                     // 2840
   * If `func` is an object the created callback will return `true` for elements                                       // 2841
   * that contain the equivalent object properties, otherwise it will return `false`.                                  // 2842
   *                                                                                                                   // 2843
   * @static                                                                                                           // 2844
   * @memberOf _                                                                                                       // 2845
   * @category Utilities                                                                                               // 2846
   * @param {*} [func=identity] The value to convert to a callback.                                                    // 2847
   * @param {*} [thisArg] The `this` binding of the created callback.                                                  // 2848
   * @param {number} [argCount] The number of arguments the callback accepts.                                          // 2849
   * @returns {Function} Returns a callback function.                                                                  // 2850
   * @example                                                                                                          // 2851
   *                                                                                                                   // 2852
   * var characters = [                                                                                                // 2853
   *   { 'name': 'barney', 'age': 36 },                                                                                // 2854
   *   { 'name': 'fred',   'age': 40 }                                                                                 // 2855
   * ];                                                                                                                // 2856
   *                                                                                                                   // 2857
   * // wrap to create custom callback shorthands                                                                      // 2858
   * _.createCallback = _.wrap(_.createCallback, function(func, callback, thisArg) {                                   // 2859
   *   var match = /^(.+?)__([gl]t)(.+)$/.exec(callback);                                                              // 2860
   *   return !match ? func(callback, thisArg) : function(object) {                                                    // 2861
   *     return match[2] == 'gt' ? object[match[1]] > match[3] : object[match[1]] < match[3];                          // 2862
   *   };                                                                                                              // 2863
   * });                                                                                                               // 2864
   *                                                                                                                   // 2865
   * _.filter(characters, 'age__gt38');                                                                                // 2866
   * // => [{ 'name': 'fred', 'age': 40 }]                                                                             // 2867
   */                                                                                                                  // 2868
  function createCallback(func, thisArg, argCount) {                                                                   // 2869
    var type = typeof func;                                                                                            // 2870
    if (func == null || type == 'function') {                                                                          // 2871
      return baseCreateCallback(func, thisArg, argCount);                                                              // 2872
    }                                                                                                                  // 2873
    // handle "_.pluck" style callback shorthands                                                                      // 2874
    if (type != 'object') {                                                                                            // 2875
      return property(func);                                                                                           // 2876
    }                                                                                                                  // 2877
    var props = keys(func),                                                                                            // 2878
        key = props[0],                                                                                                // 2879
        a = func[key];                                                                                                 // 2880
                                                                                                                       // 2881
    // handle "_.where" style callback shorthands                                                                      // 2882
    if (props.length == 1 && a === a && !isObject(a)) {                                                                // 2883
      // fast path the common case of providing an object with a single                                                // 2884
      // property containing a primitive value                                                                         // 2885
      return function(object) {                                                                                        // 2886
        var b = object[key];                                                                                           // 2887
        return a === b && (a !== 0 || (1 / a == 1 / b));                                                               // 2888
      };                                                                                                               // 2889
    }                                                                                                                  // 2890
    return function(object) {                                                                                          // 2891
      var length = props.length,                                                                                       // 2892
          result = false;                                                                                              // 2893
                                                                                                                       // 2894
      while (length--) {                                                                                               // 2895
        if (!(result = baseIsEqual(object[props[length]], func[props[length]], null, true))) {                         // 2896
          break;                                                                                                       // 2897
        }                                                                                                              // 2898
      }                                                                                                                // 2899
      return result;                                                                                                   // 2900
    };                                                                                                                 // 2901
  }                                                                                                                    // 2902
                                                                                                                       // 2903
  /**                                                                                                                  // 2904
   * Converts the characters `&`, `<`, `>`, `"`, and `'` in `string` to their                                          // 2905
   * corresponding HTML entities.                                                                                      // 2906
   *                                                                                                                   // 2907
   * @static                                                                                                           // 2908
   * @memberOf _                                                                                                       // 2909
   * @category Utilities                                                                                               // 2910
   * @param {string} string The string to escape.                                                                      // 2911
   * @returns {string} Returns the escaped string.                                                                     // 2912
   * @example                                                                                                          // 2913
   *                                                                                                                   // 2914
   * _.escape('Fred, Wilma, & Pebbles');                                                                               // 2915
   * // => 'Fred, Wilma, &amp; Pebbles'                                                                                // 2916
   */                                                                                                                  // 2917
  function escape(string) {                                                                                            // 2918
    return string == null ? '' : String(string).replace(reUnescapedHtml, escapeHtmlChar);                              // 2919
  }                                                                                                                    // 2920
                                                                                                                       // 2921
  /**                                                                                                                  // 2922
   * This method returns the first argument provided to it.                                                            // 2923
   *                                                                                                                   // 2924
   * @static                                                                                                           // 2925
   * @memberOf _                                                                                                       // 2926
   * @category Utilities                                                                                               // 2927
   * @param {*} value Any value.                                                                                       // 2928
   * @returns {*} Returns `value`.                                                                                     // 2929
   * @example                                                                                                          // 2930
   *                                                                                                                   // 2931
   * var object = { 'name': 'fred' };                                                                                  // 2932
   * _.identity(object) === object;                                                                                    // 2933
   * // => true                                                                                                        // 2934
   */                                                                                                                  // 2935
  function identity(value) {                                                                                           // 2936
    return value;                                                                                                      // 2937
  }                                                                                                                    // 2938
                                                                                                                       // 2939
  /**                                                                                                                  // 2940
   * A no-operation function.                                                                                          // 2941
   *                                                                                                                   // 2942
   * @static                                                                                                           // 2943
   * @memberOf _                                                                                                       // 2944
   * @category Utilities                                                                                               // 2945
   * @example                                                                                                          // 2946
   *                                                                                                                   // 2947
   * var object = { 'name': 'fred' };                                                                                  // 2948
   * _.noop(object) === undefined;                                                                                     // 2949
   * // => true                                                                                                        // 2950
   */                                                                                                                  // 2951
  function noop() {                                                                                                    // 2952
    // no operation performed                                                                                          // 2953
  }                                                                                                                    // 2954
                                                                                                                       // 2955
  /**                                                                                                                  // 2956
   * Creates a "_.pluck" style function, which returns the `key` value of a                                            // 2957
   * given object.                                                                                                     // 2958
   *                                                                                                                   // 2959
   * @static                                                                                                           // 2960
   * @memberOf _                                                                                                       // 2961
   * @category Utilities                                                                                               // 2962
   * @param {string} key The name of the property to retrieve.                                                         // 2963
   * @returns {Function} Returns the new function.                                                                     // 2964
   * @example                                                                                                          // 2965
   *                                                                                                                   // 2966
   * var characters = [                                                                                                // 2967
   *   { 'name': 'fred',   'age': 40 },                                                                                // 2968
   *   { 'name': 'barney', 'age': 36 }                                                                                 // 2969
   * ];                                                                                                                // 2970
   *                                                                                                                   // 2971
   * var getName = _.property('name');                                                                                 // 2972
   *                                                                                                                   // 2973
   * _.map(characters, getName);                                                                                       // 2974
   * // => ['barney', 'fred']                                                                                          // 2975
   *                                                                                                                   // 2976
   * _.sortBy(characters, getName);                                                                                    // 2977
   * // => [{ 'name': 'barney', 'age': 36 }, { 'name': 'fred',   'age': 40 }]                                          // 2978
   */                                                                                                                  // 2979
  function property(key) {                                                                                             // 2980
    return function(object) {                                                                                          // 2981
      return object[key];                                                                                              // 2982
    };                                                                                                                 // 2983
  }                                                                                                                    // 2984
                                                                                                                       // 2985
  /**                                                                                                                  // 2986
   * A micro-templating method that handles arbitrary delimiters, preserves                                            // 2987
   * whitespace, and correctly escapes quotes within interpolated code.                                                // 2988
   *                                                                                                                   // 2989
   * Note: In the development build, `_.template` utilizes sourceURLs for easier                                       // 2990
   * debugging. See http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/#toc-sourceurl                    // 2991
   *                                                                                                                   // 2992
   * For more information on precompiling templates see:                                                               // 2993
   * http://lodash.com/custom-builds                                                                                   // 2994
   *                                                                                                                   // 2995
   * For more information on Chrome extension sandboxes see:                                                           // 2996
   * http://developer.chrome.com/stable/extensions/sandboxingEval.html                                                 // 2997
   *                                                                                                                   // 2998
   * @static                                                                                                           // 2999
   * @memberOf _                                                                                                       // 3000
   * @category Utilities                                                                                               // 3001
   * @param {string} text The template text.                                                                           // 3002
   * @param {Object} data The data object used to populate the text.                                                   // 3003
   * @param {Object} [options] The options object.                                                                     // 3004
   * @param {RegExp} [options.escape] The "escape" delimiter.                                                          // 3005
   * @param {RegExp} [options.evaluate] The "evaluate" delimiter.                                                      // 3006
   * @param {Object} [options.imports] An object to import into the template as local variables.                       // 3007
   * @param {RegExp} [options.interpolate] The "interpolate" delimiter.                                                // 3008
   * @param {string} [sourceURL] The sourceURL of the template's compiled source.                                      // 3009
   * @param {string} [variable] The data object variable name.                                                         // 3010
   * @returns {Function|string} Returns a compiled function when no `data` object                                      // 3011
   *  is given, else it returns the interpolated text.                                                                 // 3012
   * @example                                                                                                          // 3013
   *                                                                                                                   // 3014
   * // using the "interpolate" delimiter to create a compiled template                                                // 3015
   * var compiled = _.template('hello <%= name %>');                                                                   // 3016
   * compiled({ 'name': 'fred' });                                                                                     // 3017
   * // => 'hello fred'                                                                                                // 3018
   *                                                                                                                   // 3019
   * // using the "escape" delimiter to escape HTML in data property values                                            // 3020
   * _.template('<b><%- value %></b>', { 'value': '<script>' });                                                       // 3021
   * // => '<b>&lt;script&gt;</b>'                                                                                     // 3022
   *                                                                                                                   // 3023
   * // using the "evaluate" delimiter to generate HTML                                                                // 3024
   * var list = '<% _.forEach(people, function(name) { %><li><%- name %></li><% }); %>';                               // 3025
   * _.template(list, { 'people': ['fred', 'barney'] });                                                               // 3026
   * // => '<li>fred</li><li>barney</li>'                                                                              // 3027
   *                                                                                                                   // 3028
   * // using the ES6 delimiter as an alternative to the default "interpolate" delimiter                               // 3029
   * _.template('hello ${ name }', { 'name': 'pebbles' });                                                             // 3030
   * // => 'hello pebbles'                                                                                             // 3031
   *                                                                                                                   // 3032
   * // using the internal `print` function in "evaluate" delimiters                                                   // 3033
   * _.template('<% print("hello " + name); %>!', { 'name': 'barney' });                                               // 3034
   * // => 'hello barney!'                                                                                             // 3035
   *                                                                                                                   // 3036
   * // using a custom template delimiters                                                                             // 3037
   * _.templateSettings = {                                                                                            // 3038
   *   'interpolate': /{{([\s\S]+?)}}/g                                                                                // 3039
   * };                                                                                                                // 3040
   *                                                                                                                   // 3041
   * _.template('hello {{ name }}!', { 'name': 'mustache' });                                                          // 3042
   * // => 'hello mustache!'                                                                                           // 3043
   *                                                                                                                   // 3044
   * // using the `imports` option to import jQuery                                                                    // 3045
   * var list = '<% jq.each(people, function(name) { %><li><%- name %></li><% }); %>';                                 // 3046
   * _.template(list, { 'people': ['fred', 'barney'] }, { 'imports': { 'jq': jQuery } });                              // 3047
   * // => '<li>fred</li><li>barney</li>'                                                                              // 3048
   *                                                                                                                   // 3049
   * // using the `sourceURL` option to specify a custom sourceURL for the template                                    // 3050
   * var compiled = _.template('hello <%= name %>', null, { 'sourceURL': '/basic/greeting.jst' });                     // 3051
   * compiled(data);                                                                                                   // 3052
   * // => find the source of "greeting.jst" under the Sources tab or Resources panel of the web inspector             // 3053
   *                                                                                                                   // 3054
   * // using the `variable` option to ensure a with-statement isn't used in the compiled template                     // 3055
   * var compiled = _.template('hi <%= data.name %>!', null, { 'variable': 'data' });                                  // 3056
   * compiled.source;                                                                                                  // 3057
   * // => function(data) {                                                                                            // 3058
   *   var __t, __p = '', __e = _.escape;                                                                              // 3059
   *   __p += 'hi ' + ((__t = ( data.name )) == null ? '' : __t) + '!';                                                // 3060
   *   return __p;                                                                                                     // 3061
   * }                                                                                                                 // 3062
   *                                                                                                                   // 3063
   * // using the `source` property to inline compiled templates for meaningful                                        // 3064
   * // line numbers in error messages and a stack trace                                                               // 3065
   * fs.writeFileSync(path.join(cwd, 'jst.js'), '\
   *   var JST = {\
   *     "main": ' + _.template(mainText).source + '\
   *   };\
   * ');                                                                                                               // 3070
   */                                                                                                                  // 3071
  function template(text, data, options) {                                                                             // 3072
    // based on John Resig's `tmpl` implementation                                                                     // 3073
    // http://ejohn.org/blog/javascript-micro-templating/                                                              // 3074
    // and Laura Doktorova's doT.js                                                                                    // 3075
    // https://github.com/olado/doT                                                                                    // 3076
    var settings = lodash.templateSettings;                                                                            // 3077
    text = String(text || '');                                                                                         // 3078
                                                                                                                       // 3079
    // avoid missing dependencies when `iteratorTemplate` is not defined                                               // 3080
    options = defaults({}, options, settings);                                                                         // 3081
                                                                                                                       // 3082
    var imports = defaults({}, options.imports, settings.imports),                                                     // 3083
        importsKeys = keys(imports),                                                                                   // 3084
        importsValues = values(imports);                                                                               // 3085
                                                                                                                       // 3086
    var isEvaluating,                                                                                                  // 3087
        index = 0,                                                                                                     // 3088
        interpolate = options.interpolate || reNoMatch,                                                                // 3089
        source = "__p += '";                                                                                           // 3090
                                                                                                                       // 3091
    // compile the regexp to match each delimiter                                                                      // 3092
    var reDelimiters = RegExp(                                                                                         // 3093
      (options.escape || reNoMatch).source + '|' +                                                                     // 3094
      interpolate.source + '|' +                                                                                       // 3095
      (interpolate === reInterpolate ? reEsTemplate : reNoMatch).source + '|' +                                        // 3096
      (options.evaluate || reNoMatch).source + '|$'                                                                    // 3097
    , 'g');                                                                                                            // 3098
                                                                                                                       // 3099
    text.replace(reDelimiters, function(match, escapeValue, interpolateValue, esTemplateValue, evaluateValue, offset) {
      interpolateValue || (interpolateValue = esTemplateValue);                                                        // 3101
                                                                                                                       // 3102
      // escape characters that cannot be included in string literals                                                  // 3103
      source += text.slice(index, offset).replace(reUnescapedString, escapeStringChar);                                // 3104
                                                                                                                       // 3105
      // replace delimiters with snippets                                                                              // 3106
      if (escapeValue) {                                                                                               // 3107
        source += "' +\n__e(" + escapeValue + ") +\n'";                                                                // 3108
      }                                                                                                                // 3109
      if (evaluateValue) {                                                                                             // 3110
        isEvaluating = true;                                                                                           // 3111
        source += "';\n" + evaluateValue + ";\n__p += '";                                                              // 3112
      }                                                                                                                // 3113
      if (interpolateValue) {                                                                                          // 3114
        source += "' +\n((__t = (" + interpolateValue + ")) == null ? '' : __t) +\n'";                                 // 3115
      }                                                                                                                // 3116
      index = offset + match.length;                                                                                   // 3117
                                                                                                                       // 3118
      // the JS engine embedded in Adobe products requires returning the `match`                                       // 3119
      // string in order to produce the correct `offset` value                                                         // 3120
      return match;                                                                                                    // 3121
    });                                                                                                                // 3122
                                                                                                                       // 3123
    source += "';\n";                                                                                                  // 3124
                                                                                                                       // 3125
    // if `variable` is not specified, wrap a with-statement around the generated                                      // 3126
    // code to add the data object to the top of the scope chain                                                       // 3127
    var variable = options.variable,                                                                                   // 3128
        hasVariable = variable;                                                                                        // 3129
                                                                                                                       // 3130
    if (!hasVariable) {                                                                                                // 3131
      variable = 'obj';                                                                                                // 3132
      source = 'with (' + variable + ') {\n' + source + '\n}\n';                                                       // 3133
    }                                                                                                                  // 3134
    // cleanup code by stripping empty strings                                                                         // 3135
    source = (isEvaluating ? source.replace(reEmptyStringLeading, '') : source)                                        // 3136
      .replace(reEmptyStringMiddle, '$1')                                                                              // 3137
      .replace(reEmptyStringTrailing, '$1;');                                                                          // 3138
                                                                                                                       // 3139
    // frame code as the function body                                                                                 // 3140
    source = 'function(' + variable + ') {\n' +                                                                        // 3141
      (hasVariable ? '' : variable + ' || (' + variable + ' = {});\n') +                                               // 3142
      "var __t, __p = '', __e = _.escape" +                                                                            // 3143
      (isEvaluating                                                                                                    // 3144
        ? ', __j = Array.prototype.join;\n' +                                                                          // 3145
          "function print() { __p += __j.call(arguments, '') }\n"                                                      // 3146
        : ';\n'                                                                                                        // 3147
      ) +                                                                                                              // 3148
      source +                                                                                                         // 3149
      'return __p\n}';                                                                                                 // 3150
                                                                                                                       // 3151
    // Use a sourceURL for easier debugging.                                                                           // 3152
    // http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/#toc-sourceurl                                 // 3153
    var sourceURL = '\n/*\n//# sourceURL=' + (options.sourceURL || '/lodash/template/source[' + (templateCounter++) + ']') + '\n*/';
                                                                                                                       // 3155
    try {                                                                                                              // 3156
      var result = Function(importsKeys, 'return ' + source + sourceURL).apply(undefined, importsValues);              // 3157
    } catch(e) {                                                                                                       // 3158
      e.source = source;                                                                                               // 3159
      throw e;                                                                                                         // 3160
    }                                                                                                                  // 3161
    if (data) {                                                                                                        // 3162
      return result(data);                                                                                             // 3163
    }                                                                                                                  // 3164
    // provide the compiled function's source by its `toString` method, in                                             // 3165
    // supported environments, or the `source` property as a convenience for                                           // 3166
    // inlining compiled templates during the build process                                                            // 3167
    result.source = source;                                                                                            // 3168
    return result;                                                                                                     // 3169
  }                                                                                                                    // 3170
                                                                                                                       // 3171
  /*--------------------------------------------------------------------------*/                                       // 3172
                                                                                                                       // 3173
  lodash.assign = assign;                                                                                              // 3174
  lodash.bind = bind;                                                                                                  // 3175
  lodash.createCallback = createCallback;                                                                              // 3176
  lodash.defaults = defaults;                                                                                          // 3177
  lodash.filter = filter;                                                                                              // 3178
  lodash.forEach = forEach;                                                                                            // 3179
  lodash.forIn = forIn;                                                                                                // 3180
  lodash.forOwn = forOwn;                                                                                              // 3181
  lodash.keys = keys;                                                                                                  // 3182
  lodash.property = property;                                                                                          // 3183
  lodash.reject = reject;                                                                                              // 3184
  lodash.values = values;                                                                                              // 3185
                                                                                                                       // 3186
  lodash.each = forEach;                                                                                               // 3187
  lodash.extend = assign;                                                                                              // 3188
  lodash.select = filter;                                                                                              // 3189
                                                                                                                       // 3190
  /*--------------------------------------------------------------------------*/                                       // 3191
                                                                                                                       // 3192
  // add functions that return unwrapped values when chaining                                                          // 3193
  lodash.clone = clone;                                                                                                // 3194
  lodash.cloneDeep = cloneDeep;                                                                                        // 3195
  lodash.escape = escape;                                                                                              // 3196
  lodash.find = find;                                                                                                  // 3197
  lodash.identity = identity;                                                                                          // 3198
  lodash.isArguments = isArguments;                                                                                    // 3199
  lodash.isArray = isArray;                                                                                            // 3200
  lodash.isFunction = isFunction;                                                                                      // 3201
  lodash.isObject = isObject;                                                                                          // 3202
  lodash.isString = isString;                                                                                          // 3203
  lodash.noop = noop;                                                                                                  // 3204
  lodash.template = template;                                                                                          // 3205
                                                                                                                       // 3206
  lodash.detect = find;                                                                                                // 3207
  lodash.findWhere = find;                                                                                             // 3208
                                                                                                                       // 3209
  /*--------------------------------------------------------------------------*/                                       // 3210
                                                                                                                       // 3211
  /**                                                                                                                  // 3212
   * The semantic version number.                                                                                      // 3213
   *                                                                                                                   // 3214
   * @static                                                                                                           // 3215
   * @memberOf _                                                                                                       // 3216
   * @type string                                                                                                      // 3217
   */                                                                                                                  // 3218
  lodash.VERSION = '2.4.1';                                                                                            // 3219
                                                                                                                       // 3220
  /*--------------------------------------------------------------------------*/                                       // 3221
                                                                                                                       // 3222
  if (freeExports && freeModule) {                                                                                     // 3223
    // in Node.js or RingoJS                                                                                           // 3224
    if (moduleExports) {                                                                                               // 3225
      (freeModule.exports = lodash)._ = lodash;                                                                        // 3226
    }                                                                                                                  // 3227
    // in Narwhal or Rhino -require                                                                                    // 3228
    else {                                                                                                             // 3229
      freeExports._ = lodash;                                                                                          // 3230
    }                                                                                                                  // 3231
  }                                                                                                                    // 3232
                                                                                                                       // 3233
}.call(this));                                                                                                         // 3234
                                                                                                                       // 3235
});                                                                                                                    // 3236
require.register("side-comments/js/helpers/mobile-check.js", function(exports, require, module){                       // 3237
module.exports = function() {                                                                                          // 3238
	var check = false;                                                                                                    // 3239
	(function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))check = true})(navigator.userAgent||navigator.vendor||window.opera);
	return check;                                                                                                         // 3241
}                                                                                                                      // 3242
});                                                                                                                    // 3243
                                                                                                                       // 3244
require.register("side-comments/templates/section.html", function(exports, require, module){                           // 3245
module.exports = '<div class="side-comment <%= sectionClasses %>">\n  <a href="#" class="marker">\n    <span><%= comments.length %></span>\n  </a>\n  \n  <div class="comments-wrapper">\n    <ul class="comments">\n      <% _.each(comments, function( comment ){ %>\n        <%= _.template(commentTemplate, { comment: comment, currentUser: currentUser }) %>\n      <% }) %>\n    </ul>\n    \n    <a href="#" class="add-comment">Leave a comment</a>\n    \n    <% if (currentUser){ %>\n      <div class="comment-form">\n        <div class="author-avatar">\n          <img src="<%= currentUser.avatarUrl %>">\n        </div>\n        <p class="author-name">\n          <%= currentUser.name %>\n        </p>\n        <div class="comment-box" contenteditable="true" data-placeholder-content="Leave a comment..."></div>\n        <div class="actions">\n          <a href="#" class="action-link post">Post</a>\n          <a href="#" class="action-link cancel">Cancel</a>\n        </div>\n      </div>\n    <% } %>\n  </div>\n</div>';
});                                                                                                                    // 3247
require.register("side-comments/templates/comment.html", function(exports, require, module){                           // 3248
module.exports = '<li data-comment-id="<%= comment.id %>">\n  <div class="author-avatar">\n    <img src="<%= comment.authorAvatarUrl %>">\n  </div>\n  <p class="author-name">\n    <%= comment.authorName %>\n  </p>\n  <p class="comment">\n    <%= comment.comment %>\n  </p>\n  <% if (currentUser && comment.authorId === currentUser.id){ %>\n  <a href="#" class="action-link delete">Delete</a>\n  <% } %>\n</li>';
});                                                                                                                    // 3250
require.alias("component-emitter/index.js", "side-comments/deps/emitter/index.js");                                    // 3251
require.alias("component-emitter/index.js", "emitter/index.js");                                                       // 3252
                                                                                                                       // 3253
require.alias("side-comments/js/main.js", "side-comments/index.js");                                                   // 3254
                                                                                                                       // 3255
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/compatibility/medium-editor.js                                                             //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
/*global self, document, DOMException */                                                                               // 1
                                                                                                                       // 2
/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */                                    // 3
                                                                                                                       // 4
// Full polyfill for browsers with no classList support                                                                // 5
if (!("classList" in document.createElement("_"))) {                                                                   // 6
  (function (view) {                                                                                                   // 7
                                                                                                                       // 8
  "use strict";                                                                                                        // 9
                                                                                                                       // 10
  if (!('Element' in view)) return;                                                                                    // 11
                                                                                                                       // 12
  var                                                                                                                  // 13
      classListProp = "classList"                                                                                      // 14
    , protoProp = "prototype"                                                                                          // 15
    , elemCtrProto = view.Element[protoProp]                                                                           // 16
    , objCtr = Object                                                                                                  // 17
    , strTrim = String[protoProp].trim || function () {                                                                // 18
      return this.replace(/^\s+|\s+$/g, "");                                                                           // 19
    }                                                                                                                  // 20
    , arrIndexOf = Array[protoProp].indexOf || function (item) {                                                       // 21
      var                                                                                                              // 22
          i = 0                                                                                                        // 23
        , len = this.length                                                                                            // 24
      ;                                                                                                                // 25
      for (; i < len; i++) {                                                                                           // 26
        if (i in this && this[i] === item) {                                                                           // 27
          return i;                                                                                                    // 28
        }                                                                                                              // 29
      }                                                                                                                // 30
      return -1;                                                                                                       // 31
    }                                                                                                                  // 32
    // Vendors: please allow content code to instantiate DOMExceptions                                                 // 33
    , DOMEx = function (type, message) {                                                                               // 34
      this.name = type;                                                                                                // 35
      this.code = DOMException[type];                                                                                  // 36
      this.message = message;                                                                                          // 37
    }                                                                                                                  // 38
    , checkTokenAndGetIndex = function (classList, token) {                                                            // 39
      if (token === "") {                                                                                              // 40
        throw new DOMEx(                                                                                               // 41
            "SYNTAX_ERR"                                                                                               // 42
          , "An invalid or illegal string was specified"                                                               // 43
        );                                                                                                             // 44
      }                                                                                                                // 45
      if (/\s/.test(token)) {                                                                                          // 46
        throw new DOMEx(                                                                                               // 47
            "INVALID_CHARACTER_ERR"                                                                                    // 48
          , "String contains an invalid character"                                                                     // 49
        );                                                                                                             // 50
      }                                                                                                                // 51
      return arrIndexOf.call(classList, token);                                                                        // 52
    }                                                                                                                  // 53
    , ClassList = function (elem) {                                                                                    // 54
      var                                                                                                              // 55
          trimmedClasses = strTrim.call(elem.getAttribute("class") || "")                                              // 56
        , classes = trimmedClasses ? trimmedClasses.split(/\s+/) : []                                                  // 57
        , i = 0                                                                                                        // 58
        , len = classes.length                                                                                         // 59
      ;                                                                                                                // 60
      for (; i < len; i++) {                                                                                           // 61
        this.push(classes[i]);                                                                                         // 62
      }                                                                                                                // 63
      this._updateClassName = function () {                                                                            // 64
        elem.setAttribute("class", this.toString());                                                                   // 65
      };                                                                                                               // 66
    }                                                                                                                  // 67
    , classListProto = ClassList[protoProp] = []                                                                       // 68
    , classListGetter = function () {                                                                                  // 69
      return new ClassList(this);                                                                                      // 70
    }                                                                                                                  // 71
  ;                                                                                                                    // 72
  // Most DOMException implementations don't allow calling DOMException's toString()                                   // 73
  // on non-DOMExceptions. Error's toString() is sufficient here.                                                      // 74
  DOMEx[protoProp] = Error[protoProp];                                                                                 // 75
  classListProto.item = function (i) {                                                                                 // 76
    return this[i] || null;                                                                                            // 77
  };                                                                                                                   // 78
  classListProto.contains = function (token) {                                                                         // 79
    token += "";                                                                                                       // 80
    return checkTokenAndGetIndex(this, token) !== -1;                                                                  // 81
  };                                                                                                                   // 82
  classListProto.add = function () {                                                                                   // 83
    var                                                                                                                // 84
        tokens = arguments                                                                                             // 85
      , i = 0                                                                                                          // 86
      , l = tokens.length                                                                                              // 87
      , token                                                                                                          // 88
      , updated = false                                                                                                // 89
    ;                                                                                                                  // 90
    do {                                                                                                               // 91
      token = tokens[i] + "";                                                                                          // 92
      if (checkTokenAndGetIndex(this, token) === -1) {                                                                 // 93
        this.push(token);                                                                                              // 94
        updated = true;                                                                                                // 95
      }                                                                                                                // 96
    }                                                                                                                  // 97
    while (++i < l);                                                                                                   // 98
                                                                                                                       // 99
    if (updated) {                                                                                                     // 100
      this._updateClassName();                                                                                         // 101
    }                                                                                                                  // 102
  };                                                                                                                   // 103
  classListProto.remove = function () {                                                                                // 104
    var                                                                                                                // 105
        tokens = arguments                                                                                             // 106
      , i = 0                                                                                                          // 107
      , l = tokens.length                                                                                              // 108
      , token                                                                                                          // 109
      , updated = false                                                                                                // 110
      , index                                                                                                          // 111
    ;                                                                                                                  // 112
    do {                                                                                                               // 113
      token = tokens[i] + "";                                                                                          // 114
      index = checkTokenAndGetIndex(this, token);                                                                      // 115
      while (index !== -1) {                                                                                           // 116
        this.splice(index, 1);                                                                                         // 117
        updated = true;                                                                                                // 118
        index = checkTokenAndGetIndex(this, token);                                                                    // 119
      }                                                                                                                // 120
    }                                                                                                                  // 121
    while (++i < l);                                                                                                   // 122
                                                                                                                       // 123
    if (updated) {                                                                                                     // 124
      this._updateClassName();                                                                                         // 125
    }                                                                                                                  // 126
  };                                                                                                                   // 127
  classListProto.toggle = function (token, force) {                                                                    // 128
    token += "";                                                                                                       // 129
                                                                                                                       // 130
    var                                                                                                                // 131
        result = this.contains(token)                                                                                  // 132
      , method = result ?                                                                                              // 133
        force !== true && "remove"                                                                                     // 134
      :                                                                                                                // 135
        force !== false && "add"                                                                                       // 136
    ;                                                                                                                  // 137
                                                                                                                       // 138
    if (method) {                                                                                                      // 139
      this[method](token);                                                                                             // 140
    }                                                                                                                  // 141
                                                                                                                       // 142
    if (force === true || force === false) {                                                                           // 143
      return force;                                                                                                    // 144
    } else {                                                                                                           // 145
      return !result;                                                                                                  // 146
    }                                                                                                                  // 147
  };                                                                                                                   // 148
  classListProto.toString = function () {                                                                              // 149
    return this.join(" ");                                                                                             // 150
  };                                                                                                                   // 151
                                                                                                                       // 152
  if (objCtr.defineProperty) {                                                                                         // 153
    var classListPropDesc = {                                                                                          // 154
        get: classListGetter                                                                                           // 155
      , enumerable: true                                                                                               // 156
      , configurable: true                                                                                             // 157
    };                                                                                                                 // 158
    try {                                                                                                              // 159
      objCtr.defineProperty(elemCtrProto, classListProp, classListPropDesc);                                           // 160
    } catch (ex) { // IE 8 doesn't support enumerable:true                                                             // 161
      if (ex.number === -0x7FF5EC54) {                                                                                 // 162
        classListPropDesc.enumerable = false;                                                                          // 163
        objCtr.defineProperty(elemCtrProto, classListProp, classListPropDesc);                                         // 164
      }                                                                                                                // 165
    }                                                                                                                  // 166
  } else if (objCtr[protoProp].__defineGetter__) {                                                                     // 167
    elemCtrProto.__defineGetter__(classListProp, classListGetter);                                                     // 168
  }                                                                                                                    // 169
                                                                                                                       // 170
  }(self));                                                                                                            // 171
}                                                                                                                      // 172
                                                                                                                       // 173
/* Blob.js                                                                                                             // 174
 * A Blob implementation.                                                                                              // 175
 * 2014-07-24                                                                                                          // 176
 *                                                                                                                     // 177
 * By Eli Grey, http://eligrey.com                                                                                     // 178
 * By Devin Samarin, https://github.com/dsamarin                                                                       // 179
 * License: X11/MIT                                                                                                    // 180
 *   See https://github.com/eligrey/Blob.js/blob/master/LICENSE.md                                                     // 181
 */                                                                                                                    // 182
                                                                                                                       // 183
/*global self, unescape */                                                                                             // 184
/*jslint bitwise: true, regexp: true, confusion: true, es5: true, vars: true, white: true,                             // 185
  plusplus: true */                                                                                                    // 186
                                                                                                                       // 187
/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */                                              // 188
                                                                                                                       // 189
(function (view) {                                                                                                     // 190
  "use strict";                                                                                                        // 191
                                                                                                                       // 192
  view.URL = view.URL || view.webkitURL;                                                                               // 193
                                                                                                                       // 194
  if (view.Blob && view.URL) {                                                                                         // 195
    try {                                                                                                              // 196
      new Blob;                                                                                                        // 197
      return;                                                                                                          // 198
    } catch (e) {}                                                                                                     // 199
  }                                                                                                                    // 200
                                                                                                                       // 201
  // Internally we use a BlobBuilder implementation to base Blob off of                                                // 202
  // in order to support older browsers that only have BlobBuilder                                                     // 203
  var BlobBuilder = view.BlobBuilder || view.WebKitBlobBuilder || view.MozBlobBuilder || (function(view) {             // 204
    var                                                                                                                // 205
        get_class = function(object) {                                                                                 // 206
        return Object.prototype.toString.call(object).match(/^\[object\s(.*)\]$/)[1];                                  // 207
      }                                                                                                                // 208
      , FakeBlobBuilder = function BlobBuilder() {                                                                     // 209
        this.data = [];                                                                                                // 210
      }                                                                                                                // 211
      , FakeBlob = function Blob(data, type, encoding) {                                                               // 212
        this.data = data;                                                                                              // 213
        this.size = data.length;                                                                                       // 214
        this.type = type;                                                                                              // 215
        this.encoding = encoding;                                                                                      // 216
      }                                                                                                                // 217
      , FBB_proto = FakeBlobBuilder.prototype                                                                          // 218
      , FB_proto = FakeBlob.prototype                                                                                  // 219
      , FileReaderSync = view.FileReaderSync                                                                           // 220
      , FileException = function(type) {                                                                               // 221
        this.code = this[this.name = type];                                                                            // 222
      }                                                                                                                // 223
      , file_ex_codes = (                                                                                              // 224
          "NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR "                                        // 225
        + "NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR"                                                   // 226
      ).split(" ")                                                                                                     // 227
      , file_ex_code = file_ex_codes.length                                                                            // 228
      , real_URL = view.URL || view.webkitURL || view                                                                  // 229
      , real_create_object_URL = real_URL.createObjectURL                                                              // 230
      , real_revoke_object_URL = real_URL.revokeObjectURL                                                              // 231
      , URL = real_URL                                                                                                 // 232
      , btoa = view.btoa                                                                                               // 233
      , atob = view.atob                                                                                               // 234
                                                                                                                       // 235
      , ArrayBuffer = view.ArrayBuffer                                                                                 // 236
      , Uint8Array = view.Uint8Array                                                                                   // 237
                                                                                                                       // 238
      , origin = /^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/                                                              // 239
    ;                                                                                                                  // 240
    FakeBlob.fake = FB_proto.fake = true;                                                                              // 241
    while (file_ex_code--) {                                                                                           // 242
      FileException.prototype[file_ex_codes[file_ex_code]] = file_ex_code + 1;                                         // 243
    }                                                                                                                  // 244
    // Polyfill URL                                                                                                    // 245
    if (!real_URL.createObjectURL) {                                                                                   // 246
      URL = view.URL = function(uri) {                                                                                 // 247
        var                                                                                                            // 248
            uri_info = document.createElementNS("http://www.w3.org/1999/xhtml", "a")                                   // 249
          , uri_origin                                                                                                 // 250
        ;                                                                                                              // 251
        uri_info.href = uri;                                                                                           // 252
        if (!("origin" in uri_info)) {                                                                                 // 253
          if (uri_info.protocol.toLowerCase() === "data:") {                                                           // 254
            uri_info.origin = null;                                                                                    // 255
          } else {                                                                                                     // 256
            uri_origin = uri.match(origin);                                                                            // 257
            uri_info.origin = uri_origin && uri_origin[1];                                                             // 258
          }                                                                                                            // 259
        }                                                                                                              // 260
        return uri_info;                                                                                               // 261
      };                                                                                                               // 262
    }                                                                                                                  // 263
    URL.createObjectURL = function(blob) {                                                                             // 264
      var                                                                                                              // 265
          type = blob.type                                                                                             // 266
        , data_URI_header                                                                                              // 267
      ;                                                                                                                // 268
      if (type === null) {                                                                                             // 269
        type = "application/octet-stream";                                                                             // 270
      }                                                                                                                // 271
      if (blob instanceof FakeBlob) {                                                                                  // 272
        data_URI_header = "data:" + type;                                                                              // 273
        if (blob.encoding === "base64") {                                                                              // 274
          return data_URI_header + ";base64," + blob.data;                                                             // 275
        } else if (blob.encoding === "URI") {                                                                          // 276
          return data_URI_header + "," + decodeURIComponent(blob.data);                                                // 277
        } if (btoa) {                                                                                                  // 278
          return data_URI_header + ";base64," + btoa(blob.data);                                                       // 279
        } else {                                                                                                       // 280
          return data_URI_header + "," + encodeURIComponent(blob.data);                                                // 281
        }                                                                                                              // 282
      } else if (real_create_object_URL) {                                                                             // 283
        return real_create_object_URL.call(real_URL, blob);                                                            // 284
      }                                                                                                                // 285
    };                                                                                                                 // 286
    URL.revokeObjectURL = function(object_URL) {                                                                       // 287
      if (object_URL.substring(0, 5) !== "data:" && real_revoke_object_URL) {                                          // 288
        real_revoke_object_URL.call(real_URL, object_URL);                                                             // 289
      }                                                                                                                // 290
    };                                                                                                                 // 291
    FBB_proto.append = function(data/*, endings*/) {                                                                   // 292
      var bb = this.data;                                                                                              // 293
      // decode data to a binary string                                                                                // 294
      if (Uint8Array && (data instanceof ArrayBuffer || data instanceof Uint8Array)) {                                 // 295
        var                                                                                                            // 296
            str = ""                                                                                                   // 297
          , buf = new Uint8Array(data)                                                                                 // 298
          , i = 0                                                                                                      // 299
          , buf_len = buf.length                                                                                       // 300
        ;                                                                                                              // 301
        for (; i < buf_len; i++) {                                                                                     // 302
          str += String.fromCharCode(buf[i]);                                                                          // 303
        }                                                                                                              // 304
        bb.push(str);                                                                                                  // 305
      } else if (get_class(data) === "Blob" || get_class(data) === "File") {                                           // 306
        if (FileReaderSync) {                                                                                          // 307
          var fr = new FileReaderSync;                                                                                 // 308
          bb.push(fr.readAsBinaryString(data));                                                                        // 309
        } else {                                                                                                       // 310
          // async FileReader won't work as BlobBuilder is sync                                                        // 311
          throw new FileException("NOT_READABLE_ERR");                                                                 // 312
        }                                                                                                              // 313
      } else if (data instanceof FakeBlob) {                                                                           // 314
        if (data.encoding === "base64" && atob) {                                                                      // 315
          bb.push(atob(data.data));                                                                                    // 316
        } else if (data.encoding === "URI") {                                                                          // 317
          bb.push(decodeURIComponent(data.data));                                                                      // 318
        } else if (data.encoding === "raw") {                                                                          // 319
          bb.push(data.data);                                                                                          // 320
        }                                                                                                              // 321
      } else {                                                                                                         // 322
        if (typeof data !== "string") {                                                                                // 323
          data += ""; // convert unsupported types to strings                                                          // 324
        }                                                                                                              // 325
        // decode UTF-16 to binary string                                                                              // 326
        bb.push(unescape(encodeURIComponent(data)));                                                                   // 327
      }                                                                                                                // 328
    };                                                                                                                 // 329
    FBB_proto.getBlob = function(type) {                                                                               // 330
      if (!arguments.length) {                                                                                         // 331
        type = null;                                                                                                   // 332
      }                                                                                                                // 333
      return new FakeBlob(this.data.join(""), type, "raw");                                                            // 334
    };                                                                                                                 // 335
    FBB_proto.toString = function() {                                                                                  // 336
      return "[object BlobBuilder]";                                                                                   // 337
    };                                                                                                                 // 338
    FB_proto.slice = function(start, end, type) {                                                                      // 339
      var args = arguments.length;                                                                                     // 340
      if (args < 3) {                                                                                                  // 341
        type = null;                                                                                                   // 342
      }                                                                                                                // 343
      return new FakeBlob(                                                                                             // 344
          this.data.slice(start, args > 1 ? end : this.data.length)                                                    // 345
        , type                                                                                                         // 346
        , this.encoding                                                                                                // 347
      );                                                                                                               // 348
    };                                                                                                                 // 349
    FB_proto.toString = function() {                                                                                   // 350
      return "[object Blob]";                                                                                          // 351
    };                                                                                                                 // 352
    FB_proto.close = function() {                                                                                      // 353
      this.size = 0;                                                                                                   // 354
      delete this.data;                                                                                                // 355
    };                                                                                                                 // 356
    return FakeBlobBuilder;                                                                                            // 357
  }(view));                                                                                                            // 358
                                                                                                                       // 359
  view.Blob = function(blobParts, options) {                                                                           // 360
    var type = options ? (options.type || "") : "";                                                                    // 361
    var builder = new BlobBuilder();                                                                                   // 362
    if (blobParts) {                                                                                                   // 363
      for (var i = 0, len = blobParts.length; i < len; i++) {                                                          // 364
        if (Uint8Array && blobParts[i] instanceof Uint8Array) {                                                        // 365
          builder.append(blobParts[i].buffer);                                                                         // 366
        }                                                                                                              // 367
        else {                                                                                                         // 368
          builder.append(blobParts[i]);                                                                                // 369
        }                                                                                                              // 370
      }                                                                                                                // 371
    }                                                                                                                  // 372
    var blob = builder.getBlob(type);                                                                                  // 373
    if (!blob.slice && blob.webkitSlice) {                                                                             // 374
      blob.slice = blob.webkitSlice;                                                                                   // 375
    }                                                                                                                  // 376
    return blob;                                                                                                       // 377
  };                                                                                                                   // 378
                                                                                                                       // 379
  var getPrototypeOf = Object.getPrototypeOf || function(object) {                                                     // 380
    return object.__proto__;                                                                                           // 381
  };                                                                                                                   // 382
  view.Blob.prototype = getPrototypeOf(new view.Blob());                                                               // 383
}(typeof self !== "undefined" && self || typeof window !== "undefined" && window || this.content || this));            // 384
                                                                                                                       // 385
(function (root, factory) {                                                                                            // 386
    'use strict';                                                                                                      // 387
    if (typeof module === 'object') {                                                                                  // 388
        module.exports = factory;                                                                                      // 389
    } else if (typeof define === 'function' && define.amd) {                                                           // 390
        define(function () {                                                                                           // 391
            return factory;                                                                                            // 392
        });                                                                                                            // 393
    } else {                                                                                                           // 394
        root.MediumEditor = factory;                                                                                   // 395
    }                                                                                                                  // 396
}(this, function () {                                                                                                  // 397
                                                                                                                       // 398
    'use strict';                                                                                                      // 399
                                                                                                                       // 400
var Util;                                                                                                              // 401
                                                                                                                       // 402
(function (window, document) {                                                                                         // 403
    'use strict';                                                                                                      // 404
                                                                                                                       // 405
    function copyInto(dest, source, overwrite) {                                                                       // 406
        var prop;                                                                                                      // 407
        dest = dest || {};                                                                                             // 408
        for (prop in source) {                                                                                         // 409
            if (source.hasOwnProperty(prop) && (overwrite || dest.hasOwnProperty(prop) === false)) {                   // 410
                dest[prop] = source[prop];                                                                             // 411
            }                                                                                                          // 412
        }                                                                                                              // 413
        return dest;                                                                                                   // 414
    }                                                                                                                  // 415
                                                                                                                       // 416
    Util = {                                                                                                           // 417
                                                                                                                       // 418
        // http://stackoverflow.com/questions/17907445/how-to-detect-ie11#comment30165888_17907562                     // 419
        // by rg89                                                                                                     // 420
        isIE: ((navigator.appName === 'Microsoft Internet Explorer') || ((navigator.appName === 'Netscape') && (new RegExp('Trident/.*rv:([0-9]{1,}[.0-9]{0,})').exec(navigator.userAgent) !== null))),
                                                                                                                       // 422
        // https://github.com/jashkenas/underscore                                                                     // 423
        keyCode: {                                                                                                     // 424
            BACKSPACE: 8,                                                                                              // 425
            TAB: 9,                                                                                                    // 426
            ENTER: 13,                                                                                                 // 427
            ESCAPE: 27,                                                                                                // 428
            SPACE: 32,                                                                                                 // 429
            DELETE: 46                                                                                                 // 430
        },                                                                                                             // 431
                                                                                                                       // 432
        parentElements: ['p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'blockquote', 'pre'],                                // 433
                                                                                                                       // 434
        defaults: function defaults(dest, source) {                                                                    // 435
            return copyInto(dest, source);                                                                             // 436
        },                                                                                                             // 437
                                                                                                                       // 438
        derives: function derives(base, derived) {                                                                     // 439
            var origPrototype = derived.prototype;                                                                     // 440
            function Proto() { }                                                                                       // 441
            Proto.prototype = base.prototype;                                                                          // 442
            derived.prototype = new Proto();                                                                           // 443
            derived.prototype.constructor = base;                                                                      // 444
            derived.prototype = copyInto(derived.prototype, origPrototype);                                            // 445
            return derived;                                                                                            // 446
        },                                                                                                             // 447
                                                                                                                       // 448
        // Find the next node in the DOM tree that represents any text that is being                                   // 449
        // displayed directly next to the targetNode (passed as an argument)                                           // 450
        // Text that appears directly next to the current node can be:                                                 // 451
        //  - A sibling text node                                                                                      // 452
        //  - A descendant of a sibling element                                                                        // 453
        //  - A sibling text node of an ancestor                                                                       // 454
        //  - A descendant of a sibling element of an ancestor                                                         // 455
        findAdjacentTextNodeWithContent: function findAdjacentTextNodeWithContent(rootNode, targetNode, ownerDocument) {
            var pastTarget = false,                                                                                    // 457
                nextNode,                                                                                              // 458
                nodeIterator = ownerDocument.createNodeIterator(rootNode, NodeFilter.SHOW_TEXT, null, false);          // 459
                                                                                                                       // 460
            // Use a native NodeIterator to iterate over all the text nodes that are descendants                       // 461
            // of the rootNode.  Once past the targetNode, choose the first non-empty text node                        // 462
            nextNode = nodeIterator.nextNode();                                                                        // 463
            while (nextNode) {                                                                                         // 464
                if (nextNode === targetNode) {                                                                         // 465
                    pastTarget = true;                                                                                 // 466
                } else if (pastTarget) {                                                                               // 467
                    if (nextNode.nodeType === 3 && nextNode.nodeValue && nextNode.nodeValue.trim().length > 0) {       // 468
                        break;                                                                                         // 469
                    }                                                                                                  // 470
                }                                                                                                      // 471
                nextNode = nodeIterator.nextNode();                                                                    // 472
            }                                                                                                          // 473
                                                                                                                       // 474
            return nextNode;                                                                                           // 475
        },                                                                                                             // 476
                                                                                                                       // 477
        isDescendant: function isDescendant(parent, child) {                                                           // 478
            if (!parent || !child) {                                                                                   // 479
                return false;                                                                                          // 480
            }                                                                                                          // 481
            var node = child.parentNode;                                                                               // 482
            while (node !== null) {                                                                                    // 483
                if (node === parent) {                                                                                 // 484
                    return true;                                                                                       // 485
                }                                                                                                      // 486
                node = node.parentNode;                                                                                // 487
            }                                                                                                          // 488
            return false;                                                                                              // 489
        },                                                                                                             // 490
                                                                                                                       // 491
        // https://github.com/jashkenas/underscore                                                                     // 492
        isElement: function isElement(obj) {                                                                           // 493
            return !!(obj && obj.nodeType === 1);                                                                      // 494
        },                                                                                                             // 495
                                                                                                                       // 496
        now: function now() {                                                                                          // 497
            return Date.now() || new Date().getTime();                                                                 // 498
        },                                                                                                             // 499
                                                                                                                       // 500
        // https://github.com/jashkenas/underscore                                                                     // 501
        throttle: function (func, wait) {                                                                              // 502
            var THROTTLE_INTERVAL = 50,                                                                                // 503
                context,                                                                                               // 504
                args,                                                                                                  // 505
                result,                                                                                                // 506
                timeout = null,                                                                                        // 507
                previous = 0,                                                                                          // 508
                later = function () {                                                                                  // 509
                    previous = Util.now();                                                                             // 510
                    timeout = null;                                                                                    // 511
                    result = func.apply(context, args);                                                                // 512
                    if (!timeout) {                                                                                    // 513
                        context = args = null;                                                                         // 514
                    }                                                                                                  // 515
                };                                                                                                     // 516
                                                                                                                       // 517
            if (!wait && wait !== 0) {                                                                                 // 518
                wait = THROTTLE_INTERVAL;                                                                              // 519
            }                                                                                                          // 520
                                                                                                                       // 521
            return function () {                                                                                       // 522
                var now = Util.now(),                                                                                  // 523
                    remaining = wait - (now - previous);                                                               // 524
                                                                                                                       // 525
                context = this;                                                                                        // 526
                args = arguments;                                                                                      // 527
                if (remaining <= 0 || remaining > wait) {                                                              // 528
                    if (timeout) {                                                                                     // 529
                        clearTimeout(timeout);                                                                         // 530
                        timeout = null;                                                                                // 531
                    }                                                                                                  // 532
                    previous = now;                                                                                    // 533
                    result = func.apply(context, args);                                                                // 534
                    if (!timeout) {                                                                                    // 535
                        context = args = null;                                                                         // 536
                    }                                                                                                  // 537
                } else if (!timeout) {                                                                                 // 538
                    timeout = setTimeout(later, remaining);                                                            // 539
                }                                                                                                      // 540
                return result;                                                                                         // 541
            };                                                                                                         // 542
        },                                                                                                             // 543
                                                                                                                       // 544
        traverseUp: function (current, testElementFunction) {                                                          // 545
                                                                                                                       // 546
            do {                                                                                                       // 547
                if (current.nodeType === 1) {                                                                          // 548
                    if (testElementFunction(current)) {                                                                // 549
                        return current;                                                                                // 550
                    }                                                                                                  // 551
                    // do not traverse upwards past the nearest containing editor                                      // 552
                    if (current.getAttribute('data-medium-element')) {                                                 // 553
                        return false;                                                                                  // 554
                    }                                                                                                  // 555
                }                                                                                                      // 556
                                                                                                                       // 557
                current = current.parentNode;                                                                          // 558
            } while (current);                                                                                         // 559
                                                                                                                       // 560
            return false;                                                                                              // 561
                                                                                                                       // 562
        },                                                                                                             // 563
                                                                                                                       // 564
        htmlEntities: function (str) {                                                                                 // 565
            // converts special characters (like <) into their escaped/encoded values (like &lt;).                     // 566
            // This allows you to show to display the string without the browser reading it as HTML.                   // 567
            return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
        },                                                                                                             // 569
                                                                                                                       // 570
        // http://stackoverflow.com/questions/6690752/insert-html-at-caret-in-a-contenteditable-div                    // 571
        insertHTMLCommand: function (doc, html) {                                                                      // 572
            var selection, range, el, fragment, node, lastNode, toReplace;                                             // 573
                                                                                                                       // 574
            if (doc.queryCommandSupported('insertHTML')) {                                                             // 575
                try {                                                                                                  // 576
                    return doc.execCommand('insertHTML', false, html);                                                 // 577
                } catch (ignore) {}                                                                                    // 578
            }                                                                                                          // 579
                                                                                                                       // 580
            selection = doc.defaultView.getSelection();                                                                // 581
            if (selection.getRangeAt && selection.rangeCount) {                                                        // 582
                range = selection.getRangeAt(0);                                                                       // 583
                toReplace = range.commonAncestorContainer;                                                             // 584
                // Ensure range covers maximum amount of nodes as possible                                             // 585
                // By moving up the DOM and selecting ancestors whose only child is the range                          // 586
                if ((toReplace.nodeType === 3 && toReplace.nodeValue === range.toString()) ||                          // 587
                        (toReplace.nodeType !== 3 && toReplace.innerHTML === range.toString())) {                      // 588
                    while (toReplace.parentNode &&                                                                     // 589
                            toReplace.parentNode.childNodes.length === 1 &&                                            // 590
                            !toReplace.parentNode.getAttribute('data-medium-element')) {                               // 591
                        toReplace = toReplace.parentNode;                                                              // 592
                    }                                                                                                  // 593
                    range.selectNode(toReplace);                                                                       // 594
                }                                                                                                      // 595
                range.deleteContents();                                                                                // 596
                                                                                                                       // 597
                el = doc.createElement("div");                                                                         // 598
                el.innerHTML = html;                                                                                   // 599
                fragment = doc.createDocumentFragment();                                                               // 600
                while (el.firstChild) {                                                                                // 601
                    node = el.firstChild;                                                                              // 602
                    lastNode = fragment.appendChild(node);                                                             // 603
                }                                                                                                      // 604
                range.insertNode(fragment);                                                                            // 605
                                                                                                                       // 606
                // Preserve the selection:                                                                             // 607
                if (lastNode) {                                                                                        // 608
                    range = range.cloneRange();                                                                        // 609
                    range.setStartAfter(lastNode);                                                                     // 610
                    range.collapse(true);                                                                              // 611
                    selection.removeAllRanges();                                                                       // 612
                    selection.addRange(range);                                                                         // 613
                }                                                                                                      // 614
            }                                                                                                          // 615
        },                                                                                                             // 616
                                                                                                                       // 617
        getSelectionRange: function (ownerDocument) {                                                                  // 618
            var selection = ownerDocument.getSelection();                                                              // 619
            if (selection.rangeCount === 0) {                                                                          // 620
                return null;                                                                                           // 621
            }                                                                                                          // 622
            return selection.getRangeAt(0);                                                                            // 623
        },                                                                                                             // 624
                                                                                                                       // 625
        // http://stackoverflow.com/questions/1197401/how-can-i-get-the-element-the-caret-is-in-with-javascript-when-using-contentedi
        // by You                                                                                                      // 627
        getSelectionStart: function (ownerDocument) {                                                                  // 628
            var node = ownerDocument.getSelection().anchorNode,                                                        // 629
                startNode = (node && node.nodeType === 3 ? node.parentNode : node);                                    // 630
            return startNode;                                                                                          // 631
        },                                                                                                             // 632
                                                                                                                       // 633
        getSelectionData: function (el) {                                                                              // 634
            var tagName;                                                                                               // 635
                                                                                                                       // 636
            if (el && el.tagName) {                                                                                    // 637
                tagName = el.tagName.toLowerCase();                                                                    // 638
            }                                                                                                          // 639
                                                                                                                       // 640
            while (el && this.parentElements.indexOf(tagName) === -1) {                                                // 641
                el = el.parentNode;                                                                                    // 642
                if (el && el.tagName) {                                                                                // 643
                    tagName = el.tagName.toLowerCase();                                                                // 644
                }                                                                                                      // 645
            }                                                                                                          // 646
                                                                                                                       // 647
            return {                                                                                                   // 648
                el: el,                                                                                                // 649
                tagName: tagName                                                                                       // 650
            };                                                                                                         // 651
        },                                                                                                             // 652
                                                                                                                       // 653
        execFormatBlock: function (doc, tagName) {                                                                     // 654
            var selectionData = this.getSelectionData(this.getSelectionStart(doc));                                    // 655
            // FF handles blockquote differently on formatBlock                                                        // 656
            // allowing nesting, we need to use outdent                                                                // 657
            // https://developer.mozilla.org/en-US/docs/Rich-Text_Editing_in_Mozilla                                   // 658
            if (tagName === 'blockquote' && selectionData.el &&                                                        // 659
                    selectionData.el.parentNode.tagName.toLowerCase() === 'blockquote') {                              // 660
                return doc.execCommand('outdent', false, null);                                                        // 661
            }                                                                                                          // 662
            if (selectionData.tagName === tagName) {                                                                   // 663
                tagName = 'p';                                                                                         // 664
            }                                                                                                          // 665
            // When IE we need to add <> to heading elements and                                                       // 666
            //  blockquote needs to be called as indent                                                                // 667
            // http://stackoverflow.com/questions/10741831/execcommand-formatblock-headings-in-ie                      // 668
            // http://stackoverflow.com/questions/1816223/rich-text-editor-with-blockquote-function/1821777#1821777    // 669
            if (this.isIE) {                                                                                           // 670
                if (tagName === 'blockquote') {                                                                        // 671
                    return doc.execCommand('indent', false, tagName);                                                  // 672
                }                                                                                                      // 673
                tagName = '<' + tagName + '>';                                                                         // 674
            }                                                                                                          // 675
            return doc.execCommand('formatBlock', false, tagName);                                                     // 676
        },                                                                                                             // 677
                                                                                                                       // 678
        // TODO: not sure if this should be here                                                                       // 679
        setTargetBlank: function (el) {                                                                                // 680
            var i;                                                                                                     // 681
            if (el.tagName.toLowerCase() === 'a') {                                                                    // 682
                el.target = '_blank';                                                                                  // 683
            } else {                                                                                                   // 684
                el = el.getElementsByTagName('a');                                                                     // 685
                                                                                                                       // 686
                for (i = 0; i < el.length; i += 1) {                                                                   // 687
                    el[i].target = '_blank';                                                                           // 688
                }                                                                                                      // 689
            }                                                                                                          // 690
        },                                                                                                             // 691
                                                                                                                       // 692
        addClassToAnchors: function (el, buttonClass) {                                                                // 693
            var classes = buttonClass.split(' '),                                                                      // 694
                i,                                                                                                     // 695
                j;                                                                                                     // 696
            if (el.tagName.toLowerCase() === 'a') {                                                                    // 697
                for (j = 0; j < classes.length; j += 1) {                                                              // 698
                    el.classList.add(classes[j]);                                                                      // 699
                }                                                                                                      // 700
            } else {                                                                                                   // 701
                el = el.getElementsByTagName('a');                                                                     // 702
                for (i = 0; i < el.length; i += 1) {                                                                   // 703
                    for (j = 0; j < classes.length; j += 1) {                                                          // 704
                        el[i].classList.add(classes[j]);                                                               // 705
                    }                                                                                                  // 706
                }                                                                                                      // 707
            }                                                                                                          // 708
        },                                                                                                             // 709
                                                                                                                       // 710
        isListItem: function (node) {                                                                                  // 711
            if (!node) {                                                                                               // 712
                return false;                                                                                          // 713
            }                                                                                                          // 714
            if (node.tagName.toLowerCase() === 'li') {                                                                 // 715
                return true;                                                                                           // 716
            }                                                                                                          // 717
                                                                                                                       // 718
            var parentNode = node.parentNode,                                                                          // 719
                tagName = parentNode.tagName.toLowerCase();                                                            // 720
            while (this.parentElements.indexOf(tagName) === -1 && tagName !== 'div') {                                 // 721
                if (tagName === 'li') {                                                                                // 722
                    return true;                                                                                       // 723
                }                                                                                                      // 724
                parentNode = parentNode.parentNode;                                                                    // 725
                if (parentNode && parentNode.tagName) {                                                                // 726
                    tagName = parentNode.tagName.toLowerCase();                                                        // 727
                } else {                                                                                               // 728
                    return false;                                                                                      // 729
                }                                                                                                      // 730
            }                                                                                                          // 731
            return false;                                                                                              // 732
        },                                                                                                             // 733
                                                                                                                       // 734
        cleanListDOM: function (element) {                                                                             // 735
            if (element.tagName.toLowerCase() === 'li') {                                                              // 736
                var list = element.parentElement;                                                                      // 737
                if (list.parentElement.tagName.toLowerCase() === 'p') { // yes we need to clean up                     // 738
                    this.unwrapElement(list.parentElement);                                                            // 739
                }                                                                                                      // 740
            }                                                                                                          // 741
        },                                                                                                             // 742
                                                                                                                       // 743
        unwrapElement: function (element) {                                                                            // 744
            var parent = element.parentNode,                                                                           // 745
                current = element.firstChild,                                                                          // 746
                next;                                                                                                  // 747
            do {                                                                                                       // 748
                next = current.nextSibling;                                                                            // 749
                parent.insertBefore(current, element);                                                                 // 750
                current = next;                                                                                        // 751
            } while (current);                                                                                         // 752
            parent.removeChild(element);                                                                               // 753
        },                                                                                                             // 754
                                                                                                                       // 755
        deprecatedMethod: function (oldName, newName, args) {                                                          // 756
            // Thanks IE9, you're the best                                                                             // 757
            if (window.console !== undefined) {                                                                        // 758
                console.warn(oldName +                                                                                 // 759
                    ' is deprecated and will be removed, please use ' +                                                // 760
                    newName +                                                                                          // 761
                    ' instead');                                                                                       // 762
            }                                                                                                          // 763
            if (typeof this[newName] === 'function') {                                                                 // 764
                this[newName].apply(this, args);                                                                       // 765
            }                                                                                                          // 766
        }                                                                                                              // 767
    };                                                                                                                 // 768
}(window, document));                                                                                                  // 769
                                                                                                                       // 770
var Selection;                                                                                                         // 771
                                                                                                                       // 772
(function (window, document) {                                                                                         // 773
    'use strict';                                                                                                      // 774
                                                                                                                       // 775
    Selection = {                                                                                                      // 776
        findMatchingSelectionParent: function (testElementFunction, contentWindow) {                                   // 777
            var selection = contentWindow.getSelection(), range, current;                                              // 778
                                                                                                                       // 779
            if (selection.rangeCount === 0) {                                                                          // 780
                return false;                                                                                          // 781
            }                                                                                                          // 782
                                                                                                                       // 783
            range = selection.getRangeAt(0);                                                                           // 784
            current = range.commonAncestorContainer;                                                                   // 785
                                                                                                                       // 786
            return Util.traverseUp(current, testElementFunction);                                                      // 787
        },                                                                                                             // 788
                                                                                                                       // 789
        getSelectionElement: function (contentWindow) {                                                                // 790
            return this.findMatchingSelectionParent(function (el) {                                                    // 791
                return el.getAttribute('data-medium-element');                                                         // 792
            }, contentWindow);                                                                                         // 793
        },                                                                                                             // 794
                                                                                                                       // 795
        selectionInContentEditableFalse: function (contentWindow) {                                                    // 796
            return this.findMatchingSelectionParent(function (el) {                                                    // 797
                return (el && el.nodeName !== '#text' && el.getAttribute('contenteditable') === 'false');              // 798
            }, contentWindow);                                                                                         // 799
        },                                                                                                             // 800
                                                                                                                       // 801
        // http://stackoverflow.com/questions/4176923/html-of-selected-text                                            // 802
        // by Tim Down                                                                                                 // 803
        getSelectionHtml: function getSelectionHtml() {                                                                // 804
            var i,                                                                                                     // 805
                html = '',                                                                                             // 806
                sel = this.options.contentWindow.getSelection(),                                                       // 807
                len,                                                                                                   // 808
                container;                                                                                             // 809
            if (sel.rangeCount) {                                                                                      // 810
                container = this.options.ownerDocument.createElement('div');                                           // 811
                for (i = 0, len = sel.rangeCount; i < len; i += 1) {                                                   // 812
                    container.appendChild(sel.getRangeAt(i).cloneContents());                                          // 813
                }                                                                                                      // 814
                html = container.innerHTML;                                                                            // 815
            }                                                                                                          // 816
            return html;                                                                                               // 817
        },                                                                                                             // 818
                                                                                                                       // 819
        /**                                                                                                            // 820
         *  Find the caret position within an element irrespective of any inline tags it may contain.                  // 821
         *                                                                                                             // 822
         *  @param {DOMElement} An element containing the cursor to find offsets relative to.                          // 823
         *  @param {Range} A Range representing cursor position. Will window.getSelection if none is passed.           // 824
         *  @return {Object} 'left' and 'right' attributes contain offsets from begining and end of Element            // 825
         */                                                                                                            // 826
        getCaretOffsets: function getCaretOffsets(element, range) {                                                    // 827
            var preCaretRange, postCaretRange;                                                                         // 828
                                                                                                                       // 829
            if (!range) {                                                                                              // 830
                range = window.getSelection().getRangeAt(0);                                                           // 831
            }                                                                                                          // 832
                                                                                                                       // 833
            preCaretRange = range.cloneRange();                                                                        // 834
            postCaretRange = range.cloneRange();                                                                       // 835
                                                                                                                       // 836
            preCaretRange.selectNodeContents(element);                                                                 // 837
            preCaretRange.setEnd(range.endContainer, range.endOffset);                                                 // 838
                                                                                                                       // 839
            postCaretRange.selectNodeContents(element);                                                                // 840
            postCaretRange.setStart(range.endContainer, range.endOffset);                                              // 841
                                                                                                                       // 842
            return {                                                                                                   // 843
                left: preCaretRange.toString().length,                                                                 // 844
                right: postCaretRange.toString().length                                                                // 845
            };                                                                                                         // 846
        },                                                                                                             // 847
                                                                                                                       // 848
        // http://stackoverflow.com/questions/15867542/range-object-get-selection-parent-node-chrome-vs-firefox        // 849
        rangeSelectsSingleNode: function (range) {                                                                     // 850
            var startNode = range.startContainer;                                                                      // 851
            return startNode === range.endContainer &&                                                                 // 852
                startNode.hasChildNodes() &&                                                                           // 853
                range.endOffset === range.startOffset + 1;                                                             // 854
        },                                                                                                             // 855
                                                                                                                       // 856
        getSelectedParentElement: function (range) {                                                                   // 857
            var selectedParentElement = null;                                                                          // 858
            if (this.rangeSelectsSingleNode(range) && range.startContainer.childNodes[range.startOffset].nodeType !== 3) {
                selectedParentElement = range.startContainer.childNodes[range.startOffset];                            // 860
            } else if (range.startContainer.nodeType === 3) {                                                          // 861
                selectedParentElement = range.startContainer.parentNode;                                               // 862
            } else {                                                                                                   // 863
                selectedParentElement = range.startContainer;                                                          // 864
            }                                                                                                          // 865
            return selectedParentElement;                                                                              // 866
        }                                                                                                              // 867
    };                                                                                                                 // 868
}(document, window));                                                                                                  // 869
                                                                                                                       // 870
var Events;                                                                                                            // 871
                                                                                                                       // 872
(function (window, document) {                                                                                         // 873
    'use strict';                                                                                                      // 874
                                                                                                                       // 875
    Events = function (instance) {                                                                                     // 876
        this.base = instance;                                                                                          // 877
        this.options = this.base.options;                                                                              // 878
        this.events = [];                                                                                              // 879
        this.customEvents = {};                                                                                        // 880
        this.listeners = {};                                                                                           // 881
    };                                                                                                                 // 882
                                                                                                                       // 883
    Events.prototype = {                                                                                               // 884
                                                                                                                       // 885
        // Helpers for event handling                                                                                  // 886
                                                                                                                       // 887
        attachDOMEvent: function (target, event, listener, useCapture) {                                               // 888
            target.addEventListener(event, listener, useCapture);                                                      // 889
            this.events.push([target, event, listener, useCapture]);                                                   // 890
        },                                                                                                             // 891
                                                                                                                       // 892
        detachDOMEvent: function (target, event, listener, useCapture) {                                               // 893
            var index = this.indexOfListener(target, event, listener, useCapture),                                     // 894
                e;                                                                                                     // 895
            if (index !== -1) {                                                                                        // 896
                e = this.events.splice(index, 1)[0];                                                                   // 897
                e[0].removeEventListener(e[1], e[2], e[3]);                                                            // 898
            }                                                                                                          // 899
        },                                                                                                             // 900
                                                                                                                       // 901
        indexOfListener: function (target, event, listener, useCapture) {                                              // 902
            var i, n, item;                                                                                            // 903
            for (i = 0, n = this.events.length; i < n; i = i + 1) {                                                    // 904
                item = this.events[i];                                                                                 // 905
                if (item[0] === target && item[1] === event && item[2] === listener && item[3] === useCapture) {       // 906
                    return i;                                                                                          // 907
                }                                                                                                      // 908
            }                                                                                                          // 909
            return -1;                                                                                                 // 910
        },                                                                                                             // 911
                                                                                                                       // 912
        detachAllDOMEvents: function () {                                                                              // 913
            var e = this.events.pop();                                                                                 // 914
            while (e) {                                                                                                // 915
                e[0].removeEventListener(e[1], e[2], e[3]);                                                            // 916
                e = this.events.pop();                                                                                 // 917
            }                                                                                                          // 918
        },                                                                                                             // 919
                                                                                                                       // 920
        // custom events                                                                                               // 921
        attachCustomEvent: function (event, handler) {                                                                 // 922
            this.setupListener(event);                                                                                 // 923
            // If we don't suppot this custom event, don't do anything                                                 // 924
            if (this.listeners[event]) {                                                                               // 925
                if (!this.customEvents[event]) {                                                                       // 926
                    this.customEvents[event] = [];                                                                     // 927
                }                                                                                                      // 928
                this.customEvents[event].push(handler);                                                                // 929
            }                                                                                                          // 930
        },                                                                                                             // 931
                                                                                                                       // 932
        triggerCustomEvent: function (name, data, editable) {                                                          // 933
            if (this.customEvents[name]) {                                                                             // 934
                this.customEvents[name].forEach(function (handler) {                                                   // 935
                    handler(data, editable);                                                                           // 936
                });                                                                                                    // 937
            }                                                                                                          // 938
        },                                                                                                             // 939
                                                                                                                       // 940
        // Listening to browser events to emit events medium-editor cares about                                        // 941
                                                                                                                       // 942
        setupListener: function (name) {                                                                               // 943
            if (this.listeners[name]) {                                                                                // 944
                return;                                                                                                // 945
            }                                                                                                          // 946
                                                                                                                       // 947
            switch (name) {                                                                                            // 948
            case 'externalInteraction':                                                                                // 949
                // Detecting when focus is lost                                                                        // 950
                this.attachDOMEvent(this.options.ownerDocument.body, 'click', this.handleInteraction.bind(this), true);
                this.attachDOMEvent(this.options.ownerDocument.body, 'focus', this.handleInteraction.bind(this), true);
                this.listeners[name] = true;                                                                           // 953
                break;                                                                                                 // 954
            case 'editableClick':                                                                                      // 955
                // Detecting click in the contenteditables                                                             // 956
                this.base.elements.forEach(function (element) {                                                        // 957
                    this.attachDOMEvent(element, 'click', this.handleClick.bind(this));                                // 958
                }.bind(this));                                                                                         // 959
                this.listeners[name] = true;                                                                           // 960
                break;                                                                                                 // 961
            case 'editableBlur':                                                                                       // 962
                // Detecting blur in the contenteditables                                                              // 963
                this.base.elements.forEach(function (element) {                                                        // 964
                    this.attachDOMEvent(element, 'blur', this.handleBlur.bind(this));                                  // 965
                }.bind(this));                                                                                         // 966
                this.listeners[name] = true;                                                                           // 967
                break;                                                                                                 // 968
            case 'editableKeypress':                                                                                   // 969
                // Detecting keypress in the contenteditables                                                          // 970
                this.base.elements.forEach(function (element) {                                                        // 971
                    this.attachDOMEvent(element, 'keypress', this.handleKeypress.bind(this));                          // 972
                }.bind(this));                                                                                         // 973
                this.listeners[name] = true;                                                                           // 974
                break;                                                                                                 // 975
            case 'editableKeydown':                                                                                    // 976
                // Detecting keydown on the contenteditables                                                           // 977
                this.base.elements.forEach(function (element) {                                                        // 978
                    this.attachDOMEvent(element, 'keydown', this.handleKeydown.bind(this));                            // 979
                }.bind(this));                                                                                         // 980
                this.listeners[name] = true;                                                                           // 981
                break;                                                                                                 // 982
            case 'editableKeydownEnter':                                                                               // 983
                // Detecting keydown for ENTER on the contenteditables                                                 // 984
                this.setupListener('editableKeydown');                                                                 // 985
                this.listeners[name] = true;                                                                           // 986
                break;                                                                                                 // 987
            case 'editableKeydownTab':                                                                                 // 988
                // Detecting keydown for TAB on the contenteditable                                                    // 989
                this.setupListener('editableKeydown');                                                                 // 990
                this.listeners[name] = true;                                                                           // 991
                break;                                                                                                 // 992
            case 'editableKeydownDelete':                                                                              // 993
                // Detecting keydown for DELETE/BACKSPACE on the contenteditables                                      // 994
                this.setupListener('editableKeydown');                                                                 // 995
                this.listeners[name] = true;                                                                           // 996
                break;                                                                                                 // 997
            case 'editableMouseover':                                                                                  // 998
                // Detecting mouseover on the contenteditables                                                         // 999
                this.base.elements.forEach(function (element) {                                                        // 1000
                    this.attachDOMEvent(element, 'mouseover', this.handleMouseover.bind(this));                        // 1001
                }.bind(this));                                                                                         // 1002
                this.listeners[name] = true;                                                                           // 1003
                break;                                                                                                 // 1004
            case 'editableDrag':                                                                                       // 1005
                // Detecting dragover and dragleave on the contenteditables                                            // 1006
                this.base.elements.forEach(function (element) {                                                        // 1007
                    this.attachDOMEvent(element, 'dragover', this.handleDragging.bind(this));                          // 1008
                    this.attachDOMEvent(element, 'dragleave', this.handleDragging.bind(this));                         // 1009
                }.bind(this));                                                                                         // 1010
                this.listeners[name] = true;                                                                           // 1011
                break;                                                                                                 // 1012
            case 'editableDrop':                                                                                       // 1013
                // Detecting drop on the contenteditables                                                              // 1014
                this.base.elements.forEach(function (element) {                                                        // 1015
                    this.attachDOMEvent(element, 'drop', this.handleDrop.bind(this));                                  // 1016
                }.bind(this));                                                                                         // 1017
                this.listeners[name] = true;                                                                           // 1018
                break;                                                                                                 // 1019
            case 'editablePaste':                                                                                      // 1020
                // Detecting paste on the contenteditables                                                             // 1021
                this.base.elements.forEach(function (element) {                                                        // 1022
                    this.attachDOMEvent(element, 'paste', this.handlePaste.bind(this));                                // 1023
                }.bind(this));                                                                                         // 1024
                this.listeners[name] = true;                                                                           // 1025
                break;                                                                                                 // 1026
            }                                                                                                          // 1027
        },                                                                                                             // 1028
                                                                                                                       // 1029
        handleInteraction: function (event) {                                                                          // 1030
            var isDescendantOfEditorElements = false,                                                                  // 1031
                selection = this.options.contentWindow.getSelection(),                                                 // 1032
                toolbarEl = (this.base.toolbar) ? this.base.toolbar.getToolbarElement() : null,                        // 1033
                anchorPreview = this.base.getExtensionByName('anchor-preview'),                                        // 1034
                previewEl = (anchorPreview && anchorPreview.getPreviewElement) ? anchorPreview.getPreviewElement() : null,
                selRange = selection.isCollapsed ?                                                                     // 1036
                           null :                                                                                      // 1037
                           Selection.getSelectedParentElement(selection.getRangeAt(0)),                                // 1038
                i;                                                                                                     // 1039
                                                                                                                       // 1040
            // This control was introduced also to avoid the toolbar                                                   // 1041
            // to disapper when selecting from right to left and                                                       // 1042
            // the selection ends at the beginning of the text.                                                        // 1043
            for (i = 0; i < this.base.elements.length; i += 1) {                                                       // 1044
                if (this.base.elements[i] === event.target                                                             // 1045
                        || Util.isDescendant(this.base.elements[i], event.target)                                      // 1046
                        || Util.isDescendant(this.base.elements[i], selRange)) {                                       // 1047
                    isDescendantOfEditorElements = true;                                                               // 1048
                    break;                                                                                             // 1049
                }                                                                                                      // 1050
            }                                                                                                          // 1051
            // If it's not part of the editor, toolbar, or anchor preview                                              // 1052
            if (!isDescendantOfEditorElements                                                                          // 1053
                    && (!toolbarEl || (toolbarEl !== event.target && !Util.isDescendant(toolbarEl, event.target)))     // 1054
                    && (!previewEl || (previewEl !== event.target && !Util.isDescendant(previewEl, event.target)))) {  // 1055
                this.triggerCustomEvent('externalInteraction', event);                                                 // 1056
            }                                                                                                          // 1057
        },                                                                                                             // 1058
                                                                                                                       // 1059
        handleClick: function (event) {                                                                                // 1060
            this.triggerCustomEvent('editableClick', event, event.currentTarget);                                      // 1061
        },                                                                                                             // 1062
                                                                                                                       // 1063
        handleBlur: function (event) {                                                                                 // 1064
            this.triggerCustomEvent('editableBlur', event, event.currentTarget);                                       // 1065
        },                                                                                                             // 1066
                                                                                                                       // 1067
        handleKeypress: function (event) {                                                                             // 1068
            this.triggerCustomEvent('editableKeypress', event, event.currentTarget);                                   // 1069
        },                                                                                                             // 1070
                                                                                                                       // 1071
        handleMouseover: function (event) {                                                                            // 1072
            this.triggerCustomEvent('editableMouseover', event, event.currentTarget);                                  // 1073
        },                                                                                                             // 1074
                                                                                                                       // 1075
        handleDragging: function (event) {                                                                             // 1076
            this.triggerCustomEvent('editableDrag', event, event.currentTarget);                                       // 1077
        },                                                                                                             // 1078
                                                                                                                       // 1079
        handleDrop: function (event) {                                                                                 // 1080
            this.triggerCustomEvent('editableDrop', event, event.currentTarget);                                       // 1081
        },                                                                                                             // 1082
                                                                                                                       // 1083
        handlePaste: function (event) {                                                                                // 1084
            this.triggerCustomEvent('editablePaste', event, event.currentTarget);                                      // 1085
        },                                                                                                             // 1086
                                                                                                                       // 1087
        handleKeydown: function (event) {                                                                              // 1088
            this.triggerCustomEvent('editableKeydown', event, event.currentTarget);                                    // 1089
                                                                                                                       // 1090
            switch (event.which) {                                                                                     // 1091
            case Util.keyCode.ENTER:                                                                                   // 1092
                this.triggerCustomEvent('editableKeydownEnter', event, event.currentTarget);                           // 1093
                break;                                                                                                 // 1094
            case Util.keyCode.TAB:                                                                                     // 1095
                this.triggerCustomEvent('editableKeydownTab', event, event.currentTarget);                             // 1096
                break;                                                                                                 // 1097
            case Util.keyCode.DELETE:                                                                                  // 1098
            case Util.keyCode.BACKSPACE:                                                                               // 1099
                this.triggerCustomEvent('editableKeydownDelete', event, event.currentTarget);                          // 1100
                break;                                                                                                 // 1101
            }                                                                                                          // 1102
        }                                                                                                              // 1103
    };                                                                                                                 // 1104
                                                                                                                       // 1105
}(window, document));                                                                                                  // 1106
var DefaultButton,                                                                                                     // 1107
    ButtonsData;                                                                                                       // 1108
                                                                                                                       // 1109
(function (window, document) {                                                                                         // 1110
    'use strict';                                                                                                      // 1111
                                                                                                                       // 1112
    ButtonsData = {                                                                                                    // 1113
        'bold': {                                                                                                      // 1114
            name: 'bold',                                                                                              // 1115
            action: 'bold',                                                                                            // 1116
            aria: 'bold',                                                                                              // 1117
            tagNames: ['b', 'strong'],                                                                                 // 1118
            style: {                                                                                                   // 1119
                prop: 'font-weight',                                                                                   // 1120
                value: '700|bold'                                                                                      // 1121
            },                                                                                                         // 1122
            useQueryState: true,                                                                                       // 1123
            contentDefault: '<b>B</b>',                                                                                // 1124
            contentFA: '<i class="fa fa-bold"></i>',                                                                   // 1125
            key: 'b'                                                                                                   // 1126
        },                                                                                                             // 1127
        'italic': {                                                                                                    // 1128
            name: 'italic',                                                                                            // 1129
            action: 'italic',                                                                                          // 1130
            aria: 'italic',                                                                                            // 1131
            tagNames: ['i', 'em'],                                                                                     // 1132
            style: {                                                                                                   // 1133
                prop: 'font-style',                                                                                    // 1134
                value: 'italic'                                                                                        // 1135
            },                                                                                                         // 1136
            useQueryState: true,                                                                                       // 1137
            contentDefault: '<b><i>I</i></b>',                                                                         // 1138
            contentFA: '<i class="fa fa-italic"></i>',                                                                 // 1139
            key: 'i'                                                                                                   // 1140
        },                                                                                                             // 1141
        'underline': {                                                                                                 // 1142
            name: 'underline',                                                                                         // 1143
            action: 'underline',                                                                                       // 1144
            aria: 'underline',                                                                                         // 1145
            tagNames: ['u'],                                                                                           // 1146
            style: {                                                                                                   // 1147
                prop: 'text-decoration',                                                                               // 1148
                value: 'underline'                                                                                     // 1149
            },                                                                                                         // 1150
            useQueryState: true,                                                                                       // 1151
            contentDefault: '<b><u>U</u></b>',                                                                         // 1152
            contentFA: '<i class="fa fa-underline"></i>',                                                              // 1153
            key: 'u'                                                                                                   // 1154
        },                                                                                                             // 1155
        'strikethrough': {                                                                                             // 1156
            name: 'strikethrough',                                                                                     // 1157
            action: 'strikethrough',                                                                                   // 1158
            aria: 'strike through',                                                                                    // 1159
            tagNames: ['strike'],                                                                                      // 1160
            style: {                                                                                                   // 1161
                prop: 'text-decoration',                                                                               // 1162
                value: 'line-through'                                                                                  // 1163
            },                                                                                                         // 1164
            useQueryState: true,                                                                                       // 1165
            contentDefault: '<s>A</s>',                                                                                // 1166
            contentFA: '<i class="fa fa-strikethrough"></i>'                                                           // 1167
        },                                                                                                             // 1168
        'superscript': {                                                                                               // 1169
            name: 'superscript',                                                                                       // 1170
            action: 'superscript',                                                                                     // 1171
            aria: 'superscript',                                                                                       // 1172
            tagNames: ['sup'],                                                                                         // 1173
            /* firefox doesn't behave the way we want it to, so we CAN'T use queryCommandState for superscript         // 1174
               https://github.com/guardian/scribe/blob/master/BROWSERINCONSISTENCIES.md#documentquerycommandstate */   // 1175
            // useQueryState: true                                                                                     // 1176
            contentDefault: '<b>x<sup>1</sup></b>',                                                                    // 1177
            contentFA: '<i class="fa fa-superscript"></i>'                                                             // 1178
        },                                                                                                             // 1179
        'subscript': {                                                                                                 // 1180
            name: 'subscript',                                                                                         // 1181
            action: 'subscript',                                                                                       // 1182
            aria: 'subscript',                                                                                         // 1183
            tagNames: ['sub'],                                                                                         // 1184
            /* firefox doesn't behave the way we want it to, so we CAN'T use queryCommandState for subscript           // 1185
               https://github.com/guardian/scribe/blob/master/BROWSERINCONSISTENCIES.md#documentquerycommandstate */   // 1186
            // useQueryState: true                                                                                     // 1187
            contentDefault: '<b>x<sub>1</sub></b>',                                                                    // 1188
            contentFA: '<i class="fa fa-subscript"></i>'                                                               // 1189
        },                                                                                                             // 1190
        'image': {                                                                                                     // 1191
            name: 'image',                                                                                             // 1192
            action: 'image',                                                                                           // 1193
            aria: 'image',                                                                                             // 1194
            tagNames: ['img'],                                                                                         // 1195
            contentDefault: '<b>image</b>',                                                                            // 1196
            contentFA: '<i class="fa fa-picture-o"></i>'                                                               // 1197
        },                                                                                                             // 1198
        'quote': {                                                                                                     // 1199
            name: 'quote',                                                                                             // 1200
            action: 'append-blockquote',                                                                               // 1201
            aria: 'blockquote',                                                                                        // 1202
            tagNames: ['blockquote'],                                                                                  // 1203
            contentDefault: '<b>&ldquo;</b>',                                                                          // 1204
            contentFA: '<i class="fa fa-quote-right"></i>'                                                             // 1205
        },                                                                                                             // 1206
        'orderedlist': {                                                                                               // 1207
            name: 'orderedlist',                                                                                       // 1208
            action: 'insertorderedlist',                                                                               // 1209
            aria: 'ordered list',                                                                                      // 1210
            tagNames: ['ol'],                                                                                          // 1211
            useQueryState: true,                                                                                       // 1212
            contentDefault: '<b>1.</b>',                                                                               // 1213
            contentFA: '<i class="fa fa-list-ol"></i>'                                                                 // 1214
        },                                                                                                             // 1215
        'unorderedlist': {                                                                                             // 1216
            name: 'unorderedlist',                                                                                     // 1217
            action: 'insertunorderedlist',                                                                             // 1218
            aria: 'unordered list',                                                                                    // 1219
            tagNames: ['ul'],                                                                                          // 1220
            useQueryState: true,                                                                                       // 1221
            contentDefault: '<b>&bull;</b>',                                                                           // 1222
            contentFA: '<i class="fa fa-list-ul"></i>'                                                                 // 1223
        },                                                                                                             // 1224
        'pre': {                                                                                                       // 1225
            name: 'pre',                                                                                               // 1226
            action: 'append-pre',                                                                                      // 1227
            aria: 'preformatted text',                                                                                 // 1228
            tagNames: ['pre'],                                                                                         // 1229
            contentDefault: '<b>0101</b>',                                                                             // 1230
            contentFA: '<i class="fa fa-code fa-lg"></i>'                                                              // 1231
        },                                                                                                             // 1232
        'indent': {                                                                                                    // 1233
            name: 'indent',                                                                                            // 1234
            action: 'indent',                                                                                          // 1235
            aria: 'indent',                                                                                            // 1236
            tagNames: [],                                                                                              // 1237
            contentDefault: '<b>&rarr;</b>',                                                                           // 1238
            contentFA: '<i class="fa fa-indent"></i>'                                                                  // 1239
        },                                                                                                             // 1240
        'outdent': {                                                                                                   // 1241
            name: 'outdent',                                                                                           // 1242
            action: 'outdent',                                                                                         // 1243
            aria: 'outdent',                                                                                           // 1244
            tagNames: [],                                                                                              // 1245
            contentDefault: '<b>&larr;</b>',                                                                           // 1246
            contentFA: '<i class="fa fa-outdent"></i>'                                                                 // 1247
        },                                                                                                             // 1248
        'justifyCenter': {                                                                                             // 1249
            name: 'justifyCenter',                                                                                     // 1250
            action: 'justifyCenter',                                                                                   // 1251
            aria: 'center justify',                                                                                    // 1252
            tagNames: [],                                                                                              // 1253
            style: {                                                                                                   // 1254
                prop: 'text-align',                                                                                    // 1255
                value: 'center'                                                                                        // 1256
            },                                                                                                         // 1257
            useQueryState: true,                                                                                       // 1258
            contentDefault: '<b>C</b>',                                                                                // 1259
            contentFA: '<i class="fa fa-align-center"></i>'                                                            // 1260
        },                                                                                                             // 1261
        'justifyFull': {                                                                                               // 1262
            name: 'justifyFull',                                                                                       // 1263
            action: 'justifyFull',                                                                                     // 1264
            aria: 'full justify',                                                                                      // 1265
            tagNames: [],                                                                                              // 1266
            style: {                                                                                                   // 1267
                prop: 'text-align',                                                                                    // 1268
                value: 'justify'                                                                                       // 1269
            },                                                                                                         // 1270
            useQueryState: true,                                                                                       // 1271
            contentDefault: '<b>J</b>',                                                                                // 1272
            contentFA: '<i class="fa fa-align-justify"></i>'                                                           // 1273
        },                                                                                                             // 1274
        'justifyLeft': {                                                                                               // 1275
            name: 'justifyLeft',                                                                                       // 1276
            action: 'justifyLeft',                                                                                     // 1277
            aria: 'left justify',                                                                                      // 1278
            tagNames: [],                                                                                              // 1279
            style: {                                                                                                   // 1280
                prop: 'text-align',                                                                                    // 1281
                value: 'left'                                                                                          // 1282
            },                                                                                                         // 1283
            useQueryState: true,                                                                                       // 1284
            contentDefault: '<b>L</b>',                                                                                // 1285
            contentFA: '<i class="fa fa-align-left"></i>'                                                              // 1286
        },                                                                                                             // 1287
        'justifyRight': {                                                                                              // 1288
            name: 'justifyRight',                                                                                      // 1289
            action: 'justifyRight',                                                                                    // 1290
            aria: 'right justify',                                                                                     // 1291
            tagNames: [],                                                                                              // 1292
            style: {                                                                                                   // 1293
                prop: 'text-align',                                                                                    // 1294
                value: 'right'                                                                                         // 1295
            },                                                                                                         // 1296
            useQueryState: true,                                                                                       // 1297
            contentDefault: '<b>R</b>',                                                                                // 1298
            contentFA: '<i class="fa fa-align-right"></i>'                                                             // 1299
        },                                                                                                             // 1300
        'header1': {                                                                                                   // 1301
            name: 'header1',                                                                                           // 1302
            action: function (options) {                                                                               // 1303
                return 'append-' + options.firstHeader;                                                                // 1304
            },                                                                                                         // 1305
            aria: function (options) {                                                                                 // 1306
                return options.firstHeader;                                                                            // 1307
            },                                                                                                         // 1308
            tagNames: function (options) {                                                                             // 1309
                return [options.firstHeader];                                                                          // 1310
            },                                                                                                         // 1311
            contentDefault: '<b>H1</b>'                                                                                // 1312
        },                                                                                                             // 1313
        'header2': {                                                                                                   // 1314
            name: 'header2',                                                                                           // 1315
            action: function (options) {                                                                               // 1316
                return 'append-' + options.secondHeader;                                                               // 1317
            },                                                                                                         // 1318
            aria: function (options) {                                                                                 // 1319
                return options.secondHeader;                                                                           // 1320
            },                                                                                                         // 1321
            tagNames: function (options) {                                                                             // 1322
                return [options.secondHeader];                                                                         // 1323
            },                                                                                                         // 1324
            contentDefault: '<b>H2</b>'                                                                                // 1325
        }                                                                                                              // 1326
    };                                                                                                                 // 1327
                                                                                                                       // 1328
    DefaultButton = function (options, instance) {                                                                     // 1329
        this.options = options;                                                                                        // 1330
        this.name = options.name;                                                                                      // 1331
        this.init(instance);                                                                                           // 1332
    };                                                                                                                 // 1333
                                                                                                                       // 1334
    DefaultButton.prototype = {                                                                                        // 1335
        init: function (instance) {                                                                                    // 1336
            this.base = instance;                                                                                      // 1337
                                                                                                                       // 1338
            this.button = this.createButton();                                                                         // 1339
            this.base.on(this.button, 'click', this.handleClick.bind(this));                                           // 1340
            if (this.options.key) {                                                                                    // 1341
                this.base.subscribe('editableKeydown', this.handleKeydown.bind(this));                                 // 1342
            }                                                                                                          // 1343
        },                                                                                                             // 1344
        getButton: function () {                                                                                       // 1345
            return this.button;                                                                                        // 1346
        },                                                                                                             // 1347
        getAction: function () {                                                                                       // 1348
            return (typeof this.options.action === 'function') ? this.options.action(this.base.options) : this.options.action;
        },                                                                                                             // 1350
        getAria: function () {                                                                                         // 1351
            return (typeof this.options.aria === 'function') ? this.options.aria(this.base.options) : this.options.aria;
        },                                                                                                             // 1353
        getTagNames: function () {                                                                                     // 1354
            return (typeof this.options.tagNames === 'function') ? this.options.tagNames(this.base.options) : this.options.tagNames;
        },                                                                                                             // 1356
        createButton: function () {                                                                                    // 1357
            var button = this.base.options.ownerDocument.createElement('button'),                                      // 1358
                content = this.options.contentDefault;                                                                 // 1359
            button.classList.add('medium-editor-action');                                                              // 1360
            button.classList.add('medium-editor-action-' + this.name);                                                 // 1361
            button.setAttribute('data-action', this.getAction());                                                      // 1362
            button.setAttribute('aria-label', this.getAria());                                                         // 1363
            if (this.base.options.buttonLabels) {                                                                      // 1364
                if (this.base.options.buttonLabels === 'fontawesome' && this.options.contentFA) {                      // 1365
                    content = this.options.contentFA;                                                                  // 1366
                } else if (typeof this.base.options.buttonLabels === 'object' && this.base.options.buttonLabels[this.name]) {
                    content = this.base.options.buttonLabels[this.options.name];                                       // 1368
                }                                                                                                      // 1369
            }                                                                                                          // 1370
            button.innerHTML = content;                                                                                // 1371
            return button;                                                                                             // 1372
        },                                                                                                             // 1373
        handleKeydown: function (evt) {                                                                                // 1374
            var key, action;                                                                                           // 1375
                                                                                                                       // 1376
            if (evt.ctrlKey || evt.metaKey) {                                                                          // 1377
                key = String.fromCharCode(evt.which || evt.keyCode).toLowerCase();                                     // 1378
                if (this.options.key === key) {                                                                        // 1379
                    evt.preventDefault();                                                                              // 1380
                    evt.stopPropagation();                                                                             // 1381
                                                                                                                       // 1382
                    action = this.getAction();                                                                         // 1383
                    if (action) {                                                                                      // 1384
                        this.base.execAction(action);                                                                  // 1385
                    }                                                                                                  // 1386
                }                                                                                                      // 1387
            }                                                                                                          // 1388
        },                                                                                                             // 1389
        handleClick: function (evt) {                                                                                  // 1390
            evt.preventDefault();                                                                                      // 1391
            evt.stopPropagation();                                                                                     // 1392
                                                                                                                       // 1393
            var action = this.getAction();                                                                             // 1394
                                                                                                                       // 1395
            if (action) {                                                                                              // 1396
                this.base.execAction(action);                                                                          // 1397
            }                                                                                                          // 1398
        },                                                                                                             // 1399
        isActive: function () {                                                                                        // 1400
            return this.button.classList.contains(this.base.options.activeButtonClass);                                // 1401
        },                                                                                                             // 1402
        setInactive: function () {                                                                                     // 1403
            this.button.classList.remove(this.base.options.activeButtonClass);                                         // 1404
            delete this.knownState;                                                                                    // 1405
        },                                                                                                             // 1406
        setActive: function () {                                                                                       // 1407
            this.button.classList.add(this.base.options.activeButtonClass);                                            // 1408
            delete this.knownState;                                                                                    // 1409
        },                                                                                                             // 1410
        queryCommandState: function () {                                                                               // 1411
            var queryState = null;                                                                                     // 1412
            if (this.options.useQueryState) {                                                                          // 1413
                queryState = this.base.queryCommandState(this.getAction());                                            // 1414
            }                                                                                                          // 1415
            return queryState;                                                                                         // 1416
        },                                                                                                             // 1417
        isAlreadyApplied: function (node) {                                                                            // 1418
            var isMatch = false,                                                                                       // 1419
                tagNames = this.getTagNames(),                                                                         // 1420
                styleVals,                                                                                             // 1421
                computedStyle;                                                                                         // 1422
                                                                                                                       // 1423
            if (this.knownState === false || this.knownState === true) {                                               // 1424
                return this.knownState;                                                                                // 1425
            }                                                                                                          // 1426
                                                                                                                       // 1427
            if (tagNames && tagNames.length > 0 && node.tagName) {                                                     // 1428
                isMatch = tagNames.indexOf(node.tagName.toLowerCase()) !== -1;                                         // 1429
            }                                                                                                          // 1430
                                                                                                                       // 1431
            if (!isMatch && this.options.style) {                                                                      // 1432
                styleVals = this.options.style.value.split('|');                                                       // 1433
                computedStyle = this.base.options.contentWindow.getComputedStyle(node, null).getPropertyValue(this.options.style.prop);
                styleVals.forEach(function (val) {                                                                     // 1435
                    if (!this.knownState) {                                                                            // 1436
                        isMatch = (computedStyle.indexOf(val) !== -1);                                                 // 1437
                        // text-decoration is not inherited by default                                                 // 1438
                        // so if the computed style for text-decoration doesn't match                                  // 1439
                        // don't write to knownState so we can fallback to other checks                                // 1440
                        if (isMatch || this.options.style.prop !== 'text-decoration') {                                // 1441
                            this.knownState = isMatch;                                                                 // 1442
                        }                                                                                              // 1443
                    }                                                                                                  // 1444
                }.bind(this));                                                                                         // 1445
            }                                                                                                          // 1446
                                                                                                                       // 1447
            return isMatch;                                                                                            // 1448
        }                                                                                                              // 1449
    };                                                                                                                 // 1450
}(window, document));                                                                                                  // 1451
                                                                                                                       // 1452
var PasteHandler;                                                                                                      // 1453
                                                                                                                       // 1454
(function (window, document) {                                                                                         // 1455
    'use strict';                                                                                                      // 1456
    /*jslint regexp: true*/                                                                                            // 1457
    /*                                                                                                                 // 1458
        jslint does not allow character negation, because the negation                                                 // 1459
        will not match any unicode characters. In the regexes in this                                                  // 1460
        block, negation is used specifically to match the end of an html                                               // 1461
        tag, and in fact unicode characters *should* be allowed.                                                       // 1462
    */                                                                                                                 // 1463
    function createReplacements() {                                                                                    // 1464
        return [                                                                                                       // 1465
                                                                                                                       // 1466
            // replace two bogus tags that begin pastes from google docs                                               // 1467
            [new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi), ""],                                                      // 1468
            [new RegExp(/<\/b>(<br[^>]*>)?$/gi), ""],                                                                  // 1469
                                                                                                                       // 1470
             // un-html spaces and newlines inserted by OS X                                                           // 1471
            [new RegExp(/<span class="Apple-converted-space">\s+<\/span>/g), ' '],                                     // 1472
            [new RegExp(/<br class="Apple-interchange-newline">/g), '<br>'],                                           // 1473
                                                                                                                       // 1474
            // replace google docs italics+bold with a span to be replaced once the html is inserted                   // 1475
            [new RegExp(/<span[^>]*(font-style:italic;font-weight:bold|font-weight:bold;font-style:italic)[^>]*>/gi), '<span class="replace-with italic bold">'],
                                                                                                                       // 1477
            // replace google docs italics with a span to be replaced once the html is inserted                        // 1478
            [new RegExp(/<span[^>]*font-style:italic[^>]*>/gi), '<span class="replace-with italic">'],                 // 1479
                                                                                                                       // 1480
            //[replace google docs bolds with a span to be replaced once the html is inserted                          // 1481
            [new RegExp(/<span[^>]*font-weight:bold[^>]*>/gi), '<span class="replace-with bold">'],                    // 1482
                                                                                                                       // 1483
             // replace manually entered b/i/a tags with real ones                                                     // 1484
            [new RegExp(/&lt;(\/?)(i|b|a)&gt;/gi), '<$1$2>'],                                                          // 1485
                                                                                                                       // 1486
             // replace manually a tags with real ones, converting smart-quotes from google docs                       // 1487
            [new RegExp(/&lt;a\s+href=(&quot;|&rdquo;|&ldquo;||)([^&]+)(&quot;|&rdquo;|&ldquo;||)&gt;/gi), '<a href="$2">'],
                                                                                                                       // 1489
            // Newlines between paragraphs in html have no syntactic value,                                            // 1490
            // but then have a tendency to accidentally become additional paragraphs down the line                     // 1491
            [new RegExp(/<\/p>\n+/gi), '</p>'],                                                                        // 1492
            [new RegExp(/\n+<p/gi), '<p'],                                                                             // 1493
                                                                                                                       // 1494
            // Microsoft Word makes these odd tags, like <o:p></o:p>                                                   // 1495
            [new RegExp(/<\/?o:[a-z]*>/gi), '']                                                                        // 1496
        ];                                                                                                             // 1497
    }                                                                                                                  // 1498
    /*jslint regexp: false*/                                                                                           // 1499
                                                                                                                       // 1500
    PasteHandler = function (instance) {                                                                               // 1501
        this.base = instance;                                                                                          // 1502
        this.options = this.base.options;                                                                              // 1503
                                                                                                                       // 1504
        if (this.options.forcePlainText || this.options.cleanPastedHTML) {                                             // 1505
            this.base.subscribe('editablePaste', this.handlePaste.bind(this));                                         // 1506
        }                                                                                                              // 1507
    };                                                                                                                 // 1508
                                                                                                                       // 1509
    PasteHandler.prototype = {                                                                                         // 1510
        handlePaste: function (event, element) {                                                                       // 1511
            var paragraphs,                                                                                            // 1512
                html = '',                                                                                             // 1513
                p,                                                                                                     // 1514
                dataFormatHTML = 'text/html',                                                                          // 1515
                dataFormatPlain = 'text/plain';                                                                        // 1516
                                                                                                                       // 1517
            if (this.options.contentWindow.clipboardData && event.clipboardData === undefined) {                       // 1518
                event.clipboardData = this.options.contentWindow.clipboardData;                                        // 1519
                // If window.clipboardData exists, but event.clipboardData doesn't exist,                              // 1520
                // we're probably in IE. IE only has two possibilities for clipboard                                   // 1521
                // data format: 'Text' and 'URL'.                                                                      // 1522
                //                                                                                                     // 1523
                // Of the two, we want 'Text':                                                                         // 1524
                dataFormatHTML = 'Text';                                                                               // 1525
                dataFormatPlain = 'Text';                                                                              // 1526
            }                                                                                                          // 1527
                                                                                                                       // 1528
            if (event.clipboardData                                                                                    // 1529
                    && event.clipboardData.getData                                                                     // 1530
                    && !event.defaultPrevented) {                                                                      // 1531
                event.preventDefault();                                                                                // 1532
                                                                                                                       // 1533
                if (this.options.cleanPastedHTML && event.clipboardData.getData(dataFormatHTML)) {                     // 1534
                    return this.cleanPaste(event.clipboardData.getData(dataFormatHTML));                               // 1535
                }                                                                                                      // 1536
                                                                                                                       // 1537
                if (!(this.options.disableReturn || element.getAttribute('data-disable-return'))) {                    // 1538
                    paragraphs = event.clipboardData.getData(dataFormatPlain).split(/[\r\n]/g);                        // 1539
                    for (p = 0; p < paragraphs.length; p += 1) {                                                       // 1540
                        if (paragraphs[p] !== '') {                                                                    // 1541
                            html += '<p>' + Util.htmlEntities(paragraphs[p]) + '</p>';                                 // 1542
                        }                                                                                              // 1543
                    }                                                                                                  // 1544
                    Util.insertHTMLCommand(this.options.ownerDocument, html);                                          // 1545
                } else {                                                                                               // 1546
                    html = Util.htmlEntities(event.clipboardData.getData(dataFormatPlain));                            // 1547
                    Util.insertHTMLCommand(this.options.ownerDocument, html);                                          // 1548
                }                                                                                                      // 1549
            }                                                                                                          // 1550
        },                                                                                                             // 1551
                                                                                                                       // 1552
        cleanPaste: function (text) {                                                                                  // 1553
            var i, elList, workEl,                                                                                     // 1554
                el = Selection.getSelectionElement(this.options.contentWindow),                                        // 1555
                multiline = /<p|<br|<div/.test(text),                                                                  // 1556
                replacements = createReplacements();                                                                   // 1557
                                                                                                                       // 1558
            for (i = 0; i < replacements.length; i += 1) {                                                             // 1559
                text = text.replace(replacements[i][0], replacements[i][1]);                                           // 1560
            }                                                                                                          // 1561
                                                                                                                       // 1562
            if (multiline) {                                                                                           // 1563
                // double br's aren't converted to p tags, but we want paragraphs.                                     // 1564
                elList = text.split('<br><br>');                                                                       // 1565
                                                                                                                       // 1566
                this.pasteHTML('<p>' + elList.join('</p><p>') + '</p>');                                               // 1567
                                                                                                                       // 1568
                try {                                                                                                  // 1569
                    this.options.ownerDocument.execCommand('insertText', false, "\n");                                 // 1570
                } catch (ignore) { }                                                                                   // 1571
                                                                                                                       // 1572
                // block element cleanup                                                                               // 1573
                elList = el.querySelectorAll('a,p,div,br');                                                            // 1574
                for (i = 0; i < elList.length; i += 1) {                                                               // 1575
                    workEl = elList[i];                                                                                // 1576
                                                                                                                       // 1577
                    // Microsoft Word replaces some spaces with newlines.                                              // 1578
                    // While newlines between block elements are meaningless, newlines within                          // 1579
                    // elements are sometimes actually spaces.                                                         // 1580
                    workEl.innerHTML = workEl.innerHTML.replace(/\n/gi, ' ');                                          // 1581
                                                                                                                       // 1582
                    switch (workEl.tagName.toLowerCase()) {                                                            // 1583
                    case 'a':                                                                                          // 1584
                        if (this.options.targetBlank) {                                                                // 1585
                            Util.setTargetBlank(workEl);                                                               // 1586
                        }                                                                                              // 1587
                        break;                                                                                         // 1588
                    case 'p':                                                                                          // 1589
                    case 'div':                                                                                        // 1590
                        this.filterCommonBlocks(workEl);                                                               // 1591
                        break;                                                                                         // 1592
                    case 'br':                                                                                         // 1593
                        this.filterLineBreak(workEl);                                                                  // 1594
                        break;                                                                                         // 1595
                    }                                                                                                  // 1596
                }                                                                                                      // 1597
            } else {                                                                                                   // 1598
                this.pasteHTML(text);                                                                                  // 1599
            }                                                                                                          // 1600
        },                                                                                                             // 1601
                                                                                                                       // 1602
        pasteHTML: function (html) {                                                                                   // 1603
            var elList, workEl, i, fragmentBody, pasteBlock = this.options.ownerDocument.createDocumentFragment();     // 1604
                                                                                                                       // 1605
            pasteBlock.appendChild(this.options.ownerDocument.createElement('body'));                                  // 1606
                                                                                                                       // 1607
            fragmentBody = pasteBlock.querySelector('body');                                                           // 1608
            fragmentBody.innerHTML = html;                                                                             // 1609
                                                                                                                       // 1610
            this.cleanupSpans(fragmentBody);                                                                           // 1611
                                                                                                                       // 1612
            elList = fragmentBody.querySelectorAll('*');                                                               // 1613
            for (i = 0; i < elList.length; i += 1) {                                                                   // 1614
                workEl = elList[i];                                                                                    // 1615
                                                                                                                       // 1616
                // delete ugly attributes                                                                              // 1617
                workEl.removeAttribute('class');                                                                       // 1618
                workEl.removeAttribute('style');                                                                       // 1619
                workEl.removeAttribute('dir');                                                                         // 1620
                                                                                                                       // 1621
                if (workEl.tagName.toLowerCase() === 'meta') {                                                         // 1622
                    workEl.parentNode.removeChild(workEl);                                                             // 1623
                }                                                                                                      // 1624
            }                                                                                                          // 1625
            Util.insertHTMLCommand(this.options.ownerDocument, fragmentBody.innerHTML.replace(/&nbsp;/g, ' '));        // 1626
        },                                                                                                             // 1627
        isCommonBlock: function (el) {                                                                                 // 1628
            return (el && (el.tagName.toLowerCase() === 'p' || el.tagName.toLowerCase() === 'div'));                   // 1629
        },                                                                                                             // 1630
        filterCommonBlocks: function (el) {                                                                            // 1631
            if (/^\s*$/.test(el.textContent) && el.parentNode) {                                                       // 1632
                el.parentNode.removeChild(el);                                                                         // 1633
            }                                                                                                          // 1634
        },                                                                                                             // 1635
        filterLineBreak: function (el) {                                                                               // 1636
                                                                                                                       // 1637
            if (this.isCommonBlock(el.previousElementSibling)) {                                                       // 1638
                // remove stray br's following common block elements                                                   // 1639
                this.removeWithParent(el);                                                                             // 1640
            } else if (this.isCommonBlock(el.parentNode) && (el.parentNode.firstChild === el || el.parentNode.lastChild === el)) {
                // remove br's just inside open or close tags of a div/p                                               // 1642
                this.removeWithParent(el);                                                                             // 1643
            } else if (el.parentNode && el.parentNode.childElementCount === 1 && el.parentNode.textContent === '') {   // 1644
                // and br's that are the only child of elements other than div/p                                       // 1645
                this.removeWithParent(el);                                                                             // 1646
            }                                                                                                          // 1647
        },                                                                                                             // 1648
                                                                                                                       // 1649
        // remove an element, including its parent, if it is the only element within its parent                        // 1650
        removeWithParent: function (el) {                                                                              // 1651
            if (el && el.parentNode) {                                                                                 // 1652
                if (el.parentNode.parentNode && el.parentNode.childElementCount === 1) {                               // 1653
                    el.parentNode.parentNode.removeChild(el.parentNode);                                               // 1654
                } else {                                                                                               // 1655
                    el.parentNode.removeChild(el);                                                                     // 1656
                }                                                                                                      // 1657
            }                                                                                                          // 1658
        },                                                                                                             // 1659
                                                                                                                       // 1660
        cleanupSpans: function (container_el) {                                                                        // 1661
            var i,                                                                                                     // 1662
                el,                                                                                                    // 1663
                new_el,                                                                                                // 1664
                spans = container_el.querySelectorAll('.replace-with'),                                                // 1665
                isCEF = function (el) {                                                                                // 1666
                    return (el && el.nodeName !== '#text' && el.getAttribute('contenteditable') === 'false');          // 1667
                };                                                                                                     // 1668
                                                                                                                       // 1669
            for (i = 0; i < spans.length; i += 1) {                                                                    // 1670
                el = spans[i];                                                                                         // 1671
                new_el = this.options.ownerDocument.createElement(el.classList.contains('bold') ? 'b' : 'i');          // 1672
                                                                                                                       // 1673
                if (el.classList.contains('bold') && el.classList.contains('italic')) {                                // 1674
                    // add an i tag as well if this has both italics and bold                                          // 1675
                    new_el.innerHTML = '<i>' + el.innerHTML + '</i>';                                                  // 1676
                } else {                                                                                               // 1677
                    new_el.innerHTML = el.innerHTML;                                                                   // 1678
                }                                                                                                      // 1679
                el.parentNode.replaceChild(new_el, el);                                                                // 1680
            }                                                                                                          // 1681
                                                                                                                       // 1682
            spans = container_el.querySelectorAll('span');                                                             // 1683
            for (i = 0; i < spans.length; i += 1) {                                                                    // 1684
                el = spans[i];                                                                                         // 1685
                                                                                                                       // 1686
                // bail if span is in contenteditable = false                                                          // 1687
                if (Util.traverseUp(el, isCEF)) {                                                                      // 1688
                    return false;                                                                                      // 1689
                }                                                                                                      // 1690
                                                                                                                       // 1691
                // remove empty spans, replace others with their contents                                              // 1692
                if (/^\s*$/.test()) {                                                                                  // 1693
                    el.parentNode.removeChild(el);                                                                     // 1694
                } else {                                                                                               // 1695
                    el.parentNode.replaceChild(this.options.ownerDocument.createTextNode(el.textContent), el);         // 1696
                }                                                                                                      // 1697
            }                                                                                                          // 1698
        }                                                                                                              // 1699
    };                                                                                                                 // 1700
}(window, document));                                                                                                  // 1701
                                                                                                                       // 1702
var AnchorExtension;                                                                                                   // 1703
                                                                                                                       // 1704
(function (window, document) {                                                                                         // 1705
    'use strict';                                                                                                      // 1706
                                                                                                                       // 1707
    function AnchorDerived() {                                                                                         // 1708
        this.parent = true;                                                                                            // 1709
        this.options = {                                                                                               // 1710
            name: 'anchor',                                                                                            // 1711
            action: 'createLink',                                                                                      // 1712
            aria: 'link',                                                                                              // 1713
            tagNames: ['a'],                                                                                           // 1714
            contentDefault: '<b>#</b>',                                                                                // 1715
            contentFA: '<i class="fa fa-link"></i>'                                                                    // 1716
        };                                                                                                             // 1717
        this.name = 'anchor';                                                                                          // 1718
        this.hasForm = true;                                                                                           // 1719
    }                                                                                                                  // 1720
                                                                                                                       // 1721
    AnchorDerived.prototype = {                                                                                        // 1722
                                                                                                                       // 1723
        // Button and Extension handling                                                                               // 1724
                                                                                                                       // 1725
        // Called when the button the toolbar is clicked                                                               // 1726
        // Overrides DefaultButton.handleClick                                                                         // 1727
        handleClick: function (evt) {                                                                                  // 1728
            evt.preventDefault();                                                                                      // 1729
            evt.stopPropagation();                                                                                     // 1730
                                                                                                                       // 1731
            var selectedParentElement = Selection.getSelectedParentElement(Util.getSelectionRange(this.base.options.ownerDocument));
            if (selectedParentElement.tagName &&                                                                       // 1733
                    selectedParentElement.tagName.toLowerCase() === 'a') {                                             // 1734
                return this.base.execAction('unlink');                                                                 // 1735
            }                                                                                                          // 1736
                                                                                                                       // 1737
            if (!this.isDisplayed()) {                                                                                 // 1738
                this.showForm();                                                                                       // 1739
            }                                                                                                          // 1740
                                                                                                                       // 1741
            return false;                                                                                              // 1742
        },                                                                                                             // 1743
                                                                                                                       // 1744
        // Called by medium-editor to append form to the toolbar                                                       // 1745
        getForm: function () {                                                                                         // 1746
            if (!this.form) {                                                                                          // 1747
                this.form = this.createForm();                                                                         // 1748
            }                                                                                                          // 1749
            return this.form;                                                                                          // 1750
        },                                                                                                             // 1751
                                                                                                                       // 1752
        // Used by medium-editor when the default toolbar is to be displayed                                           // 1753
        isDisplayed: function () {                                                                                     // 1754
            return this.getForm().style.display === 'block';                                                           // 1755
        },                                                                                                             // 1756
                                                                                                                       // 1757
        hideForm: function () {                                                                                        // 1758
            this.getForm().style.display = 'none';                                                                     // 1759
            this.getInput().value = '';                                                                                // 1760
        },                                                                                                             // 1761
                                                                                                                       // 1762
        showForm: function (link_value) {                                                                              // 1763
            var input = this.getInput();                                                                               // 1764
                                                                                                                       // 1765
            this.base.saveSelection();                                                                                 // 1766
            this.base.hideToolbarDefaultActions();                                                                     // 1767
            this.getForm().style.display = 'block';                                                                    // 1768
            this.base.setToolbarPosition();                                                                            // 1769
                                                                                                                       // 1770
            input.value = link_value || '';                                                                            // 1771
            input.focus();                                                                                             // 1772
        },                                                                                                             // 1773
                                                                                                                       // 1774
        // Called by core when tearing down medium-editor (deactivate)                                                 // 1775
        deactivate: function () {                                                                                      // 1776
            if (!this.form) {                                                                                          // 1777
                return false;                                                                                          // 1778
            }                                                                                                          // 1779
                                                                                                                       // 1780
            if (this.form.parentNode) {                                                                                // 1781
                this.form.parentNode.removeChild(this.form);                                                           // 1782
            }                                                                                                          // 1783
                                                                                                                       // 1784
            delete this.form;                                                                                          // 1785
        },                                                                                                             // 1786
                                                                                                                       // 1787
        // core methods                                                                                                // 1788
                                                                                                                       // 1789
        doFormSave: function () {                                                                                      // 1790
            var targetCheckbox = this.getForm().querySelector('.medium-editor-toolbar-anchor-target'),                 // 1791
                buttonCheckbox = this.getForm().querySelector('.medium-editor-toolbar-anchor-button'),                 // 1792
                opts = {                                                                                               // 1793
                    url: this.getInput().value                                                                         // 1794
                };                                                                                                     // 1795
                                                                                                                       // 1796
            this.base.restoreSelection();                                                                              // 1797
                                                                                                                       // 1798
            if (this.base.options.checkLinkFormat) {                                                                   // 1799
                opts.url = this.checkLinkFormat(opts.url);                                                             // 1800
            }                                                                                                          // 1801
                                                                                                                       // 1802
            if (targetCheckbox && targetCheckbox.checked) {                                                            // 1803
                opts.target = "_blank";                                                                                // 1804
            } else {                                                                                                   // 1805
                opts.target = "_self";                                                                                 // 1806
            }                                                                                                          // 1807
                                                                                                                       // 1808
            if (buttonCheckbox && buttonCheckbox.checked) {                                                            // 1809
                opts.buttonClass = this.base.options.anchorButtonClass;                                                // 1810
            }                                                                                                          // 1811
                                                                                                                       // 1812
            this.base.createLink(opts);                                                                                // 1813
            this.base.checkSelection();                                                                                // 1814
        },                                                                                                             // 1815
                                                                                                                       // 1816
        checkLinkFormat: function (value) {                                                                            // 1817
            var re = /^(https?|ftps?|rtmpt?):\/\/|mailto:/;                                                            // 1818
            return (re.test(value) ? '' : 'http://') + value;                                                          // 1819
        },                                                                                                             // 1820
                                                                                                                       // 1821
        doFormCancel: function () {                                                                                    // 1822
            this.base.restoreSelection();                                                                              // 1823
            this.base.checkSelection();                                                                                // 1824
        },                                                                                                             // 1825
                                                                                                                       // 1826
        // form creation and event handling                                                                            // 1827
                                                                                                                       // 1828
        createForm: function () {                                                                                      // 1829
            var doc = this.base.options.ownerDocument,                                                                 // 1830
                form = doc.createElement('div'),                                                                       // 1831
                input = doc.createElement('input'),                                                                    // 1832
                close = doc.createElement('a'),                                                                        // 1833
                save = doc.createElement('a'),                                                                         // 1834
                target,                                                                                                // 1835
                target_label,                                                                                          // 1836
                button,                                                                                                // 1837
                button_label;                                                                                          // 1838
                                                                                                                       // 1839
            // Anchor Form (div)                                                                                       // 1840
            form.className = 'medium-editor-toolbar-form';                                                             // 1841
            form.id = 'medium-editor-toolbar-form-anchor-' + this.base.id;                                             // 1842
                                                                                                                       // 1843
            // Handle clicks on the form itself                                                                        // 1844
            this.base.on(form, 'click', this.handleFormClick.bind(this));                                              // 1845
                                                                                                                       // 1846
            // Add url textbox                                                                                         // 1847
            input.setAttribute('type', 'text');                                                                        // 1848
            input.className = 'medium-editor-toolbar-input';                                                           // 1849
            input.setAttribute('placeholder', this.base.options.anchorInputPlaceholder);                               // 1850
            form.appendChild(input);                                                                                   // 1851
                                                                                                                       // 1852
            // Handle typing in the textbox                                                                            // 1853
            this.base.on(input, 'keyup', this.handleTextboxKeyup.bind(this));                                          // 1854
                                                                                                                       // 1855
            // Add save buton                                                                                          // 1856
            save.setAttribute('href', '#');                                                                            // 1857
            save.className = 'medium-editor-toolbar-save';                                                             // 1858
            save.innerHTML = this.base.options.buttonLabels === 'fontawesome' ?                                        // 1859
                             '<i class="fa fa-check"></i>' :                                                           // 1860
                             '&#10003;';                                                                               // 1861
            form.appendChild(save);                                                                                    // 1862
                                                                                                                       // 1863
            // Handle save button clicks (capture)                                                                     // 1864
            this.base.on(save, 'click', this.handleSaveClick.bind(this), true);                                        // 1865
                                                                                                                       // 1866
            // Add close button                                                                                        // 1867
            close.setAttribute('href', '#');                                                                           // 1868
            close.className = 'medium-editor-toolbar-close';                                                           // 1869
            close.innerHTML = this.base.options.buttonLabels === 'fontawesome' ?                                       // 1870
                              '<i class="fa fa-times"></i>' :                                                          // 1871
                              '&times;';                                                                               // 1872
            form.appendChild(close);                                                                                   // 1873
                                                                                                                       // 1874
            // Handle close button clicks                                                                              // 1875
            this.base.on(close, 'click', this.handleCloseClick.bind(this));                                            // 1876
                                                                                                                       // 1877
            // (Optional) Add 'open in new window' checkbox                                                            // 1878
            if (this.base.options.anchorTarget) {                                                                      // 1879
                target = doc.createElement('input');                                                                   // 1880
                target.setAttribute('type', 'checkbox');                                                               // 1881
                target.className = 'medium-editor-toolbar-anchor-target';                                              // 1882
                                                                                                                       // 1883
                target_label = doc.createElement('label');                                                             // 1884
                target_label.innerHTML = this.base.options.anchorInputCheckboxLabel;                                   // 1885
                target_label.insertBefore(target, target_label.firstChild);                                            // 1886
                                                                                                                       // 1887
                form.appendChild(target_label);                                                                        // 1888
            }                                                                                                          // 1889
                                                                                                                       // 1890
            // (Optional) Add 'add button class to anchor' checkbox                                                    // 1891
            if (this.base.options.anchorButton) {                                                                      // 1892
                button = doc.createElement('input');                                                                   // 1893
                button.setAttribute('type', 'checkbox');                                                               // 1894
                button.className = 'medium-editor-toolbar-anchor-button';                                              // 1895
                                                                                                                       // 1896
                button_label = doc.createElement('label');                                                             // 1897
                button_label.innerHTML = "Button";                                                                     // 1898
                button_label.insertBefore(button, button_label.firstChild);                                            // 1899
                                                                                                                       // 1900
                form.appendChild(button_label);                                                                        // 1901
            }                                                                                                          // 1902
                                                                                                                       // 1903
            return form;                                                                                               // 1904
        },                                                                                                             // 1905
                                                                                                                       // 1906
        getInput: function () {                                                                                        // 1907
            return this.getForm().querySelector('input.medium-editor-toolbar-input');                                  // 1908
        },                                                                                                             // 1909
                                                                                                                       // 1910
        handleTextboxKeyup: function (event) {                                                                         // 1911
            // For ENTER -> create the anchor                                                                          // 1912
            if (event.keyCode === Util.keyCode.ENTER) {                                                                // 1913
                event.preventDefault();                                                                                // 1914
                this.doFormSave();                                                                                     // 1915
                return;                                                                                                // 1916
            }                                                                                                          // 1917
                                                                                                                       // 1918
            // For ESCAPE -> close the form                                                                            // 1919
            if (event.keyCode === Util.keyCode.ESCAPE) {                                                               // 1920
                event.preventDefault();                                                                                // 1921
                this.doFormCancel();                                                                                   // 1922
            }                                                                                                          // 1923
        },                                                                                                             // 1924
                                                                                                                       // 1925
        handleFormClick: function (event) {                                                                            // 1926
            // make sure not to hide form when clicking inside the form                                                // 1927
            event.stopPropagation();                                                                                   // 1928
        },                                                                                                             // 1929
                                                                                                                       // 1930
        handleSaveClick: function (event) {                                                                            // 1931
            // Clicking Save -> create the anchor                                                                      // 1932
            event.preventDefault();                                                                                    // 1933
            this.doFormSave();                                                                                         // 1934
        },                                                                                                             // 1935
                                                                                                                       // 1936
        handleCloseClick: function (event) {                                                                           // 1937
            // Click Close -> close the form                                                                           // 1938
            event.preventDefault();                                                                                    // 1939
            this.doFormCancel();                                                                                       // 1940
        }                                                                                                              // 1941
    };                                                                                                                 // 1942
                                                                                                                       // 1943
    AnchorExtension = Util.derives(DefaultButton, AnchorDerived);                                                      // 1944
}(window, document));                                                                                                  // 1945
                                                                                                                       // 1946
var AnchorPreview;                                                                                                     // 1947
                                                                                                                       // 1948
(function (window, document) {                                                                                         // 1949
    'use strict';                                                                                                      // 1950
                                                                                                                       // 1951
    AnchorPreview = function () {                                                                                      // 1952
        this.parent = true;                                                                                            // 1953
        this.name = 'anchor-preview';                                                                                  // 1954
    };                                                                                                                 // 1955
                                                                                                                       // 1956
    AnchorPreview.prototype = {                                                                                        // 1957
                                                                                                                       // 1958
        init: function (instance) {                                                                                    // 1959
            this.base = instance;                                                                                      // 1960
            this.anchorPreview = this.createPreview();                                                                 // 1961
            this.base.options.elementsContainer.appendChild(this.anchorPreview);                                       // 1962
                                                                                                                       // 1963
            this.attachToEditables();                                                                                  // 1964
        },                                                                                                             // 1965
                                                                                                                       // 1966
        getPreviewElement: function () {                                                                               // 1967
            return this.anchorPreview;                                                                                 // 1968
        },                                                                                                             // 1969
                                                                                                                       // 1970
        createPreview: function () {                                                                                   // 1971
            var el = this.base.options.ownerDocument.createElement('div');                                             // 1972
                                                                                                                       // 1973
            el.id = 'medium-editor-anchor-preview-' + this.base.id;                                                    // 1974
            el.className = 'medium-editor-anchor-preview';                                                             // 1975
            el.innerHTML = this.getTemplate();                                                                         // 1976
                                                                                                                       // 1977
            this.base.on(el, 'click', this.handleClick.bind(this));                                                    // 1978
                                                                                                                       // 1979
            return el;                                                                                                 // 1980
        },                                                                                                             // 1981
                                                                                                                       // 1982
        getTemplate: function () {                                                                                     // 1983
            return '<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">' +    // 1984
                '    <i class="medium-editor-toolbar-anchor-preview-inner"></i>' +                                     // 1985
                '</div>';                                                                                              // 1986
        },                                                                                                             // 1987
                                                                                                                       // 1988
        deactivate: function () {                                                                                      // 1989
            if (this.anchorPreview) {                                                                                  // 1990
                if (this.anchorPreview.parentNode) {                                                                   // 1991
                    this.anchorPreview.parentNode.removeChild(this.anchorPreview);                                     // 1992
                }                                                                                                      // 1993
                delete this.anchorPreview;                                                                             // 1994
            }                                                                                                          // 1995
        },                                                                                                             // 1996
                                                                                                                       // 1997
        hidePreview: function () {                                                                                     // 1998
            this.anchorPreview.classList.remove('medium-editor-anchor-preview-active');                                // 1999
            this.activeAnchor = null;                                                                                  // 2000
        },                                                                                                             // 2001
                                                                                                                       // 2002
        showPreview: function (anchorEl) {                                                                             // 2003
            if (this.anchorPreview.classList.contains('medium-editor-anchor-preview-active')                           // 2004
                    || anchorEl.getAttribute('data-disable-preview')) {                                                // 2005
                return true;                                                                                           // 2006
            }                                                                                                          // 2007
                                                                                                                       // 2008
            this.anchorPreview.querySelector('i').textContent = anchorEl.attributes.href.value;                        // 2009
                                                                                                                       // 2010
            this.anchorPreview.classList.add('medium-toolbar-arrow-over');                                             // 2011
            this.anchorPreview.classList.remove('medium-toolbar-arrow-under');                                         // 2012
                                                                                                                       // 2013
            if (!this.anchorPreview.classList.contains('medium-editor-anchor-preview-active')) {                       // 2014
                this.anchorPreview.classList.add('medium-editor-anchor-preview-active');                               // 2015
            }                                                                                                          // 2016
                                                                                                                       // 2017
            this.activeAnchor = anchorEl;                                                                              // 2018
                                                                                                                       // 2019
            this.positionPreview();                                                                                    // 2020
            this.attachPreviewHandlers();                                                                              // 2021
                                                                                                                       // 2022
            return this;                                                                                               // 2023
        },                                                                                                             // 2024
                                                                                                                       // 2025
        positionPreview: function () {                                                                                 // 2026
            var buttonHeight = 40,                                                                                     // 2027
                boundary = this.activeAnchor.getBoundingClientRect(),                                                  // 2028
                middleBoundary = (boundary.left + boundary.right) / 2,                                                 // 2029
                halfOffsetWidth,                                                                                       // 2030
                defaultLeft;                                                                                           // 2031
                                                                                                                       // 2032
            halfOffsetWidth = this.anchorPreview.offsetWidth / 2;                                                      // 2033
            defaultLeft = this.base.options.diffLeft - halfOffsetWidth;                                                // 2034
                                                                                                                       // 2035
            this.anchorPreview.style.top = Math.round(buttonHeight + boundary.bottom - this.base.options.diffTop + this.base.options.contentWindow.pageYOffset - this.anchorPreview.offsetHeight) + 'px';
            if (middleBoundary < halfOffsetWidth) {                                                                    // 2037
                this.anchorPreview.style.left = defaultLeft + halfOffsetWidth + 'px';                                  // 2038
            } else if ((this.base.options.contentWindow.innerWidth - middleBoundary) < halfOffsetWidth) {              // 2039
                this.anchorPreview.style.left = this.base.options.contentWindow.innerWidth + defaultLeft - halfOffsetWidth + 'px';
            } else {                                                                                                   // 2041
                this.anchorPreview.style.left = defaultLeft + middleBoundary + 'px';                                   // 2042
            }                                                                                                          // 2043
        },                                                                                                             // 2044
                                                                                                                       // 2045
        attachToEditables: function () {                                                                               // 2046
            this.base.subscribe('editableMouseover', this.handleEditableMouseover.bind(this));                         // 2047
        },                                                                                                             // 2048
                                                                                                                       // 2049
        handleClick: function (event) {                                                                                // 2050
            var range,                                                                                                 // 2051
                sel,                                                                                                   // 2052
                anchorExtension = this.base.getExtensionByName('anchor'),                                              // 2053
                activeAnchor = this.activeAnchor;                                                                      // 2054
                                                                                                                       // 2055
            if (anchorExtension && activeAnchor) {                                                                     // 2056
                range = this.base.options.ownerDocument.createRange();                                                 // 2057
                range.selectNodeContents(this.activeAnchor);                                                           // 2058
                                                                                                                       // 2059
                sel = this.base.options.contentWindow.getSelection();                                                  // 2060
                sel.removeAllRanges();                                                                                 // 2061
                sel.addRange(range);                                                                                   // 2062
                // Using setTimeout + options.delay because:                                                           // 2063
                // We may actually be displaying the anchor form, which should be controlled by options.delay          // 2064
                this.base.delay(function () {                                                                          // 2065
                    if (activeAnchor) {                                                                                // 2066
                        anchorExtension.showForm(activeAnchor.attributes.href.value);                                  // 2067
                        activeAnchor = null;                                                                           // 2068
                    }                                                                                                  // 2069
                }.bind(this));                                                                                         // 2070
            }                                                                                                          // 2071
                                                                                                                       // 2072
            this.hidePreview();                                                                                        // 2073
        },                                                                                                             // 2074
                                                                                                                       // 2075
        handleAnchorMouseout: function (event) {                                                                       // 2076
            this.anchorToPreview = null;                                                                               // 2077
            this.base.off(this.activeAnchor, 'mouseout', this.instance_handleAnchorMouseout);                          // 2078
            this.instance_handleAnchorMouseout = null;                                                                 // 2079
        },                                                                                                             // 2080
                                                                                                                       // 2081
        handleEditableMouseover: function (event) {                                                                    // 2082
            if (event.target && event.target.tagName.toLowerCase() === 'a') {                                          // 2083
                                                                                                                       // 2084
                // Detect empty href attributes                                                                        // 2085
                // The browser will make href="" or href="#top"                                                        // 2086
                // into absolute urls when accessed as event.targed.href, so check the html                            // 2087
                if (!/href=["']\S+["']/.test(event.target.outerHTML) || /href=["']#\S+["']/.test(event.target.outerHTML)) {
                    return true;                                                                                       // 2089
                }                                                                                                      // 2090
                                                                                                                       // 2091
                // only show when hovering on anchors                                                                  // 2092
                if (this.base.toolbar && this.base.toolbar.isDisplayed()) {                                            // 2093
                    // only show when toolbar is not present                                                           // 2094
                    return true;                                                                                       // 2095
                }                                                                                                      // 2096
                                                                                                                       // 2097
                // detach handler for other anchor in case we hovered multiple anchors quickly                         // 2098
                if (this.activeAnchor && this.activeAnchor !== event.target) {                                         // 2099
                    this.detachPreviewHandlers();                                                                      // 2100
                }                                                                                                      // 2101
                                                                                                                       // 2102
                this.anchorToPreview = event.target;                                                                   // 2103
                                                                                                                       // 2104
                this.instance_handleAnchorMouseout = this.handleAnchorMouseout.bind(this);                             // 2105
                this.base.on(this.anchorToPreview, 'mouseout', this.instance_handleAnchorMouseout);                    // 2106
                // Using setTimeout + options.delay because:                                                           // 2107
                // - We're going to show the anchor preview according to the configured delay                          // 2108
                //   if the mouse has not left the anchor tag in that time                                             // 2109
                this.base.delay(function () {                                                                          // 2110
                    if (this.anchorToPreview) {                                                                        // 2111
                        //this.activeAnchor = this.anchorToPreview;                                                    // 2112
                        this.showPreview(this.anchorToPreview);                                                        // 2113
                    }                                                                                                  // 2114
                }.bind(this));                                                                                         // 2115
            }                                                                                                          // 2116
        },                                                                                                             // 2117
                                                                                                                       // 2118
        handlePreviewMouseover: function (event) {                                                                     // 2119
            this.lastOver = (new Date()).getTime();                                                                    // 2120
            this.hovering = true;                                                                                      // 2121
        },                                                                                                             // 2122
                                                                                                                       // 2123
        handlePreviewMouseout: function (event) {                                                                      // 2124
            if (!event.relatedTarget || !/anchor-preview/.test(event.relatedTarget.className)) {                       // 2125
                this.hovering = false;                                                                                 // 2126
            }                                                                                                          // 2127
        },                                                                                                             // 2128
                                                                                                                       // 2129
        updatePreview: function () {                                                                                   // 2130
            if (this.hovering) {                                                                                       // 2131
                return true;                                                                                           // 2132
            }                                                                                                          // 2133
            var durr = (new Date()).getTime() - this.lastOver;                                                         // 2134
            if (durr > this.base.options.anchorPreviewHideDelay) {                                                     // 2135
                // hide the preview 1/2 second after mouse leaves the link                                             // 2136
                this.detachPreviewHandlers();                                                                          // 2137
            }                                                                                                          // 2138
        },                                                                                                             // 2139
                                                                                                                       // 2140
        detachPreviewHandlers: function () {                                                                           // 2141
            // cleanup                                                                                                 // 2142
            clearInterval(this.interval_timer);                                                                        // 2143
            if (this.instance_handlePreviewMouseover) {                                                                // 2144
                this.base.off(this.anchorPreview, 'mouseover', this.instance_handlePreviewMouseover);                  // 2145
                this.base.off(this.anchorPreview, 'mouseout', this.instance_handlePreviewMouseout);                    // 2146
                if (this.activeAnchor) {                                                                               // 2147
                    this.base.off(this.activeAnchor, 'mouseover', this.instance_handlePreviewMouseover);               // 2148
                    this.base.off(this.activeAnchor, 'mouseout', this.instance_handlePreviewMouseout);                 // 2149
                }                                                                                                      // 2150
            }                                                                                                          // 2151
                                                                                                                       // 2152
            this.hidePreview();                                                                                        // 2153
                                                                                                                       // 2154
            this.hovering = this.instance_handlePreviewMouseover = this.instance_handlePreviewMouseout = null;         // 2155
        },                                                                                                             // 2156
                                                                                                                       // 2157
        // TODO: break up method and extract out handlers                                                              // 2158
        attachPreviewHandlers: function () {                                                                           // 2159
            this.lastOver = (new Date()).getTime();                                                                    // 2160
            this.hovering = true;                                                                                      // 2161
                                                                                                                       // 2162
            this.instance_handlePreviewMouseover = this.handlePreviewMouseover.bind(this);                             // 2163
            this.instance_handlePreviewMouseout = this.handlePreviewMouseout.bind(this);                               // 2164
                                                                                                                       // 2165
            this.interval_timer = setInterval(this.updatePreview.bind(this), 200);                                     // 2166
                                                                                                                       // 2167
            this.base.on(this.anchorPreview, 'mouseover', this.instance_handlePreviewMouseover);                       // 2168
            this.base.on(this.anchorPreview, 'mouseout', this.instance_handlePreviewMouseout);                         // 2169
            this.base.on(this.activeAnchor, 'mouseover', this.instance_handlePreviewMouseover);                        // 2170
            this.base.on(this.activeAnchor, 'mouseout', this.instance_handlePreviewMouseout);                          // 2171
        }                                                                                                              // 2172
    };                                                                                                                 // 2173
}(window, document));                                                                                                  // 2174
                                                                                                                       // 2175
var Toolbar;                                                                                                           // 2176
                                                                                                                       // 2177
(function (window, document) {                                                                                         // 2178
    'use strict';                                                                                                      // 2179
                                                                                                                       // 2180
    Toolbar = function Toolbar(instance) {                                                                             // 2181
        this.base = instance;                                                                                          // 2182
        this.options = instance.options;                                                                               // 2183
        this.initThrottledMethods();                                                                                   // 2184
    };                                                                                                                 // 2185
                                                                                                                       // 2186
    Toolbar.prototype = {                                                                                              // 2187
                                                                                                                       // 2188
        // Toolbar creation/deletion                                                                                   // 2189
                                                                                                                       // 2190
        createToolbar: function () {                                                                                   // 2191
            var toolbar = this.base.options.ownerDocument.createElement('div');                                        // 2192
                                                                                                                       // 2193
            toolbar.id = 'medium-editor-toolbar-' + this.base.id;                                                      // 2194
            toolbar.className = 'medium-editor-toolbar';                                                               // 2195
                                                                                                                       // 2196
            if (this.options.staticToolbar) {                                                                          // 2197
                toolbar.className += " static-toolbar";                                                                // 2198
            } else {                                                                                                   // 2199
                toolbar.className += " stalker-toolbar";                                                               // 2200
            }                                                                                                          // 2201
                                                                                                                       // 2202
            toolbar.appendChild(this.createToolbarButtons());                                                          // 2203
                                                                                                                       // 2204
            // Add any forms that extensions may have                                                                  // 2205
            this.base.commands.forEach(function (extension) {                                                          // 2206
                if (extension.hasForm) {                                                                               // 2207
                    toolbar.appendChild(extension.getForm());                                                          // 2208
                }                                                                                                      // 2209
            });                                                                                                        // 2210
                                                                                                                       // 2211
            this.attachEventHandlers();                                                                                // 2212
            this.base.subscribe('externalInteraction', this.handleBlur.bind(this));                                    // 2213
                                                                                                                       // 2214
            return toolbar;                                                                                            // 2215
        },                                                                                                             // 2216
                                                                                                                       // 2217
        createToolbarButtons: function () {                                                                            // 2218
            var ul = this.base.options.ownerDocument.createElement('ul'),                                              // 2219
                li,                                                                                                    // 2220
                btn,                                                                                                   // 2221
                buttons;                                                                                               // 2222
                                                                                                                       // 2223
            ul.id = 'medium-editor-toolbar-actions' + this.base.id;                                                    // 2224
            ul.className = 'medium-editor-toolbar-actions clearfix';                                                   // 2225
            ul.style.display = 'block';                                                                                // 2226
                                                                                                                       // 2227
            this.base.commands.forEach(function (extension) {                                                          // 2228
                if (typeof extension.getButton === 'function') {                                                       // 2229
                    btn = extension.getButton(this.base);                                                              // 2230
                    li = this.base.options.ownerDocument.createElement('li');                                          // 2231
                    if (Util.isElement(btn)) {                                                                         // 2232
                        li.appendChild(btn);                                                                           // 2233
                    } else {                                                                                           // 2234
                        li.innerHTML = btn;                                                                            // 2235
                    }                                                                                                  // 2236
                    ul.appendChild(li);                                                                                // 2237
                }                                                                                                      // 2238
            }.bind(this));                                                                                             // 2239
                                                                                                                       // 2240
            buttons = ul.querySelectorAll('button');                                                                   // 2241
            if (buttons.length > 0) {                                                                                  // 2242
                buttons[0].classList.add(this.options.firstButtonClass);                                               // 2243
                buttons[buttons.length - 1].classList.add(this.options.lastButtonClass);                               // 2244
            }                                                                                                          // 2245
                                                                                                                       // 2246
            return ul;                                                                                                 // 2247
        },                                                                                                             // 2248
                                                                                                                       // 2249
        deactivate: function () {                                                                                      // 2250
            if (this.toolbar) {                                                                                        // 2251
                if (this.toolbar.parentNode) {                                                                         // 2252
                    this.toolbar.parentNode.removeChild(this.toolbar);                                                 // 2253
                }                                                                                                      // 2254
                delete this.toolbar;                                                                                   // 2255
            }                                                                                                          // 2256
        },                                                                                                             // 2257
                                                                                                                       // 2258
        // Toolbar accessors                                                                                           // 2259
                                                                                                                       // 2260
        getToolbarElement: function () {                                                                               // 2261
            if (!this.toolbar) {                                                                                       // 2262
                this.toolbar = this.createToolbar();                                                                   // 2263
            }                                                                                                          // 2264
                                                                                                                       // 2265
            return this.toolbar;                                                                                       // 2266
        },                                                                                                             // 2267
                                                                                                                       // 2268
        getToolbarActionsElement: function () {                                                                        // 2269
            return this.getToolbarElement().querySelector('.medium-editor-toolbar-actions');                           // 2270
        },                                                                                                             // 2271
                                                                                                                       // 2272
        // Toolbar event handlers                                                                                      // 2273
                                                                                                                       // 2274
        initThrottledMethods: function () {                                                                            // 2275
            // throttledPositionToolbar is throttled because:                                                          // 2276
            // - It will be called when the browser is resizing, which can fire many times very quickly                // 2277
            // - For some event (like resize) a slight lag in UI responsiveness is OK and provides performance benefits
            this.throttledPositionToolbar = Util.throttle(function (event) {                                           // 2279
                if (this.base.isActive) {                                                                              // 2280
                    this.positionToolbarIfShown();                                                                     // 2281
                }                                                                                                      // 2282
            }.bind(this));                                                                                             // 2283
        },                                                                                                             // 2284
                                                                                                                       // 2285
        attachEventHandlers: function () {                                                                             // 2286
            // Handle mouseup on document for updating the selection in the toolbar                                    // 2287
            this.base.on(this.options.ownerDocument.documentElement, 'mouseup', this.handleDocumentMouseup.bind(this));
                                                                                                                       // 2289
            // Add a scroll event for sticky toolbar                                                                   // 2290
            if (this.options.staticToolbar && this.options.stickyToolbar) {                                            // 2291
                // On scroll (capture), re-position the toolbar                                                        // 2292
                this.base.on(this.options.contentWindow, 'scroll', this.handleWindowScroll.bind(this), true);          // 2293
            }                                                                                                          // 2294
                                                                                                                       // 2295
            // On resize, re-position the toolbar                                                                      // 2296
            this.base.on(this.options.contentWindow, 'resize', this.handleWindowResize.bind(this));                    // 2297
                                                                                                                       // 2298
            // Handlers for each contentedtiable element                                                               // 2299
            this.base.elements.forEach(function (element) {                                                            // 2300
                // Attach click handler to each contenteditable element                                                // 2301
                this.base.on(element, 'click', this.handleEditableClick.bind(this));                                   // 2302
                                                                                                                       // 2303
                // Attach keyup handler to each contenteditable element                                                // 2304
                this.base.on(element, 'keyup', this.handleEditableKeyup.bind(this));                                   // 2305
                                                                                                                       // 2306
                // Attach blur handler to each contenteditable element                                                 // 2307
                this.base.on(element, 'blur', this.handleEditableBlur.bind(this));                                     // 2308
            }.bind(this));                                                                                             // 2309
        },                                                                                                             // 2310
                                                                                                                       // 2311
        handleWindowScroll: function (event) {                                                                         // 2312
            this.positionToolbarIfShown();                                                                             // 2313
        },                                                                                                             // 2314
                                                                                                                       // 2315
        handleWindowResize: function (event) {                                                                         // 2316
            this.throttledPositionToolbar();                                                                           // 2317
        },                                                                                                             // 2318
                                                                                                                       // 2319
        handleDocumentMouseup: function (event) {                                                                      // 2320
            // Do not trigger checkState when mouseup fires over the toolbar                                           // 2321
            if (event &&                                                                                               // 2322
                    event.target &&                                                                                    // 2323
                    Util.isDescendant(this.getToolbarElement(), event.target)) {                                       // 2324
                return false;                                                                                          // 2325
            }                                                                                                          // 2326
            this.checkState();                                                                                         // 2327
        },                                                                                                             // 2328
                                                                                                                       // 2329
        handleEditableClick: function (event) {                                                                        // 2330
            // Delay the call to checkState to handle bug where selection is empty                                     // 2331
            // immediately after clicking inside a pre-existing selection                                              // 2332
            setTimeout(function () {                                                                                   // 2333
                this.checkState();                                                                                     // 2334
            }.bind(this), 0);                                                                                          // 2335
        },                                                                                                             // 2336
                                                                                                                       // 2337
        handleEditableKeyup: function (event) {                                                                        // 2338
            this.checkState();                                                                                         // 2339
        },                                                                                                             // 2340
                                                                                                                       // 2341
        handleEditableBlur: function (event) {                                                                         // 2342
            var getBlurRelatedTarget = function (e) {                                                                  // 2343
                return e.relatedTarget || // standard HTML5 DOM                                                        // 2344
                    e.explicitOriginalTarget || // Firefox only                                                        // 2345
                    document.activeElement; // IE9-11                                                                  // 2346
            },                                                                                                         // 2347
                isRelatedTargetOwnedByThisEditor = false;                                                              // 2348
            // Do not trigger checkState when bluring the editable area and clicking into the toolbar                  // 2349
            if (event &&                                                                                               // 2350
                    getBlurRelatedTarget(event) &&                                                                     // 2351
                    Util.isDescendant(this.getToolbarElement(), getBlurRelatedTarget(event))) {                        // 2352
                return false;                                                                                          // 2353
            }                                                                                                          // 2354
            // Remove all selections before checking state. This is necessary to avoid issues with                     // 2355
            // standardizeSelectionStart 'canceling' the blur event by moving the selection.                           // 2356
            this.base.elements.forEach(function (el) {                                                                 // 2357
                isRelatedTargetOwnedByThisEditor = isRelatedTargetOwnedByThisEditor || Util.isDescendant(el, getBlurRelatedTarget(event)) ||
                    getBlurRelatedTarget(event) === el;                                                                // 2359
            });                                                                                                        // 2360
            // We only remove all the ranges if the user clicked outside the contenteditables managed by this medium-editor instance. Otherwise keep the ranges,
            // because we were okay with the behavior that it did.                                                     // 2362
            if (!isRelatedTargetOwnedByThisEditor) {                                                                   // 2363
                this.options.contentWindow.getSelection().removeAllRanges();                                           // 2364
            }                                                                                                          // 2365
            this.checkState();                                                                                         // 2366
        },                                                                                                             // 2367
                                                                                                                       // 2368
        handleBlur: function (event) {                                                                                 // 2369
            // Delay the call to hideToolbar to handle bug with multiple editors on the page at once                   // 2370
            setTimeout(function () {                                                                                   // 2371
                this.hideToolbar();                                                                                    // 2372
            }.bind(this), 0);                                                                                          // 2373
        },                                                                                                             // 2374
                                                                                                                       // 2375
        // Hiding/showing toolbar                                                                                      // 2376
                                                                                                                       // 2377
        isDisplayed: function () {                                                                                     // 2378
            return this.getToolbarElement().classList.contains('medium-editor-toolbar-active');                        // 2379
        },                                                                                                             // 2380
                                                                                                                       // 2381
        showToolbar: function () {                                                                                     // 2382
            if (!this.isDisplayed()) {                                                                                 // 2383
                this.getToolbarElement().classList.add('medium-editor-toolbar-active');                                // 2384
                if (typeof this.options.onShowToolbar === 'function') {                                                // 2385
                    this.options.onShowToolbar();                                                                      // 2386
                }                                                                                                      // 2387
            }                                                                                                          // 2388
        },                                                                                                             // 2389
                                                                                                                       // 2390
        hideToolbar: function () {                                                                                     // 2391
            if (this.isDisplayed()) {                                                                                  // 2392
                this.base.commands.forEach(function (extension) {                                                      // 2393
                    if (typeof extension.onHide === 'function') {                                                      // 2394
                        extension.onHide();                                                                            // 2395
                    }                                                                                                  // 2396
                });                                                                                                    // 2397
                                                                                                                       // 2398
                this.getToolbarElement().classList.remove('medium-editor-toolbar-active');                             // 2399
                if (typeof this.options.onHideToolbar === 'function') {                                                // 2400
                    this.options.onHideToolbar();                                                                      // 2401
                }                                                                                                      // 2402
            }                                                                                                          // 2403
        },                                                                                                             // 2404
                                                                                                                       // 2405
        isToolbarDefaultActionsDisplayed: function () {                                                                // 2406
            return this.getToolbarActionsElement().style.display === 'block';                                          // 2407
        },                                                                                                             // 2408
                                                                                                                       // 2409
        hideToolbarDefaultActions: function () {                                                                       // 2410
            if (this.isToolbarDefaultActionsDisplayed()) {                                                             // 2411
                this.getToolbarActionsElement().style.display = 'none';                                                // 2412
            }                                                                                                          // 2413
        },                                                                                                             // 2414
                                                                                                                       // 2415
        showToolbarDefaultActions: function () {                                                                       // 2416
            this.hideExtensionForms();                                                                                 // 2417
                                                                                                                       // 2418
            if (!this.isToolbarDefaultActionsDisplayed()) {                                                            // 2419
                this.getToolbarActionsElement().style.display = 'block';                                               // 2420
            }                                                                                                          // 2421
                                                                                                                       // 2422
            // Using setTimeout + options.delay because:                                                               // 2423
            // We will actually be displaying the toolbar, which should be controlled by options.delay                 // 2424
            this.base.delay(function () {                                                                              // 2425
                this.showToolbar();                                                                                    // 2426
            }.bind(this));                                                                                             // 2427
        },                                                                                                             // 2428
                                                                                                                       // 2429
        hideExtensionForms: function () {                                                                              // 2430
            // Hide all extension forms                                                                                // 2431
            this.base.commands.forEach(function (extension) {                                                          // 2432
                if (extension.hasForm && extension.isDisplayed()) {                                                    // 2433
                    extension.hideForm();                                                                              // 2434
                }                                                                                                      // 2435
            });                                                                                                        // 2436
        },                                                                                                             // 2437
                                                                                                                       // 2438
        // Responding to changes in user selection                                                                     // 2439
                                                                                                                       // 2440
        // Checks for existance of multiple block elements in the current selection                                    // 2441
        multipleBlockElementsSelected: function () {                                                                   // 2442
            /*jslint regexp: true*/                                                                                    // 2443
            var selectionHtml = Selection.getSelectionHtml.call(this).replace(/<[\S]+><\/[\S]+>/gim, ''),              // 2444
                hasMultiParagraphs = selectionHtml.match(/<(p|h[1-6]|blockquote)[^>]*>/g);                             // 2445
            /*jslint regexp: false*/                                                                                   // 2446
                                                                                                                       // 2447
            return !!hasMultiParagraphs && hasMultiParagraphs.length > 1;                                              // 2448
        },                                                                                                             // 2449
                                                                                                                       // 2450
        // TODO: selection and selectionRange should be properties of the                                              // 2451
        //       Selection object                                                                                      // 2452
        checkSelectionElement: function (newSelection, selectionElement) {                                             // 2453
            var i,                                                                                                     // 2454
                adjacentNode,                                                                                          // 2455
                offset = 0,                                                                                            // 2456
                newRange,                                                                                              // 2457
                selectionRange = newSelection.getRangeAt(0);                                                           // 2458
                                                                                                                       // 2459
            /*                                                                                                         // 2460
            * In firefox, there are cases (ie doubleclick of a word) where the selectionRange start                    // 2461
            * will be at the very end of an element.  In other browsers, the selectionRange start                      // 2462
            * would instead be at the very beginning of an element that actually has content.                          // 2463
            * example:                                                                                                 // 2464
            *   <span>foo</span><span>bar</span>                                                                       // 2465
            *                                                                                                          // 2466
            * If the text 'bar' is selected, most browsers will have the selectionRange start at the beginning         // 2467
            * of the 'bar' span.  However, there are cases where firefox will have the selectionRange start            // 2468
            * at the end of the 'foo' span.  The contenteditable behavior will be ok, but if there are any             // 2469
            * properties on the 'bar' span, they won't be reflected accurately in the toolbar                          // 2470
            * (ie 'Bold' button wouldn't be active)                                                                    // 2471
            *                                                                                                          // 2472
            * So, for cases where the selectionRange start is at the end of an element/node, find the next             // 2473
            * adjacent text node that actually has content in it, and move the selectionRange start there.             // 2474
            */                                                                                                         // 2475
            if (this.options.standardizeSelectionStart &&                                                              // 2476
                    selectionRange.startContainer.nodeValue &&                                                         // 2477
                    (selectionRange.startOffset === selectionRange.startContainer.nodeValue.length)) {                 // 2478
                adjacentNode = Util.findAdjacentTextNodeWithContent(Selection.getSelectionElement(this.options.contentWindow), selectionRange.startContainer, this.options.ownerDocument);
                if (adjacentNode) {                                                                                    // 2480
                    offset = 0;                                                                                        // 2481
                    while (adjacentNode.nodeValue.substr(offset, 1).trim().length === 0) {                             // 2482
                        offset = offset + 1;                                                                           // 2483
                    }                                                                                                  // 2484
                    newRange = this.options.ownerDocument.createRange();                                               // 2485
                    newRange.setStart(adjacentNode, offset);                                                           // 2486
                    newRange.setEnd(selectionRange.endContainer, selectionRange.endOffset);                            // 2487
                    newSelection.removeAllRanges();                                                                    // 2488
                    newSelection.addRange(newRange);                                                                   // 2489
                    selectionRange = newRange;                                                                         // 2490
                }                                                                                                      // 2491
            }                                                                                                          // 2492
                                                                                                                       // 2493
            for (i = 0; i < this.base.elements.length; i += 1) {                                                       // 2494
                if (this.base.elements[i] === selectionElement) {                                                      // 2495
                    this.showAndUpdateToolbar();                                                                       // 2496
                    return;                                                                                            // 2497
                }                                                                                                      // 2498
            }                                                                                                          // 2499
                                                                                                                       // 2500
            if (!this.options.staticToolbar) {                                                                         // 2501
                this.hideToolbar();                                                                                    // 2502
            }                                                                                                          // 2503
        },                                                                                                             // 2504
                                                                                                                       // 2505
        checkState: function () {                                                                                      // 2506
            var newSelection,                                                                                          // 2507
                selectionElement;                                                                                      // 2508
                                                                                                                       // 2509
            if (!this.base.preventSelectionUpdates) {                                                                  // 2510
                newSelection = this.options.contentWindow.getSelection();                                              // 2511
                if ((!this.options.updateOnEmptySelection && newSelection.toString().trim() === '') ||                 // 2512
                        (this.options.allowMultiParagraphSelection === false && this.multipleBlockElementsSelected()) ||
                        Selection.selectionInContentEditableFalse(this.options.contentWindow)) {                       // 2514
                    if (!this.options.staticToolbar) {                                                                 // 2515
                        this.hideToolbar();                                                                            // 2516
                    } else {                                                                                           // 2517
                        this.showAndUpdateToolbar();                                                                   // 2518
                    }                                                                                                  // 2519
                                                                                                                       // 2520
                } else {                                                                                               // 2521
                    selectionElement = Selection.getSelectionElement(this.options.contentWindow);                      // 2522
                    if (!selectionElement || selectionElement.getAttribute('data-disable-toolbar')) {                  // 2523
                        if (!this.options.staticToolbar) {                                                             // 2524
                            this.hideToolbar();                                                                        // 2525
                        }                                                                                              // 2526
                    } else {                                                                                           // 2527
                        this.checkSelectionElement(newSelection, selectionElement);                                    // 2528
                    }                                                                                                  // 2529
                }                                                                                                      // 2530
            }                                                                                                          // 2531
        },                                                                                                             // 2532
                                                                                                                       // 2533
        // Updating the toolbar                                                                                        // 2534
                                                                                                                       // 2535
        showAndUpdateToolbar: function () {                                                                            // 2536
            this.setToolbarButtonStates();                                                                             // 2537
            this.showToolbarDefaultActions();                                                                          // 2538
            this.setToolbarPosition();                                                                                 // 2539
        },                                                                                                             // 2540
                                                                                                                       // 2541
        setToolbarButtonStates: function () {                                                                          // 2542
            this.base.commands.forEach(function (extension) {                                                          // 2543
                if (typeof extension.isActive === 'function') {                                                        // 2544
                    extension.setInactive();                                                                           // 2545
                }                                                                                                      // 2546
            }.bind(this));                                                                                             // 2547
            this.checkActiveButtons();                                                                                 // 2548
        },                                                                                                             // 2549
                                                                                                                       // 2550
        checkActiveButtons: function () {                                                                              // 2551
            var manualStateChecks = [],                                                                                // 2552
                queryState = null,                                                                                     // 2553
                selectionRange = Util.getSelectionRange(this.options.ownerDocument),                                   // 2554
                parentNode,                                                                                            // 2555
                updateExtensionState = function (extension) {                                                          // 2556
                    if (typeof extension.checkState === 'function') {                                                  // 2557
                        extension.checkState(parentNode);                                                              // 2558
                    } else if (typeof extension.isActive === 'function' &&                                             // 2559
                               typeof extension.isAlreadyApplied === 'function') {                                     // 2560
                        if (!extension.isActive() && extension.isAlreadyApplied(parentNode)) {                         // 2561
                            extension.setActive();                                                                     // 2562
                        }                                                                                              // 2563
                    }                                                                                                  // 2564
                };                                                                                                     // 2565
                                                                                                                       // 2566
            if (!selectionRange) {                                                                                     // 2567
                return;                                                                                                // 2568
            }                                                                                                          // 2569
                                                                                                                       // 2570
            parentNode = Selection.getSelectedParentElement(selectionRange);                                           // 2571
                                                                                                                       // 2572
            // Loop through all commands                                                                               // 2573
            this.base.commands.forEach(function (command) {                                                            // 2574
                // For those commands where we can use document.queryCommandState(), do so                             // 2575
                if (typeof command.queryCommandState === 'function') {                                                 // 2576
                    queryState = command.queryCommandState();                                                          // 2577
                    // If queryCommandState returns a valid value, we can trust the browser                            // 2578
                    // and don't need to do our manual checks                                                          // 2579
                    if (queryState !== null) {                                                                         // 2580
                        if (queryState) {                                                                              // 2581
                            command.setActive();                                                                       // 2582
                        }                                                                                              // 2583
                        return;                                                                                        // 2584
                    }                                                                                                  // 2585
                }                                                                                                      // 2586
                // We can't use queryCommandState for this command, so add to manualStateChecks                        // 2587
                manualStateChecks.push(command);                                                                       // 2588
            });                                                                                                        // 2589
                                                                                                                       // 2590
            // Climb up the DOM and do manual checks for whether a certain command is currently enabled for this node  // 2591
            while (parentNode.tagName !== undefined && Util.parentElements.indexOf(parentNode.tagName.toLowerCase) === -1) {
                manualStateChecks.forEach(updateExtensionState);                                                       // 2593
                                                                                                                       // 2594
                // we can abort the search upwards if we leave the contentEditable element                             // 2595
                if (this.base.elements.indexOf(parentNode) !== -1) {                                                   // 2596
                    break;                                                                                             // 2597
                }                                                                                                      // 2598
                parentNode = parentNode.parentNode;                                                                    // 2599
            }                                                                                                          // 2600
        },                                                                                                             // 2601
                                                                                                                       // 2602
        // Positioning toolbar                                                                                         // 2603
                                                                                                                       // 2604
        positionToolbarIfShown: function () {                                                                          // 2605
            if (this.isDisplayed()) {                                                                                  // 2606
                this.setToolbarPosition();                                                                             // 2607
            }                                                                                                          // 2608
        },                                                                                                             // 2609
                                                                                                                       // 2610
        setToolbarPosition: function () {                                                                              // 2611
            var container = Selection.getSelectionElement(this.options.contentWindow),                                 // 2612
                selection = this.options.contentWindow.getSelection(),                                                 // 2613
                anchorPreview;                                                                                         // 2614
                                                                                                                       // 2615
            // If there isn't a valid selection, bail                                                                  // 2616
            if (!container || !this.options.contentWindow.getSelection().focusNode) {                                  // 2617
                return this;                                                                                           // 2618
            }                                                                                                          // 2619
                                                                                                                       // 2620
            // If the container isn't part of this medium-editor instance, bail                                        // 2621
            if (this.base.elements.indexOf(container) === -1) {                                                        // 2622
                return this;                                                                                           // 2623
            }                                                                                                          // 2624
                                                                                                                       // 2625
            if (this.options.staticToolbar) {                                                                          // 2626
                this.showToolbar();                                                                                    // 2627
                this.positionStaticToolbar(container);                                                                 // 2628
                                                                                                                       // 2629
            } else if (!selection.isCollapsed) {                                                                       // 2630
                this.showToolbar();                                                                                    // 2631
                this.positionToolbar(selection);                                                                       // 2632
            }                                                                                                          // 2633
                                                                                                                       // 2634
            anchorPreview = this.base.getExtensionByName('anchor-preview');                                            // 2635
                                                                                                                       // 2636
            if (anchorPreview && typeof anchorPreview.hidePreview === 'function') {                                    // 2637
                anchorPreview.hidePreview();                                                                           // 2638
            }                                                                                                          // 2639
        },                                                                                                             // 2640
                                                                                                                       // 2641
        positionStaticToolbar: function (container) {                                                                  // 2642
            // position the toolbar at left 0, so we can get the real width of the toolbar                             // 2643
            this.getToolbarElement().style.left = '0';                                                                 // 2644
                                                                                                                       // 2645
            // document.documentElement for IE 9                                                                       // 2646
            var scrollTop = (this.options.ownerDocument.documentElement && this.options.ownerDocument.documentElement.scrollTop) || this.options.ownerDocument.body.scrollTop,
                windowWidth = this.options.contentWindow.innerWidth,                                                   // 2648
                toolbarElement = this.getToolbarElement(),                                                             // 2649
                containerRect = container.getBoundingClientRect(),                                                     // 2650
                containerTop = containerRect.top + scrollTop,                                                          // 2651
                containerCenter = (containerRect.left + (containerRect.width / 2)),                                    // 2652
                toolbarHeight = toolbarElement.offsetHeight,                                                           // 2653
                toolbarWidth = toolbarElement.offsetWidth,                                                             // 2654
                halfOffsetWidth = toolbarWidth / 2,                                                                    // 2655
                targetLeft;                                                                                            // 2656
                                                                                                                       // 2657
            if (this.options.stickyToolbar) {                                                                          // 2658
                // If it's beyond the height of the editor, position it at the bottom of the editor                    // 2659
                if (scrollTop > (containerTop + container.offsetHeight - toolbarHeight)) {                             // 2660
                    toolbarElement.style.top = (containerTop + container.offsetHeight - toolbarHeight) + 'px';         // 2661
                    toolbarElement.classList.remove('sticky-toolbar');                                                 // 2662
                                                                                                                       // 2663
                // Stick the toolbar to the top of the window                                                          // 2664
                } else if (scrollTop > (containerTop - toolbarHeight)) {                                               // 2665
                    toolbarElement.classList.add('sticky-toolbar');                                                    // 2666
                    toolbarElement.style.top = "0px";                                                                  // 2667
                                                                                                                       // 2668
                // Normal static toolbar position                                                                      // 2669
                } else {                                                                                               // 2670
                    toolbarElement.classList.remove('sticky-toolbar');                                                 // 2671
                    toolbarElement.style.top = containerTop - toolbarHeight + "px";                                    // 2672
                }                                                                                                      // 2673
            } else {                                                                                                   // 2674
                toolbarElement.style.top = containerTop - toolbarHeight + "px";                                        // 2675
            }                                                                                                          // 2676
                                                                                                                       // 2677
            if (this.options.toolbarAlign === 'left') {                                                                // 2678
                targetLeft = containerRect.left;                                                                       // 2679
            } else if (this.options.toolbarAlign === 'center') {                                                       // 2680
                targetLeft = containerCenter - halfOffsetWidth;                                                        // 2681
            } else if (this.options.toolbarAlign === 'right') {                                                        // 2682
                targetLeft = containerRect.right - toolbarWidth;                                                       // 2683
            }                                                                                                          // 2684
                                                                                                                       // 2685
            if (targetLeft < 0) {                                                                                      // 2686
                targetLeft = 0;                                                                                        // 2687
            } else if ((targetLeft + toolbarWidth) > windowWidth) {                                                    // 2688
                targetLeft = windowWidth - toolbarWidth;                                                               // 2689
            }                                                                                                          // 2690
                                                                                                                       // 2691
            toolbarElement.style.left = targetLeft + 'px';                                                             // 2692
        },                                                                                                             // 2693
                                                                                                                       // 2694
        positionToolbar: function (selection) {                                                                        // 2695
            // position the toolbar at left 0, so we can get the real width of the toolbar                             // 2696
            this.getToolbarElement().style.left = '0';                                                                 // 2697
                                                                                                                       // 2698
            var windowWidth = this.options.contentWindow.innerWidth,                                                   // 2699
                range = selection.getRangeAt(0),                                                                       // 2700
                boundary = range.getBoundingClientRect(),                                                              // 2701
                middleBoundary = (boundary.left + boundary.right) / 2,                                                 // 2702
                toolbarElement = this.getToolbarElement(),                                                             // 2703
                toolbarHeight = toolbarElement.offsetHeight,                                                           // 2704
                toolbarWidth = toolbarElement.offsetWidth,                                                             // 2705
                halfOffsetWidth = toolbarWidth / 2,                                                                    // 2706
                buttonHeight = 50,                                                                                     // 2707
                defaultLeft = this.options.diffLeft - halfOffsetWidth;                                                 // 2708
                                                                                                                       // 2709
            if (boundary.top < buttonHeight) {                                                                         // 2710
                toolbarElement.classList.add('medium-toolbar-arrow-over');                                             // 2711
                toolbarElement.classList.remove('medium-toolbar-arrow-under');                                         // 2712
                toolbarElement.style.top = buttonHeight + boundary.bottom - this.options.diffTop + this.options.contentWindow.pageYOffset - toolbarHeight + 'px';
            } else {                                                                                                   // 2714
                toolbarElement.classList.add('medium-toolbar-arrow-under');                                            // 2715
                toolbarElement.classList.remove('medium-toolbar-arrow-over');                                          // 2716
                toolbarElement.style.top = boundary.top + this.options.diffTop + this.options.contentWindow.pageYOffset - toolbarHeight + 'px';
            }                                                                                                          // 2718
            if (middleBoundary < halfOffsetWidth) {                                                                    // 2719
                toolbarElement.style.left = defaultLeft + halfOffsetWidth + 'px';                                      // 2720
            } else if ((windowWidth - middleBoundary) < halfOffsetWidth) {                                             // 2721
                toolbarElement.style.left = windowWidth + defaultLeft - halfOffsetWidth + 'px';                        // 2722
            } else {                                                                                                   // 2723
                toolbarElement.style.left = defaultLeft + middleBoundary + 'px';                                       // 2724
            }                                                                                                          // 2725
        }                                                                                                              // 2726
    };                                                                                                                 // 2727
}(window, document));                                                                                                  // 2728
                                                                                                                       // 2729
var Placeholders;                                                                                                      // 2730
                                                                                                                       // 2731
(function (window, document) {                                                                                         // 2732
    'use strict';                                                                                                      // 2733
                                                                                                                       // 2734
    Placeholders = function (instance) {                                                                               // 2735
        this.base = instance;                                                                                          // 2736
                                                                                                                       // 2737
        this.initPlaceholders();                                                                                       // 2738
        this.attachEventHandlers();                                                                                    // 2739
    };                                                                                                                 // 2740
                                                                                                                       // 2741
    Placeholders.prototype = {                                                                                         // 2742
                                                                                                                       // 2743
        initPlaceholders: function () {                                                                                // 2744
            this.base.elements.forEach(function (el) {                                                                 // 2745
                this.updatePlaceholder(el);                                                                            // 2746
            }.bind(this));                                                                                             // 2747
        },                                                                                                             // 2748
                                                                                                                       // 2749
        showPlaceholder: function (el) {                                                                               // 2750
            if (el) {                                                                                                  // 2751
                el.classList.add('medium-editor-placeholder');                                                         // 2752
            }                                                                                                          // 2753
        },                                                                                                             // 2754
                                                                                                                       // 2755
        hidePlaceholder: function (el) {                                                                               // 2756
            if (el) {                                                                                                  // 2757
                el.classList.remove('medium-editor-placeholder');                                                      // 2758
            }                                                                                                          // 2759
        },                                                                                                             // 2760
                                                                                                                       // 2761
        updatePlaceholder: function (el) {                                                                             // 2762
            if (!(el.querySelector('img')) &&                                                                          // 2763
                    !(el.querySelector('blockquote')) &&                                                               // 2764
                    el.textContent.replace(/^\s+|\s+$/g, '') === '') {                                                 // 2765
                this.showPlaceholder(el);                                                                              // 2766
            } else {                                                                                                   // 2767
                this.hidePlaceholder(el);                                                                              // 2768
            }                                                                                                          // 2769
        },                                                                                                             // 2770
                                                                                                                       // 2771
        attachEventHandlers: function () {                                                                             // 2772
            // Custom events                                                                                           // 2773
            this.base.subscribe('externalInteraction', this.handleExternalInteraction.bind(this));                     // 2774
                                                                                                                       // 2775
            // Check placeholder on blur                                                                               // 2776
            this.base.subscribe('editableBlur', this.handleBlur.bind(this));                                           // 2777
                                                                                                                       // 2778
            // Events where we always hide the placeholder                                                             // 2779
            this.base.subscribe('editableClick', this.handleHidePlaceholderEvent.bind(this));                          // 2780
            this.base.subscribe('editableKeypress', this.handleHidePlaceholderEvent.bind(this));                       // 2781
            this.base.subscribe('editablePaste', this.handleHidePlaceholderEvent.bind(this));                          // 2782
        },                                                                                                             // 2783
                                                                                                                       // 2784
        handleHidePlaceholderEvent: function (event, element) {                                                        // 2785
            // Events where we hide the placeholder                                                                    // 2786
            this.hidePlaceholder(element);                                                                             // 2787
        },                                                                                                             // 2788
                                                                                                                       // 2789
        handleBlur: function (event, element) {                                                                        // 2790
            // Update placeholder for element that lost focus                                                          // 2791
            this.updatePlaceholder(element);                                                                           // 2792
        },                                                                                                             // 2793
                                                                                                                       // 2794
        handleExternalInteraction: function (event) {                                                                  // 2795
            // Update all placeholders                                                                                 // 2796
            this.initPlaceholders();                                                                                   // 2797
        }                                                                                                              // 2798
    };                                                                                                                 // 2799
                                                                                                                       // 2800
}(window, document));                                                                                                  // 2801
function MediumEditor(elements, options) {                                                                             // 2802
    'use strict';                                                                                                      // 2803
    return this.init(elements, options);                                                                               // 2804
}                                                                                                                      // 2805
                                                                                                                       // 2806
(function () {                                                                                                         // 2807
    'use strict';                                                                                                      // 2808
                                                                                                                       // 2809
    // Event handlers that shouldn't be exposed externally                                                             // 2810
                                                                                                                       // 2811
    function handleDisabledEnterKeydown(event, element) {                                                              // 2812
        if (this.options.disableReturn || element.getAttribute('data-disable-return')) {                               // 2813
            event.preventDefault();                                                                                    // 2814
        } else if (this.options.disableDoubleReturn || this.getAttribute('data-disable-double-return')) {              // 2815
            var node = Util.getSelectionStart(this.options.ownerDocument);                                             // 2816
            if (node && node.textContent.trim() === '') {                                                              // 2817
                event.preventDefault();                                                                                // 2818
            }                                                                                                          // 2819
        }                                                                                                              // 2820
    }                                                                                                                  // 2821
                                                                                                                       // 2822
    function handleTabKeydown(event, element) {                                                                        // 2823
        // Override tab only for pre nodes                                                                             // 2824
        var node = Util.getSelectionStart(this.options.ownerDocument),                                                 // 2825
            tag = node && node.tagName.toLowerCase();                                                                  // 2826
                                                                                                                       // 2827
        if (tag === 'pre') {                                                                                           // 2828
            event.preventDefault();                                                                                    // 2829
            Util.insertHTMLCommand(this.options.ownerDocument, '    ');                                                // 2830
        }                                                                                                              // 2831
                                                                                                                       // 2832
        // Tab to indent list structures!                                                                              // 2833
        if (Util.isListItem(node)) {                                                                                   // 2834
            event.preventDefault();                                                                                    // 2835
                                                                                                                       // 2836
            // If Shift is down, outdent, otherwise indent                                                             // 2837
            if (event.shiftKey) {                                                                                      // 2838
                this.options.ownerDocument.execCommand('outdent', false, null);                                        // 2839
            } else {                                                                                                   // 2840
                this.options.ownerDocument.execCommand('indent', false, null);                                         // 2841
            }                                                                                                          // 2842
        }                                                                                                              // 2843
    }                                                                                                                  // 2844
                                                                                                                       // 2845
    function handleBlockDeleteKeydowns(event, element) {                                                               // 2846
        var range, sel, p, node = Util.getSelectionStart(this.options.ownerDocument),                                  // 2847
            tagName = node.tagName.toLowerCase(),                                                                      // 2848
            isEmpty = /^(\s+|<br\/?>)?$/i,                                                                             // 2849
            isHeader = /h\d/i;                                                                                         // 2850
                                                                                                                       // 2851
        if ((event.which === Util.keyCode.BACKSPACE || event.which === Util.keyCode.ENTER)                             // 2852
                // has a preceeding sibling                                                                            // 2853
                && node.previousElementSibling                                                                         // 2854
                // in a header                                                                                         // 2855
                && isHeader.test(tagName)                                                                              // 2856
                // at the very end of the block                                                                        // 2857
                && Selection.getCaretOffsets(node).left === 0) {                                                       // 2858
            if (event.which === Util.keyCode.BACKSPACE && isEmpty.test(node.previousElementSibling.innerHTML)) {       // 2859
                // backspacing the begining of a header into an empty previous element will                            // 2860
                // change the tagName of the current node to prevent one                                               // 2861
                // instead delete previous node and cancel the event.                                                  // 2862
                node.previousElementSibling.parentNode.removeChild(node.previousElementSibling);                       // 2863
                event.preventDefault();                                                                                // 2864
            } else if (event.which === Util.keyCode.ENTER) {                                                           // 2865
                // hitting return in the begining of a header will create empty header elements before the current one // 2866
                // instead, make "<p><br></p>" element, which are what happens if you hit return in an empty paragraph // 2867
                p = this.options.ownerDocument.createElement('p');                                                     // 2868
                p.innerHTML = '<br>';                                                                                  // 2869
                node.previousElementSibling.parentNode.insertBefore(p, node);                                          // 2870
                event.preventDefault();                                                                                // 2871
            }                                                                                                          // 2872
        } else if (event.which === Util.keyCode.DELETE                                                                 // 2873
                    // between two sibling elements                                                                    // 2874
                    && node.nextElementSibling                                                                         // 2875
                    && node.previousElementSibling                                                                     // 2876
                    // not in a header                                                                                 // 2877
                    && !isHeader.test(tagName)                                                                         // 2878
                    // in an empty tag                                                                                 // 2879
                    && isEmpty.test(node.innerHTML)                                                                    // 2880
                    // when the next tag *is* a header                                                                 // 2881
                    && isHeader.test(node.nextElementSibling.tagName)) {                                               // 2882
            // hitting delete in an empty element preceding a header, ex:                                              // 2883
            //  <p>[CURSOR]</p><h1>Header</h1>                                                                         // 2884
            // Will cause the h1 to become a paragraph.                                                                // 2885
            // Instead, delete the paragraph node and move the cursor to the begining of the h1                        // 2886
                                                                                                                       // 2887
            // remove node and move cursor to start of header                                                          // 2888
            range = this.options.ownerDocument.createRange();                                                          // 2889
            sel = this.options.ownerDocument.getSelection();                                                           // 2890
                                                                                                                       // 2891
            range.setStart(node.nextElementSibling, 0);                                                                // 2892
            range.collapse(true);                                                                                      // 2893
                                                                                                                       // 2894
            sel.removeAllRanges();                                                                                     // 2895
            sel.addRange(range);                                                                                       // 2896
                                                                                                                       // 2897
            node.previousElementSibling.parentNode.removeChild(node);                                                  // 2898
                                                                                                                       // 2899
            event.preventDefault();                                                                                    // 2900
        } else if (event.which === Util.keyCode.BACKSPACE                                                              // 2901
                && tagName === 'li'                                                                                    // 2902
                // hitting backspace inside an empty li                                                                // 2903
                && isEmpty.test(node.innerHTML)                                                                        // 2904
                // is first element (no preceeding siblings)                                                           // 2905
                && !node.previousElementSibling                                                                        // 2906
                // parent also does not have a sibling                                                                 // 2907
                && !node.parentElement.previousElementSibling                                                          // 2908
                // is not the only li in a list                                                                        // 2909
                && node.nextElementSibling.tagName.toLowerCase() === 'li') {                                           // 2910
            // backspacing in an empty first list element in the first list (with more elements) ex:                   // 2911
            //  <ul><li>[CURSOR]</li><li>List Item 2</li></ul>                                                         // 2912
            // will remove the first <li> but add some extra element before (varies based on browser)                  // 2913
            // Instead, this will:                                                                                     // 2914
            // 1) remove the list element                                                                              // 2915
            // 2) create a paragraph before the list                                                                   // 2916
            // 3) move the cursor into the paragraph                                                                   // 2917
                                                                                                                       // 2918
            // create a paragraph before the list                                                                      // 2919
            p = this.options.ownerDocument.createElement('p');                                                         // 2920
            p.innerHTML = '<br>';                                                                                      // 2921
            node.parentElement.parentElement.insertBefore(p, node.parentElement);                                      // 2922
                                                                                                                       // 2923
            // move the cursor into the new paragraph                                                                  // 2924
            range = this.options.ownerDocument.createRange();                                                          // 2925
            sel = this.options.ownerDocument.getSelection();                                                           // 2926
            range.setStart(p, 0);                                                                                      // 2927
            range.collapse(true);                                                                                      // 2928
            sel.removeAllRanges();                                                                                     // 2929
            sel.addRange(range);                                                                                       // 2930
                                                                                                                       // 2931
            // remove the list element                                                                                 // 2932
            node.parentElement.removeChild(node);                                                                      // 2933
                                                                                                                       // 2934
            event.preventDefault();                                                                                    // 2935
        }                                                                                                              // 2936
    }                                                                                                                  // 2937
                                                                                                                       // 2938
    function handleDrag(event, element) {                                                                              // 2939
        var className = 'medium-editor-dragover';                                                                      // 2940
        event.preventDefault();                                                                                        // 2941
        event.dataTransfer.dropEffect = 'copy';                                                                        // 2942
                                                                                                                       // 2943
        if (event.type === 'dragover') {                                                                               // 2944
            event.target.classList.add(className);                                                                     // 2945
        } else if (event.type === 'dragleave') {                                                                       // 2946
            event.target.classList.remove(className);                                                                  // 2947
        }                                                                                                              // 2948
    }                                                                                                                  // 2949
                                                                                                                       // 2950
    function handleDrop(event, element) {                                                                              // 2951
        var className = 'medium-editor-dragover',                                                                      // 2952
            files;                                                                                                     // 2953
        event.preventDefault();                                                                                        // 2954
        event.stopPropagation();                                                                                       // 2955
                                                                                                                       // 2956
        // IE9 does not support the File API, so prevent file from opening in a new window                             // 2957
        // but also don't try to actually get the file                                                                 // 2958
        if (event.dataTransfer.files) {                                                                                // 2959
            files = Array.prototype.slice.call(event.dataTransfer.files, 0);                                           // 2960
            files.some(function (file) {                                                                               // 2961
                if (file.type.match("image")) {                                                                        // 2962
                    var fileReader, id;                                                                                // 2963
                    fileReader = new FileReader();                                                                     // 2964
                    fileReader.readAsDataURL(file);                                                                    // 2965
                                                                                                                       // 2966
                    id = 'medium-img-' + (+new Date());                                                                // 2967
                    Util.insertHTMLCommand(this.options.ownerDocument, '<img class="medium-image-loading" id="' + id + '" />');
                                                                                                                       // 2969
                    fileReader.onload = function () {                                                                  // 2970
                        var img = this.options.ownerDocument.getElementById(id);                                       // 2971
                        if (img) {                                                                                     // 2972
                            img.removeAttribute('id');                                                                 // 2973
                            img.removeAttribute('class');                                                              // 2974
                            img.src = fileReader.result;                                                               // 2975
                        }                                                                                              // 2976
                    }.bind(this);                                                                                      // 2977
                }                                                                                                      // 2978
            }.bind(this));                                                                                             // 2979
        }                                                                                                              // 2980
        event.target.classList.remove(className);                                                                      // 2981
    }                                                                                                                  // 2982
                                                                                                                       // 2983
    function handleKeyup(event) {                                                                                      // 2984
        var node = Util.getSelectionStart(this.options.ownerDocument),                                                 // 2985
            tagName;                                                                                                   // 2986
                                                                                                                       // 2987
        if (!node) {                                                                                                   // 2988
            return;                                                                                                    // 2989
        }                                                                                                              // 2990
                                                                                                                       // 2991
        if (node.getAttribute('data-medium-element') && node.children.length === 0) {                                  // 2992
            this.options.ownerDocument.execCommand('formatBlock', false, 'p');                                         // 2993
        }                                                                                                              // 2994
                                                                                                                       // 2995
        if (event.which === Util.keyCode.ENTER && !Util.isListItem(node)) {                                            // 2996
            tagName = node.tagName.toLowerCase();                                                                      // 2997
            // For anchor tags, unlink                                                                                 // 2998
            if (tagName === 'a') {                                                                                     // 2999
                this.options.ownerDocument.execCommand('unlink', false, null);                                         // 3000
            } else if (!event.shiftKey) {                                                                              // 3001
                // only format block if this is not a header tag                                                       // 3002
                if (!/h\d/.test(tagName)) {                                                                            // 3003
                    this.options.ownerDocument.execCommand('formatBlock', false, 'p');                                 // 3004
                }                                                                                                      // 3005
            }                                                                                                          // 3006
        }                                                                                                              // 3007
    }                                                                                                                  // 3008
                                                                                                                       // 3009
    // Internal helper methods which shouldn't be exposed externally                                                   // 3010
                                                                                                                       // 3011
    function createElementsArray(selector) {                                                                           // 3012
        if (!selector) {                                                                                               // 3013
            selector = [];                                                                                             // 3014
        }                                                                                                              // 3015
        // If string, use as query selector                                                                            // 3016
        if (typeof selector === 'string') {                                                                            // 3017
            selector = this.options.ownerDocument.querySelectorAll(selector);                                          // 3018
        }                                                                                                              // 3019
        // If element, put into array                                                                                  // 3020
        if (Util.isElement(selector)) {                                                                                // 3021
            selector = [selector];                                                                                     // 3022
        }                                                                                                              // 3023
        // Convert NodeList (or other array like object) into an array                                                 // 3024
        this.elements = Array.prototype.slice.apply(selector);                                                         // 3025
    }                                                                                                                  // 3026
                                                                                                                       // 3027
    function initExtension(extension, name, instance) {                                                                // 3028
        if (extension.parent) {                                                                                        // 3029
            extension.base = instance;                                                                                 // 3030
        }                                                                                                              // 3031
        if (typeof extension.init === 'function') {                                                                    // 3032
            extension.init(instance);                                                                                  // 3033
        }                                                                                                              // 3034
        if (!extension.name) {                                                                                         // 3035
            extension.name = name;                                                                                     // 3036
        }                                                                                                              // 3037
        return extension;                                                                                              // 3038
    }                                                                                                                  // 3039
                                                                                                                       // 3040
    function shouldAddDefaultAnchorPreview() {                                                                         // 3041
        var i,                                                                                                         // 3042
            shouldAdd = false;                                                                                         // 3043
                                                                                                                       // 3044
        // If anchor-preview is disabled, don't add                                                                    // 3045
        if (this.options.disableAnchorPreview) {                                                                       // 3046
            return false;                                                                                              // 3047
        }                                                                                                              // 3048
        // If anchor-preview extension has been overriden, don't add                                                   // 3049
        if (this.options.extensions['anchor-preview']) {                                                               // 3050
            return false;                                                                                              // 3051
        }                                                                                                              // 3052
        // If toolbar is disabled, don't add                                                                           // 3053
        if (this.options.disableToolbar) {                                                                             // 3054
            return false;                                                                                              // 3055
        }                                                                                                              // 3056
        // If all elements have 'data-disable-toolbar' attribute, don't add                                            // 3057
        for (i = 0; i < this.elements.length; i += 1) {                                                                // 3058
            if (!this.elements[i].getAttribute('data-disable-toolbar')) {                                              // 3059
                shouldAdd = true;                                                                                      // 3060
                break;                                                                                                 // 3061
            }                                                                                                          // 3062
        }                                                                                                              // 3063
                                                                                                                       // 3064
        return shouldAdd;                                                                                              // 3065
    }                                                                                                                  // 3066
                                                                                                                       // 3067
    function initElements() {                                                                                          // 3068
        var i,                                                                                                         // 3069
            addToolbar = false;                                                                                        // 3070
        for (i = 0; i < this.elements.length; i += 1) {                                                                // 3071
            if (!this.options.disableEditing && !this.elements[i].getAttribute('data-disable-editing')) {              // 3072
                this.elements[i].setAttribute('contentEditable', true);                                                // 3073
            }                                                                                                          // 3074
            if (!this.elements[i].getAttribute('data-placeholder')) {                                                  // 3075
                this.elements[i].setAttribute('data-placeholder', this.options.placeholder);                           // 3076
            }                                                                                                          // 3077
            this.elements[i].setAttribute('data-medium-element', true);                                                // 3078
            this.elements[i].setAttribute('role', 'textbox');                                                          // 3079
            this.elements[i].setAttribute('aria-multiline', true);                                                     // 3080
            if (!this.options.disableToolbar && !this.elements[i].getAttribute('data-disable-toolbar')) {              // 3081
                addToolbar = true;                                                                                     // 3082
            }                                                                                                          // 3083
        }                                                                                                              // 3084
        // Init toolbar                                                                                                // 3085
        if (!this.toolbar && addToolbar) {                                                                             // 3086
            this.toolbar = new Toolbar(this);                                                                          // 3087
            this.options.elementsContainer.appendChild(this.toolbar.getToolbarElement());                              // 3088
        }                                                                                                              // 3089
    }                                                                                                                  // 3090
                                                                                                                       // 3091
    function attachHandlers() {                                                                                        // 3092
        var i;                                                                                                         // 3093
                                                                                                                       // 3094
        // attach to tabs                                                                                              // 3095
        this.subscribe('editableKeydownTab', handleTabKeydown.bind(this));                                             // 3096
                                                                                                                       // 3097
        // Bind keys which can create or destroy a block element: backspace, delete, return                            // 3098
        this.subscribe('editableKeydownDelete', handleBlockDeleteKeydowns.bind(this));                                 // 3099
        this.subscribe('editableKeydownEnter', handleBlockDeleteKeydowns.bind(this));                                  // 3100
                                                                                                                       // 3101
        // disabling return or double return                                                                           // 3102
        if (this.options.disableReturn || this.options.disableDoubleReturn) {                                          // 3103
            this.subscribe('editableKeydownEnter', handleDisabledEnterKeydown.bind(this));                             // 3104
        } else {                                                                                                       // 3105
            for (i = 0; i < this.elements.length; i += 1) {                                                            // 3106
                if (this.elements[i].getAttribute('data-disable-return') || this.elements[i].getAttribute('data-disable-double-return')) {
                    this.subscribe('editableKeydownEnter', handleDisabledEnterKeydown.bind(this));                     // 3108
                    break;                                                                                             // 3109
                }                                                                                                      // 3110
            }                                                                                                          // 3111
        }                                                                                                              // 3112
                                                                                                                       // 3113
        // if we're not disabling return, add a handler to help handle cleanup                                         // 3114
        // for certain cases when enter is pressed                                                                     // 3115
        if (!this.options.disableReturn) {                                                                             // 3116
            this.elements.forEach(function (element) {                                                                 // 3117
                if (!element.getAttribute('data-disable-return')) {                                                    // 3118
                    this.on(element, 'keyup', handleKeyup.bind(this));                                                 // 3119
                }                                                                                                      // 3120
            }.bind(this));                                                                                             // 3121
        }                                                                                                              // 3122
                                                                                                                       // 3123
        // drag and drop of images                                                                                     // 3124
        if (this.options.imageDragging) {                                                                              // 3125
            this.subscribe('editableDrag', handleDrag.bind(this));                                                     // 3126
            this.subscribe('editableDrop', handleDrop.bind(this));                                                     // 3127
        }                                                                                                              // 3128
    }                                                                                                                  // 3129
                                                                                                                       // 3130
    function initCommands() {                                                                                          // 3131
        var buttons = this.options.buttons,                                                                            // 3132
            extensions = this.options.extensions,                                                                      // 3133
            ext,                                                                                                       // 3134
            name;                                                                                                      // 3135
        this.commands = [];                                                                                            // 3136
                                                                                                                       // 3137
        buttons.forEach(function (buttonName) {                                                                        // 3138
            if (extensions[buttonName]) {                                                                              // 3139
                ext = initExtension(extensions[buttonName], buttonName, this);                                         // 3140
                this.commands.push(ext);                                                                               // 3141
            } else if (buttonName === 'anchor') {                                                                      // 3142
                ext = initExtension(new AnchorExtension(), buttonName, this);                                          // 3143
                this.commands.push(ext);                                                                               // 3144
            } else if (ButtonsData.hasOwnProperty(buttonName)) {                                                       // 3145
                ext = new DefaultButton(ButtonsData[buttonName], this);                                                // 3146
                this.commands.push(ext);                                                                               // 3147
            }                                                                                                          // 3148
        }.bind(this));                                                                                                 // 3149
                                                                                                                       // 3150
        for (name in extensions) {                                                                                     // 3151
            if (extensions.hasOwnProperty(name) && buttons.indexOf(name) === -1) {                                     // 3152
                ext = initExtension(extensions[name], name, this);                                                     // 3153
            }                                                                                                          // 3154
        }                                                                                                              // 3155
                                                                                                                       // 3156
        // Add AnchorPreview as extension if needed                                                                    // 3157
        if (shouldAddDefaultAnchorPreview.call(this)) {                                                                // 3158
            this.commands.push(initExtension(new AnchorPreview(), 'anchor-preview', this));                            // 3159
        }                                                                                                              // 3160
    }                                                                                                                  // 3161
                                                                                                                       // 3162
    function execActionInternal(action, opts) {                                                                        // 3163
        /*jslint regexp: true*/                                                                                        // 3164
        var appendAction = /^append-(.+)$/gi,                                                                          // 3165
            match;                                                                                                     // 3166
        /*jslint regexp: false*/                                                                                       // 3167
                                                                                                                       // 3168
        // Actions starting with 'append-' should attempt to format a block of text ('formatBlock') using a specific   // 3169
        // type of block element (ie append-blockquote, append-h1, append-pre, etc.)                                   // 3170
        match = appendAction.exec(action);                                                                             // 3171
        if (match) {                                                                                                   // 3172
            return Util.execFormatBlock(this.options.ownerDocument, match[1]);                                         // 3173
        }                                                                                                              // 3174
                                                                                                                       // 3175
        if (action === 'createLink') {                                                                                 // 3176
            return this.createLink(opts);                                                                              // 3177
        }                                                                                                              // 3178
                                                                                                                       // 3179
        if (action === 'image') {                                                                                      // 3180
            return this.options.ownerDocument.execCommand('insertImage', false, this.options.contentWindow.getSelection());
        }                                                                                                              // 3182
                                                                                                                       // 3183
        return this.options.ownerDocument.execCommand(action, false, null);                                            // 3184
    }                                                                                                                  // 3185
                                                                                                                       // 3186
    MediumEditor.statics = {                                                                                           // 3187
        ButtonsData: ButtonsData,                                                                                      // 3188
        DefaultButton: DefaultButton,                                                                                  // 3189
        AnchorExtension: AnchorExtension,                                                                              // 3190
        Toolbar: Toolbar,                                                                                              // 3191
        AnchorPreview: AnchorPreview                                                                                   // 3192
    };                                                                                                                 // 3193
                                                                                                                       // 3194
    MediumEditor.prototype = {                                                                                         // 3195
        defaults: {                                                                                                    // 3196
            allowMultiParagraphSelection: true,                                                                        // 3197
            anchorInputPlaceholder: 'Paste or type a link',                                                            // 3198
            anchorInputCheckboxLabel: 'Open in new window',                                                            // 3199
            anchorPreviewHideDelay: 500,                                                                               // 3200
            buttons: ['bold', 'italic', 'underline', 'anchor', 'header1', 'header2', 'quote'],                         // 3201
            buttonLabels: false,                                                                                       // 3202
            checkLinkFormat: false,                                                                                    // 3203
            cleanPastedHTML: false,                                                                                    // 3204
            delay: 0,                                                                                                  // 3205
            diffLeft: 0,                                                                                               // 3206
            diffTop: -10,                                                                                              // 3207
            disableReturn: false,                                                                                      // 3208
            disableDoubleReturn: false,                                                                                // 3209
            disableToolbar: false,                                                                                     // 3210
            disableAnchorPreview: false,                                                                               // 3211
            disableEditing: false,                                                                                     // 3212
            disablePlaceholders: false,                                                                                // 3213
            toolbarAlign: 'center',                                                                                    // 3214
            elementsContainer: false,                                                                                  // 3215
            imageDragging: true,                                                                                       // 3216
            standardizeSelectionStart: false,                                                                          // 3217
            contentWindow: window,                                                                                     // 3218
            ownerDocument: document,                                                                                   // 3219
            firstHeader: 'h3',                                                                                         // 3220
            forcePlainText: true,                                                                                      // 3221
            placeholder: 'Type your text',                                                                             // 3222
            secondHeader: 'h4',                                                                                        // 3223
            targetBlank: false,                                                                                        // 3224
            anchorTarget: false,                                                                                       // 3225
            anchorButton: false,                                                                                       // 3226
            anchorButtonClass: 'btn',                                                                                  // 3227
            extensions: {},                                                                                            // 3228
            activeButtonClass: 'medium-editor-button-active',                                                          // 3229
            firstButtonClass: 'medium-editor-button-first',                                                            // 3230
            lastButtonClass: 'medium-editor-button-last'                                                               // 3231
        },                                                                                                             // 3232
                                                                                                                       // 3233
        // NOT DOCUMENTED - exposed for backwards compatability                                                        // 3234
        init: function (elements, options) {                                                                           // 3235
            var uniqueId = 1;                                                                                          // 3236
                                                                                                                       // 3237
            this.options = Util.defaults(options, this.defaults);                                                      // 3238
            createElementsArray.call(this, elements);                                                                  // 3239
            if (this.elements.length === 0) {                                                                          // 3240
                return;                                                                                                // 3241
            }                                                                                                          // 3242
                                                                                                                       // 3243
            if (!this.options.elementsContainer) {                                                                     // 3244
                this.options.elementsContainer = this.options.ownerDocument.body;                                      // 3245
            }                                                                                                          // 3246
                                                                                                                       // 3247
            while (this.options.elementsContainer.querySelector('#medium-editor-toolbar-' + uniqueId)) {               // 3248
                uniqueId = uniqueId + 1;                                                                               // 3249
            }                                                                                                          // 3250
                                                                                                                       // 3251
            this.id = uniqueId;                                                                                        // 3252
                                                                                                                       // 3253
            return this.setup();                                                                                       // 3254
        },                                                                                                             // 3255
                                                                                                                       // 3256
        setup: function () {                                                                                           // 3257
            if (this.isActive) {                                                                                       // 3258
                return;                                                                                                // 3259
            }                                                                                                          // 3260
                                                                                                                       // 3261
            this.events = new Events(this);                                                                            // 3262
            this.isActive = true;                                                                                      // 3263
                                                                                                                       // 3264
            // Call initialization helpers                                                                             // 3265
            initCommands.call(this);                                                                                   // 3266
            initElements.call(this);                                                                                   // 3267
            attachHandlers.call(this);                                                                                 // 3268
                                                                                                                       // 3269
            this.pasteHandler = new PasteHandler(this);                                                                // 3270
                                                                                                                       // 3271
            if (!this.options.disablePlaceholders) {                                                                   // 3272
                this.placeholders = new Placeholders(this);                                                            // 3273
            }                                                                                                          // 3274
        },                                                                                                             // 3275
                                                                                                                       // 3276
        destroy: function () {                                                                                         // 3277
            if (!this.isActive) {                                                                                      // 3278
                return;                                                                                                // 3279
            }                                                                                                          // 3280
                                                                                                                       // 3281
            var i;                                                                                                     // 3282
                                                                                                                       // 3283
            this.isActive = false;                                                                                     // 3284
                                                                                                                       // 3285
            if (this.toolbar !== undefined) {                                                                          // 3286
                this.toolbar.deactivate();                                                                             // 3287
                delete this.toolbar;                                                                                   // 3288
            }                                                                                                          // 3289
                                                                                                                       // 3290
            for (i = 0; i < this.elements.length; i += 1) {                                                            // 3291
                this.elements[i].removeAttribute('contentEditable');                                                   // 3292
                this.elements[i].removeAttribute('data-medium-element');                                               // 3293
            }                                                                                                          // 3294
                                                                                                                       // 3295
            this.commands.forEach(function (extension) {                                                               // 3296
                if (typeof extension.deactivate === 'function') {                                                      // 3297
                    extension.deactivate();                                                                            // 3298
                }                                                                                                      // 3299
            }.bind(this));                                                                                             // 3300
                                                                                                                       // 3301
            this.events.detachAllDOMEvents();                                                                          // 3302
        },                                                                                                             // 3303
                                                                                                                       // 3304
        on: function (target, event, listener, useCapture) {                                                           // 3305
            this.events.attachDOMEvent(target, event, listener, useCapture);                                           // 3306
        },                                                                                                             // 3307
                                                                                                                       // 3308
        off: function (target, event, listener, useCapture) {                                                          // 3309
            this.events.detachDOMEvent(target, event, listener, useCapture);                                           // 3310
        },                                                                                                             // 3311
                                                                                                                       // 3312
        subscribe: function (event, listener) {                                                                        // 3313
            this.events.attachCustomEvent(event, listener);                                                            // 3314
        },                                                                                                             // 3315
                                                                                                                       // 3316
        delay: function (fn) {                                                                                         // 3317
            var self = this;                                                                                           // 3318
            setTimeout(function () {                                                                                   // 3319
                if (self.isActive) {                                                                                   // 3320
                    fn();                                                                                              // 3321
                }                                                                                                      // 3322
            }, this.options.delay);                                                                                    // 3323
        },                                                                                                             // 3324
                                                                                                                       // 3325
        serialize: function () {                                                                                       // 3326
            var i,                                                                                                     // 3327
                elementid,                                                                                             // 3328
                content = {};                                                                                          // 3329
            for (i = 0; i < this.elements.length; i += 1) {                                                            // 3330
                elementid = (this.elements[i].id !== '') ? this.elements[i].id : 'element-' + i;                       // 3331
                content[elementid] = {                                                                                 // 3332
                    value: this.elements[i].innerHTML.trim()                                                           // 3333
                };                                                                                                     // 3334
            }                                                                                                          // 3335
            return content;                                                                                            // 3336
        },                                                                                                             // 3337
                                                                                                                       // 3338
        getExtensionByName: function (name) {                                                                          // 3339
            var extension;                                                                                             // 3340
            if (this.commands && this.commands.length) {                                                               // 3341
                this.commands.forEach(function (ext) {                                                                 // 3342
                    if (ext.name === name) {                                                                           // 3343
                        extension = ext;                                                                               // 3344
                    }                                                                                                  // 3345
                });                                                                                                    // 3346
            }                                                                                                          // 3347
            return extension;                                                                                          // 3348
        },                                                                                                             // 3349
                                                                                                                       // 3350
        /**                                                                                                            // 3351
         * NOT DOCUMENTED - exposed for backwards compatability                                                        // 3352
         * Helper function to call a method with a number of parameters on all registered extensions.                  // 3353
         * The function assures that the function exists before calling.                                               // 3354
         *                                                                                                             // 3355
         * @param {string} funcName name of the function to call                                                       // 3356
         * @param [args] arguments passed into funcName                                                                // 3357
         */                                                                                                            // 3358
        callExtensions: function (funcName) {                                                                          // 3359
            if (arguments.length < 1) {                                                                                // 3360
                return;                                                                                                // 3361
            }                                                                                                          // 3362
                                                                                                                       // 3363
            var args = Array.prototype.slice.call(arguments, 1),                                                       // 3364
                ext,                                                                                                   // 3365
                name;                                                                                                  // 3366
                                                                                                                       // 3367
            for (name in this.options.extensions) {                                                                    // 3368
                if (this.options.extensions.hasOwnProperty(name)) {                                                    // 3369
                    ext = this.options.extensions[name];                                                               // 3370
                    if (ext[funcName] !== undefined) {                                                                 // 3371
                        ext[funcName].apply(ext, args);                                                                // 3372
                    }                                                                                                  // 3373
                }                                                                                                      // 3374
            }                                                                                                          // 3375
            return this;                                                                                               // 3376
        },                                                                                                             // 3377
                                                                                                                       // 3378
        stopSelectionUpdates: function () {                                                                            // 3379
            this.preventSelectionUpdates = true;                                                                       // 3380
        },                                                                                                             // 3381
                                                                                                                       // 3382
        startSelectionUpdates: function () {                                                                           // 3383
            this.preventSelectionUpdates = false;                                                                      // 3384
        },                                                                                                             // 3385
                                                                                                                       // 3386
        // NOT DOCUMENTED - exposed as extension helper and for backwards compatability                                // 3387
        checkSelection: function () {                                                                                  // 3388
            if (this.toolbar) {                                                                                        // 3389
                this.toolbar.checkState();                                                                             // 3390
            }                                                                                                          // 3391
            return this;                                                                                               // 3392
        },                                                                                                             // 3393
                                                                                                                       // 3394
        // Wrapper around document.queryCommandState for checking whether an action has already                        // 3395
        // been applied to the current selection                                                                       // 3396
        queryCommandState: function (action) {                                                                         // 3397
            var fullAction = /^full-(.+)$/gi,                                                                          // 3398
                match,                                                                                                 // 3399
                queryState = null;                                                                                     // 3400
                                                                                                                       // 3401
            // Actions starting with 'full-' need to be modified since this is a medium-editor concept                 // 3402
            match = fullAction.exec(action);                                                                           // 3403
            if (match) {                                                                                               // 3404
                action = match[1];                                                                                     // 3405
            }                                                                                                          // 3406
                                                                                                                       // 3407
            try {                                                                                                      // 3408
                queryState = this.options.ownerDocument.queryCommandState(action);                                     // 3409
            } catch (exc) {                                                                                            // 3410
                queryState = null;                                                                                     // 3411
            }                                                                                                          // 3412
                                                                                                                       // 3413
            return queryState;                                                                                         // 3414
        },                                                                                                             // 3415
                                                                                                                       // 3416
        execAction: function (action, opts) {                                                                          // 3417
            /*jslint regexp: true*/                                                                                    // 3418
            var fullAction = /^full-(.+)$/gi,                                                                          // 3419
                match,                                                                                                 // 3420
                result;                                                                                                // 3421
            /*jslint regexp: false*/                                                                                   // 3422
                                                                                                                       // 3423
            // Actions starting with 'full-' should be applied to to the entire contents of the editable element       // 3424
            // (ie full-bold, full-append-pre, etc.)                                                                   // 3425
            match = fullAction.exec(action);                                                                           // 3426
            if (match) {                                                                                               // 3427
                // Store the current selection to be restored after applying the action                                // 3428
                this.saveSelection();                                                                                  // 3429
                // Select all of the contents before calling the action                                                // 3430
                this.selectAllContents();                                                                              // 3431
                result = execActionInternal.call(this, match[1], opts);                                                // 3432
                // Restore the previous selection                                                                      // 3433
                this.restoreSelection();                                                                               // 3434
            } else {                                                                                                   // 3435
                result = execActionInternal.call(this, action, opts);                                                  // 3436
            }                                                                                                          // 3437
                                                                                                                       // 3438
            // do some DOM clean-up for known browser issues after the action                                          // 3439
            if (action === 'insertunorderedlist' || action === 'insertorderedlist') {                                  // 3440
                Util.cleanListDOM(this.getSelectedParentElement());                                                    // 3441
            }                                                                                                          // 3442
                                                                                                                       // 3443
            this.checkSelection();                                                                                     // 3444
            return result;                                                                                             // 3445
        },                                                                                                             // 3446
                                                                                                                       // 3447
        getSelectedParentElement: function (range) {                                                                   // 3448
            if (range === undefined) {                                                                                 // 3449
                range = this.options.contentWindow.getSelection().getRangeAt(0);                                       // 3450
            }                                                                                                          // 3451
            return Selection.getSelectedParentElement(range);                                                          // 3452
        },                                                                                                             // 3453
                                                                                                                       // 3454
        // NOT DOCUMENTED - exposed as extension helper                                                                // 3455
        hideToolbarDefaultActions: function () {                                                                       // 3456
            if (this.toolbar) {                                                                                        // 3457
                this.toolbar.hideToolbarDefaultActions();                                                              // 3458
            }                                                                                                          // 3459
            return this;                                                                                               // 3460
        },                                                                                                             // 3461
                                                                                                                       // 3462
        // NOT DOCUMENTED - exposed as extension helper and for backwards compatability                                // 3463
        setToolbarPosition: function () {                                                                              // 3464
            if (this.toolbar) {                                                                                        // 3465
                this.toolbar.setToolbarPosition();                                                                     // 3466
            }                                                                                                          // 3467
        },                                                                                                             // 3468
                                                                                                                       // 3469
        selectAllContents: function () {                                                                               // 3470
            var range = this.options.ownerDocument.createRange(),                                                      // 3471
                sel = this.options.contentWindow.getSelection(),                                                       // 3472
                currNode = Selection.getSelectionElement(this.options.contentWindow);                                  // 3473
                                                                                                                       // 3474
            if (currNode) {                                                                                            // 3475
                // Move to the lowest descendant node that still selects all of the contents                           // 3476
                while (currNode.children.length === 1) {                                                               // 3477
                    currNode = currNode.children[0];                                                                   // 3478
                }                                                                                                      // 3479
                                                                                                                       // 3480
                range.selectNodeContents(currNode);                                                                    // 3481
                sel.removeAllRanges();                                                                                 // 3482
                sel.addRange(range);                                                                                   // 3483
            }                                                                                                          // 3484
        },                                                                                                             // 3485
                                                                                                                       // 3486
        // http://stackoverflow.com/questions/17678843/cant-restore-selection-after-html-modify-even-if-its-the-same-html
        // Tim Down                                                                                                    // 3488
        // TODO: move to selection.js and clean up old methods there                                                   // 3489
        saveSelection: function () {                                                                                   // 3490
            this.selectionState = null;                                                                                // 3491
                                                                                                                       // 3492
            var selection = this.options.contentWindow.getSelection(),                                                 // 3493
                range,                                                                                                 // 3494
                preSelectionRange,                                                                                     // 3495
                start,                                                                                                 // 3496
                editableElementIndex = -1;                                                                             // 3497
                                                                                                                       // 3498
            if (selection.rangeCount > 0) {                                                                            // 3499
                range = selection.getRangeAt(0);                                                                       // 3500
                preSelectionRange = range.cloneRange();                                                                // 3501
                                                                                                                       // 3502
                // Find element current selection is inside                                                            // 3503
                this.elements.forEach(function (el, index) {                                                           // 3504
                    if (el === range.startContainer || Util.isDescendant(el, range.startContainer)) {                  // 3505
                        editableElementIndex = index;                                                                  // 3506
                        return false;                                                                                  // 3507
                    }                                                                                                  // 3508
                });                                                                                                    // 3509
                                                                                                                       // 3510
                if (editableElementIndex > -1) {                                                                       // 3511
                    preSelectionRange.selectNodeContents(this.elements[editableElementIndex]);                         // 3512
                    preSelectionRange.setEnd(range.startContainer, range.startOffset);                                 // 3513
                    start = preSelectionRange.toString().length;                                                       // 3514
                                                                                                                       // 3515
                    this.selectionState = {                                                                            // 3516
                        start: start,                                                                                  // 3517
                        end: start + range.toString().length,                                                          // 3518
                        editableElementIndex: editableElementIndex                                                     // 3519
                    };                                                                                                 // 3520
                }                                                                                                      // 3521
            }                                                                                                          // 3522
        },                                                                                                             // 3523
                                                                                                                       // 3524
        // http://stackoverflow.com/questions/17678843/cant-restore-selection-after-html-modify-even-if-its-the-same-html
        // Tim Down                                                                                                    // 3526
        // TODO: move to selection.js and clean up old methods there                                                   // 3527
        restoreSelection: function () {                                                                                // 3528
            if (!this.selectionState) {                                                                                // 3529
                return;                                                                                                // 3530
            }                                                                                                          // 3531
                                                                                                                       // 3532
            var editableElement = this.elements[this.selectionState.editableElementIndex],                             // 3533
                charIndex = 0,                                                                                         // 3534
                range = this.options.ownerDocument.createRange(),                                                      // 3535
                nodeStack = [editableElement],                                                                         // 3536
                node,                                                                                                  // 3537
                foundStart = false,                                                                                    // 3538
                stop = false,                                                                                          // 3539
                i,                                                                                                     // 3540
                sel,                                                                                                   // 3541
                nextCharIndex;                                                                                         // 3542
                                                                                                                       // 3543
            range.setStart(editableElement, 0);                                                                        // 3544
            range.collapse(true);                                                                                      // 3545
                                                                                                                       // 3546
            node = nodeStack.pop();                                                                                    // 3547
            while (!stop && node) {                                                                                    // 3548
                if (node.nodeType === 3) {                                                                             // 3549
                    nextCharIndex = charIndex + node.length;                                                           // 3550
                    if (!foundStart && this.selectionState.start >= charIndex && this.selectionState.start <= nextCharIndex) {
                        range.setStart(node, this.selectionState.start - charIndex);                                   // 3552
                        foundStart = true;                                                                             // 3553
                    }                                                                                                  // 3554
                    if (foundStart && this.selectionState.end >= charIndex && this.selectionState.end <= nextCharIndex) {
                        range.setEnd(node, this.selectionState.end - charIndex);                                       // 3556
                        stop = true;                                                                                   // 3557
                    }                                                                                                  // 3558
                    charIndex = nextCharIndex;                                                                         // 3559
                } else {                                                                                               // 3560
                    i = node.childNodes.length - 1;                                                                    // 3561
                    while (i >= 0) {                                                                                   // 3562
                        nodeStack.push(node.childNodes[i]);                                                            // 3563
                        i -= 1;                                                                                        // 3564
                    }                                                                                                  // 3565
                }                                                                                                      // 3566
                if (!stop) {                                                                                           // 3567
                    node = nodeStack.pop();                                                                            // 3568
                }                                                                                                      // 3569
            }                                                                                                          // 3570
                                                                                                                       // 3571
            sel = this.options.contentWindow.getSelection();                                                           // 3572
            sel.removeAllRanges();                                                                                     // 3573
            sel.addRange(range);                                                                                       // 3574
        },                                                                                                             // 3575
                                                                                                                       // 3576
        createLink: function (opts) {                                                                                  // 3577
            var customEvent,                                                                                           // 3578
                i;                                                                                                     // 3579
                                                                                                                       // 3580
            if (opts.url && opts.url.trim().length > 0) {                                                              // 3581
                this.options.ownerDocument.execCommand('createLink', false, opts.url);                                 // 3582
                                                                                                                       // 3583
                if (this.options.targetBlank || opts.target === '_blank') {                                            // 3584
                    Util.setTargetBlank(Util.getSelectionStart(this.options.ownerDocument));                           // 3585
                }                                                                                                      // 3586
                                                                                                                       // 3587
                if (opts.buttonClass) {                                                                                // 3588
                    Util.addClassToAnchors(Util.getSelectionStart(this.options.ownerDocument), opts.buttonClass);      // 3589
                }                                                                                                      // 3590
            }                                                                                                          // 3591
                                                                                                                       // 3592
            if (this.options.targetBlank || opts.target === "_blank" || opts.buttonClass) {                            // 3593
                customEvent = this.options.ownerDocument.createEvent("HTMLEvents");                                    // 3594
                customEvent.initEvent("input", true, true, this.options.contentWindow);                                // 3595
                for (i = 0; i < this.elements.length; i += 1) {                                                        // 3596
                    this.elements[i].dispatchEvent(customEvent);                                                       // 3597
                }                                                                                                      // 3598
            }                                                                                                          // 3599
        },                                                                                                             // 3600
                                                                                                                       // 3601
        // alias for setup - keeping for backwards compatability                                                       // 3602
        activate: function () {                                                                                        // 3603
            Util.deprecatedMethod.call(this, 'activate', 'setup', arguments);                                          // 3604
        },                                                                                                             // 3605
                                                                                                                       // 3606
        // alias for destory - keeping for backwards compatability                                                     // 3607
        deactivate: function () {                                                                                      // 3608
            Util.deprecatedMethod.call(this, 'deactivate', 'destroy', arguments);                                      // 3609
        },                                                                                                             // 3610
                                                                                                                       // 3611
        cleanPaste: function (text) {                                                                                  // 3612
            this.pasteHandler.cleanPaste(text);                                                                        // 3613
        },                                                                                                             // 3614
                                                                                                                       // 3615
        pasteHTML: function (html) {                                                                                   // 3616
            this.pasteHandler.pasteHTML(html);                                                                         // 3617
        }                                                                                                              // 3618
    };                                                                                                                 // 3619
}());                                                                                                                  // 3620
                                                                                                                       // 3621
    return MediumEditor;                                                                                               // 3622
}()));                                                                                                                 // 3623
                                                                                                                       // 3624
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/compatibility/bower_components/handlebars/handlebars.runtime.js                            //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
/*!                                                                                                                    // 1
                                                                                                                       // 2
 handlebars v3.0.3                                                                                                     // 3
                                                                                                                       // 4
Copyright (C) 2011-2014 by Yehuda Katz                                                                                 // 5
                                                                                                                       // 6
Permission is hereby granted, free of charge, to any person obtaining a copy                                           // 7
of this software and associated documentation files (the "Software"), to deal                                          // 8
in the Software without restriction, including without limitation the rights                                           // 9
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell                                              // 10
copies of the Software, and to permit persons to whom the Software is                                                  // 11
furnished to do so, subject to the following conditions:                                                               // 12
                                                                                                                       // 13
The above copyright notice and this permission notice shall be included in                                             // 14
all copies or substantial portions of the Software.                                                                    // 15
                                                                                                                       // 16
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR                                             // 17
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,                                               // 18
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE                                            // 19
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER                                                 // 20
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,                                          // 21
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN                                              // 22
THE SOFTWARE.                                                                                                          // 23
                                                                                                                       // 24
@license                                                                                                               // 25
*/                                                                                                                     // 26
(function webpackUniversalModuleDefinition(root, factory) {                                                            // 27
	if(typeof exports === 'object' && typeof module === 'object')                                                         // 28
		module.exports = factory();                                                                                          // 29
	else if(typeof define === 'function' && define.amd)                                                                   // 30
		define(factory);                                                                                                     // 31
	else if(typeof exports === 'object')                                                                                  // 32
		exports["Handlebars"] = factory();                                                                                   // 33
	else                                                                                                                  // 34
		root["Handlebars"] = factory();                                                                                      // 35
})(this, function() {                                                                                                  // 36
return /******/ (function(modules) { // webpackBootstrap                                                               // 37
/******/ 	// The module cache                                                                                          // 38
/******/ 	var installedModules = {};                                                                                   // 39
                                                                                                                       // 40
/******/ 	// The require function                                                                                      // 41
/******/ 	function __webpack_require__(moduleId) {                                                                     // 42
                                                                                                                       // 43
/******/ 		// Check if module is in cache                                                                              // 44
/******/ 		if(installedModules[moduleId])                                                                              // 45
/******/ 			return installedModules[moduleId].exports;                                                                 // 46
                                                                                                                       // 47
/******/ 		// Create a new module (and put it into the cache)                                                          // 48
/******/ 		var module = installedModules[moduleId] = {                                                                 // 49
/******/ 			exports: {},                                                                                               // 50
/******/ 			id: moduleId,                                                                                              // 51
/******/ 			loaded: false                                                                                              // 52
/******/ 		};                                                                                                          // 53
                                                                                                                       // 54
/******/ 		// Execute the module function                                                                              // 55
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);                        // 56
                                                                                                                       // 57
/******/ 		// Flag the module as loaded                                                                                // 58
/******/ 		module.loaded = true;                                                                                       // 59
                                                                                                                       // 60
/******/ 		// Return the exports of the module                                                                         // 61
/******/ 		return module.exports;                                                                                      // 62
/******/ 	}                                                                                                            // 63
                                                                                                                       // 64
                                                                                                                       // 65
/******/ 	// expose the modules object (__webpack_modules__)                                                           // 66
/******/ 	__webpack_require__.m = modules;                                                                             // 67
                                                                                                                       // 68
/******/ 	// expose the module cache                                                                                   // 69
/******/ 	__webpack_require__.c = installedModules;                                                                    // 70
                                                                                                                       // 71
/******/ 	// __webpack_public_path__                                                                                   // 72
/******/ 	__webpack_require__.p = "";                                                                                  // 73
                                                                                                                       // 74
/******/ 	// Load entry module and return exports                                                                      // 75
/******/ 	return __webpack_require__(0);                                                                               // 76
/******/ })                                                                                                            // 77
/************************************************************************/                                             // 78
/******/ ([                                                                                                            // 79
/* 0 */                                                                                                                // 80
/***/ function(module, exports, __webpack_require__) {                                                                 // 81
                                                                                                                       // 82
	'use strict';                                                                                                         // 83
                                                                                                                       // 84
	var _interopRequireWildcard = __webpack_require__(7)['default'];                                                      // 85
                                                                                                                       // 86
	exports.__esModule = true;                                                                                            // 87
                                                                                                                       // 88
	var _import = __webpack_require__(1);                                                                                 // 89
                                                                                                                       // 90
	var base = _interopRequireWildcard(_import);                                                                          // 91
                                                                                                                       // 92
	// Each of these augment the Handlebars object. No need to setup here.                                                // 93
	// (This is done to easily share code between commonjs and browse envs)                                               // 94
                                                                                                                       // 95
	var _SafeString = __webpack_require__(2);                                                                             // 96
                                                                                                                       // 97
	var _SafeString2 = _interopRequireWildcard(_SafeString);                                                              // 98
                                                                                                                       // 99
	var _Exception = __webpack_require__(3);                                                                              // 100
                                                                                                                       // 101
	var _Exception2 = _interopRequireWildcard(_Exception);                                                                // 102
                                                                                                                       // 103
	var _import2 = __webpack_require__(4);                                                                                // 104
                                                                                                                       // 105
	var Utils = _interopRequireWildcard(_import2);                                                                        // 106
                                                                                                                       // 107
	var _import3 = __webpack_require__(5);                                                                                // 108
                                                                                                                       // 109
	var runtime = _interopRequireWildcard(_import3);                                                                      // 110
                                                                                                                       // 111
	var _noConflict = __webpack_require__(6);                                                                             // 112
                                                                                                                       // 113
	var _noConflict2 = _interopRequireWildcard(_noConflict);                                                              // 114
                                                                                                                       // 115
	// For compatibility and usage outside of module systems, make the Handlebars object a namespace                      // 116
	function create() {                                                                                                   // 117
	  var hb = new base.HandlebarsEnvironment();                                                                          // 118
                                                                                                                       // 119
	  Utils.extend(hb, base);                                                                                             // 120
	  hb.SafeString = _SafeString2['default'];                                                                            // 121
	  hb.Exception = _Exception2['default'];                                                                              // 122
	  hb.Utils = Utils;                                                                                                   // 123
	  hb.escapeExpression = Utils.escapeExpression;                                                                       // 124
                                                                                                                       // 125
	  hb.VM = runtime;                                                                                                    // 126
	  hb.template = function (spec) {                                                                                     // 127
	    return runtime.template(spec, hb);                                                                                // 128
	  };                                                                                                                  // 129
                                                                                                                       // 130
	  return hb;                                                                                                          // 131
	}                                                                                                                     // 132
                                                                                                                       // 133
	var inst = create();                                                                                                  // 134
	inst.create = create;                                                                                                 // 135
                                                                                                                       // 136
	_noConflict2['default'](inst);                                                                                        // 137
                                                                                                                       // 138
	inst['default'] = inst;                                                                                               // 139
                                                                                                                       // 140
	exports['default'] = inst;                                                                                            // 141
	module.exports = exports['default'];                                                                                  // 142
                                                                                                                       // 143
/***/ },                                                                                                               // 144
/* 1 */                                                                                                                // 145
/***/ function(module, exports, __webpack_require__) {                                                                 // 146
                                                                                                                       // 147
	'use strict';                                                                                                         // 148
                                                                                                                       // 149
	var _interopRequireWildcard = __webpack_require__(7)['default'];                                                      // 150
                                                                                                                       // 151
	exports.__esModule = true;                                                                                            // 152
	exports.HandlebarsEnvironment = HandlebarsEnvironment;                                                                // 153
	exports.createFrame = createFrame;                                                                                    // 154
                                                                                                                       // 155
	var _import = __webpack_require__(4);                                                                                 // 156
                                                                                                                       // 157
	var Utils = _interopRequireWildcard(_import);                                                                         // 158
                                                                                                                       // 159
	var _Exception = __webpack_require__(3);                                                                              // 160
                                                                                                                       // 161
	var _Exception2 = _interopRequireWildcard(_Exception);                                                                // 162
                                                                                                                       // 163
	var VERSION = '3.0.1';                                                                                                // 164
	exports.VERSION = VERSION;                                                                                            // 165
	var COMPILER_REVISION = 6;                                                                                            // 166
                                                                                                                       // 167
	exports.COMPILER_REVISION = COMPILER_REVISION;                                                                        // 168
	var REVISION_CHANGES = {                                                                                              // 169
	  1: '<= 1.0.rc.2', // 1.0.rc.2 is actually rev2 but doesn't report it                                                // 170
	  2: '== 1.0.0-rc.3',                                                                                                 // 171
	  3: '== 1.0.0-rc.4',                                                                                                 // 172
	  4: '== 1.x.x',                                                                                                      // 173
	  5: '== 2.0.0-alpha.x',                                                                                              // 174
	  6: '>= 2.0.0-beta.1'                                                                                                // 175
	};                                                                                                                    // 176
                                                                                                                       // 177
	exports.REVISION_CHANGES = REVISION_CHANGES;                                                                          // 178
	var isArray = Utils.isArray,                                                                                          // 179
	    isFunction = Utils.isFunction,                                                                                    // 180
	    toString = Utils.toString,                                                                                        // 181
	    objectType = '[object Object]';                                                                                   // 182
                                                                                                                       // 183
	function HandlebarsEnvironment(helpers, partials) {                                                                   // 184
	  this.helpers = helpers || {};                                                                                       // 185
	  this.partials = partials || {};                                                                                     // 186
                                                                                                                       // 187
	  registerDefaultHelpers(this);                                                                                       // 188
	}                                                                                                                     // 189
                                                                                                                       // 190
	HandlebarsEnvironment.prototype = {                                                                                   // 191
	  constructor: HandlebarsEnvironment,                                                                                 // 192
                                                                                                                       // 193
	  logger: logger,                                                                                                     // 194
	  log: log,                                                                                                           // 195
                                                                                                                       // 196
	  registerHelper: function registerHelper(name, fn) {                                                                 // 197
	    if (toString.call(name) === objectType) {                                                                         // 198
	      if (fn) {                                                                                                       // 199
	        throw new _Exception2['default']('Arg not supported with multiple helpers');                                  // 200
	      }                                                                                                               // 201
	      Utils.extend(this.helpers, name);                                                                               // 202
	    } else {                                                                                                          // 203
	      this.helpers[name] = fn;                                                                                        // 204
	    }                                                                                                                 // 205
	  },                                                                                                                  // 206
	  unregisterHelper: function unregisterHelper(name) {                                                                 // 207
	    delete this.helpers[name];                                                                                        // 208
	  },                                                                                                                  // 209
                                                                                                                       // 210
	  registerPartial: function registerPartial(name, partial) {                                                          // 211
	    if (toString.call(name) === objectType) {                                                                         // 212
	      Utils.extend(this.partials, name);                                                                              // 213
	    } else {                                                                                                          // 214
	      if (typeof partial === 'undefined') {                                                                           // 215
	        throw new _Exception2['default']('Attempting to register a partial as undefined');                            // 216
	      }                                                                                                               // 217
	      this.partials[name] = partial;                                                                                  // 218
	    }                                                                                                                 // 219
	  },                                                                                                                  // 220
	  unregisterPartial: function unregisterPartial(name) {                                                               // 221
	    delete this.partials[name];                                                                                       // 222
	  }                                                                                                                   // 223
	};                                                                                                                    // 224
                                                                                                                       // 225
	function registerDefaultHelpers(instance) {                                                                           // 226
	  instance.registerHelper('helperMissing', function () {                                                              // 227
	    if (arguments.length === 1) {                                                                                     // 228
	      // A missing field in a {{foo}} constuct.                                                                       // 229
	      return undefined;                                                                                               // 230
	    } else {                                                                                                          // 231
	      // Someone is actually trying to call something, blow up.                                                       // 232
	      throw new _Exception2['default']('Missing helper: "' + arguments[arguments.length - 1].name + '"');             // 233
	    }                                                                                                                 // 234
	  });                                                                                                                 // 235
                                                                                                                       // 236
	  instance.registerHelper('blockHelperMissing', function (context, options) {                                         // 237
	    var inverse = options.inverse,                                                                                    // 238
	        fn = options.fn;                                                                                              // 239
                                                                                                                       // 240
	    if (context === true) {                                                                                           // 241
	      return fn(this);                                                                                                // 242
	    } else if (context === false || context == null) {                                                                // 243
	      return inverse(this);                                                                                           // 244
	    } else if (isArray(context)) {                                                                                    // 245
	      if (context.length > 0) {                                                                                       // 246
	        if (options.ids) {                                                                                            // 247
	          options.ids = [options.name];                                                                               // 248
	        }                                                                                                             // 249
                                                                                                                       // 250
	        return instance.helpers.each(context, options);                                                               // 251
	      } else {                                                                                                        // 252
	        return inverse(this);                                                                                         // 253
	      }                                                                                                               // 254
	    } else {                                                                                                          // 255
	      if (options.data && options.ids) {                                                                              // 256
	        var data = createFrame(options.data);                                                                         // 257
	        data.contextPath = Utils.appendContextPath(options.data.contextPath, options.name);                           // 258
	        options = { data: data };                                                                                     // 259
	      }                                                                                                               // 260
                                                                                                                       // 261
	      return fn(context, options);                                                                                    // 262
	    }                                                                                                                 // 263
	  });                                                                                                                 // 264
                                                                                                                       // 265
	  instance.registerHelper('each', function (context, options) {                                                       // 266
	    if (!options) {                                                                                                   // 267
	      throw new _Exception2['default']('Must pass iterator to #each');                                                // 268
	    }                                                                                                                 // 269
                                                                                                                       // 270
	    var fn = options.fn,                                                                                              // 271
	        inverse = options.inverse,                                                                                    // 272
	        i = 0,                                                                                                        // 273
	        ret = '',                                                                                                     // 274
	        data = undefined,                                                                                             // 275
	        contextPath = undefined;                                                                                      // 276
                                                                                                                       // 277
	    if (options.data && options.ids) {                                                                                // 278
	      contextPath = Utils.appendContextPath(options.data.contextPath, options.ids[0]) + '.';                          // 279
	    }                                                                                                                 // 280
                                                                                                                       // 281
	    if (isFunction(context)) {                                                                                        // 282
	      context = context.call(this);                                                                                   // 283
	    }                                                                                                                 // 284
                                                                                                                       // 285
	    if (options.data) {                                                                                               // 286
	      data = createFrame(options.data);                                                                               // 287
	    }                                                                                                                 // 288
                                                                                                                       // 289
	    function execIteration(field, index, last) {                                                                      // 290
	      if (data) {                                                                                                     // 291
	        data.key = field;                                                                                             // 292
	        data.index = index;                                                                                           // 293
	        data.first = index === 0;                                                                                     // 294
	        data.last = !!last;                                                                                           // 295
                                                                                                                       // 296
	        if (contextPath) {                                                                                            // 297
	          data.contextPath = contextPath + field;                                                                     // 298
	        }                                                                                                             // 299
	      }                                                                                                               // 300
                                                                                                                       // 301
	      ret = ret + fn(context[field], {                                                                                // 302
	        data: data,                                                                                                   // 303
	        blockParams: Utils.blockParams([context[field], field], [contextPath + field, null])                          // 304
	      });                                                                                                             // 305
	    }                                                                                                                 // 306
                                                                                                                       // 307
	    if (context && typeof context === 'object') {                                                                     // 308
	      if (isArray(context)) {                                                                                         // 309
	        for (var j = context.length; i < j; i++) {                                                                    // 310
	          execIteration(i, i, i === context.length - 1);                                                              // 311
	        }                                                                                                             // 312
	      } else {                                                                                                        // 313
	        var priorKey = undefined;                                                                                     // 314
                                                                                                                       // 315
	        for (var key in context) {                                                                                    // 316
	          if (context.hasOwnProperty(key)) {                                                                          // 317
	            // We're running the iterations one step out of sync so we can detect                                     // 318
	            // the last iteration without have to scan the object twice and create                                    // 319
	            // an itermediate keys array.                                                                             // 320
	            if (priorKey) {                                                                                           // 321
	              execIteration(priorKey, i - 1);                                                                         // 322
	            }                                                                                                         // 323
	            priorKey = key;                                                                                           // 324
	            i++;                                                                                                      // 325
	          }                                                                                                           // 326
	        }                                                                                                             // 327
	        if (priorKey) {                                                                                               // 328
	          execIteration(priorKey, i - 1, true);                                                                       // 329
	        }                                                                                                             // 330
	      }                                                                                                               // 331
	    }                                                                                                                 // 332
                                                                                                                       // 333
	    if (i === 0) {                                                                                                    // 334
	      ret = inverse(this);                                                                                            // 335
	    }                                                                                                                 // 336
                                                                                                                       // 337
	    return ret;                                                                                                       // 338
	  });                                                                                                                 // 339
                                                                                                                       // 340
	  instance.registerHelper('if', function (conditional, options) {                                                     // 341
	    if (isFunction(conditional)) {                                                                                    // 342
	      conditional = conditional.call(this);                                                                           // 343
	    }                                                                                                                 // 344
                                                                                                                       // 345
	    // Default behavior is to render the positive path if the value is truthy and not empty.                          // 346
	    // The `includeZero` option may be set to treat the condtional as purely not empty based on the                   // 347
	    // behavior of isEmpty. Effectively this determines if 0 is handled by the positive path or negative.             // 348
	    if (!options.hash.includeZero && !conditional || Utils.isEmpty(conditional)) {                                    // 349
	      return options.inverse(this);                                                                                   // 350
	    } else {                                                                                                          // 351
	      return options.fn(this);                                                                                        // 352
	    }                                                                                                                 // 353
	  });                                                                                                                 // 354
                                                                                                                       // 355
	  instance.registerHelper('unless', function (conditional, options) {                                                 // 356
	    return instance.helpers['if'].call(this, conditional, { fn: options.inverse, inverse: options.fn, hash: options.hash });
	  });                                                                                                                 // 358
                                                                                                                       // 359
	  instance.registerHelper('with', function (context, options) {                                                       // 360
	    if (isFunction(context)) {                                                                                        // 361
	      context = context.call(this);                                                                                   // 362
	    }                                                                                                                 // 363
                                                                                                                       // 364
	    var fn = options.fn;                                                                                              // 365
                                                                                                                       // 366
	    if (!Utils.isEmpty(context)) {                                                                                    // 367
	      if (options.data && options.ids) {                                                                              // 368
	        var data = createFrame(options.data);                                                                         // 369
	        data.contextPath = Utils.appendContextPath(options.data.contextPath, options.ids[0]);                         // 370
	        options = { data: data };                                                                                     // 371
	      }                                                                                                               // 372
                                                                                                                       // 373
	      return fn(context, options);                                                                                    // 374
	    } else {                                                                                                          // 375
	      return options.inverse(this);                                                                                   // 376
	    }                                                                                                                 // 377
	  });                                                                                                                 // 378
                                                                                                                       // 379
	  instance.registerHelper('log', function (message, options) {                                                        // 380
	    var level = options.data && options.data.level != null ? parseInt(options.data.level, 10) : 1;                    // 381
	    instance.log(level, message);                                                                                     // 382
	  });                                                                                                                 // 383
                                                                                                                       // 384
	  instance.registerHelper('lookup', function (obj, field) {                                                           // 385
	    return obj && obj[field];                                                                                         // 386
	  });                                                                                                                 // 387
	}                                                                                                                     // 388
                                                                                                                       // 389
	var logger = {                                                                                                        // 390
	  methodMap: { 0: 'debug', 1: 'info', 2: 'warn', 3: 'error' },                                                        // 391
                                                                                                                       // 392
	  // State enum                                                                                                       // 393
	  DEBUG: 0,                                                                                                           // 394
	  INFO: 1,                                                                                                            // 395
	  WARN: 2,                                                                                                            // 396
	  ERROR: 3,                                                                                                           // 397
	  level: 1,                                                                                                           // 398
                                                                                                                       // 399
	  // Can be overridden in the host environment                                                                        // 400
	  log: function log(level, message) {                                                                                 // 401
	    if (typeof console !== 'undefined' && logger.level <= level) {                                                    // 402
	      var method = logger.methodMap[level];                                                                           // 403
	      (console[method] || console.log).call(console, message); // eslint-disable-line no-console                      // 404
	    }                                                                                                                 // 405
	  }                                                                                                                   // 406
	};                                                                                                                    // 407
                                                                                                                       // 408
	exports.logger = logger;                                                                                              // 409
	var log = logger.log;                                                                                                 // 410
                                                                                                                       // 411
	exports.log = log;                                                                                                    // 412
                                                                                                                       // 413
	function createFrame(object) {                                                                                        // 414
	  var frame = Utils.extend({}, object);                                                                               // 415
	  frame._parent = object;                                                                                             // 416
	  return frame;                                                                                                       // 417
	}                                                                                                                     // 418
                                                                                                                       // 419
	/* [args, ]options */                                                                                                 // 420
                                                                                                                       // 421
/***/ },                                                                                                               // 422
/* 2 */                                                                                                                // 423
/***/ function(module, exports, __webpack_require__) {                                                                 // 424
                                                                                                                       // 425
	'use strict';                                                                                                         // 426
                                                                                                                       // 427
	exports.__esModule = true;                                                                                            // 428
	// Build out our basic SafeString type                                                                                // 429
	function SafeString(string) {                                                                                         // 430
	  this.string = string;                                                                                               // 431
	}                                                                                                                     // 432
                                                                                                                       // 433
	SafeString.prototype.toString = SafeString.prototype.toHTML = function () {                                           // 434
	  return '' + this.string;                                                                                            // 435
	};                                                                                                                    // 436
                                                                                                                       // 437
	exports['default'] = SafeString;                                                                                      // 438
	module.exports = exports['default'];                                                                                  // 439
                                                                                                                       // 440
/***/ },                                                                                                               // 441
/* 3 */                                                                                                                // 442
/***/ function(module, exports, __webpack_require__) {                                                                 // 443
                                                                                                                       // 444
	'use strict';                                                                                                         // 445
                                                                                                                       // 446
	exports.__esModule = true;                                                                                            // 447
                                                                                                                       // 448
	var errorProps = ['description', 'fileName', 'lineNumber', 'message', 'name', 'number', 'stack'];                     // 449
                                                                                                                       // 450
	function Exception(message, node) {                                                                                   // 451
	  var loc = node && node.loc,                                                                                         // 452
	      line = undefined,                                                                                               // 453
	      column = undefined;                                                                                             // 454
	  if (loc) {                                                                                                          // 455
	    line = loc.start.line;                                                                                            // 456
	    column = loc.start.column;                                                                                        // 457
                                                                                                                       // 458
	    message += ' - ' + line + ':' + column;                                                                           // 459
	  }                                                                                                                   // 460
                                                                                                                       // 461
	  var tmp = Error.prototype.constructor.call(this, message);                                                          // 462
                                                                                                                       // 463
	  // Unfortunately errors are not enumerable in Chrome (at least), so `for prop in tmp` doesn't work.                 // 464
	  for (var idx = 0; idx < errorProps.length; idx++) {                                                                 // 465
	    this[errorProps[idx]] = tmp[errorProps[idx]];                                                                     // 466
	  }                                                                                                                   // 467
                                                                                                                       // 468
	  if (Error.captureStackTrace) {                                                                                      // 469
	    Error.captureStackTrace(this, Exception);                                                                         // 470
	  }                                                                                                                   // 471
                                                                                                                       // 472
	  if (loc) {                                                                                                          // 473
	    this.lineNumber = line;                                                                                           // 474
	    this.column = column;                                                                                             // 475
	  }                                                                                                                   // 476
	}                                                                                                                     // 477
                                                                                                                       // 478
	Exception.prototype = new Error();                                                                                    // 479
                                                                                                                       // 480
	exports['default'] = Exception;                                                                                       // 481
	module.exports = exports['default'];                                                                                  // 482
                                                                                                                       // 483
/***/ },                                                                                                               // 484
/* 4 */                                                                                                                // 485
/***/ function(module, exports, __webpack_require__) {                                                                 // 486
                                                                                                                       // 487
	'use strict';                                                                                                         // 488
                                                                                                                       // 489
	exports.__esModule = true;                                                                                            // 490
	exports.extend = extend;                                                                                              // 491
                                                                                                                       // 492
	// Older IE versions do not directly support indexOf so we must implement our own, sadly.                             // 493
	exports.indexOf = indexOf;                                                                                            // 494
	exports.escapeExpression = escapeExpression;                                                                          // 495
	exports.isEmpty = isEmpty;                                                                                            // 496
	exports.blockParams = blockParams;                                                                                    // 497
	exports.appendContextPath = appendContextPath;                                                                        // 498
	var escape = {                                                                                                        // 499
	  '&': '&amp;',                                                                                                       // 500
	  '<': '&lt;',                                                                                                        // 501
	  '>': '&gt;',                                                                                                        // 502
	  '"': '&quot;',                                                                                                      // 503
	  '\'': '&#x27;',                                                                                                     // 504
	  '`': '&#x60;'                                                                                                       // 505
	};                                                                                                                    // 506
                                                                                                                       // 507
	var badChars = /[&<>"'`]/g,                                                                                           // 508
	    possible = /[&<>"'`]/;                                                                                            // 509
                                                                                                                       // 510
	function escapeChar(chr) {                                                                                            // 511
	  return escape[chr];                                                                                                 // 512
	}                                                                                                                     // 513
                                                                                                                       // 514
	function extend(obj /* , ...source */) {                                                                              // 515
	  for (var i = 1; i < arguments.length; i++) {                                                                        // 516
	    for (var key in arguments[i]) {                                                                                   // 517
	      if (Object.prototype.hasOwnProperty.call(arguments[i], key)) {                                                  // 518
	        obj[key] = arguments[i][key];                                                                                 // 519
	      }                                                                                                               // 520
	    }                                                                                                                 // 521
	  }                                                                                                                   // 522
                                                                                                                       // 523
	  return obj;                                                                                                         // 524
	}                                                                                                                     // 525
                                                                                                                       // 526
	var toString = Object.prototype.toString;                                                                             // 527
                                                                                                                       // 528
	exports.toString = toString;                                                                                          // 529
	// Sourced from lodash                                                                                                // 530
	// https://github.com/bestiejs/lodash/blob/master/LICENSE.txt                                                         // 531
	/*eslint-disable func-style, no-var */                                                                                // 532
	var isFunction = function isFunction(value) {                                                                         // 533
	  return typeof value === 'function';                                                                                 // 534
	};                                                                                                                    // 535
	// fallback for older versions of Chrome and Safari                                                                   // 536
	/* istanbul ignore next */                                                                                            // 537
	if (isFunction(/x/)) {                                                                                                // 538
	  exports.isFunction = isFunction = function (value) {                                                                // 539
	    return typeof value === 'function' && toString.call(value) === '[object Function]';                               // 540
	  };                                                                                                                  // 541
	}                                                                                                                     // 542
	var isFunction;                                                                                                       // 543
	exports.isFunction = isFunction;                                                                                      // 544
	/*eslint-enable func-style, no-var */                                                                                 // 545
                                                                                                                       // 546
	/* istanbul ignore next */                                                                                            // 547
	var isArray = Array.isArray || function (value) {                                                                     // 548
	  return value && typeof value === 'object' ? toString.call(value) === '[object Array]' : false;                      // 549
	};exports.isArray = isArray;                                                                                          // 550
                                                                                                                       // 551
	function indexOf(array, value) {                                                                                      // 552
	  for (var i = 0, len = array.length; i < len; i++) {                                                                 // 553
	    if (array[i] === value) {                                                                                         // 554
	      return i;                                                                                                       // 555
	    }                                                                                                                 // 556
	  }                                                                                                                   // 557
	  return -1;                                                                                                          // 558
	}                                                                                                                     // 559
                                                                                                                       // 560
	function escapeExpression(string) {                                                                                   // 561
	  if (typeof string !== 'string') {                                                                                   // 562
	    // don't escape SafeStrings, since they're already safe                                                           // 563
	    if (string && string.toHTML) {                                                                                    // 564
	      return string.toHTML();                                                                                         // 565
	    } else if (string == null) {                                                                                      // 566
	      return '';                                                                                                      // 567
	    } else if (!string) {                                                                                             // 568
	      return string + '';                                                                                             // 569
	    }                                                                                                                 // 570
                                                                                                                       // 571
	    // Force a string conversion as this will be done by the append regardless and                                    // 572
	    // the regex test will do this transparently behind the scenes, causing issues if                                 // 573
	    // an object's to string has escaped characters in it.                                                            // 574
	    string = '' + string;                                                                                             // 575
	  }                                                                                                                   // 576
                                                                                                                       // 577
	  if (!possible.test(string)) {                                                                                       // 578
	    return string;                                                                                                    // 579
	  }                                                                                                                   // 580
	  return string.replace(badChars, escapeChar);                                                                        // 581
	}                                                                                                                     // 582
                                                                                                                       // 583
	function isEmpty(value) {                                                                                             // 584
	  if (!value && value !== 0) {                                                                                        // 585
	    return true;                                                                                                      // 586
	  } else if (isArray(value) && value.length === 0) {                                                                  // 587
	    return true;                                                                                                      // 588
	  } else {                                                                                                            // 589
	    return false;                                                                                                     // 590
	  }                                                                                                                   // 591
	}                                                                                                                     // 592
                                                                                                                       // 593
	function blockParams(params, ids) {                                                                                   // 594
	  params.path = ids;                                                                                                  // 595
	  return params;                                                                                                      // 596
	}                                                                                                                     // 597
                                                                                                                       // 598
	function appendContextPath(contextPath, id) {                                                                         // 599
	  return (contextPath ? contextPath + '.' : '') + id;                                                                 // 600
	}                                                                                                                     // 601
                                                                                                                       // 602
/***/ },                                                                                                               // 603
/* 5 */                                                                                                                // 604
/***/ function(module, exports, __webpack_require__) {                                                                 // 605
                                                                                                                       // 606
	'use strict';                                                                                                         // 607
                                                                                                                       // 608
	var _interopRequireWildcard = __webpack_require__(7)['default'];                                                      // 609
                                                                                                                       // 610
	exports.__esModule = true;                                                                                            // 611
	exports.checkRevision = checkRevision;                                                                                // 612
                                                                                                                       // 613
	// TODO: Remove this line and break up compilePartial                                                                 // 614
                                                                                                                       // 615
	exports.template = template;                                                                                          // 616
	exports.wrapProgram = wrapProgram;                                                                                    // 617
	exports.resolvePartial = resolvePartial;                                                                              // 618
	exports.invokePartial = invokePartial;                                                                                // 619
	exports.noop = noop;                                                                                                  // 620
                                                                                                                       // 621
	var _import = __webpack_require__(4);                                                                                 // 622
                                                                                                                       // 623
	var Utils = _interopRequireWildcard(_import);                                                                         // 624
                                                                                                                       // 625
	var _Exception = __webpack_require__(3);                                                                              // 626
                                                                                                                       // 627
	var _Exception2 = _interopRequireWildcard(_Exception);                                                                // 628
                                                                                                                       // 629
	var _COMPILER_REVISION$REVISION_CHANGES$createFrame = __webpack_require__(1);                                         // 630
                                                                                                                       // 631
	function checkRevision(compilerInfo) {                                                                                // 632
	  var compilerRevision = compilerInfo && compilerInfo[0] || 1,                                                        // 633
	      currentRevision = _COMPILER_REVISION$REVISION_CHANGES$createFrame.COMPILER_REVISION;                            // 634
                                                                                                                       // 635
	  if (compilerRevision !== currentRevision) {                                                                         // 636
	    if (compilerRevision < currentRevision) {                                                                         // 637
	      var runtimeVersions = _COMPILER_REVISION$REVISION_CHANGES$createFrame.REVISION_CHANGES[currentRevision],        // 638
	          compilerVersions = _COMPILER_REVISION$REVISION_CHANGES$createFrame.REVISION_CHANGES[compilerRevision];      // 639
	      throw new _Exception2['default']('Template was precompiled with an older version of Handlebars than the current runtime. ' + 'Please update your precompiler to a newer version (' + runtimeVersions + ') or downgrade your runtime to an older version (' + compilerVersions + ').');
	    } else {                                                                                                          // 641
	      // Use the embedded version info since the runtime doesn't know about this revision yet                         // 642
	      throw new _Exception2['default']('Template was precompiled with a newer version of Handlebars than the current runtime. ' + 'Please update your runtime to a newer version (' + compilerInfo[1] + ').');
	    }                                                                                                                 // 644
	  }                                                                                                                   // 645
	}                                                                                                                     // 646
                                                                                                                       // 647
	function template(templateSpec, env) {                                                                                // 648
	  /* istanbul ignore next */                                                                                          // 649
	  if (!env) {                                                                                                         // 650
	    throw new _Exception2['default']('No environment passed to template');                                            // 651
	  }                                                                                                                   // 652
	  if (!templateSpec || !templateSpec.main) {                                                                          // 653
	    throw new _Exception2['default']('Unknown template object: ' + typeof templateSpec);                              // 654
	  }                                                                                                                   // 655
                                                                                                                       // 656
	  // Note: Using env.VM references rather than local var references throughout this section to allow                  // 657
	  // for external users to override these as psuedo-supported APIs.                                                   // 658
	  env.VM.checkRevision(templateSpec.compiler);                                                                        // 659
                                                                                                                       // 660
	  function invokePartialWrapper(partial, context, options) {                                                          // 661
	    if (options.hash) {                                                                                               // 662
	      context = Utils.extend({}, context, options.hash);                                                              // 663
	    }                                                                                                                 // 664
                                                                                                                       // 665
	    partial = env.VM.resolvePartial.call(this, partial, context, options);                                            // 666
	    var result = env.VM.invokePartial.call(this, partial, context, options);                                          // 667
                                                                                                                       // 668
	    if (result == null && env.compile) {                                                                              // 669
	      options.partials[options.name] = env.compile(partial, templateSpec.compilerOptions, env);                       // 670
	      result = options.partials[options.name](context, options);                                                      // 671
	    }                                                                                                                 // 672
	    if (result != null) {                                                                                             // 673
	      if (options.indent) {                                                                                           // 674
	        var lines = result.split('\n');                                                                               // 675
	        for (var i = 0, l = lines.length; i < l; i++) {                                                               // 676
	          if (!lines[i] && i + 1 === l) {                                                                             // 677
	            break;                                                                                                    // 678
	          }                                                                                                           // 679
                                                                                                                       // 680
	          lines[i] = options.indent + lines[i];                                                                       // 681
	        }                                                                                                             // 682
	        result = lines.join('\n');                                                                                    // 683
	      }                                                                                                               // 684
	      return result;                                                                                                  // 685
	    } else {                                                                                                          // 686
	      throw new _Exception2['default']('The partial ' + options.name + ' could not be compiled when running in runtime-only mode');
	    }                                                                                                                 // 688
	  }                                                                                                                   // 689
                                                                                                                       // 690
	  // Just add water                                                                                                   // 691
	  var container = {                                                                                                   // 692
	    strict: function strict(obj, name) {                                                                              // 693
	      if (!(name in obj)) {                                                                                           // 694
	        throw new _Exception2['default']('"' + name + '" not defined in ' + obj);                                     // 695
	      }                                                                                                               // 696
	      return obj[name];                                                                                               // 697
	    },                                                                                                                // 698
	    lookup: function lookup(depths, name) {                                                                           // 699
	      var len = depths.length;                                                                                        // 700
	      for (var i = 0; i < len; i++) {                                                                                 // 701
	        if (depths[i] && depths[i][name] != null) {                                                                   // 702
	          return depths[i][name];                                                                                     // 703
	        }                                                                                                             // 704
	      }                                                                                                               // 705
	    },                                                                                                                // 706
	    lambda: function lambda(current, context) {                                                                       // 707
	      return typeof current === 'function' ? current.call(context) : current;                                         // 708
	    },                                                                                                                // 709
                                                                                                                       // 710
	    escapeExpression: Utils.escapeExpression,                                                                         // 711
	    invokePartial: invokePartialWrapper,                                                                              // 712
                                                                                                                       // 713
	    fn: function fn(i) {                                                                                              // 714
	      return templateSpec[i];                                                                                         // 715
	    },                                                                                                                // 716
                                                                                                                       // 717
	    programs: [],                                                                                                     // 718
	    program: function program(i, data, declaredBlockParams, blockParams, depths) {                                    // 719
	      var programWrapper = this.programs[i],                                                                          // 720
	          fn = this.fn(i);                                                                                            // 721
	      if (data || depths || blockParams || declaredBlockParams) {                                                     // 722
	        programWrapper = wrapProgram(this, i, fn, data, declaredBlockParams, blockParams, depths);                    // 723
	      } else if (!programWrapper) {                                                                                   // 724
	        programWrapper = this.programs[i] = wrapProgram(this, i, fn);                                                 // 725
	      }                                                                                                               // 726
	      return programWrapper;                                                                                          // 727
	    },                                                                                                                // 728
                                                                                                                       // 729
	    data: function data(value, depth) {                                                                               // 730
	      while (value && depth--) {                                                                                      // 731
	        value = value._parent;                                                                                        // 732
	      }                                                                                                               // 733
	      return value;                                                                                                   // 734
	    },                                                                                                                // 735
	    merge: function merge(param, common) {                                                                            // 736
	      var obj = param || common;                                                                                      // 737
                                                                                                                       // 738
	      if (param && common && param !== common) {                                                                      // 739
	        obj = Utils.extend({}, common, param);                                                                        // 740
	      }                                                                                                               // 741
                                                                                                                       // 742
	      return obj;                                                                                                     // 743
	    },                                                                                                                // 744
                                                                                                                       // 745
	    noop: env.VM.noop,                                                                                                // 746
	    compilerInfo: templateSpec.compiler                                                                               // 747
	  };                                                                                                                  // 748
                                                                                                                       // 749
	  function ret(context) {                                                                                             // 750
	    var options = arguments[1] === undefined ? {} : arguments[1];                                                     // 751
                                                                                                                       // 752
	    var data = options.data;                                                                                          // 753
                                                                                                                       // 754
	    ret._setup(options);                                                                                              // 755
	    if (!options.partial && templateSpec.useData) {                                                                   // 756
	      data = initData(context, data);                                                                                 // 757
	    }                                                                                                                 // 758
	    var depths = undefined,                                                                                           // 759
	        blockParams = templateSpec.useBlockParams ? [] : undefined;                                                   // 760
	    if (templateSpec.useDepths) {                                                                                     // 761
	      depths = options.depths ? [context].concat(options.depths) : [context];                                         // 762
	    }                                                                                                                 // 763
                                                                                                                       // 764
	    return templateSpec.main.call(container, context, container.helpers, container.partials, data, blockParams, depths);
	  }                                                                                                                   // 766
	  ret.isTop = true;                                                                                                   // 767
                                                                                                                       // 768
	  ret._setup = function (options) {                                                                                   // 769
	    if (!options.partial) {                                                                                           // 770
	      container.helpers = container.merge(options.helpers, env.helpers);                                              // 771
                                                                                                                       // 772
	      if (templateSpec.usePartial) {                                                                                  // 773
	        container.partials = container.merge(options.partials, env.partials);                                         // 774
	      }                                                                                                               // 775
	    } else {                                                                                                          // 776
	      container.helpers = options.helpers;                                                                            // 777
	      container.partials = options.partials;                                                                          // 778
	    }                                                                                                                 // 779
	  };                                                                                                                  // 780
                                                                                                                       // 781
	  ret._child = function (i, data, blockParams, depths) {                                                              // 782
	    if (templateSpec.useBlockParams && !blockParams) {                                                                // 783
	      throw new _Exception2['default']('must pass block params');                                                     // 784
	    }                                                                                                                 // 785
	    if (templateSpec.useDepths && !depths) {                                                                          // 786
	      throw new _Exception2['default']('must pass parent depths');                                                    // 787
	    }                                                                                                                 // 788
                                                                                                                       // 789
	    return wrapProgram(container, i, templateSpec[i], data, 0, blockParams, depths);                                  // 790
	  };                                                                                                                  // 791
	  return ret;                                                                                                         // 792
	}                                                                                                                     // 793
                                                                                                                       // 794
	function wrapProgram(container, i, fn, data, declaredBlockParams, blockParams, depths) {                              // 795
	  function prog(context) {                                                                                            // 796
	    var options = arguments[1] === undefined ? {} : arguments[1];                                                     // 797
                                                                                                                       // 798
	    return fn.call(container, context, container.helpers, container.partials, options.data || data, blockParams && [options.blockParams].concat(blockParams), depths && [context].concat(depths));
	  }                                                                                                                   // 800
	  prog.program = i;                                                                                                   // 801
	  prog.depth = depths ? depths.length : 0;                                                                            // 802
	  prog.blockParams = declaredBlockParams || 0;                                                                        // 803
	  return prog;                                                                                                        // 804
	}                                                                                                                     // 805
                                                                                                                       // 806
	function resolvePartial(partial, context, options) {                                                                  // 807
	  if (!partial) {                                                                                                     // 808
	    partial = options.partials[options.name];                                                                         // 809
	  } else if (!partial.call && !options.name) {                                                                        // 810
	    // This is a dynamic partial that returned a string                                                               // 811
	    options.name = partial;                                                                                           // 812
	    partial = options.partials[partial];                                                                              // 813
	  }                                                                                                                   // 814
	  return partial;                                                                                                     // 815
	}                                                                                                                     // 816
                                                                                                                       // 817
	function invokePartial(partial, context, options) {                                                                   // 818
	  options.partial = true;                                                                                             // 819
                                                                                                                       // 820
	  if (partial === undefined) {                                                                                        // 821
	    throw new _Exception2['default']('The partial ' + options.name + ' could not be found');                          // 822
	  } else if (partial instanceof Function) {                                                                           // 823
	    return partial(context, options);                                                                                 // 824
	  }                                                                                                                   // 825
	}                                                                                                                     // 826
                                                                                                                       // 827
	function noop() {                                                                                                     // 828
	  return '';                                                                                                          // 829
	}                                                                                                                     // 830
                                                                                                                       // 831
	function initData(context, data) {                                                                                    // 832
	  if (!data || !('root' in data)) {                                                                                   // 833
	    data = data ? _COMPILER_REVISION$REVISION_CHANGES$createFrame.createFrame(data) : {};                             // 834
	    data.root = context;                                                                                              // 835
	  }                                                                                                                   // 836
	  return data;                                                                                                        // 837
	}                                                                                                                     // 838
                                                                                                                       // 839
/***/ },                                                                                                               // 840
/* 6 */                                                                                                                // 841
/***/ function(module, exports, __webpack_require__) {                                                                 // 842
                                                                                                                       // 843
	/* WEBPACK VAR INJECTION */(function(global) {'use strict';                                                           // 844
                                                                                                                       // 845
	exports.__esModule = true;                                                                                            // 846
	/*global window */                                                                                                    // 847
                                                                                                                       // 848
	exports['default'] = function (Handlebars) {                                                                          // 849
	  /* istanbul ignore next */                                                                                          // 850
	  var root = typeof global !== 'undefined' ? global : window,                                                         // 851
	      $Handlebars = root.Handlebars;                                                                                  // 852
	  /* istanbul ignore next */                                                                                          // 853
	  Handlebars.noConflict = function () {                                                                               // 854
	    if (root.Handlebars === Handlebars) {                                                                             // 855
	      root.Handlebars = $Handlebars;                                                                                  // 856
	    }                                                                                                                 // 857
	  };                                                                                                                  // 858
	};                                                                                                                    // 859
                                                                                                                       // 860
	module.exports = exports['default'];                                                                                  // 861
	/* WEBPACK VAR INJECTION */}.call(exports, (function() { return this; }())))                                          // 862
                                                                                                                       // 863
/***/ },                                                                                                               // 864
/* 7 */                                                                                                                // 865
/***/ function(module, exports, __webpack_require__) {                                                                 // 866
                                                                                                                       // 867
	"use strict";                                                                                                         // 868
                                                                                                                       // 869
	exports["default"] = function (obj) {                                                                                 // 870
	  return obj && obj.__esModule ? obj : {                                                                              // 871
	    "default": obj                                                                                                    // 872
	  };                                                                                                                  // 873
	};                                                                                                                    // 874
                                                                                                                       // 875
	exports.__esModule = true;                                                                                            // 876
                                                                                                                       // 877
/***/ }                                                                                                                // 878
/******/ ])                                                                                                            // 879
});                                                                                                                    // 880
;                                                                                                                      // 881
                                                                                                                       // 882
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/compatibility/handlebars.noconflict.js                                                     //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
// medium-editor-insert-plugin needs its own Handlebars, not Meteor's                                                  // 1
// Handlebars. Fortunately, the local one is still available before Meteor's                                           // 2
// takes over.                                                                                                         // 3
Handlebars = window.Handlebars;                                                                                        // 4
                                                                                                                       // 5
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/compatibility/bower_components/jquery-sortable/source/js/jquery-sortable.js                //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
/* ===================================================                                                                 // 1
 *  jquery-sortable.js v0.9.12                                                                                         // 2
 *  http://johnny.github.com/jquery-sortable/                                                                          // 3
 * ===================================================                                                                 // 4
 *  Copyright (c) 2012 Jonas von Andrian                                                                               // 5
 *  All rights reserved.                                                                                               // 6
 *                                                                                                                     // 7
 *  Redistribution and use in source and binary forms, with or without                                                 // 8
 *  modification, are permitted provided that the following conditions are met:                                        // 9
 *  * Redistributions of source code must retain the above copyright                                                   // 10
 *    notice, this list of conditions and the following disclaimer.                                                    // 11
 *  * Redistributions in binary form must reproduce the above copyright                                                // 12
 *    notice, this list of conditions and the following disclaimer in the                                              // 13
 *    documentation and/or other materials provided with the distribution.                                             // 14
 *  * The name of the author may not be used to endorse or promote products                                            // 15
 *    derived from this software without specific prior written permission.                                            // 16
 *                                                                                                                     // 17
 *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND                                    // 18
 *  ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED                                      // 19
 *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE                                             // 20
 *  DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> BE LIABLE FOR ANY                                                 // 21
 *  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES                                         // 22
 *  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;                                       // 23
 *  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND                                        // 24
 *  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT                                         // 25
 *  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS                                      // 26
 *  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                                                       // 27
 * ========================================================== */                                                       // 28
                                                                                                                       // 29
!function ( $, window, pluginName, undefined){                                                                         // 30
  var eventNames,                                                                                                      // 31
  containerDefaults = {                                                                                                // 32
    // If true, items can be dragged from this container                                                               // 33
    drag: true,                                                                                                        // 34
    // If true, items can be droped onto this container                                                                // 35
    drop: true,                                                                                                        // 36
    // Exclude items from being draggable, if the                                                                      // 37
    // selector matches the item                                                                                       // 38
    exclude: "",                                                                                                       // 39
    // If true, search for nested containers within an item                                                            // 40
    nested: true,                                                                                                      // 41
    // If true, the items are assumed to be arranged vertically                                                        // 42
    vertical: true                                                                                                     // 43
  }, // end container defaults                                                                                         // 44
  groupDefaults = {                                                                                                    // 45
    // This is executed after the placeholder has been moved.                                                          // 46
    // $closestItemOrContainer contains the closest item, the placeholder                                              // 47
    // has been put at or the closest empty Container, the placeholder has                                             // 48
    // been appended to.                                                                                               // 49
    afterMove: function ($placeholder, container, $closestItemOrContainer) {                                           // 50
    },                                                                                                                 // 51
    // The exact css path between the container and its items, e.g. "> tbody"                                          // 52
    containerPath: "",                                                                                                 // 53
    // The css selector of the containers                                                                              // 54
    containerSelector: "ol, ul",                                                                                       // 55
    // Distance the mouse has to travel to start dragging                                                              // 56
    distance: 0,                                                                                                       // 57
    // Time in milliseconds after mousedown until dragging should start.                                               // 58
    // This option can be used to prevent unwanted drags when clicking on an element.                                  // 59
    delay: 0,                                                                                                          // 60
    // The css selector of the drag handle                                                                             // 61
    handle: "",                                                                                                        // 62
    // The exact css path between the item and its subcontainers                                                       // 63
    itemPath: "",                                                                                                      // 64
    // The css selector of the items                                                                                   // 65
    itemSelector: "li",                                                                                                // 66
    // Check if the dragged item may be inside the container.                                                          // 67
    // Use with care, since the search for a valid container entails a depth first search                              // 68
    // and may be quite expensive.                                                                                     // 69
    isValidTarget: function ($item, container) {                                                                       // 70
      return true                                                                                                      // 71
    },                                                                                                                 // 72
    // Executed before onDrop if placeholder is detached.                                                              // 73
    // This happens if pullPlaceholder is set to false and the drop occurs outside a container.                        // 74
    onCancel: function ($item, container, _super, event) {                                                             // 75
    },                                                                                                                 // 76
    // Executed at the beginning of a mouse move event.                                                                // 77
    // The Placeholder has not been moved yet.                                                                         // 78
    onDrag: function ($item, position, _super, event) {                                                                // 79
      $item.css(position)                                                                                              // 80
    },                                                                                                                 // 81
    // Called after the drag has been started,                                                                         // 82
    // that is the mouse button is beeing held down and                                                                // 83
    // the mouse is moving.                                                                                            // 84
    // The container is the closest initialized container.                                                             // 85
    // Therefore it might not be the container, that actually contains the item.                                       // 86
    onDragStart: function ($item, container, _super, event) {                                                          // 87
      $item.css({                                                                                                      // 88
        height: $item.height(),                                                                                        // 89
        width: $item.width()                                                                                           // 90
      })                                                                                                               // 91
      $item.addClass("dragged")                                                                                        // 92
      $("body").addClass("dragging")                                                                                   // 93
    },                                                                                                                 // 94
    // Called when the mouse button is beeing released                                                                 // 95
    onDrop: function ($item, container, _super, event) {                                                               // 96
      $item.removeClass("dragged").removeAttr("style")                                                                 // 97
      $("body").removeClass("dragging")                                                                                // 98
    },                                                                                                                 // 99
    // Called on mousedown. If falsy value is returned, the dragging will not start.                                   // 100
    // If clicked on input element, ignore                                                                             // 101
    onMousedown: function ($item, _super, event) {                                                                     // 102
      if (!event.target.nodeName.match(/^(input|select)$/i)) {                                                         // 103
        event.preventDefault()                                                                                         // 104
        return true                                                                                                    // 105
      }                                                                                                                // 106
    },                                                                                                                 // 107
    // Template for the placeholder. Can be any valid jQuery input                                                     // 108
    // e.g. a string, a DOM element.                                                                                   // 109
    // The placeholder must have the class "placeholder"                                                               // 110
    placeholder: '<li class="placeholder"/>',                                                                          // 111
    // If true, the position of the placeholder is calculated on every mousemove.                                      // 112
    // If false, it is only calculated when the mouse is above a container.                                            // 113
    pullPlaceholder: true,                                                                                             // 114
    // Specifies serialization of the container group.                                                                 // 115
    // The pair $parent/$children is either container/items or item/subcontainers.                                     // 116
    serialize: function ($parent, $children, parentIsContainer) {                                                      // 117
      var result = $.extend({}, $parent.data())                                                                        // 118
                                                                                                                       // 119
      if(parentIsContainer)                                                                                            // 120
        return [$children]                                                                                             // 121
      else if ($children[0]){                                                                                          // 122
        result.children = $children                                                                                    // 123
      }                                                                                                                // 124
                                                                                                                       // 125
      delete result.subContainers                                                                                      // 126
      delete result.sortable                                                                                           // 127
                                                                                                                       // 128
      return result                                                                                                    // 129
    },                                                                                                                 // 130
    // Set tolerance while dragging. Positive values decrease sensitivity,                                             // 131
    // negative values increase it.                                                                                    // 132
    tolerance: 0                                                                                                       // 133
  }, // end group defaults                                                                                             // 134
  containerGroups = {},                                                                                                // 135
  groupCounter = 0,                                                                                                    // 136
  emptyBox = {                                                                                                         // 137
    left: 0,                                                                                                           // 138
    top: 0,                                                                                                            // 139
    bottom: 0,                                                                                                         // 140
    right:0                                                                                                            // 141
  },                                                                                                                   // 142
  eventNames = {                                                                                                       // 143
    start: "touchstart.sortable mousedown.sortable",                                                                   // 144
    drop: "touchend.sortable touchcancel.sortable mouseup.sortable",                                                   // 145
    drag: "touchmove.sortable mousemove.sortable",                                                                     // 146
    scroll: "scroll.sortable"                                                                                          // 147
  },                                                                                                                   // 148
  subContainerKey = "subContainers"                                                                                    // 149
                                                                                                                       // 150
  /*                                                                                                                   // 151
   * a is Array [left, right, top, bottom]                                                                             // 152
   * b is array [left, top]                                                                                            // 153
   */                                                                                                                  // 154
  function d(a,b) {                                                                                                    // 155
    var x = Math.max(0, a[0] - b[0], b[0] - a[1]),                                                                     // 156
    y = Math.max(0, a[2] - b[1], b[1] - a[3])                                                                          // 157
    return x+y;                                                                                                        // 158
  }                                                                                                                    // 159
                                                                                                                       // 160
  function setDimensions(array, dimensions, tolerance, useOffset) {                                                    // 161
    var i = array.length,                                                                                              // 162
    offsetMethod = useOffset ? "offset" : "position"                                                                   // 163
    tolerance = tolerance || 0                                                                                         // 164
                                                                                                                       // 165
    while(i--){                                                                                                        // 166
      var el = array[i].el ? array[i].el : $(array[i]),                                                                // 167
      // use fitting method                                                                                            // 168
      pos = el[offsetMethod]()                                                                                         // 169
      pos.left += parseInt(el.css('margin-left'), 10)                                                                  // 170
      pos.top += parseInt(el.css('margin-top'),10)                                                                     // 171
      dimensions[i] = [                                                                                                // 172
        pos.left - tolerance,                                                                                          // 173
        pos.left + el.outerWidth() + tolerance,                                                                        // 174
        pos.top - tolerance,                                                                                           // 175
        pos.top + el.outerHeight() + tolerance                                                                         // 176
      ]                                                                                                                // 177
    }                                                                                                                  // 178
  }                                                                                                                    // 179
                                                                                                                       // 180
  function getRelativePosition(pointer, element) {                                                                     // 181
    var offset = element.offset()                                                                                      // 182
    return {                                                                                                           // 183
      left: pointer.left - offset.left,                                                                                // 184
      top: pointer.top - offset.top                                                                                    // 185
    }                                                                                                                  // 186
  }                                                                                                                    // 187
                                                                                                                       // 188
  function sortByDistanceDesc(dimensions, pointer, lastPointer) {                                                      // 189
    pointer = [pointer.left, pointer.top]                                                                              // 190
    lastPointer = lastPointer && [lastPointer.left, lastPointer.top]                                                   // 191
                                                                                                                       // 192
    var dim,                                                                                                           // 193
    i = dimensions.length,                                                                                             // 194
    distances = []                                                                                                     // 195
                                                                                                                       // 196
    while(i--){                                                                                                        // 197
      dim = dimensions[i]                                                                                              // 198
      distances[i] = [i,d(dim,pointer), lastPointer && d(dim, lastPointer)]                                            // 199
    }                                                                                                                  // 200
    distances = distances.sort(function  (a,b) {                                                                       // 201
      return b[1] - a[1] || b[2] - a[2] || b[0] - a[0]                                                                 // 202
    })                                                                                                                 // 203
                                                                                                                       // 204
    // last entry is the closest                                                                                       // 205
    return distances                                                                                                   // 206
  }                                                                                                                    // 207
                                                                                                                       // 208
  function ContainerGroup(options) {                                                                                   // 209
    this.options = $.extend({}, groupDefaults, options)                                                                // 210
    this.containers = []                                                                                               // 211
                                                                                                                       // 212
    if(!this.options.rootGroup){                                                                                       // 213
      this.scrollProxy = $.proxy(this.scroll, this)                                                                    // 214
      this.dragProxy = $.proxy(this.drag, this)                                                                        // 215
      this.dropProxy = $.proxy(this.drop, this)                                                                        // 216
      this.placeholder = $(this.options.placeholder)                                                                   // 217
                                                                                                                       // 218
      if(!options.isValidTarget)                                                                                       // 219
        this.options.isValidTarget = undefined                                                                         // 220
    }                                                                                                                  // 221
  }                                                                                                                    // 222
                                                                                                                       // 223
  ContainerGroup.get = function  (options) {                                                                           // 224
    if(!containerGroups[options.group]) {                                                                              // 225
      if(options.group === undefined)                                                                                  // 226
        options.group = groupCounter ++                                                                                // 227
                                                                                                                       // 228
      containerGroups[options.group] = new ContainerGroup(options)                                                     // 229
    }                                                                                                                  // 230
                                                                                                                       // 231
    return containerGroups[options.group]                                                                              // 232
  }                                                                                                                    // 233
                                                                                                                       // 234
  ContainerGroup.prototype = {                                                                                         // 235
    dragInit: function  (e, itemContainer) {                                                                           // 236
      this.$document = $(itemContainer.el[0].ownerDocument)                                                            // 237
                                                                                                                       // 238
      // get item to drag                                                                                              // 239
      this.item = $(e.target).closest(this.options.itemSelector)                                                       // 240
      this.itemContainer = itemContainer                                                                               // 241
                                                                                                                       // 242
      if(this.item.is(this.options.exclude) ||                                                                         // 243
         !this.options.onMousedown(this.item, groupDefaults.onMousedown, e)){                                          // 244
        return                                                                                                         // 245
      }                                                                                                                // 246
                                                                                                                       // 247
      this.setPointer(e)                                                                                               // 248
      this.toggleListeners('on')                                                                                       // 249
                                                                                                                       // 250
      this.setupDelayTimer()                                                                                           // 251
      this.dragInitDone = true                                                                                         // 252
    },                                                                                                                 // 253
    drag: function  (e) {                                                                                              // 254
      if(!this.dragging){                                                                                              // 255
        if(!this.distanceMet(e) || !this.delayMet)                                                                     // 256
          return                                                                                                       // 257
                                                                                                                       // 258
        this.options.onDragStart(this.item, this.itemContainer, groupDefaults.onDragStart, e)                          // 259
        this.item.before(this.placeholder)                                                                             // 260
        this.dragging = true                                                                                           // 261
      }                                                                                                                // 262
                                                                                                                       // 263
      this.setPointer(e)                                                                                               // 264
      // place item under the cursor                                                                                   // 265
      this.options.onDrag(this.item,                                                                                   // 266
                          getRelativePosition(this.pointer, this.item.offsetParent()),                                 // 267
                          groupDefaults.onDrag,                                                                        // 268
                          e)                                                                                           // 269
                                                                                                                       // 270
      var x = e.pageX || e.originalEvent.pageX,                                                                        // 271
      y = e.pageY || e.originalEvent.pageY,                                                                            // 272
      box = this.sameResultBox,                                                                                        // 273
      t = this.options.tolerance                                                                                       // 274
                                                                                                                       // 275
      if(!box || box.top - t > y || box.bottom + t < y || box.left - t > x || box.right + t < x)                       // 276
        if(!this.searchValidTarget())                                                                                  // 277
          this.placeholder.detach()                                                                                    // 278
    },                                                                                                                 // 279
    drop: function  (e) {                                                                                              // 280
      this.toggleListeners('off')                                                                                      // 281
                                                                                                                       // 282
      this.dragInitDone = false                                                                                        // 283
                                                                                                                       // 284
      if(this.dragging){                                                                                               // 285
        // processing Drop, check if placeholder is detached                                                           // 286
        if(this.placeholder.closest("html")[0])                                                                        // 287
          this.placeholder.before(this.item).detach()                                                                  // 288
        else                                                                                                           // 289
          this.options.onCancel(this.item, this.itemContainer, groupDefaults.onCancel, e)                              // 290
                                                                                                                       // 291
        this.options.onDrop(this.item, this.getContainer(this.item), groupDefaults.onDrop, e)                          // 292
                                                                                                                       // 293
        // cleanup                                                                                                     // 294
        this.clearDimensions()                                                                                         // 295
        this.clearOffsetParent()                                                                                       // 296
        this.lastAppendedItem = this.sameResultBox = undefined                                                         // 297
        this.dragging = false                                                                                          // 298
      }                                                                                                                // 299
    },                                                                                                                 // 300
    searchValidTarget: function  (pointer, lastPointer) {                                                              // 301
      if(!pointer){                                                                                                    // 302
        pointer = this.relativePointer || this.pointer                                                                 // 303
        lastPointer = this.lastRelativePointer || this.lastPointer                                                     // 304
      }                                                                                                                // 305
                                                                                                                       // 306
      var distances = sortByDistanceDesc(this.getContainerDimensions(),                                                // 307
                                         pointer,                                                                      // 308
                                         lastPointer),                                                                 // 309
      i = distances.length                                                                                             // 310
                                                                                                                       // 311
      while(i--){                                                                                                      // 312
        var index = distances[i][0],                                                                                   // 313
        distance = distances[i][1]                                                                                     // 314
                                                                                                                       // 315
        if(!distance || this.options.pullPlaceholder){                                                                 // 316
          var container = this.containers[index]                                                                       // 317
          if(!container.disabled){                                                                                     // 318
            if(!this.$getOffsetParent()){                                                                              // 319
              var offsetParent = container.getItemOffsetParent()                                                       // 320
              pointer = getRelativePosition(pointer, offsetParent)                                                     // 321
              lastPointer = getRelativePosition(lastPointer, offsetParent)                                             // 322
            }                                                                                                          // 323
            if(container.searchValidTarget(pointer, lastPointer))                                                      // 324
              return true                                                                                              // 325
          }                                                                                                            // 326
        }                                                                                                              // 327
      }                                                                                                                // 328
      if(this.sameResultBox)                                                                                           // 329
        this.sameResultBox = undefined                                                                                 // 330
    },                                                                                                                 // 331
    movePlaceholder: function  (container, item, method, sameResultBox) {                                              // 332
      var lastAppendedItem = this.lastAppendedItem                                                                     // 333
      if(!sameResultBox && lastAppendedItem && lastAppendedItem[0] === item[0])                                        // 334
        return;                                                                                                        // 335
                                                                                                                       // 336
      item[method](this.placeholder)                                                                                   // 337
      this.lastAppendedItem = item                                                                                     // 338
      this.sameResultBox = sameResultBox                                                                               // 339
      this.options.afterMove(this.placeholder, container, item)                                                        // 340
    },                                                                                                                 // 341
    getContainerDimensions: function  () {                                                                             // 342
      if(!this.containerDimensions)                                                                                    // 343
        setDimensions(this.containers, this.containerDimensions = [], this.options.tolerance, !this.$getOffsetParent())
      return this.containerDimensions                                                                                  // 345
    },                                                                                                                 // 346
    getContainer: function  (element) {                                                                                // 347
      return element.closest(this.options.containerSelector).data(pluginName)                                          // 348
    },                                                                                                                 // 349
    $getOffsetParent: function  () {                                                                                   // 350
      if(this.offsetParent === undefined){                                                                             // 351
        var i = this.containers.length - 1,                                                                            // 352
        offsetParent = this.containers[i].getItemOffsetParent()                                                        // 353
                                                                                                                       // 354
        if(!this.options.rootGroup){                                                                                   // 355
          while(i--){                                                                                                  // 356
            if(offsetParent[0] != this.containers[i].getItemOffsetParent()[0]){                                        // 357
              // If every container has the same offset parent,                                                        // 358
              // use position() which is relative to this parent,                                                      // 359
              // otherwise use offset()                                                                                // 360
              // compare #setDimensions                                                                                // 361
              offsetParent = false                                                                                     // 362
              break;                                                                                                   // 363
            }                                                                                                          // 364
          }                                                                                                            // 365
        }                                                                                                              // 366
                                                                                                                       // 367
        this.offsetParent = offsetParent                                                                               // 368
      }                                                                                                                // 369
      return this.offsetParent                                                                                         // 370
    },                                                                                                                 // 371
    setPointer: function (e) {                                                                                         // 372
      var pointer = this.getPointer(e)                                                                                 // 373
                                                                                                                       // 374
      if(this.$getOffsetParent()){                                                                                     // 375
        var relativePointer = getRelativePosition(pointer, this.$getOffsetParent())                                    // 376
        this.lastRelativePointer = this.relativePointer                                                                // 377
        this.relativePointer = relativePointer                                                                         // 378
      }                                                                                                                // 379
                                                                                                                       // 380
      this.lastPointer = this.pointer                                                                                  // 381
      this.pointer = pointer                                                                                           // 382
    },                                                                                                                 // 383
    distanceMet: function (e) {                                                                                        // 384
      var currentPointer = this.getPointer(e)                                                                          // 385
      return (Math.max(                                                                                                // 386
        Math.abs(this.pointer.left - currentPointer.left),                                                             // 387
        Math.abs(this.pointer.top - currentPointer.top)                                                                // 388
      ) >= this.options.distance)                                                                                      // 389
    },                                                                                                                 // 390
    getPointer: function(e) {                                                                                          // 391
      return {                                                                                                         // 392
        left: e.pageX || e.originalEvent.pageX,                                                                        // 393
        top: e.pageY || e.originalEvent.pageY                                                                          // 394
      }                                                                                                                // 395
    },                                                                                                                 // 396
    setupDelayTimer: function () {                                                                                     // 397
      var that = this                                                                                                  // 398
      this.delayMet = !this.options.delay                                                                              // 399
                                                                                                                       // 400
      // init delay timer if needed                                                                                    // 401
      if (!this.delayMet) {                                                                                            // 402
        clearTimeout(this._mouseDelayTimer);                                                                           // 403
        this._mouseDelayTimer = setTimeout(function() {                                                                // 404
          that.delayMet = true                                                                                         // 405
        }, this.options.delay)                                                                                         // 406
      }                                                                                                                // 407
    },                                                                                                                 // 408
    scroll: function  (e) {                                                                                            // 409
      this.clearDimensions()                                                                                           // 410
      this.clearOffsetParent() // TODO is this needed?                                                                 // 411
    },                                                                                                                 // 412
    toggleListeners: function (method) {                                                                               // 413
      var that = this,                                                                                                 // 414
      events = ['drag','drop','scroll']                                                                                // 415
                                                                                                                       // 416
      $.each(events,function  (i,event) {                                                                              // 417
        that.$document[method](eventNames[event], that[event + 'Proxy'])                                               // 418
      })                                                                                                               // 419
    },                                                                                                                 // 420
    clearOffsetParent: function () {                                                                                   // 421
      this.offsetParent = undefined                                                                                    // 422
    },                                                                                                                 // 423
    // Recursively clear container and item dimensions                                                                 // 424
    clearDimensions: function  () {                                                                                    // 425
      this.traverse(function(object){                                                                                  // 426
        object._clearDimensions()                                                                                      // 427
      })                                                                                                               // 428
    },                                                                                                                 // 429
    traverse: function(callback) {                                                                                     // 430
      callback(this)                                                                                                   // 431
      var i = this.containers.length                                                                                   // 432
      while(i--){                                                                                                      // 433
        this.containers[i].traverse(callback)                                                                          // 434
      }                                                                                                                // 435
    },                                                                                                                 // 436
    _clearDimensions: function(){                                                                                      // 437
      this.containerDimensions = undefined                                                                             // 438
    },                                                                                                                 // 439
    _destroy: function () {                                                                                            // 440
      containerGroups[this.options.group] = undefined                                                                  // 441
    }                                                                                                                  // 442
  }                                                                                                                    // 443
                                                                                                                       // 444
  function Container(element, options) {                                                                               // 445
    this.el = element                                                                                                  // 446
    this.options = $.extend( {}, containerDefaults, options)                                                           // 447
                                                                                                                       // 448
    this.group = ContainerGroup.get(this.options)                                                                      // 449
    this.rootGroup = this.options.rootGroup || this.group                                                              // 450
    this.handle = this.rootGroup.options.handle || this.rootGroup.options.itemSelector                                 // 451
                                                                                                                       // 452
    var itemPath = this.rootGroup.options.itemPath                                                                     // 453
    this.target = itemPath ? this.el.find(itemPath) : this.el                                                          // 454
                                                                                                                       // 455
    this.target.on(eventNames.start, this.handle, $.proxy(this.dragInit, this))                                        // 456
                                                                                                                       // 457
    if(this.options.drop)                                                                                              // 458
      this.group.containers.push(this)                                                                                 // 459
  }                                                                                                                    // 460
                                                                                                                       // 461
  Container.prototype = {                                                                                              // 462
    dragInit: function  (e) {                                                                                          // 463
      var rootGroup = this.rootGroup                                                                                   // 464
                                                                                                                       // 465
      if( !this.disabled &&                                                                                            // 466
          !rootGroup.dragInitDone &&                                                                                   // 467
          this.options.drag &&                                                                                         // 468
          this.isValidDrag(e)) {                                                                                       // 469
        rootGroup.dragInit(e, this)                                                                                    // 470
      }                                                                                                                // 471
    },                                                                                                                 // 472
    isValidDrag: function(e) {                                                                                         // 473
      return e.which == 1 ||                                                                                           // 474
        e.type == "touchstart" && e.originalEvent.touches.length == 1                                                  // 475
    },                                                                                                                 // 476
    searchValidTarget: function  (pointer, lastPointer) {                                                              // 477
      var distances = sortByDistanceDesc(this.getItemDimensions(),                                                     // 478
                                         pointer,                                                                      // 479
                                         lastPointer),                                                                 // 480
      i = distances.length,                                                                                            // 481
      rootGroup = this.rootGroup,                                                                                      // 482
      validTarget = !rootGroup.options.isValidTarget ||                                                                // 483
        rootGroup.options.isValidTarget(rootGroup.item, this)                                                          // 484
                                                                                                                       // 485
      if(!i && validTarget){                                                                                           // 486
        rootGroup.movePlaceholder(this, this.target, "append")                                                         // 487
        return true                                                                                                    // 488
      } else                                                                                                           // 489
        while(i--){                                                                                                    // 490
          var index = distances[i][0],                                                                                 // 491
          distance = distances[i][1]                                                                                   // 492
          if(!distance && this.hasChildGroup(index)){                                                                  // 493
            var found = this.getContainerGroup(index).searchValidTarget(pointer, lastPointer)                          // 494
            if(found)                                                                                                  // 495
              return true                                                                                              // 496
          }                                                                                                            // 497
          else if(validTarget){                                                                                        // 498
            this.movePlaceholder(index, pointer)                                                                       // 499
            return true                                                                                                // 500
          }                                                                                                            // 501
        }                                                                                                              // 502
    },                                                                                                                 // 503
    movePlaceholder: function  (index, pointer) {                                                                      // 504
      var item = $(this.items[index]),                                                                                 // 505
      dim = this.itemDimensions[index],                                                                                // 506
      method = "after",                                                                                                // 507
      width = item.outerWidth(),                                                                                       // 508
      height = item.outerHeight(),                                                                                     // 509
      offset = item.offset(),                                                                                          // 510
      sameResultBox = {                                                                                                // 511
        left: offset.left,                                                                                             // 512
        right: offset.left + width,                                                                                    // 513
        top: offset.top,                                                                                               // 514
        bottom: offset.top + height                                                                                    // 515
      }                                                                                                                // 516
      if(this.options.vertical){                                                                                       // 517
        var yCenter = (dim[2] + dim[3]) / 2,                                                                           // 518
        inUpperHalf = pointer.top <= yCenter                                                                           // 519
        if(inUpperHalf){                                                                                               // 520
          method = "before"                                                                                            // 521
          sameResultBox.bottom -= height / 2                                                                           // 522
        } else                                                                                                         // 523
          sameResultBox.top += height / 2                                                                              // 524
      } else {                                                                                                         // 525
        var xCenter = (dim[0] + dim[1]) / 2,                                                                           // 526
        inLeftHalf = pointer.left <= xCenter                                                                           // 527
        if(inLeftHalf){                                                                                                // 528
          method = "before"                                                                                            // 529
          sameResultBox.right -= width / 2                                                                             // 530
        } else                                                                                                         // 531
          sameResultBox.left += width / 2                                                                              // 532
      }                                                                                                                // 533
      if(this.hasChildGroup(index))                                                                                    // 534
        sameResultBox = emptyBox                                                                                       // 535
      this.rootGroup.movePlaceholder(this, item, method, sameResultBox)                                                // 536
    },                                                                                                                 // 537
    getItemDimensions: function  () {                                                                                  // 538
      if(!this.itemDimensions){                                                                                        // 539
        this.items = this.$getChildren(this.el, "item").filter(":not(.placeholder, .dragged)").get()                   // 540
        setDimensions(this.items, this.itemDimensions = [], this.options.tolerance)                                    // 541
      }                                                                                                                // 542
      return this.itemDimensions                                                                                       // 543
    },                                                                                                                 // 544
    getItemOffsetParent: function  () {                                                                                // 545
      var offsetParent,                                                                                                // 546
      el = this.el                                                                                                     // 547
      // Since el might be empty we have to check el itself and                                                        // 548
      // can not do something like el.children().first().offsetParent()                                                // 549
      if(el.css("position") === "relative" || el.css("position") === "absolute"  || el.css("position") === "fixed")    // 550
        offsetParent = el                                                                                              // 551
      else                                                                                                             // 552
        offsetParent = el.offsetParent()                                                                               // 553
      return offsetParent                                                                                              // 554
    },                                                                                                                 // 555
    hasChildGroup: function (index) {                                                                                  // 556
      return this.options.nested && this.getContainerGroup(index)                                                      // 557
    },                                                                                                                 // 558
    getContainerGroup: function  (index) {                                                                             // 559
      var childGroup = $.data(this.items[index], subContainerKey)                                                      // 560
      if( childGroup === undefined){                                                                                   // 561
        var childContainers = this.$getChildren(this.items[index], "container")                                        // 562
        childGroup = false                                                                                             // 563
                                                                                                                       // 564
        if(childContainers[0]){                                                                                        // 565
          var options = $.extend({}, this.options, {                                                                   // 566
            rootGroup: this.rootGroup,                                                                                 // 567
            group: groupCounter ++                                                                                     // 568
          })                                                                                                           // 569
          childGroup = childContainers[pluginName](options).data(pluginName).group                                     // 570
        }                                                                                                              // 571
        $.data(this.items[index], subContainerKey, childGroup)                                                         // 572
      }                                                                                                                // 573
      return childGroup                                                                                                // 574
    },                                                                                                                 // 575
    $getChildren: function (parent, type) {                                                                            // 576
      var options = this.rootGroup.options,                                                                            // 577
      path = options[type + "Path"],                                                                                   // 578
      selector = options[type + "Selector"]                                                                            // 579
                                                                                                                       // 580
      parent = $(parent)                                                                                               // 581
      if(path)                                                                                                         // 582
        parent = parent.find(path)                                                                                     // 583
                                                                                                                       // 584
      return parent.children(selector)                                                                                 // 585
    },                                                                                                                 // 586
    _serialize: function (parent, isContainer) {                                                                       // 587
      var that = this,                                                                                                 // 588
      childType = isContainer ? "item" : "container",                                                                  // 589
                                                                                                                       // 590
      children = this.$getChildren(parent, childType).not(this.options.exclude).map(function () {                      // 591
        return that._serialize($(this), !isContainer)                                                                  // 592
      }).get()                                                                                                         // 593
                                                                                                                       // 594
      return this.rootGroup.options.serialize(parent, children, isContainer)                                           // 595
    },                                                                                                                 // 596
    traverse: function(callback) {                                                                                     // 597
      $.each(this.items || [], function(item){                                                                         // 598
        var group = $.data(this, subContainerKey)                                                                      // 599
        if(group)                                                                                                      // 600
          group.traverse(callback)                                                                                     // 601
      });                                                                                                              // 602
                                                                                                                       // 603
      callback(this)                                                                                                   // 604
    },                                                                                                                 // 605
    _clearDimensions: function  () {                                                                                   // 606
      this.itemDimensions = undefined                                                                                  // 607
    },                                                                                                                 // 608
    _destroy: function() {                                                                                             // 609
      var that = this;                                                                                                 // 610
                                                                                                                       // 611
      this.target.off(eventNames.start, this.handle);                                                                  // 612
      this.el.removeData(pluginName)                                                                                   // 613
                                                                                                                       // 614
      if(this.options.drop)                                                                                            // 615
        this.group.containers = $.grep(this.group.containers, function(val){                                           // 616
          return val != that                                                                                           // 617
        })                                                                                                             // 618
                                                                                                                       // 619
      $.each(this.items || [], function(){                                                                             // 620
        $.removeData(this, subContainerKey)                                                                            // 621
      })                                                                                                               // 622
    }                                                                                                                  // 623
  }                                                                                                                    // 624
                                                                                                                       // 625
  var API = {                                                                                                          // 626
    enable: function() {                                                                                               // 627
      this.traverse(function(object){                                                                                  // 628
        object.disabled = false                                                                                        // 629
      })                                                                                                               // 630
    },                                                                                                                 // 631
    disable: function (){                                                                                              // 632
      this.traverse(function(object){                                                                                  // 633
        object.disabled = true                                                                                         // 634
      })                                                                                                               // 635
    },                                                                                                                 // 636
    serialize: function () {                                                                                           // 637
      return this._serialize(this.el, true)                                                                            // 638
    },                                                                                                                 // 639
    refresh: function() {                                                                                              // 640
      this.traverse(function(object){                                                                                  // 641
        object._clearDimensions()                                                                                      // 642
      })                                                                                                               // 643
    },                                                                                                                 // 644
    destroy: function () {                                                                                             // 645
      this.traverse(function(object){                                                                                  // 646
        object._destroy();                                                                                             // 647
      })                                                                                                               // 648
    }                                                                                                                  // 649
  }                                                                                                                    // 650
                                                                                                                       // 651
  $.extend(Container.prototype, API)                                                                                   // 652
                                                                                                                       // 653
  /**                                                                                                                  // 654
   * jQuery API                                                                                                        // 655
   *                                                                                                                   // 656
   * Parameters are                                                                                                    // 657
   *   either options on init                                                                                          // 658
   *   or a method name followed by arguments to pass to the method                                                    // 659
   */                                                                                                                  // 660
  $.fn[pluginName] = function(methodOrOptions) {                                                                       // 661
    var args = Array.prototype.slice.call(arguments, 1)                                                                // 662
                                                                                                                       // 663
    return this.map(function(){                                                                                        // 664
      var $t = $(this),                                                                                                // 665
      object = $t.data(pluginName)                                                                                     // 666
                                                                                                                       // 667
      if(object && API[methodOrOptions])                                                                               // 668
        return API[methodOrOptions].apply(object, args) || this                                                        // 669
      else if(!object && (methodOrOptions === undefined ||                                                             // 670
                          typeof methodOrOptions === "object"))                                                        // 671
        $t.data(pluginName, new Container($t, methodOrOptions))                                                        // 672
                                                                                                                       // 673
      return this                                                                                                      // 674
    });                                                                                                                // 675
  };                                                                                                                   // 676
                                                                                                                       // 677
}(jQuery, window, 'sortable');                                                                                         // 678
                                                                                                                       // 679
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/compatibility/bower_components/blueimp-file-upload/js/vendor/jquery.ui.widget.js           //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
/*! jQuery UI - v1.11.1+CommonJS - 2014-09-17                                                                          // 1
* http://jqueryui.com                                                                                                  // 2
* Includes: widget.js                                                                                                  // 3
* Copyright 2014 jQuery Foundation and other contributors; Licensed MIT */                                             // 4
                                                                                                                       // 5
(function( factory ) {                                                                                                 // 6
	if ( typeof define === "function" && define.amd ) {                                                                   // 7
                                                                                                                       // 8
		// AMD. Register as an anonymous module.                                                                             // 9
		define([ "jquery" ], factory );                                                                                      // 10
                                                                                                                       // 11
	} else if (typeof exports === "object") {                                                                             // 12
		// Node/CommonJS:                                                                                                    // 13
		factory(require("jquery"));                                                                                          // 14
                                                                                                                       // 15
	} else {                                                                                                              // 16
                                                                                                                       // 17
		// Browser globals                                                                                                   // 18
		factory( jQuery );                                                                                                   // 19
	}                                                                                                                     // 20
}(function( $ ) {                                                                                                      // 21
/*!                                                                                                                    // 22
 * jQuery UI Widget 1.11.1                                                                                             // 23
 * http://jqueryui.com                                                                                                 // 24
 *                                                                                                                     // 25
 * Copyright 2014 jQuery Foundation and other contributors                                                             // 26
 * Released under the MIT license.                                                                                     // 27
 * http://jquery.org/license                                                                                           // 28
 *                                                                                                                     // 29
 * http://api.jqueryui.com/jQuery.widget/                                                                              // 30
 */                                                                                                                    // 31
                                                                                                                       // 32
                                                                                                                       // 33
var widget_uuid = 0,                                                                                                   // 34
	widget_slice = Array.prototype.slice;                                                                                 // 35
                                                                                                                       // 36
$.cleanData = (function( orig ) {                                                                                      // 37
	return function( elems ) {                                                                                            // 38
		var events, elem, i;                                                                                                 // 39
		for ( i = 0; (elem = elems[i]) != null; i++ ) {                                                                      // 40
			try {                                                                                                               // 41
                                                                                                                       // 42
				// Only trigger remove when necessary to save time                                                                 // 43
				events = $._data( elem, "events" );                                                                                // 44
				if ( events && events.remove ) {                                                                                   // 45
					$( elem ).triggerHandler( "remove" );                                                                             // 46
				}                                                                                                                  // 47
                                                                                                                       // 48
			// http://bugs.jquery.com/ticket/8235                                                                               // 49
			} catch( e ) {}                                                                                                     // 50
		}                                                                                                                    // 51
		orig( elems );                                                                                                       // 52
	};                                                                                                                    // 53
})( $.cleanData );                                                                                                     // 54
                                                                                                                       // 55
$.widget = function( name, base, prototype ) {                                                                         // 56
	var fullName, existingConstructor, constructor, basePrototype,                                                        // 57
		// proxiedPrototype allows the provided prototype to remain unmodified                                               // 58
		// so that it can be used as a mixin for multiple widgets (#8876)                                                    // 59
		proxiedPrototype = {},                                                                                               // 60
		namespace = name.split( "." )[ 0 ];                                                                                  // 61
                                                                                                                       // 62
	name = name.split( "." )[ 1 ];                                                                                        // 63
	fullName = namespace + "-" + name;                                                                                    // 64
                                                                                                                       // 65
	if ( !prototype ) {                                                                                                   // 66
		prototype = base;                                                                                                    // 67
		base = $.Widget;                                                                                                     // 68
	}                                                                                                                     // 69
                                                                                                                       // 70
	// create selector for plugin                                                                                         // 71
	$.expr[ ":" ][ fullName.toLowerCase() ] = function( elem ) {                                                          // 72
		return !!$.data( elem, fullName );                                                                                   // 73
	};                                                                                                                    // 74
                                                                                                                       // 75
	$[ namespace ] = $[ namespace ] || {};                                                                                // 76
	existingConstructor = $[ namespace ][ name ];                                                                         // 77
	constructor = $[ namespace ][ name ] = function( options, element ) {                                                 // 78
		// allow instantiation without "new" keyword                                                                         // 79
		if ( !this._createWidget ) {                                                                                         // 80
			return new constructor( options, element );                                                                         // 81
		}                                                                                                                    // 82
                                                                                                                       // 83
		// allow instantiation without initializing for simple inheritance                                                   // 84
		// must use "new" keyword (the code above always passes args)                                                        // 85
		if ( arguments.length ) {                                                                                            // 86
			this._createWidget( options, element );                                                                             // 87
		}                                                                                                                    // 88
	};                                                                                                                    // 89
	// extend with the existing constructor to carry over any static properties                                           // 90
	$.extend( constructor, existingConstructor, {                                                                         // 91
		version: prototype.version,                                                                                          // 92
		// copy the object used to create the prototype in case we need to                                                   // 93
		// redefine the widget later                                                                                         // 94
		_proto: $.extend( {}, prototype ),                                                                                   // 95
		// track widgets that inherit from this widget in case this widget is                                                // 96
		// redefined after a widget inherits from it                                                                         // 97
		_childConstructors: []                                                                                               // 98
	});                                                                                                                   // 99
                                                                                                                       // 100
	basePrototype = new base();                                                                                           // 101
	// we need to make the options hash a property directly on the new instance                                           // 102
	// otherwise we'll modify the options hash on the prototype that we're                                                // 103
	// inheriting from                                                                                                    // 104
	basePrototype.options = $.widget.extend( {}, basePrototype.options );                                                 // 105
	$.each( prototype, function( prop, value ) {                                                                          // 106
		if ( !$.isFunction( value ) ) {                                                                                      // 107
			proxiedPrototype[ prop ] = value;                                                                                   // 108
			return;                                                                                                             // 109
		}                                                                                                                    // 110
		proxiedPrototype[ prop ] = (function() {                                                                             // 111
			var _super = function() {                                                                                           // 112
					return base.prototype[ prop ].apply( this, arguments );                                                           // 113
				},                                                                                                                 // 114
				_superApply = function( args ) {                                                                                   // 115
					return base.prototype[ prop ].apply( this, args );                                                                // 116
				};                                                                                                                 // 117
			return function() {                                                                                                 // 118
				var __super = this._super,                                                                                         // 119
					__superApply = this._superApply,                                                                                  // 120
					returnValue;                                                                                                      // 121
                                                                                                                       // 122
				this._super = _super;                                                                                              // 123
				this._superApply = _superApply;                                                                                    // 124
                                                                                                                       // 125
				returnValue = value.apply( this, arguments );                                                                      // 126
                                                                                                                       // 127
				this._super = __super;                                                                                             // 128
				this._superApply = __superApply;                                                                                   // 129
                                                                                                                       // 130
				return returnValue;                                                                                                // 131
			};                                                                                                                  // 132
		})();                                                                                                                // 133
	});                                                                                                                   // 134
	constructor.prototype = $.widget.extend( basePrototype, {                                                             // 135
		// TODO: remove support for widgetEventPrefix                                                                        // 136
		// always use the name + a colon as the prefix, e.g., draggable:start                                                // 137
		// don't prefix for widgets that aren't DOM-based                                                                    // 138
		widgetEventPrefix: existingConstructor ? (basePrototype.widgetEventPrefix || name) : name                            // 139
	}, proxiedPrototype, {                                                                                                // 140
		constructor: constructor,                                                                                            // 141
		namespace: namespace,                                                                                                // 142
		widgetName: name,                                                                                                    // 143
		widgetFullName: fullName                                                                                             // 144
	});                                                                                                                   // 145
                                                                                                                       // 146
	// If this widget is being redefined then we need to find all widgets that                                            // 147
	// are inheriting from it and redefine all of them so that they inherit from                                          // 148
	// the new version of this widget. We're essentially trying to replace one                                            // 149
	// level in the prototype chain.                                                                                      // 150
	if ( existingConstructor ) {                                                                                          // 151
		$.each( existingConstructor._childConstructors, function( i, child ) {                                               // 152
			var childPrototype = child.prototype;                                                                               // 153
                                                                                                                       // 154
			// redefine the child widget using the same prototype that was                                                      // 155
			// originally used, but inherit from the new version of the base                                                    // 156
			$.widget( childPrototype.namespace + "." + childPrototype.widgetName, constructor, child._proto );                  // 157
		});                                                                                                                  // 158
		// remove the list of existing child constructors from the old constructor                                           // 159
		// so the old child constructors can be garbage collected                                                            // 160
		delete existingConstructor._childConstructors;                                                                       // 161
	} else {                                                                                                              // 162
		base._childConstructors.push( constructor );                                                                         // 163
	}                                                                                                                     // 164
                                                                                                                       // 165
	$.widget.bridge( name, constructor );                                                                                 // 166
                                                                                                                       // 167
	return constructor;                                                                                                   // 168
};                                                                                                                     // 169
                                                                                                                       // 170
$.widget.extend = function( target ) {                                                                                 // 171
	var input = widget_slice.call( arguments, 1 ),                                                                        // 172
		inputIndex = 0,                                                                                                      // 173
		inputLength = input.length,                                                                                          // 174
		key,                                                                                                                 // 175
		value;                                                                                                               // 176
	for ( ; inputIndex < inputLength; inputIndex++ ) {                                                                    // 177
		for ( key in input[ inputIndex ] ) {                                                                                 // 178
			value = input[ inputIndex ][ key ];                                                                                 // 179
			if ( input[ inputIndex ].hasOwnProperty( key ) && value !== undefined ) {                                           // 180
				// Clone objects                                                                                                   // 181
				if ( $.isPlainObject( value ) ) {                                                                                  // 182
					target[ key ] = $.isPlainObject( target[ key ] ) ?                                                                // 183
						$.widget.extend( {}, target[ key ], value ) :                                                                    // 184
						// Don't extend strings, arrays, etc. with objects                                                               // 185
						$.widget.extend( {}, value );                                                                                    // 186
				// Copy everything else by reference                                                                               // 187
				} else {                                                                                                           // 188
					target[ key ] = value;                                                                                            // 189
				}                                                                                                                  // 190
			}                                                                                                                   // 191
		}                                                                                                                    // 192
	}                                                                                                                     // 193
	return target;                                                                                                        // 194
};                                                                                                                     // 195
                                                                                                                       // 196
$.widget.bridge = function( name, object ) {                                                                           // 197
	var fullName = object.prototype.widgetFullName || name;                                                               // 198
	$.fn[ name ] = function( options ) {                                                                                  // 199
		var isMethodCall = typeof options === "string",                                                                      // 200
			args = widget_slice.call( arguments, 1 ),                                                                           // 201
			returnValue = this;                                                                                                 // 202
                                                                                                                       // 203
		// allow multiple hashes to be passed on init                                                                        // 204
		options = !isMethodCall && args.length ?                                                                             // 205
			$.widget.extend.apply( null, [ options ].concat(args) ) :                                                           // 206
			options;                                                                                                            // 207
                                                                                                                       // 208
		if ( isMethodCall ) {                                                                                                // 209
			this.each(function() {                                                                                              // 210
				var methodValue,                                                                                                   // 211
					instance = $.data( this, fullName );                                                                              // 212
				if ( options === "instance" ) {                                                                                    // 213
					returnValue = instance;                                                                                           // 214
					return false;                                                                                                     // 215
				}                                                                                                                  // 216
				if ( !instance ) {                                                                                                 // 217
					return $.error( "cannot call methods on " + name + " prior to initialization; " +                                 // 218
						"attempted to call method '" + options + "'" );                                                                  // 219
				}                                                                                                                  // 220
				if ( !$.isFunction( instance[options] ) || options.charAt( 0 ) === "_" ) {                                         // 221
					return $.error( "no such method '" + options + "' for " + name + " widget instance" );                            // 222
				}                                                                                                                  // 223
				methodValue = instance[ options ].apply( instance, args );                                                         // 224
				if ( methodValue !== instance && methodValue !== undefined ) {                                                     // 225
					returnValue = methodValue && methodValue.jquery ?                                                                 // 226
						returnValue.pushStack( methodValue.get() ) :                                                                     // 227
						methodValue;                                                                                                     // 228
					return false;                                                                                                     // 229
				}                                                                                                                  // 230
			});                                                                                                                 // 231
		} else {                                                                                                             // 232
			this.each(function() {                                                                                              // 233
				var instance = $.data( this, fullName );                                                                           // 234
				if ( instance ) {                                                                                                  // 235
					instance.option( options || {} );                                                                                 // 236
					if ( instance._init ) {                                                                                           // 237
						instance._init();                                                                                                // 238
					}                                                                                                                 // 239
				} else {                                                                                                           // 240
					$.data( this, fullName, new object( options, this ) );                                                            // 241
				}                                                                                                                  // 242
			});                                                                                                                 // 243
		}                                                                                                                    // 244
                                                                                                                       // 245
		return returnValue;                                                                                                  // 246
	};                                                                                                                    // 247
};                                                                                                                     // 248
                                                                                                                       // 249
$.Widget = function( /* options, element */ ) {};                                                                      // 250
$.Widget._childConstructors = [];                                                                                      // 251
                                                                                                                       // 252
$.Widget.prototype = {                                                                                                 // 253
	widgetName: "widget",                                                                                                 // 254
	widgetEventPrefix: "",                                                                                                // 255
	defaultElement: "<div>",                                                                                              // 256
	options: {                                                                                                            // 257
		disabled: false,                                                                                                     // 258
                                                                                                                       // 259
		// callbacks                                                                                                         // 260
		create: null                                                                                                         // 261
	},                                                                                                                    // 262
	_createWidget: function( options, element ) {                                                                         // 263
		element = $( element || this.defaultElement || this )[ 0 ];                                                          // 264
		this.element = $( element );                                                                                         // 265
		this.uuid = widget_uuid++;                                                                                           // 266
		this.eventNamespace = "." + this.widgetName + this.uuid;                                                             // 267
		this.options = $.widget.extend( {},                                                                                  // 268
			this.options,                                                                                                       // 269
			this._getCreateOptions(),                                                                                           // 270
			options );                                                                                                          // 271
                                                                                                                       // 272
		this.bindings = $();                                                                                                 // 273
		this.hoverable = $();                                                                                                // 274
		this.focusable = $();                                                                                                // 275
                                                                                                                       // 276
		if ( element !== this ) {                                                                                            // 277
			$.data( element, this.widgetFullName, this );                                                                       // 278
			this._on( true, this.element, {                                                                                     // 279
				remove: function( event ) {                                                                                        // 280
					if ( event.target === element ) {                                                                                 // 281
						this.destroy();                                                                                                  // 282
					}                                                                                                                 // 283
				}                                                                                                                  // 284
			});                                                                                                                 // 285
			this.document = $( element.style ?                                                                                  // 286
				// element within the document                                                                                     // 287
				element.ownerDocument :                                                                                            // 288
				// element is window or document                                                                                   // 289
				element.document || element );                                                                                     // 290
			this.window = $( this.document[0].defaultView || this.document[0].parentWindow );                                   // 291
		}                                                                                                                    // 292
                                                                                                                       // 293
		this._create();                                                                                                      // 294
		this._trigger( "create", null, this._getCreateEventData() );                                                         // 295
		this._init();                                                                                                        // 296
	},                                                                                                                    // 297
	_getCreateOptions: $.noop,                                                                                            // 298
	_getCreateEventData: $.noop,                                                                                          // 299
	_create: $.noop,                                                                                                      // 300
	_init: $.noop,                                                                                                        // 301
                                                                                                                       // 302
	destroy: function() {                                                                                                 // 303
		this._destroy();                                                                                                     // 304
		// we can probably remove the unbind calls in 2.0                                                                    // 305
		// all event bindings should go through this._on()                                                                   // 306
		this.element                                                                                                         // 307
			.unbind( this.eventNamespace )                                                                                      // 308
			.removeData( this.widgetFullName )                                                                                  // 309
			// support: jquery <1.6.3                                                                                           // 310
			// http://bugs.jquery.com/ticket/9413                                                                               // 311
			.removeData( $.camelCase( this.widgetFullName ) );                                                                  // 312
		this.widget()                                                                                                        // 313
			.unbind( this.eventNamespace )                                                                                      // 314
			.removeAttr( "aria-disabled" )                                                                                      // 315
			.removeClass(                                                                                                       // 316
				this.widgetFullName + "-disabled " +                                                                               // 317
				"ui-state-disabled" );                                                                                             // 318
                                                                                                                       // 319
		// clean up events and states                                                                                        // 320
		this.bindings.unbind( this.eventNamespace );                                                                         // 321
		this.hoverable.removeClass( "ui-state-hover" );                                                                      // 322
		this.focusable.removeClass( "ui-state-focus" );                                                                      // 323
	},                                                                                                                    // 324
	_destroy: $.noop,                                                                                                     // 325
                                                                                                                       // 326
	widget: function() {                                                                                                  // 327
		return this.element;                                                                                                 // 328
	},                                                                                                                    // 329
                                                                                                                       // 330
	option: function( key, value ) {                                                                                      // 331
		var options = key,                                                                                                   // 332
			parts,                                                                                                              // 333
			curOption,                                                                                                          // 334
			i;                                                                                                                  // 335
                                                                                                                       // 336
		if ( arguments.length === 0 ) {                                                                                      // 337
			// don't return a reference to the internal hash                                                                    // 338
			return $.widget.extend( {}, this.options );                                                                         // 339
		}                                                                                                                    // 340
                                                                                                                       // 341
		if ( typeof key === "string" ) {                                                                                     // 342
			// handle nested keys, e.g., "foo.bar" => { foo: { bar: ___ } }                                                     // 343
			options = {};                                                                                                       // 344
			parts = key.split( "." );                                                                                           // 345
			key = parts.shift();                                                                                                // 346
			if ( parts.length ) {                                                                                               // 347
				curOption = options[ key ] = $.widget.extend( {}, this.options[ key ] );                                           // 348
				for ( i = 0; i < parts.length - 1; i++ ) {                                                                         // 349
					curOption[ parts[ i ] ] = curOption[ parts[ i ] ] || {};                                                          // 350
					curOption = curOption[ parts[ i ] ];                                                                              // 351
				}                                                                                                                  // 352
				key = parts.pop();                                                                                                 // 353
				if ( arguments.length === 1 ) {                                                                                    // 354
					return curOption[ key ] === undefined ? null : curOption[ key ];                                                  // 355
				}                                                                                                                  // 356
				curOption[ key ] = value;                                                                                          // 357
			} else {                                                                                                            // 358
				if ( arguments.length === 1 ) {                                                                                    // 359
					return this.options[ key ] === undefined ? null : this.options[ key ];                                            // 360
				}                                                                                                                  // 361
				options[ key ] = value;                                                                                            // 362
			}                                                                                                                   // 363
		}                                                                                                                    // 364
                                                                                                                       // 365
		this._setOptions( options );                                                                                         // 366
                                                                                                                       // 367
		return this;                                                                                                         // 368
	},                                                                                                                    // 369
	_setOptions: function( options ) {                                                                                    // 370
		var key;                                                                                                             // 371
                                                                                                                       // 372
		for ( key in options ) {                                                                                             // 373
			this._setOption( key, options[ key ] );                                                                             // 374
		}                                                                                                                    // 375
                                                                                                                       // 376
		return this;                                                                                                         // 377
	},                                                                                                                    // 378
	_setOption: function( key, value ) {                                                                                  // 379
		this.options[ key ] = value;                                                                                         // 380
                                                                                                                       // 381
		if ( key === "disabled" ) {                                                                                          // 382
			this.widget()                                                                                                       // 383
				.toggleClass( this.widgetFullName + "-disabled", !!value );                                                        // 384
                                                                                                                       // 385
			// If the widget is becoming disabled, then nothing is interactive                                                  // 386
			if ( value ) {                                                                                                      // 387
				this.hoverable.removeClass( "ui-state-hover" );                                                                    // 388
				this.focusable.removeClass( "ui-state-focus" );                                                                    // 389
			}                                                                                                                   // 390
		}                                                                                                                    // 391
                                                                                                                       // 392
		return this;                                                                                                         // 393
	},                                                                                                                    // 394
                                                                                                                       // 395
	enable: function() {                                                                                                  // 396
		return this._setOptions({ disabled: false });                                                                        // 397
	},                                                                                                                    // 398
	disable: function() {                                                                                                 // 399
		return this._setOptions({ disabled: true });                                                                         // 400
	},                                                                                                                    // 401
                                                                                                                       // 402
	_on: function( suppressDisabledCheck, element, handlers ) {                                                           // 403
		var delegateElement,                                                                                                 // 404
			instance = this;                                                                                                    // 405
                                                                                                                       // 406
		// no suppressDisabledCheck flag, shuffle arguments                                                                  // 407
		if ( typeof suppressDisabledCheck !== "boolean" ) {                                                                  // 408
			handlers = element;                                                                                                 // 409
			element = suppressDisabledCheck;                                                                                    // 410
			suppressDisabledCheck = false;                                                                                      // 411
		}                                                                                                                    // 412
                                                                                                                       // 413
		// no element argument, shuffle and use this.element                                                                 // 414
		if ( !handlers ) {                                                                                                   // 415
			handlers = element;                                                                                                 // 416
			element = this.element;                                                                                             // 417
			delegateElement = this.widget();                                                                                    // 418
		} else {                                                                                                             // 419
			element = delegateElement = $( element );                                                                           // 420
			this.bindings = this.bindings.add( element );                                                                       // 421
		}                                                                                                                    // 422
                                                                                                                       // 423
		$.each( handlers, function( event, handler ) {                                                                       // 424
			function handlerProxy() {                                                                                           // 425
				// allow widgets to customize the disabled handling                                                                // 426
				// - disabled as an array instead of boolean                                                                       // 427
				// - disabled class as method for disabling individual parts                                                       // 428
				if ( !suppressDisabledCheck &&                                                                                     // 429
						( instance.options.disabled === true ||                                                                          // 430
							$( this ).hasClass( "ui-state-disabled" ) ) ) {                                                                 // 431
					return;                                                                                                           // 432
				}                                                                                                                  // 433
				return ( typeof handler === "string" ? instance[ handler ] : handler )                                             // 434
					.apply( instance, arguments );                                                                                    // 435
			}                                                                                                                   // 436
                                                                                                                       // 437
			// copy the guid so direct unbinding works                                                                          // 438
			if ( typeof handler !== "string" ) {                                                                                // 439
				handlerProxy.guid = handler.guid =                                                                                 // 440
					handler.guid || handlerProxy.guid || $.guid++;                                                                    // 441
			}                                                                                                                   // 442
                                                                                                                       // 443
			var match = event.match( /^([\w:-]*)\s*(.*)$/ ),                                                                    // 444
				eventName = match[1] + instance.eventNamespace,                                                                    // 445
				selector = match[2];                                                                                               // 446
			if ( selector ) {                                                                                                   // 447
				delegateElement.delegate( selector, eventName, handlerProxy );                                                     // 448
			} else {                                                                                                            // 449
				element.bind( eventName, handlerProxy );                                                                           // 450
			}                                                                                                                   // 451
		});                                                                                                                  // 452
	},                                                                                                                    // 453
                                                                                                                       // 454
	_off: function( element, eventName ) {                                                                                // 455
		eventName = (eventName || "").split( " " ).join( this.eventNamespace + " " ) + this.eventNamespace;                  // 456
		element.unbind( eventName ).undelegate( eventName );                                                                 // 457
	},                                                                                                                    // 458
                                                                                                                       // 459
	_delay: function( handler, delay ) {                                                                                  // 460
		function handlerProxy() {                                                                                            // 461
			return ( typeof handler === "string" ? instance[ handler ] : handler )                                              // 462
				.apply( instance, arguments );                                                                                     // 463
		}                                                                                                                    // 464
		var instance = this;                                                                                                 // 465
		return setTimeout( handlerProxy, delay || 0 );                                                                       // 466
	},                                                                                                                    // 467
                                                                                                                       // 468
	_hoverable: function( element ) {                                                                                     // 469
		this.hoverable = this.hoverable.add( element );                                                                      // 470
		this._on( element, {                                                                                                 // 471
			mouseenter: function( event ) {                                                                                     // 472
				$( event.currentTarget ).addClass( "ui-state-hover" );                                                             // 473
			},                                                                                                                  // 474
			mouseleave: function( event ) {                                                                                     // 475
				$( event.currentTarget ).removeClass( "ui-state-hover" );                                                          // 476
			}                                                                                                                   // 477
		});                                                                                                                  // 478
	},                                                                                                                    // 479
                                                                                                                       // 480
	_focusable: function( element ) {                                                                                     // 481
		this.focusable = this.focusable.add( element );                                                                      // 482
		this._on( element, {                                                                                                 // 483
			focusin: function( event ) {                                                                                        // 484
				$( event.currentTarget ).addClass( "ui-state-focus" );                                                             // 485
			},                                                                                                                  // 486
			focusout: function( event ) {                                                                                       // 487
				$( event.currentTarget ).removeClass( "ui-state-focus" );                                                          // 488
			}                                                                                                                   // 489
		});                                                                                                                  // 490
	},                                                                                                                    // 491
                                                                                                                       // 492
	_trigger: function( type, event, data ) {                                                                             // 493
		var prop, orig,                                                                                                      // 494
			callback = this.options[ type ];                                                                                    // 495
                                                                                                                       // 496
		data = data || {};                                                                                                   // 497
		event = $.Event( event );                                                                                            // 498
		event.type = ( type === this.widgetEventPrefix ?                                                                     // 499
			type :                                                                                                              // 500
			this.widgetEventPrefix + type ).toLowerCase();                                                                      // 501
		// the original event may come from any element                                                                      // 502
		// so we need to reset the target on the new event                                                                   // 503
		event.target = this.element[ 0 ];                                                                                    // 504
                                                                                                                       // 505
		// copy original event properties over to the new event                                                              // 506
		orig = event.originalEvent;                                                                                          // 507
		if ( orig ) {                                                                                                        // 508
			for ( prop in orig ) {                                                                                              // 509
				if ( !( prop in event ) ) {                                                                                        // 510
					event[ prop ] = orig[ prop ];                                                                                     // 511
				}                                                                                                                  // 512
			}                                                                                                                   // 513
		}                                                                                                                    // 514
                                                                                                                       // 515
		this.element.trigger( event, data );                                                                                 // 516
		return !( $.isFunction( callback ) &&                                                                                // 517
			callback.apply( this.element[0], [ event ].concat( data ) ) === false ||                                            // 518
			event.isDefaultPrevented() );                                                                                       // 519
	}                                                                                                                     // 520
};                                                                                                                     // 521
                                                                                                                       // 522
$.each( { show: "fadeIn", hide: "fadeOut" }, function( method, defaultEffect ) {                                       // 523
	$.Widget.prototype[ "_" + method ] = function( element, options, callback ) {                                         // 524
		if ( typeof options === "string" ) {                                                                                 // 525
			options = { effect: options };                                                                                      // 526
		}                                                                                                                    // 527
		var hasOptions,                                                                                                      // 528
			effectName = !options ?                                                                                             // 529
				method :                                                                                                           // 530
				options === true || typeof options === "number" ?                                                                  // 531
					defaultEffect :                                                                                                   // 532
					options.effect || defaultEffect;                                                                                  // 533
		options = options || {};                                                                                             // 534
		if ( typeof options === "number" ) {                                                                                 // 535
			options = { duration: options };                                                                                    // 536
		}                                                                                                                    // 537
		hasOptions = !$.isEmptyObject( options );                                                                            // 538
		options.complete = callback;                                                                                         // 539
		if ( options.delay ) {                                                                                               // 540
			element.delay( options.delay );                                                                                     // 541
		}                                                                                                                    // 542
		if ( hasOptions && $.effects && $.effects.effect[ effectName ] ) {                                                   // 543
			element[ method ]( options );                                                                                       // 544
		} else if ( effectName !== method && element[ effectName ] ) {                                                       // 545
			element[ effectName ]( options.duration, options.easing, callback );                                                // 546
		} else {                                                                                                             // 547
			element.queue(function( next ) {                                                                                    // 548
				$( this )[ method ]();                                                                                             // 549
				if ( callback ) {                                                                                                  // 550
					callback.call( element[ 0 ] );                                                                                    // 551
				}                                                                                                                  // 552
				next();                                                                                                            // 553
			});                                                                                                                 // 554
		}                                                                                                                    // 555
	};                                                                                                                    // 556
});                                                                                                                    // 557
                                                                                                                       // 558
var widget = $.widget;                                                                                                 // 559
                                                                                                                       // 560
                                                                                                                       // 561
                                                                                                                       // 562
}));                                                                                                                   // 563
                                                                                                                       // 564
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/compatibility/bower_components/blueimp-file-upload/js/jquery.iframe-transport.js           //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
/*                                                                                                                     // 1
 * jQuery Iframe Transport Plugin 1.8.3                                                                                // 2
 * https://github.com/blueimp/jQuery-File-Upload                                                                       // 3
 *                                                                                                                     // 4
 * Copyright 2011, Sebastian Tschan                                                                                    // 5
 * https://blueimp.net                                                                                                 // 6
 *                                                                                                                     // 7
 * Licensed under the MIT license:                                                                                     // 8
 * http://www.opensource.org/licenses/MIT                                                                              // 9
 */                                                                                                                    // 10
                                                                                                                       // 11
/* global define, require, window, document */                                                                         // 12
                                                                                                                       // 13
(function (factory) {                                                                                                  // 14
    'use strict';                                                                                                      // 15
    if (typeof define === 'function' && define.amd) {                                                                  // 16
        // Register as an anonymous AMD module:                                                                        // 17
        define(['jquery'], factory);                                                                                   // 18
    } else if (typeof exports === 'object') {                                                                          // 19
        // Node/CommonJS:                                                                                              // 20
        factory(require('jquery'));                                                                                    // 21
    } else {                                                                                                           // 22
        // Browser globals:                                                                                            // 23
        factory(window.jQuery);                                                                                        // 24
    }                                                                                                                  // 25
}(function ($) {                                                                                                       // 26
    'use strict';                                                                                                      // 27
                                                                                                                       // 28
    // Helper variable to create unique names for the transport iframes:                                               // 29
    var counter = 0;                                                                                                   // 30
                                                                                                                       // 31
    // The iframe transport accepts four additional options:                                                           // 32
    // options.fileInput: a jQuery collection of file input fields                                                     // 33
    // options.paramName: the parameter name for the file form data,                                                   // 34
    //  overrides the name property of the file input field(s),                                                        // 35
    //  can be a string or an array of strings.                                                                        // 36
    // options.formData: an array of objects with name and value properties,                                           // 37
    //  equivalent to the return data of .serializeArray(), e.g.:                                                      // 38
    //  [{name: 'a', value: 1}, {name: 'b', value: 2}]                                                                 // 39
    // options.initialIframeSrc: the URL of the initial iframe src,                                                    // 40
    //  by default set to "javascript:false;"                                                                          // 41
    $.ajaxTransport('iframe', function (options) {                                                                     // 42
        if (options.async) {                                                                                           // 43
            // javascript:false as initial iframe src                                                                  // 44
            // prevents warning popups on HTTPS in IE6:                                                                // 45
            /*jshint scripturl: true */                                                                                // 46
            var initialIframeSrc = options.initialIframeSrc || 'javascript:false;',                                    // 47
            /*jshint scripturl: false */                                                                               // 48
                form,                                                                                                  // 49
                iframe,                                                                                                // 50
                addParamChar;                                                                                          // 51
            return {                                                                                                   // 52
                send: function (_, completeCallback) {                                                                 // 53
                    form = $('<form style="display:none;"></form>');                                                   // 54
                    form.attr('accept-charset', options.formAcceptCharset);                                            // 55
                    addParamChar = /\?/.test(options.url) ? '&' : '?';                                                 // 56
                    // XDomainRequest only supports GET and POST:                                                      // 57
                    if (options.type === 'DELETE') {                                                                   // 58
                        options.url = options.url + addParamChar + '_method=DELETE';                                   // 59
                        options.type = 'POST';                                                                         // 60
                    } else if (options.type === 'PUT') {                                                               // 61
                        options.url = options.url + addParamChar + '_method=PUT';                                      // 62
                        options.type = 'POST';                                                                         // 63
                    } else if (options.type === 'PATCH') {                                                             // 64
                        options.url = options.url + addParamChar + '_method=PATCH';                                    // 65
                        options.type = 'POST';                                                                         // 66
                    }                                                                                                  // 67
                    // IE versions below IE8 cannot set the name property of                                           // 68
                    // elements that have already been added to the DOM,                                               // 69
                    // so we set the name along with the iframe HTML markup:                                           // 70
                    counter += 1;                                                                                      // 71
                    iframe = $(                                                                                        // 72
                        '<iframe src="' + initialIframeSrc +                                                           // 73
                            '" name="iframe-transport-' + counter + '"></iframe>'                                      // 74
                    ).bind('load', function () {                                                                       // 75
                        var fileInputClones,                                                                           // 76
                            paramNames = $.isArray(options.paramName) ?                                                // 77
                                    options.paramName : [options.paramName];                                           // 78
                        iframe                                                                                         // 79
                            .unbind('load')                                                                            // 80
                            .bind('load', function () {                                                                // 81
                                var response;                                                                          // 82
                                // Wrap in a try/catch block to catch exceptions thrown                                // 83
                                // when trying to access cross-domain iframe contents:                                 // 84
                                try {                                                                                  // 85
                                    response = iframe.contents();                                                      // 86
                                    // Google Chrome and Firefox do not throw an                                       // 87
                                    // exception when calling iframe.contents() on                                     // 88
                                    // cross-domain requests, so we unify the response:                                // 89
                                    if (!response.length || !response[0].firstChild) {                                 // 90
                                        throw new Error();                                                             // 91
                                    }                                                                                  // 92
                                } catch (e) {                                                                          // 93
                                    response = undefined;                                                              // 94
                                }                                                                                      // 95
                                // The complete callback returns the                                                   // 96
                                // iframe content document as response object:                                         // 97
                                completeCallback(                                                                      // 98
                                    200,                                                                               // 99
                                    'success',                                                                         // 100
                                    {'iframe': response}                                                               // 101
                                );                                                                                     // 102
                                // Fix for IE endless progress bar activity bug                                        // 103
                                // (happens on form submits to iframe targets):                                        // 104
                                $('<iframe src="' + initialIframeSrc + '"></iframe>')                                  // 105
                                    .appendTo(form);                                                                   // 106
                                window.setTimeout(function () {                                                        // 107
                                    // Removing the form in a setTimeout call                                          // 108
                                    // allows Chrome's developer tools to display                                      // 109
                                    // the response result                                                             // 110
                                    form.remove();                                                                     // 111
                                }, 0);                                                                                 // 112
                            });                                                                                        // 113
                        form                                                                                           // 114
                            .prop('target', iframe.prop('name'))                                                       // 115
                            .prop('action', options.url)                                                               // 116
                            .prop('method', options.type);                                                             // 117
                        if (options.formData) {                                                                        // 118
                            $.each(options.formData, function (index, field) {                                         // 119
                                $('<input type="hidden"/>')                                                            // 120
                                    .prop('name', field.name)                                                          // 121
                                    .val(field.value)                                                                  // 122
                                    .appendTo(form);                                                                   // 123
                            });                                                                                        // 124
                        }                                                                                              // 125
                        if (options.fileInput && options.fileInput.length &&                                           // 126
                                options.type === 'POST') {                                                             // 127
                            fileInputClones = options.fileInput.clone();                                               // 128
                            // Insert a clone for each file input field:                                               // 129
                            options.fileInput.after(function (index) {                                                 // 130
                                return fileInputClones[index];                                                         // 131
                            });                                                                                        // 132
                            if (options.paramName) {                                                                   // 133
                                options.fileInput.each(function (index) {                                              // 134
                                    $(this).prop(                                                                      // 135
                                        'name',                                                                        // 136
                                        paramNames[index] || options.paramName                                         // 137
                                    );                                                                                 // 138
                                });                                                                                    // 139
                            }                                                                                          // 140
                            // Appending the file input fields to the hidden form                                      // 141
                            // removes them from their original location:                                              // 142
                            form                                                                                       // 143
                                .append(options.fileInput)                                                             // 144
                                .prop('enctype', 'multipart/form-data')                                                // 145
                                // enctype must be set as encoding for IE:                                             // 146
                                .prop('encoding', 'multipart/form-data');                                              // 147
                            // Remove the HTML5 form attribute from the input(s):                                      // 148
                            options.fileInput.removeAttr('form');                                                      // 149
                        }                                                                                              // 150
                        form.submit();                                                                                 // 151
                        // Insert the file input fields at their original location                                     // 152
                        // by replacing the clones with the originals:                                                 // 153
                        if (fileInputClones && fileInputClones.length) {                                               // 154
                            options.fileInput.each(function (index, input) {                                           // 155
                                var clone = $(fileInputClones[index]);                                                 // 156
                                // Restore the original name and form properties:                                      // 157
                                $(input)                                                                               // 158
                                    .prop('name', clone.prop('name'))                                                  // 159
                                    .attr('form', clone.attr('form'));                                                 // 160
                                clone.replaceWith(input);                                                              // 161
                            });                                                                                        // 162
                        }                                                                                              // 163
                    });                                                                                                // 164
                    form.append(iframe).appendTo(document.body);                                                       // 165
                },                                                                                                     // 166
                abort: function () {                                                                                   // 167
                    if (iframe) {                                                                                      // 168
                        // javascript:false as iframe src aborts the request                                           // 169
                        // and prevents warning popups on HTTPS in IE6.                                                // 170
                        // concat is used to avoid the "Script URL" JSLint error:                                      // 171
                        iframe                                                                                         // 172
                            .unbind('load')                                                                            // 173
                            .prop('src', initialIframeSrc);                                                            // 174
                    }                                                                                                  // 175
                    if (form) {                                                                                        // 176
                        form.remove();                                                                                 // 177
                    }                                                                                                  // 178
                }                                                                                                      // 179
            };                                                                                                         // 180
        }                                                                                                              // 181
    });                                                                                                                // 182
                                                                                                                       // 183
    // The iframe transport returns the iframe content document as response.                                           // 184
    // The following adds converters from iframe to text, json, html, xml                                              // 185
    // and script.                                                                                                     // 186
    // Please note that the Content-Type for JSON responses has to be text/plain                                       // 187
    // or text/html, if the browser doesn't include application/json in the                                            // 188
    // Accept header, else IE will show a download dialog.                                                             // 189
    // The Content-Type for XML responses on the other hand has to be always                                           // 190
    // application/xml or text/xml, so IE properly parses the XML response.                                            // 191
    // See also                                                                                                        // 192
    // https://github.com/blueimp/jQuery-File-Upload/wiki/Setup#content-type-negotiation                               // 193
    $.ajaxSetup({                                                                                                      // 194
        converters: {                                                                                                  // 195
            'iframe text': function (iframe) {                                                                         // 196
                return iframe && $(iframe[0].body).text();                                                             // 197
            },                                                                                                         // 198
            'iframe json': function (iframe) {                                                                         // 199
                return iframe && $.parseJSON($(iframe[0].body).text());                                                // 200
            },                                                                                                         // 201
            'iframe html': function (iframe) {                                                                         // 202
                return iframe && $(iframe[0].body).html();                                                             // 203
            },                                                                                                         // 204
            'iframe xml': function (iframe) {                                                                          // 205
                var xmlDoc = iframe && iframe[0];                                                                      // 206
                return xmlDoc && $.isXMLDoc(xmlDoc) ? xmlDoc :                                                         // 207
                        $.parseXML((xmlDoc.XMLDocument && xmlDoc.XMLDocument.xml) ||                                   // 208
                            $(xmlDoc.body).html());                                                                    // 209
            },                                                                                                         // 210
            'iframe script': function (iframe) {                                                                       // 211
                return iframe && $.globalEval($(iframe[0].body).text());                                               // 212
            }                                                                                                          // 213
        }                                                                                                              // 214
    });                                                                                                                // 215
                                                                                                                       // 216
}));                                                                                                                   // 217
                                                                                                                       // 218
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/compatibility/bower_components/blueimp-file-upload/js/jquery.fileupload.js                 //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
/*                                                                                                                     // 1
 * jQuery File Upload Plugin 5.42.3                                                                                    // 2
 * https://github.com/blueimp/jQuery-File-Upload                                                                       // 3
 *                                                                                                                     // 4
 * Copyright 2010, Sebastian Tschan                                                                                    // 5
 * https://blueimp.net                                                                                                 // 6
 *                                                                                                                     // 7
 * Licensed under the MIT license:                                                                                     // 8
 * http://www.opensource.org/licenses/MIT                                                                              // 9
 */                                                                                                                    // 10
                                                                                                                       // 11
/* jshint nomen:false */                                                                                               // 12
/* global define, require, window, document, location, Blob, FormData */                                               // 13
                                                                                                                       // 14
(function (factory) {                                                                                                  // 15
    'use strict';                                                                                                      // 16
    if (typeof define === 'function' && define.amd) {                                                                  // 17
        // Register as an anonymous AMD module:                                                                        // 18
        define([                                                                                                       // 19
            'jquery',                                                                                                  // 20
            'jquery.ui.widget'                                                                                         // 21
        ], factory);                                                                                                   // 22
    } else if (typeof exports === 'object') {                                                                          // 23
        // Node/CommonJS:                                                                                              // 24
        factory(                                                                                                       // 25
            require('jquery'),                                                                                         // 26
            require('./vendor/jquery.ui.widget')                                                                       // 27
        );                                                                                                             // 28
    } else {                                                                                                           // 29
        // Browser globals:                                                                                            // 30
        factory(window.jQuery);                                                                                        // 31
    }                                                                                                                  // 32
}(function ($) {                                                                                                       // 33
    'use strict';                                                                                                      // 34
                                                                                                                       // 35
    // Detect file input support, based on                                                                             // 36
    // http://viljamis.com/blog/2012/file-upload-support-on-mobile/                                                    // 37
    $.support.fileInput = !(new RegExp(                                                                                // 38
        // Handle devices which give false positives for the feature detection:                                        // 39
        '(Android (1\\.[0156]|2\\.[01]))' +                                                                            // 40
            '|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)' +                                             // 41
            '|(w(eb)?OSBrowser)|(webOS)' +                                                                             // 42
            '|(Kindle/(1\\.0|2\\.[05]|3\\.0))'                                                                         // 43
    ).test(window.navigator.userAgent) ||                                                                              // 44
        // Feature detection for all other devices:                                                                    // 45
        $('<input type="file">').prop('disabled'));                                                                    // 46
                                                                                                                       // 47
    // The FileReader API is not actually used, but works as feature detection,                                        // 48
    // as some Safari versions (5?) support XHR file uploads via the FormData API,                                     // 49
    // but not non-multipart XHR file uploads.                                                                         // 50
    // window.XMLHttpRequestUpload is not available on IE10, so we check for                                           // 51
    // window.ProgressEvent instead to detect XHR2 file upload capability:                                             // 52
    $.support.xhrFileUpload = !!(window.ProgressEvent && window.FileReader);                                           // 53
    $.support.xhrFormDataFileUpload = !!window.FormData;                                                               // 54
                                                                                                                       // 55
    // Detect support for Blob slicing (required for chunked uploads):                                                 // 56
    $.support.blobSlice = window.Blob && (Blob.prototype.slice ||                                                      // 57
        Blob.prototype.webkitSlice || Blob.prototype.mozSlice);                                                        // 58
                                                                                                                       // 59
    // Helper function to create drag handlers for dragover/dragenter/dragleave:                                       // 60
    function getDragHandler(type) {                                                                                    // 61
        var isDragOver = type === 'dragover';                                                                          // 62
        return function (e) {                                                                                          // 63
            e.dataTransfer = e.originalEvent && e.originalEvent.dataTransfer;                                          // 64
            var dataTransfer = e.dataTransfer;                                                                         // 65
            if (dataTransfer && $.inArray('Files', dataTransfer.types) !== -1 &&                                       // 66
                    this._trigger(                                                                                     // 67
                        type,                                                                                          // 68
                        $.Event(type, {delegatedEvent: e})                                                             // 69
                    ) !== false) {                                                                                     // 70
                e.preventDefault();                                                                                    // 71
                if (isDragOver) {                                                                                      // 72
                    dataTransfer.dropEffect = 'copy';                                                                  // 73
                }                                                                                                      // 74
            }                                                                                                          // 75
        };                                                                                                             // 76
    }                                                                                                                  // 77
                                                                                                                       // 78
    // The fileupload widget listens for change events on file input fields defined                                    // 79
    // via fileInput setting and paste or drop events of the given dropZone.                                           // 80
    // In addition to the default jQuery Widget methods, the fileupload widget                                         // 81
    // exposes the "add" and "send" methods, to add or directly send files using                                       // 82
    // the fileupload API.                                                                                             // 83
    // By default, files added via file input selection, paste, drag & drop or                                         // 84
    // "add" method are uploaded immediately, but it is possible to override                                           // 85
    // the "add" callback option to queue file uploads.                                                                // 86
    $.widget('blueimp.fileupload', {                                                                                   // 87
                                                                                                                       // 88
        options: {                                                                                                     // 89
            // The drop target element(s), by the default the complete document.                                       // 90
            // Set to null to disable drag & drop support:                                                             // 91
            dropZone: $(document),                                                                                     // 92
            // The paste target element(s), by the default undefined.                                                  // 93
            // Set to a DOM node or jQuery object to enable file pasting:                                              // 94
            pasteZone: undefined,                                                                                      // 95
            // The file input field(s), that are listened to for change events.                                        // 96
            // If undefined, it is set to the file input fields inside                                                 // 97
            // of the widget element on plugin initialization.                                                         // 98
            // Set to null to disable the change listener.                                                             // 99
            fileInput: undefined,                                                                                      // 100
            // By default, the file input field is replaced with a clone after                                         // 101
            // each input field change event. This is required for iframe transport                                    // 102
            // queues and allows change events to be fired for the same file                                           // 103
            // selection, but can be disabled by setting the following option to false:                                // 104
            replaceFileInput: true,                                                                                    // 105
            // The parameter name for the file form data (the request argument name).                                  // 106
            // If undefined or empty, the name property of the file input field is                                     // 107
            // used, or "files[]" if the file input name property is also empty,                                       // 108
            // can be a string or an array of strings:                                                                 // 109
            paramName: undefined,                                                                                      // 110
            // By default, each file of a selection is uploaded using an individual                                    // 111
            // request for XHR type uploads. Set to false to upload file                                               // 112
            // selections in one request each:                                                                         // 113
            singleFileUploads: true,                                                                                   // 114
            // To limit the number of files uploaded with one XHR request,                                             // 115
            // set the following option to an integer greater than 0:                                                  // 116
            limitMultiFileUploads: undefined,                                                                          // 117
            // The following option limits the number of files uploaded with one                                       // 118
            // XHR request to keep the request size under or equal to the defined                                      // 119
            // limit in bytes:                                                                                         // 120
            limitMultiFileUploadSize: undefined,                                                                       // 121
            // Multipart file uploads add a number of bytes to each uploaded file,                                     // 122
            // therefore the following option adds an overhead for each file used                                      // 123
            // in the limitMultiFileUploadSize configuration:                                                          // 124
            limitMultiFileUploadSizeOverhead: 512,                                                                     // 125
            // Set the following option to true to issue all file upload requests                                      // 126
            // in a sequential order:                                                                                  // 127
            sequentialUploads: false,                                                                                  // 128
            // To limit the number of concurrent uploads,                                                              // 129
            // set the following option to an integer greater than 0:                                                  // 130
            limitConcurrentUploads: undefined,                                                                         // 131
            // Set the following option to true to force iframe transport uploads:                                     // 132
            forceIframeTransport: false,                                                                               // 133
            // Set the following option to the location of a redirect url on the                                       // 134
            // origin server, for cross-domain iframe transport uploads:                                               // 135
            redirect: undefined,                                                                                       // 136
            // The parameter name for the redirect url, sent as part of the form                                       // 137
            // data and set to 'redirect' if this option is empty:                                                     // 138
            redirectParamName: undefined,                                                                              // 139
            // Set the following option to the location of a postMessage window,                                       // 140
            // to enable postMessage transport uploads:                                                                // 141
            postMessage: undefined,                                                                                    // 142
            // By default, XHR file uploads are sent as multipart/form-data.                                           // 143
            // The iframe transport is always using multipart/form-data.                                               // 144
            // Set to false to enable non-multipart XHR uploads:                                                       // 145
            multipart: true,                                                                                           // 146
            // To upload large files in smaller chunks, set the following option                                       // 147
            // to a preferred maximum chunk size. If set to 0, null or undefined,                                      // 148
            // or the browser does not support the required Blob API, files will                                       // 149
            // be uploaded as a whole.                                                                                 // 150
            maxChunkSize: undefined,                                                                                   // 151
            // When a non-multipart upload or a chunked multipart upload has been                                      // 152
            // aborted, this option can be used to resume the upload by setting                                        // 153
            // it to the size of the already uploaded bytes. This option is most                                       // 154
            // useful when modifying the options object inside of the "add" or                                         // 155
            // "send" callbacks, as the options are cloned for each file upload.                                       // 156
            uploadedBytes: undefined,                                                                                  // 157
            // By default, failed (abort or error) file uploads are removed from the                                   // 158
            // global progress calculation. Set the following option to false to                                       // 159
            // prevent recalculating the global progress data:                                                         // 160
            recalculateProgress: true,                                                                                 // 161
            // Interval in milliseconds to calculate and trigger progress events:                                      // 162
            progressInterval: 100,                                                                                     // 163
            // Interval in milliseconds to calculate progress bitrate:                                                 // 164
            bitrateInterval: 500,                                                                                      // 165
            // By default, uploads are started automatically when adding files:                                        // 166
            autoUpload: true,                                                                                          // 167
                                                                                                                       // 168
            // Error and info messages:                                                                                // 169
            messages: {                                                                                                // 170
                uploadedBytes: 'Uploaded bytes exceed file size'                                                       // 171
            },                                                                                                         // 172
                                                                                                                       // 173
            // Translation function, gets the message key to be translated                                             // 174
            // and an object with context specific data as arguments:                                                  // 175
            i18n: function (message, context) {                                                                        // 176
                message = this.messages[message] || message.toString();                                                // 177
                if (context) {                                                                                         // 178
                    $.each(context, function (key, value) {                                                            // 179
                        message = message.replace('{' + key + '}', value);                                             // 180
                    });                                                                                                // 181
                }                                                                                                      // 182
                return message;                                                                                        // 183
            },                                                                                                         // 184
                                                                                                                       // 185
            // Additional form data to be sent along with the file uploads can be set                                  // 186
            // using this option, which accepts an array of objects with name and                                      // 187
            // value properties, a function returning such an array, a FormData                                        // 188
            // object (for XHR file uploads), or a simple object.                                                      // 189
            // The form of the first fileInput is given as parameter to the function:                                  // 190
            formData: function (form) {                                                                                // 191
                return form.serializeArray();                                                                          // 192
            },                                                                                                         // 193
                                                                                                                       // 194
            // The add callback is invoked as soon as files are added to the fileupload                                // 195
            // widget (via file input selection, drag & drop, paste or add API call).                                  // 196
            // If the singleFileUploads option is enabled, this callback will be                                       // 197
            // called once for each file in the selection for XHR file uploads, else                                   // 198
            // once for each file selection.                                                                           // 199
            //                                                                                                         // 200
            // The upload starts when the submit method is invoked on the data parameter.                              // 201
            // The data object contains a files property holding the added files                                       // 202
            // and allows you to override plugin options as well as define ajax settings.                              // 203
            //                                                                                                         // 204
            // Listeners for this callback can also be bound the following way:                                        // 205
            // .bind('fileuploadadd', func);                                                                           // 206
            //                                                                                                         // 207
            // data.submit() returns a Promise object and allows to attach additional                                  // 208
            // handlers using jQuery's Deferred callbacks:                                                             // 209
            // data.submit().done(func).fail(func).always(func);                                                       // 210
            add: function (e, data) {                                                                                  // 211
                if (e.isDefaultPrevented()) {                                                                          // 212
                    return false;                                                                                      // 213
                }                                                                                                      // 214
                if (data.autoUpload || (data.autoUpload !== false &&                                                   // 215
                        $(this).fileupload('option', 'autoUpload'))) {                                                 // 216
                    data.process().done(function () {                                                                  // 217
                        data.submit();                                                                                 // 218
                    });                                                                                                // 219
                }                                                                                                      // 220
            },                                                                                                         // 221
                                                                                                                       // 222
            // Other callbacks:                                                                                        // 223
                                                                                                                       // 224
            // Callback for the submit event of each file upload:                                                      // 225
            // submit: function (e, data) {}, // .bind('fileuploadsubmit', func);                                      // 226
                                                                                                                       // 227
            // Callback for the start of each file upload request:                                                     // 228
            // send: function (e, data) {}, // .bind('fileuploadsend', func);                                          // 229
                                                                                                                       // 230
            // Callback for successful uploads:                                                                        // 231
            // done: function (e, data) {}, // .bind('fileuploaddone', func);                                          // 232
                                                                                                                       // 233
            // Callback for failed (abort or error) uploads:                                                           // 234
            // fail: function (e, data) {}, // .bind('fileuploadfail', func);                                          // 235
                                                                                                                       // 236
            // Callback for completed (success, abort or error) requests:                                              // 237
            // always: function (e, data) {}, // .bind('fileuploadalways', func);                                      // 238
                                                                                                                       // 239
            // Callback for upload progress events:                                                                    // 240
            // progress: function (e, data) {}, // .bind('fileuploadprogress', func);                                  // 241
                                                                                                                       // 242
            // Callback for global upload progress events:                                                             // 243
            // progressall: function (e, data) {}, // .bind('fileuploadprogressall', func);                            // 244
                                                                                                                       // 245
            // Callback for uploads start, equivalent to the global ajaxStart event:                                   // 246
            // start: function (e) {}, // .bind('fileuploadstart', func);                                              // 247
                                                                                                                       // 248
            // Callback for uploads stop, equivalent to the global ajaxStop event:                                     // 249
            // stop: function (e) {}, // .bind('fileuploadstop', func);                                                // 250
                                                                                                                       // 251
            // Callback for change events of the fileInput(s):                                                         // 252
            // change: function (e, data) {}, // .bind('fileuploadchange', func);                                      // 253
                                                                                                                       // 254
            // Callback for paste events to the pasteZone(s):                                                          // 255
            // paste: function (e, data) {}, // .bind('fileuploadpaste', func);                                        // 256
                                                                                                                       // 257
            // Callback for drop events of the dropZone(s):                                                            // 258
            // drop: function (e, data) {}, // .bind('fileuploaddrop', func);                                          // 259
                                                                                                                       // 260
            // Callback for dragover events of the dropZone(s):                                                        // 261
            // dragover: function (e) {}, // .bind('fileuploaddragover', func);                                        // 262
                                                                                                                       // 263
            // Callback for the start of each chunk upload request:                                                    // 264
            // chunksend: function (e, data) {}, // .bind('fileuploadchunksend', func);                                // 265
                                                                                                                       // 266
            // Callback for successful chunk uploads:                                                                  // 267
            // chunkdone: function (e, data) {}, // .bind('fileuploadchunkdone', func);                                // 268
                                                                                                                       // 269
            // Callback for failed (abort or error) chunk uploads:                                                     // 270
            // chunkfail: function (e, data) {}, // .bind('fileuploadchunkfail', func);                                // 271
                                                                                                                       // 272
            // Callback for completed (success, abort or error) chunk upload requests:                                 // 273
            // chunkalways: function (e, data) {}, // .bind('fileuploadchunkalways', func);                            // 274
                                                                                                                       // 275
            // The plugin options are used as settings object for the ajax calls.                                      // 276
            // The following are jQuery ajax settings required for the file uploads:                                   // 277
            processData: false,                                                                                        // 278
            contentType: false,                                                                                        // 279
            cache: false                                                                                               // 280
        },                                                                                                             // 281
                                                                                                                       // 282
        // A list of options that require reinitializing event listeners and/or                                        // 283
        // special initialization code:                                                                                // 284
        _specialOptions: [                                                                                             // 285
            'fileInput',                                                                                               // 286
            'dropZone',                                                                                                // 287
            'pasteZone',                                                                                               // 288
            'multipart',                                                                                               // 289
            'forceIframeTransport'                                                                                     // 290
        ],                                                                                                             // 291
                                                                                                                       // 292
        _blobSlice: $.support.blobSlice && function () {                                                               // 293
            var slice = this.slice || this.webkitSlice || this.mozSlice;                                               // 294
            return slice.apply(this, arguments);                                                                       // 295
        },                                                                                                             // 296
                                                                                                                       // 297
        _BitrateTimer: function () {                                                                                   // 298
            this.timestamp = ((Date.now) ? Date.now() : (new Date()).getTime());                                       // 299
            this.loaded = 0;                                                                                           // 300
            this.bitrate = 0;                                                                                          // 301
            this.getBitrate = function (now, loaded, interval) {                                                       // 302
                var timeDiff = now - this.timestamp;                                                                   // 303
                if (!this.bitrate || !interval || timeDiff > interval) {                                               // 304
                    this.bitrate = (loaded - this.loaded) * (1000 / timeDiff) * 8;                                     // 305
                    this.loaded = loaded;                                                                              // 306
                    this.timestamp = now;                                                                              // 307
                }                                                                                                      // 308
                return this.bitrate;                                                                                   // 309
            };                                                                                                         // 310
        },                                                                                                             // 311
                                                                                                                       // 312
        _isXHRUpload: function (options) {                                                                             // 313
            return !options.forceIframeTransport &&                                                                    // 314
                ((!options.multipart && $.support.xhrFileUpload) ||                                                    // 315
                $.support.xhrFormDataFileUpload);                                                                      // 316
        },                                                                                                             // 317
                                                                                                                       // 318
        _getFormData: function (options) {                                                                             // 319
            var formData;                                                                                              // 320
            if ($.type(options.formData) === 'function') {                                                             // 321
                return options.formData(options.form);                                                                 // 322
            }                                                                                                          // 323
            if ($.isArray(options.formData)) {                                                                         // 324
                return options.formData;                                                                               // 325
            }                                                                                                          // 326
            if ($.type(options.formData) === 'object') {                                                               // 327
                formData = [];                                                                                         // 328
                $.each(options.formData, function (name, value) {                                                      // 329
                    formData.push({name: name, value: value});                                                         // 330
                });                                                                                                    // 331
                return formData;                                                                                       // 332
            }                                                                                                          // 333
            return [];                                                                                                 // 334
        },                                                                                                             // 335
                                                                                                                       // 336
        _getTotal: function (files) {                                                                                  // 337
            var total = 0;                                                                                             // 338
            $.each(files, function (index, file) {                                                                     // 339
                total += file.size || 1;                                                                               // 340
            });                                                                                                        // 341
            return total;                                                                                              // 342
        },                                                                                                             // 343
                                                                                                                       // 344
        _initProgressObject: function (obj) {                                                                          // 345
            var progress = {                                                                                           // 346
                loaded: 0,                                                                                             // 347
                total: 0,                                                                                              // 348
                bitrate: 0                                                                                             // 349
            };                                                                                                         // 350
            if (obj._progress) {                                                                                       // 351
                $.extend(obj._progress, progress);                                                                     // 352
            } else {                                                                                                   // 353
                obj._progress = progress;                                                                              // 354
            }                                                                                                          // 355
        },                                                                                                             // 356
                                                                                                                       // 357
        _initResponseObject: function (obj) {                                                                          // 358
            var prop;                                                                                                  // 359
            if (obj._response) {                                                                                       // 360
                for (prop in obj._response) {                                                                          // 361
                    if (obj._response.hasOwnProperty(prop)) {                                                          // 362
                        delete obj._response[prop];                                                                    // 363
                    }                                                                                                  // 364
                }                                                                                                      // 365
            } else {                                                                                                   // 366
                obj._response = {};                                                                                    // 367
            }                                                                                                          // 368
        },                                                                                                             // 369
                                                                                                                       // 370
        _onProgress: function (e, data) {                                                                              // 371
            if (e.lengthComputable) {                                                                                  // 372
                var now = ((Date.now) ? Date.now() : (new Date()).getTime()),                                          // 373
                    loaded;                                                                                            // 374
                if (data._time && data.progressInterval &&                                                             // 375
                        (now - data._time < data.progressInterval) &&                                                  // 376
                        e.loaded !== e.total) {                                                                        // 377
                    return;                                                                                            // 378
                }                                                                                                      // 379
                data._time = now;                                                                                      // 380
                loaded = Math.floor(                                                                                   // 381
                    e.loaded / e.total * (data.chunkSize || data._progress.total)                                      // 382
                ) + (data.uploadedBytes || 0);                                                                         // 383
                // Add the difference from the previously loaded state                                                 // 384
                // to the global loaded counter:                                                                       // 385
                this._progress.loaded += (loaded - data._progress.loaded);                                             // 386
                this._progress.bitrate = this._bitrateTimer.getBitrate(                                                // 387
                    now,                                                                                               // 388
                    this._progress.loaded,                                                                             // 389
                    data.bitrateInterval                                                                               // 390
                );                                                                                                     // 391
                data._progress.loaded = data.loaded = loaded;                                                          // 392
                data._progress.bitrate = data.bitrate = data._bitrateTimer.getBitrate(                                 // 393
                    now,                                                                                               // 394
                    loaded,                                                                                            // 395
                    data.bitrateInterval                                                                               // 396
                );                                                                                                     // 397
                // Trigger a custom progress event with a total data property set                                      // 398
                // to the file size(s) of the current upload and a loaded data                                         // 399
                // property calculated accordingly:                                                                    // 400
                this._trigger(                                                                                         // 401
                    'progress',                                                                                        // 402
                    $.Event('progress', {delegatedEvent: e}),                                                          // 403
                    data                                                                                               // 404
                );                                                                                                     // 405
                // Trigger a global progress event for all current file uploads,                                       // 406
                // including ajax calls queued for sequential file uploads:                                            // 407
                this._trigger(                                                                                         // 408
                    'progressall',                                                                                     // 409
                    $.Event('progressall', {delegatedEvent: e}),                                                       // 410
                    this._progress                                                                                     // 411
                );                                                                                                     // 412
            }                                                                                                          // 413
        },                                                                                                             // 414
                                                                                                                       // 415
        _initProgressListener: function (options) {                                                                    // 416
            var that = this,                                                                                           // 417
                xhr = options.xhr ? options.xhr() : $.ajaxSettings.xhr();                                              // 418
            // Accesss to the native XHR object is required to add event listeners                                     // 419
            // for the upload progress event:                                                                          // 420
            if (xhr.upload) {                                                                                          // 421
                $(xhr.upload).bind('progress', function (e) {                                                          // 422
                    var oe = e.originalEvent;                                                                          // 423
                    // Make sure the progress event properties get copied over:                                        // 424
                    e.lengthComputable = oe.lengthComputable;                                                          // 425
                    e.loaded = oe.loaded;                                                                              // 426
                    e.total = oe.total;                                                                                // 427
                    that._onProgress(e, options);                                                                      // 428
                });                                                                                                    // 429
                options.xhr = function () {                                                                            // 430
                    return xhr;                                                                                        // 431
                };                                                                                                     // 432
            }                                                                                                          // 433
        },                                                                                                             // 434
                                                                                                                       // 435
        _isInstanceOf: function (type, obj) {                                                                          // 436
            // Cross-frame instanceof check                                                                            // 437
            return Object.prototype.toString.call(obj) === '[object ' + type + ']';                                    // 438
        },                                                                                                             // 439
                                                                                                                       // 440
        _initXHRData: function (options) {                                                                             // 441
            var that = this,                                                                                           // 442
                formData,                                                                                              // 443
                file = options.files[0],                                                                               // 444
                // Ignore non-multipart setting if not supported:                                                      // 445
                multipart = options.multipart || !$.support.xhrFileUpload,                                             // 446
                paramName = $.type(options.paramName) === 'array' ?                                                    // 447
                    options.paramName[0] : options.paramName;                                                          // 448
            options.headers = $.extend({}, options.headers);                                                           // 449
            if (options.contentRange) {                                                                                // 450
                options.headers['Content-Range'] = options.contentRange;                                               // 451
            }                                                                                                          // 452
            if (!multipart || options.blob || !this._isInstanceOf('File', file)) {                                     // 453
                options.headers['Content-Disposition'] = 'attachment; filename="' +                                    // 454
                    encodeURI(file.name) + '"';                                                                        // 455
            }                                                                                                          // 456
            if (!multipart) {                                                                                          // 457
                options.contentType = file.type || 'application/octet-stream';                                         // 458
                options.data = options.blob || file;                                                                   // 459
            } else if ($.support.xhrFormDataFileUpload) {                                                              // 460
                if (options.postMessage) {                                                                             // 461
                    // window.postMessage does not allow sending FormData                                              // 462
                    // objects, so we just add the File/Blob objects to                                                // 463
                    // the formData array and let the postMessage window                                               // 464
                    // create the FormData object out of this array:                                                   // 465
                    formData = this._getFormData(options);                                                             // 466
                    if (options.blob) {                                                                                // 467
                        formData.push({                                                                                // 468
                            name: paramName,                                                                           // 469
                            value: options.blob                                                                        // 470
                        });                                                                                            // 471
                    } else {                                                                                           // 472
                        $.each(options.files, function (index, file) {                                                 // 473
                            formData.push({                                                                            // 474
                                name: ($.type(options.paramName) === 'array' &&                                        // 475
                                    options.paramName[index]) || paramName,                                            // 476
                                value: file                                                                            // 477
                            });                                                                                        // 478
                        });                                                                                            // 479
                    }                                                                                                  // 480
                } else {                                                                                               // 481
                    if (that._isInstanceOf('FormData', options.formData)) {                                            // 482
                        formData = options.formData;                                                                   // 483
                    } else {                                                                                           // 484
                        formData = new FormData();                                                                     // 485
                        $.each(this._getFormData(options), function (index, field) {                                   // 486
                            formData.append(field.name, field.value);                                                  // 487
                        });                                                                                            // 488
                    }                                                                                                  // 489
                    if (options.blob) {                                                                                // 490
                        formData.append(paramName, options.blob, file.name);                                           // 491
                    } else {                                                                                           // 492
                        $.each(options.files, function (index, file) {                                                 // 493
                            // This check allows the tests to run with                                                 // 494
                            // dummy objects:                                                                          // 495
                            if (that._isInstanceOf('File', file) ||                                                    // 496
                                    that._isInstanceOf('Blob', file)) {                                                // 497
                                formData.append(                                                                       // 498
                                    ($.type(options.paramName) === 'array' &&                                          // 499
                                        options.paramName[index]) || paramName,                                        // 500
                                    file,                                                                              // 501
                                    file.uploadName || file.name                                                       // 502
                                );                                                                                     // 503
                            }                                                                                          // 504
                        });                                                                                            // 505
                    }                                                                                                  // 506
                }                                                                                                      // 507
                options.data = formData;                                                                               // 508
            }                                                                                                          // 509
            // Blob reference is not needed anymore, free memory:                                                      // 510
            options.blob = null;                                                                                       // 511
        },                                                                                                             // 512
                                                                                                                       // 513
        _initIframeSettings: function (options) {                                                                      // 514
            var targetHost = $('<a></a>').prop('href', options.url).prop('host');                                      // 515
            // Setting the dataType to iframe enables the iframe transport:                                            // 516
            options.dataType = 'iframe ' + (options.dataType || '');                                                   // 517
            // The iframe transport accepts a serialized array as form data:                                           // 518
            options.formData = this._getFormData(options);                                                             // 519
            // Add redirect url to form data on cross-domain uploads:                                                  // 520
            if (options.redirect && targetHost && targetHost !== location.host) {                                      // 521
                options.formData.push({                                                                                // 522
                    name: options.redirectParamName || 'redirect',                                                     // 523
                    value: options.redirect                                                                            // 524
                });                                                                                                    // 525
            }                                                                                                          // 526
        },                                                                                                             // 527
                                                                                                                       // 528
        _initDataSettings: function (options) {                                                                        // 529
            if (this._isXHRUpload(options)) {                                                                          // 530
                if (!this._chunkedUpload(options, true)) {                                                             // 531
                    if (!options.data) {                                                                               // 532
                        this._initXHRData(options);                                                                    // 533
                    }                                                                                                  // 534
                    this._initProgressListener(options);                                                               // 535
                }                                                                                                      // 536
                if (options.postMessage) {                                                                             // 537
                    // Setting the dataType to postmessage enables the                                                 // 538
                    // postMessage transport:                                                                          // 539
                    options.dataType = 'postmessage ' + (options.dataType || '');                                      // 540
                }                                                                                                      // 541
            } else {                                                                                                   // 542
                this._initIframeSettings(options);                                                                     // 543
            }                                                                                                          // 544
        },                                                                                                             // 545
                                                                                                                       // 546
        _getParamName: function (options) {                                                                            // 547
            var fileInput = $(options.fileInput),                                                                      // 548
                paramName = options.paramName;                                                                         // 549
            if (!paramName) {                                                                                          // 550
                paramName = [];                                                                                        // 551
                fileInput.each(function () {                                                                           // 552
                    var input = $(this),                                                                               // 553
                        name = input.prop('name') || 'files[]',                                                        // 554
                        i = (input.prop('files') || [1]).length;                                                       // 555
                    while (i) {                                                                                        // 556
                        paramName.push(name);                                                                          // 557
                        i -= 1;                                                                                        // 558
                    }                                                                                                  // 559
                });                                                                                                    // 560
                if (!paramName.length) {                                                                               // 561
                    paramName = [fileInput.prop('name') || 'files[]'];                                                 // 562
                }                                                                                                      // 563
            } else if (!$.isArray(paramName)) {                                                                        // 564
                paramName = [paramName];                                                                               // 565
            }                                                                                                          // 566
            return paramName;                                                                                          // 567
        },                                                                                                             // 568
                                                                                                                       // 569
        _initFormSettings: function (options) {                                                                        // 570
            // Retrieve missing options from the input field and the                                                   // 571
            // associated form, if available:                                                                          // 572
            if (!options.form || !options.form.length) {                                                               // 573
                options.form = $(options.fileInput.prop('form'));                                                      // 574
                // If the given file input doesn't have an associated form,                                            // 575
                // use the default widget file input's form:                                                           // 576
                if (!options.form.length) {                                                                            // 577
                    options.form = $(this.options.fileInput.prop('form'));                                             // 578
                }                                                                                                      // 579
            }                                                                                                          // 580
            options.paramName = this._getParamName(options);                                                           // 581
            if (!options.url) {                                                                                        // 582
                options.url = options.form.prop('action') || location.href;                                            // 583
            }                                                                                                          // 584
            // The HTTP request method must be "POST" or "PUT":                                                        // 585
            options.type = (options.type ||                                                                            // 586
                ($.type(options.form.prop('method')) === 'string' &&                                                   // 587
                    options.form.prop('method')) || ''                                                                 // 588
                ).toUpperCase();                                                                                       // 589
            if (options.type !== 'POST' && options.type !== 'PUT' &&                                                   // 590
                    options.type !== 'PATCH') {                                                                        // 591
                options.type = 'POST';                                                                                 // 592
            }                                                                                                          // 593
            if (!options.formAcceptCharset) {                                                                          // 594
                options.formAcceptCharset = options.form.attr('accept-charset');                                       // 595
            }                                                                                                          // 596
        },                                                                                                             // 597
                                                                                                                       // 598
        _getAJAXSettings: function (data) {                                                                            // 599
            var options = $.extend({}, this.options, data);                                                            // 600
            this._initFormSettings(options);                                                                           // 601
            this._initDataSettings(options);                                                                           // 602
            return options;                                                                                            // 603
        },                                                                                                             // 604
                                                                                                                       // 605
        // jQuery 1.6 doesn't provide .state(),                                                                        // 606
        // while jQuery 1.8+ removed .isRejected() and .isResolved():                                                  // 607
        _getDeferredState: function (deferred) {                                                                       // 608
            if (deferred.state) {                                                                                      // 609
                return deferred.state();                                                                               // 610
            }                                                                                                          // 611
            if (deferred.isResolved()) {                                                                               // 612
                return 'resolved';                                                                                     // 613
            }                                                                                                          // 614
            if (deferred.isRejected()) {                                                                               // 615
                return 'rejected';                                                                                     // 616
            }                                                                                                          // 617
            return 'pending';                                                                                          // 618
        },                                                                                                             // 619
                                                                                                                       // 620
        // Maps jqXHR callbacks to the equivalent                                                                      // 621
        // methods of the given Promise object:                                                                        // 622
        _enhancePromise: function (promise) {                                                                          // 623
            promise.success = promise.done;                                                                            // 624
            promise.error = promise.fail;                                                                              // 625
            promise.complete = promise.always;                                                                         // 626
            return promise;                                                                                            // 627
        },                                                                                                             // 628
                                                                                                                       // 629
        // Creates and returns a Promise object enhanced with                                                          // 630
        // the jqXHR methods abort, success, error and complete:                                                       // 631
        _getXHRPromise: function (resolveOrReject, context, args) {                                                    // 632
            var dfd = $.Deferred(),                                                                                    // 633
                promise = dfd.promise();                                                                               // 634
            context = context || this.options.context || promise;                                                      // 635
            if (resolveOrReject === true) {                                                                            // 636
                dfd.resolveWith(context, args);                                                                        // 637
            } else if (resolveOrReject === false) {                                                                    // 638
                dfd.rejectWith(context, args);                                                                         // 639
            }                                                                                                          // 640
            promise.abort = dfd.promise;                                                                               // 641
            return this._enhancePromise(promise);                                                                      // 642
        },                                                                                                             // 643
                                                                                                                       // 644
        // Adds convenience methods to the data callback argument:                                                     // 645
        _addConvenienceMethods: function (e, data) {                                                                   // 646
            var that = this,                                                                                           // 647
                getPromise = function (args) {                                                                         // 648
                    return $.Deferred().resolveWith(that, args).promise();                                             // 649
                };                                                                                                     // 650
            data.process = function (resolveFunc, rejectFunc) {                                                        // 651
                if (resolveFunc || rejectFunc) {                                                                       // 652
                    data._processQueue = this._processQueue =                                                          // 653
                        (this._processQueue || getPromise([this])).pipe(                                               // 654
                            function () {                                                                              // 655
                                if (data.errorThrown) {                                                                // 656
                                    return $.Deferred()                                                                // 657
                                        .rejectWith(that, [data]).promise();                                           // 658
                                }                                                                                      // 659
                                return getPromise(arguments);                                                          // 660
                            }                                                                                          // 661
                        ).pipe(resolveFunc, rejectFunc);                                                               // 662
                }                                                                                                      // 663
                return this._processQueue || getPromise([this]);                                                       // 664
            };                                                                                                         // 665
            data.submit = function () {                                                                                // 666
                if (this.state() !== 'pending') {                                                                      // 667
                    data.jqXHR = this.jqXHR =                                                                          // 668
                        (that._trigger(                                                                                // 669
                            'submit',                                                                                  // 670
                            $.Event('submit', {delegatedEvent: e}),                                                    // 671
                            this                                                                                       // 672
                        ) !== false) && that._onSend(e, this);                                                         // 673
                }                                                                                                      // 674
                return this.jqXHR || that._getXHRPromise();                                                            // 675
            };                                                                                                         // 676
            data.abort = function () {                                                                                 // 677
                if (this.jqXHR) {                                                                                      // 678
                    return this.jqXHR.abort();                                                                         // 679
                }                                                                                                      // 680
                this.errorThrown = 'abort';                                                                            // 681
                that._trigger('fail', null, this);                                                                     // 682
                return that._getXHRPromise(false);                                                                     // 683
            };                                                                                                         // 684
            data.state = function () {                                                                                 // 685
                if (this.jqXHR) {                                                                                      // 686
                    return that._getDeferredState(this.jqXHR);                                                         // 687
                }                                                                                                      // 688
                if (this._processQueue) {                                                                              // 689
                    return that._getDeferredState(this._processQueue);                                                 // 690
                }                                                                                                      // 691
            };                                                                                                         // 692
            data.processing = function () {                                                                            // 693
                return !this.jqXHR && this._processQueue && that                                                       // 694
                    ._getDeferredState(this._processQueue) === 'pending';                                              // 695
            };                                                                                                         // 696
            data.progress = function () {                                                                              // 697
                return this._progress;                                                                                 // 698
            };                                                                                                         // 699
            data.response = function () {                                                                              // 700
                return this._response;                                                                                 // 701
            };                                                                                                         // 702
        },                                                                                                             // 703
                                                                                                                       // 704
        // Parses the Range header from the server response                                                            // 705
        // and returns the uploaded bytes:                                                                             // 706
        _getUploadedBytes: function (jqXHR) {                                                                          // 707
            var range = jqXHR.getResponseHeader('Range'),                                                              // 708
                parts = range && range.split('-'),                                                                     // 709
                upperBytesPos = parts && parts.length > 1 &&                                                           // 710
                    parseInt(parts[1], 10);                                                                            // 711
            return upperBytesPos && upperBytesPos + 1;                                                                 // 712
        },                                                                                                             // 713
                                                                                                                       // 714
        // Uploads a file in multiple, sequential requests                                                             // 715
        // by splitting the file up in multiple blob chunks.                                                           // 716
        // If the second parameter is true, only tests if the file                                                     // 717
        // should be uploaded in chunks, but does not invoke any                                                       // 718
        // upload requests:                                                                                            // 719
        _chunkedUpload: function (options, testOnly) {                                                                 // 720
            options.uploadedBytes = options.uploadedBytes || 0;                                                        // 721
            var that = this,                                                                                           // 722
                file = options.files[0],                                                                               // 723
                fs = file.size,                                                                                        // 724
                ub = options.uploadedBytes,                                                                            // 725
                mcs = options.maxChunkSize || fs,                                                                      // 726
                slice = this._blobSlice,                                                                               // 727
                dfd = $.Deferred(),                                                                                    // 728
                promise = dfd.promise(),                                                                               // 729
                jqXHR,                                                                                                 // 730
                upload;                                                                                                // 731
            if (!(this._isXHRUpload(options) && slice && (ub || mcs < fs)) ||                                          // 732
                    options.data) {                                                                                    // 733
                return false;                                                                                          // 734
            }                                                                                                          // 735
            if (testOnly) {                                                                                            // 736
                return true;                                                                                           // 737
            }                                                                                                          // 738
            if (ub >= fs) {                                                                                            // 739
                file.error = options.i18n('uploadedBytes');                                                            // 740
                return this._getXHRPromise(                                                                            // 741
                    false,                                                                                             // 742
                    options.context,                                                                                   // 743
                    [null, 'error', file.error]                                                                        // 744
                );                                                                                                     // 745
            }                                                                                                          // 746
            // The chunk upload method:                                                                                // 747
            upload = function () {                                                                                     // 748
                // Clone the options object for each chunk upload:                                                     // 749
                var o = $.extend({}, options),                                                                         // 750
                    currentLoaded = o._progress.loaded;                                                                // 751
                o.blob = slice.call(                                                                                   // 752
                    file,                                                                                              // 753
                    ub,                                                                                                // 754
                    ub + mcs,                                                                                          // 755
                    file.type                                                                                          // 756
                );                                                                                                     // 757
                // Store the current chunk size, as the blob itself                                                    // 758
                // will be dereferenced after data processing:                                                         // 759
                o.chunkSize = o.blob.size;                                                                             // 760
                // Expose the chunk bytes position range:                                                              // 761
                o.contentRange = 'bytes ' + ub + '-' +                                                                 // 762
                    (ub + o.chunkSize - 1) + '/' + fs;                                                                 // 763
                // Process the upload data (the blob and potential form data):                                         // 764
                that._initXHRData(o);                                                                                  // 765
                // Add progress listeners for this chunk upload:                                                       // 766
                that._initProgressListener(o);                                                                         // 767
                jqXHR = ((that._trigger('chunksend', null, o) !== false && $.ajax(o)) ||                               // 768
                        that._getXHRPromise(false, o.context))                                                         // 769
                    .done(function (result, textStatus, jqXHR) {                                                       // 770
                        ub = that._getUploadedBytes(jqXHR) ||                                                          // 771
                            (ub + o.chunkSize);                                                                        // 772
                        // Create a progress event if no final progress event                                          // 773
                        // with loaded equaling total has been triggered                                               // 774
                        // for this chunk:                                                                             // 775
                        if (currentLoaded + o.chunkSize - o._progress.loaded) {                                        // 776
                            that._onProgress($.Event('progress', {                                                     // 777
                                lengthComputable: true,                                                                // 778
                                loaded: ub - o.uploadedBytes,                                                          // 779
                                total: ub - o.uploadedBytes                                                            // 780
                            }), o);                                                                                    // 781
                        }                                                                                              // 782
                        options.uploadedBytes = o.uploadedBytes = ub;                                                  // 783
                        o.result = result;                                                                             // 784
                        o.textStatus = textStatus;                                                                     // 785
                        o.jqXHR = jqXHR;                                                                               // 786
                        that._trigger('chunkdone', null, o);                                                           // 787
                        that._trigger('chunkalways', null, o);                                                         // 788
                        if (ub < fs) {                                                                                 // 789
                            // File upload not yet complete,                                                           // 790
                            // continue with the next chunk:                                                           // 791
                            upload();                                                                                  // 792
                        } else {                                                                                       // 793
                            dfd.resolveWith(                                                                           // 794
                                o.context,                                                                             // 795
                                [result, textStatus, jqXHR]                                                            // 796
                            );                                                                                         // 797
                        }                                                                                              // 798
                    })                                                                                                 // 799
                    .fail(function (jqXHR, textStatus, errorThrown) {                                                  // 800
                        o.jqXHR = jqXHR;                                                                               // 801
                        o.textStatus = textStatus;                                                                     // 802
                        o.errorThrown = errorThrown;                                                                   // 803
                        that._trigger('chunkfail', null, o);                                                           // 804
                        that._trigger('chunkalways', null, o);                                                         // 805
                        dfd.rejectWith(                                                                                // 806
                            o.context,                                                                                 // 807
                            [jqXHR, textStatus, errorThrown]                                                           // 808
                        );                                                                                             // 809
                    });                                                                                                // 810
            };                                                                                                         // 811
            this._enhancePromise(promise);                                                                             // 812
            promise.abort = function () {                                                                              // 813
                return jqXHR.abort();                                                                                  // 814
            };                                                                                                         // 815
            upload();                                                                                                  // 816
            return promise;                                                                                            // 817
        },                                                                                                             // 818
                                                                                                                       // 819
        _beforeSend: function (e, data) {                                                                              // 820
            if (this._active === 0) {                                                                                  // 821
                // the start callback is triggered when an upload starts                                               // 822
                // and no other uploads are currently running,                                                         // 823
                // equivalent to the global ajaxStart event:                                                           // 824
                this._trigger('start');                                                                                // 825
                // Set timer for global bitrate progress calculation:                                                  // 826
                this._bitrateTimer = new this._BitrateTimer();                                                         // 827
                // Reset the global progress values:                                                                   // 828
                this._progress.loaded = this._progress.total = 0;                                                      // 829
                this._progress.bitrate = 0;                                                                            // 830
            }                                                                                                          // 831
            // Make sure the container objects for the .response() and                                                 // 832
            // .progress() methods on the data object are available                                                    // 833
            // and reset to their initial state:                                                                       // 834
            this._initResponseObject(data);                                                                            // 835
            this._initProgressObject(data);                                                                            // 836
            data._progress.loaded = data.loaded = data.uploadedBytes || 0;                                             // 837
            data._progress.total = data.total = this._getTotal(data.files) || 1;                                       // 838
            data._progress.bitrate = data.bitrate = 0;                                                                 // 839
            this._active += 1;                                                                                         // 840
            // Initialize the global progress values:                                                                  // 841
            this._progress.loaded += data.loaded;                                                                      // 842
            this._progress.total += data.total;                                                                        // 843
        },                                                                                                             // 844
                                                                                                                       // 845
        _onDone: function (result, textStatus, jqXHR, options) {                                                       // 846
            var total = options._progress.total,                                                                       // 847
                response = options._response;                                                                          // 848
            if (options._progress.loaded < total) {                                                                    // 849
                // Create a progress event if no final progress event                                                  // 850
                // with loaded equaling total has been triggered:                                                      // 851
                this._onProgress($.Event('progress', {                                                                 // 852
                    lengthComputable: true,                                                                            // 853
                    loaded: total,                                                                                     // 854
                    total: total                                                                                       // 855
                }), options);                                                                                          // 856
            }                                                                                                          // 857
            response.result = options.result = result;                                                                 // 858
            response.textStatus = options.textStatus = textStatus;                                                     // 859
            response.jqXHR = options.jqXHR = jqXHR;                                                                    // 860
            this._trigger('done', null, options);                                                                      // 861
        },                                                                                                             // 862
                                                                                                                       // 863
        _onFail: function (jqXHR, textStatus, errorThrown, options) {                                                  // 864
            var response = options._response;                                                                          // 865
            if (options.recalculateProgress) {                                                                         // 866
                // Remove the failed (error or abort) file upload from                                                 // 867
                // the global progress calculation:                                                                    // 868
                this._progress.loaded -= options._progress.loaded;                                                     // 869
                this._progress.total -= options._progress.total;                                                       // 870
            }                                                                                                          // 871
            response.jqXHR = options.jqXHR = jqXHR;                                                                    // 872
            response.textStatus = options.textStatus = textStatus;                                                     // 873
            response.errorThrown = options.errorThrown = errorThrown;                                                  // 874
            this._trigger('fail', null, options);                                                                      // 875
        },                                                                                                             // 876
                                                                                                                       // 877
        _onAlways: function (jqXHRorResult, textStatus, jqXHRorError, options) {                                       // 878
            // jqXHRorResult, textStatus and jqXHRorError are added to the                                             // 879
            // options object via done and fail callbacks                                                              // 880
            this._trigger('always', null, options);                                                                    // 881
        },                                                                                                             // 882
                                                                                                                       // 883
        _onSend: function (e, data) {                                                                                  // 884
            if (!data.submit) {                                                                                        // 885
                this._addConvenienceMethods(e, data);                                                                  // 886
            }                                                                                                          // 887
            var that = this,                                                                                           // 888
                jqXHR,                                                                                                 // 889
                aborted,                                                                                               // 890
                slot,                                                                                                  // 891
                pipe,                                                                                                  // 892
                options = that._getAJAXSettings(data),                                                                 // 893
                send = function () {                                                                                   // 894
                    that._sending += 1;                                                                                // 895
                    // Set timer for bitrate progress calculation:                                                     // 896
                    options._bitrateTimer = new that._BitrateTimer();                                                  // 897
                    jqXHR = jqXHR || (                                                                                 // 898
                        ((aborted || that._trigger(                                                                    // 899
                            'send',                                                                                    // 900
                            $.Event('send', {delegatedEvent: e}),                                                      // 901
                            options                                                                                    // 902
                        ) === false) &&                                                                                // 903
                        that._getXHRPromise(false, options.context, aborted)) ||                                       // 904
                        that._chunkedUpload(options) || $.ajax(options)                                                // 905
                    ).done(function (result, textStatus, jqXHR) {                                                      // 906
                        that._onDone(result, textStatus, jqXHR, options);                                              // 907
                    }).fail(function (jqXHR, textStatus, errorThrown) {                                                // 908
                        that._onFail(jqXHR, textStatus, errorThrown, options);                                         // 909
                    }).always(function (jqXHRorResult, textStatus, jqXHRorError) {                                     // 910
                        that._onAlways(                                                                                // 911
                            jqXHRorResult,                                                                             // 912
                            textStatus,                                                                                // 913
                            jqXHRorError,                                                                              // 914
                            options                                                                                    // 915
                        );                                                                                             // 916
                        that._sending -= 1;                                                                            // 917
                        that._active -= 1;                                                                             // 918
                        if (options.limitConcurrentUploads &&                                                          // 919
                                options.limitConcurrentUploads > that._sending) {                                      // 920
                            // Start the next queued upload,                                                           // 921
                            // that has not been aborted:                                                              // 922
                            var nextSlot = that._slots.shift();                                                        // 923
                            while (nextSlot) {                                                                         // 924
                                if (that._getDeferredState(nextSlot) === 'pending') {                                  // 925
                                    nextSlot.resolve();                                                                // 926
                                    break;                                                                             // 927
                                }                                                                                      // 928
                                nextSlot = that._slots.shift();                                                        // 929
                            }                                                                                          // 930
                        }                                                                                              // 931
                        if (that._active === 0) {                                                                      // 932
                            // The stop callback is triggered when all uploads have                                    // 933
                            // been completed, equivalent to the global ajaxStop event:                                // 934
                            that._trigger('stop');                                                                     // 935
                        }                                                                                              // 936
                    });                                                                                                // 937
                    return jqXHR;                                                                                      // 938
                };                                                                                                     // 939
            this._beforeSend(e, options);                                                                              // 940
            if (this.options.sequentialUploads ||                                                                      // 941
                    (this.options.limitConcurrentUploads &&                                                            // 942
                    this.options.limitConcurrentUploads <= this._sending)) {                                           // 943
                if (this.options.limitConcurrentUploads > 1) {                                                         // 944
                    slot = $.Deferred();                                                                               // 945
                    this._slots.push(slot);                                                                            // 946
                    pipe = slot.pipe(send);                                                                            // 947
                } else {                                                                                               // 948
                    this._sequence = this._sequence.pipe(send, send);                                                  // 949
                    pipe = this._sequence;                                                                             // 950
                }                                                                                                      // 951
                // Return the piped Promise object, enhanced with an abort method,                                     // 952
                // which is delegated to the jqXHR object of the current upload,                                       // 953
                // and jqXHR callbacks mapped to the equivalent Promise methods:                                       // 954
                pipe.abort = function () {                                                                             // 955
                    aborted = [undefined, 'abort', 'abort'];                                                           // 956
                    if (!jqXHR) {                                                                                      // 957
                        if (slot) {                                                                                    // 958
                            slot.rejectWith(options.context, aborted);                                                 // 959
                        }                                                                                              // 960
                        return send();                                                                                 // 961
                    }                                                                                                  // 962
                    return jqXHR.abort();                                                                              // 963
                };                                                                                                     // 964
                return this._enhancePromise(pipe);                                                                     // 965
            }                                                                                                          // 966
            return send();                                                                                             // 967
        },                                                                                                             // 968
                                                                                                                       // 969
        _onAdd: function (e, data) {                                                                                   // 970
            var that = this,                                                                                           // 971
                result = true,                                                                                         // 972
                options = $.extend({}, this.options, data),                                                            // 973
                files = data.files,                                                                                    // 974
                filesLength = files.length,                                                                            // 975
                limit = options.limitMultiFileUploads,                                                                 // 976
                limitSize = options.limitMultiFileUploadSize,                                                          // 977
                overhead = options.limitMultiFileUploadSizeOverhead,                                                   // 978
                batchSize = 0,                                                                                         // 979
                paramName = this._getParamName(options),                                                               // 980
                paramNameSet,                                                                                          // 981
                paramNameSlice,                                                                                        // 982
                fileSet,                                                                                               // 983
                i,                                                                                                     // 984
                j = 0;                                                                                                 // 985
            if (limitSize && (!filesLength || files[0].size === undefined)) {                                          // 986
                limitSize = undefined;                                                                                 // 987
            }                                                                                                          // 988
            if (!(options.singleFileUploads || limit || limitSize) ||                                                  // 989
                    !this._isXHRUpload(options)) {                                                                     // 990
                fileSet = [files];                                                                                     // 991
                paramNameSet = [paramName];                                                                            // 992
            } else if (!(options.singleFileUploads || limitSize) && limit) {                                           // 993
                fileSet = [];                                                                                          // 994
                paramNameSet = [];                                                                                     // 995
                for (i = 0; i < filesLength; i += limit) {                                                             // 996
                    fileSet.push(files.slice(i, i + limit));                                                           // 997
                    paramNameSlice = paramName.slice(i, i + limit);                                                    // 998
                    if (!paramNameSlice.length) {                                                                      // 999
                        paramNameSlice = paramName;                                                                    // 1000
                    }                                                                                                  // 1001
                    paramNameSet.push(paramNameSlice);                                                                 // 1002
                }                                                                                                      // 1003
            } else if (!options.singleFileUploads && limitSize) {                                                      // 1004
                fileSet = [];                                                                                          // 1005
                paramNameSet = [];                                                                                     // 1006
                for (i = 0; i < filesLength; i = i + 1) {                                                              // 1007
                    batchSize += files[i].size + overhead;                                                             // 1008
                    if (i + 1 === filesLength ||                                                                       // 1009
                            ((batchSize + files[i + 1].size + overhead) > limitSize) ||                                // 1010
                            (limit && i + 1 - j >= limit)) {                                                           // 1011
                        fileSet.push(files.slice(j, i + 1));                                                           // 1012
                        paramNameSlice = paramName.slice(j, i + 1);                                                    // 1013
                        if (!paramNameSlice.length) {                                                                  // 1014
                            paramNameSlice = paramName;                                                                // 1015
                        }                                                                                              // 1016
                        paramNameSet.push(paramNameSlice);                                                             // 1017
                        j = i + 1;                                                                                     // 1018
                        batchSize = 0;                                                                                 // 1019
                    }                                                                                                  // 1020
                }                                                                                                      // 1021
            } else {                                                                                                   // 1022
                paramNameSet = paramName;                                                                              // 1023
            }                                                                                                          // 1024
            data.originalFiles = files;                                                                                // 1025
            $.each(fileSet || files, function (index, element) {                                                       // 1026
                var newData = $.extend({}, data);                                                                      // 1027
                newData.files = fileSet ? element : [element];                                                         // 1028
                newData.paramName = paramNameSet[index];                                                               // 1029
                that._initResponseObject(newData);                                                                     // 1030
                that._initProgressObject(newData);                                                                     // 1031
                that._addConvenienceMethods(e, newData);                                                               // 1032
                result = that._trigger(                                                                                // 1033
                    'add',                                                                                             // 1034
                    $.Event('add', {delegatedEvent: e}),                                                               // 1035
                    newData                                                                                            // 1036
                );                                                                                                     // 1037
                return result;                                                                                         // 1038
            });                                                                                                        // 1039
            return result;                                                                                             // 1040
        },                                                                                                             // 1041
                                                                                                                       // 1042
        _replaceFileInput: function (data) {                                                                           // 1043
            var input = data.fileInput,                                                                                // 1044
                inputClone = input.clone(true);                                                                        // 1045
            // Add a reference for the new cloned file input to the data argument:                                     // 1046
            data.fileInputClone = inputClone;                                                                          // 1047
            $('<form></form>').append(inputClone)[0].reset();                                                          // 1048
            // Detaching allows to insert the fileInput on another form                                                // 1049
            // without loosing the file input value:                                                                   // 1050
            input.after(inputClone).detach();                                                                          // 1051
            // Avoid memory leaks with the detached file input:                                                        // 1052
            $.cleanData(input.unbind('remove'));                                                                       // 1053
            // Replace the original file input element in the fileInput                                                // 1054
            // elements set with the clone, which has been copied including                                            // 1055
            // event handlers:                                                                                         // 1056
            this.options.fileInput = this.options.fileInput.map(function (i, el) {                                     // 1057
                if (el === input[0]) {                                                                                 // 1058
                    return inputClone[0];                                                                              // 1059
                }                                                                                                      // 1060
                return el;                                                                                             // 1061
            });                                                                                                        // 1062
            // If the widget has been initialized on the file input itself,                                            // 1063
            // override this.element with the file input clone:                                                        // 1064
            if (input[0] === this.element[0]) {                                                                        // 1065
                this.element = inputClone;                                                                             // 1066
            }                                                                                                          // 1067
        },                                                                                                             // 1068
                                                                                                                       // 1069
        _handleFileTreeEntry: function (entry, path) {                                                                 // 1070
            var that = this,                                                                                           // 1071
                dfd = $.Deferred(),                                                                                    // 1072
                errorHandler = function (e) {                                                                          // 1073
                    if (e && !e.entry) {                                                                               // 1074
                        e.entry = entry;                                                                               // 1075
                    }                                                                                                  // 1076
                    // Since $.when returns immediately if one                                                         // 1077
                    // Deferred is rejected, we use resolve instead.                                                   // 1078
                    // This allows valid files and invalid items                                                       // 1079
                    // to be returned together in one set:                                                             // 1080
                    dfd.resolve([e]);                                                                                  // 1081
                },                                                                                                     // 1082
                successHandler = function (entries) {                                                                  // 1083
                    that._handleFileTreeEntries(                                                                       // 1084
                        entries,                                                                                       // 1085
                        path + entry.name + '/'                                                                        // 1086
                    ).done(function (files) {                                                                          // 1087
                        dfd.resolve(files);                                                                            // 1088
                    }).fail(errorHandler);                                                                             // 1089
                },                                                                                                     // 1090
                readEntries = function () {                                                                            // 1091
                    dirReader.readEntries(function (results) {                                                         // 1092
                        if (!results.length) {                                                                         // 1093
                            successHandler(entries);                                                                   // 1094
                        } else {                                                                                       // 1095
                            entries = entries.concat(results);                                                         // 1096
                            readEntries();                                                                             // 1097
                        }                                                                                              // 1098
                    }, errorHandler);                                                                                  // 1099
                },                                                                                                     // 1100
                dirReader, entries = [];                                                                               // 1101
            path = path || '';                                                                                         // 1102
            if (entry.isFile) {                                                                                        // 1103
                if (entry._file) {                                                                                     // 1104
                    // Workaround for Chrome bug #149735                                                               // 1105
                    entry._file.relativePath = path;                                                                   // 1106
                    dfd.resolve(entry._file);                                                                          // 1107
                } else {                                                                                               // 1108
                    entry.file(function (file) {                                                                       // 1109
                        file.relativePath = path;                                                                      // 1110
                        dfd.resolve(file);                                                                             // 1111
                    }, errorHandler);                                                                                  // 1112
                }                                                                                                      // 1113
            } else if (entry.isDirectory) {                                                                            // 1114
                dirReader = entry.createReader();                                                                      // 1115
                readEntries();                                                                                         // 1116
            } else {                                                                                                   // 1117
                // Return an empy list for file system items                                                           // 1118
                // other than files or directories:                                                                    // 1119
                dfd.resolve([]);                                                                                       // 1120
            }                                                                                                          // 1121
            return dfd.promise();                                                                                      // 1122
        },                                                                                                             // 1123
                                                                                                                       // 1124
        _handleFileTreeEntries: function (entries, path) {                                                             // 1125
            var that = this;                                                                                           // 1126
            return $.when.apply(                                                                                       // 1127
                $,                                                                                                     // 1128
                $.map(entries, function (entry) {                                                                      // 1129
                    return that._handleFileTreeEntry(entry, path);                                                     // 1130
                })                                                                                                     // 1131
            ).pipe(function () {                                                                                       // 1132
                return Array.prototype.concat.apply(                                                                   // 1133
                    [],                                                                                                // 1134
                    arguments                                                                                          // 1135
                );                                                                                                     // 1136
            });                                                                                                        // 1137
        },                                                                                                             // 1138
                                                                                                                       // 1139
        _getDroppedFiles: function (dataTransfer) {                                                                    // 1140
            dataTransfer = dataTransfer || {};                                                                         // 1141
            var items = dataTransfer.items;                                                                            // 1142
            if (items && items.length && (items[0].webkitGetAsEntry ||                                                 // 1143
                    items[0].getAsEntry)) {                                                                            // 1144
                return this._handleFileTreeEntries(                                                                    // 1145
                    $.map(items, function (item) {                                                                     // 1146
                        var entry;                                                                                     // 1147
                        if (item.webkitGetAsEntry) {                                                                   // 1148
                            entry = item.webkitGetAsEntry();                                                           // 1149
                            if (entry) {                                                                               // 1150
                                // Workaround for Chrome bug #149735:                                                  // 1151
                                entry._file = item.getAsFile();                                                        // 1152
                            }                                                                                          // 1153
                            return entry;                                                                              // 1154
                        }                                                                                              // 1155
                        return item.getAsEntry();                                                                      // 1156
                    })                                                                                                 // 1157
                );                                                                                                     // 1158
            }                                                                                                          // 1159
            return $.Deferred().resolve(                                                                               // 1160
                $.makeArray(dataTransfer.files)                                                                        // 1161
            ).promise();                                                                                               // 1162
        },                                                                                                             // 1163
                                                                                                                       // 1164
        _getSingleFileInputFiles: function (fileInput) {                                                               // 1165
            fileInput = $(fileInput);                                                                                  // 1166
            var entries = fileInput.prop('webkitEntries') ||                                                           // 1167
                    fileInput.prop('entries'),                                                                         // 1168
                files,                                                                                                 // 1169
                value;                                                                                                 // 1170
            if (entries && entries.length) {                                                                           // 1171
                return this._handleFileTreeEntries(entries);                                                           // 1172
            }                                                                                                          // 1173
            files = $.makeArray(fileInput.prop('files'));                                                              // 1174
            if (!files.length) {                                                                                       // 1175
                value = fileInput.prop('value');                                                                       // 1176
                if (!value) {                                                                                          // 1177
                    return $.Deferred().resolve([]).promise();                                                         // 1178
                }                                                                                                      // 1179
                // If the files property is not available, the browser does not                                        // 1180
                // support the File API and we add a pseudo File object with                                           // 1181
                // the input value as name with path information removed:                                              // 1182
                files = [{name: value.replace(/^.*\\/, '')}];                                                          // 1183
            } else if (files[0].name === undefined && files[0].fileName) {                                             // 1184
                // File normalization for Safari 4 and Firefox 3:                                                      // 1185
                $.each(files, function (index, file) {                                                                 // 1186
                    file.name = file.fileName;                                                                         // 1187
                    file.size = file.fileSize;                                                                         // 1188
                });                                                                                                    // 1189
            }                                                                                                          // 1190
            return $.Deferred().resolve(files).promise();                                                              // 1191
        },                                                                                                             // 1192
                                                                                                                       // 1193
        _getFileInputFiles: function (fileInput) {                                                                     // 1194
            if (!(fileInput instanceof $) || fileInput.length === 1) {                                                 // 1195
                return this._getSingleFileInputFiles(fileInput);                                                       // 1196
            }                                                                                                          // 1197
            return $.when.apply(                                                                                       // 1198
                $,                                                                                                     // 1199
                $.map(fileInput, this._getSingleFileInputFiles)                                                        // 1200
            ).pipe(function () {                                                                                       // 1201
                return Array.prototype.concat.apply(                                                                   // 1202
                    [],                                                                                                // 1203
                    arguments                                                                                          // 1204
                );                                                                                                     // 1205
            });                                                                                                        // 1206
        },                                                                                                             // 1207
                                                                                                                       // 1208
        _onChange: function (e) {                                                                                      // 1209
            var that = this,                                                                                           // 1210
                data = {                                                                                               // 1211
                    fileInput: $(e.target),                                                                            // 1212
                    form: $(e.target.form)                                                                             // 1213
                };                                                                                                     // 1214
            this._getFileInputFiles(data.fileInput).always(function (files) {                                          // 1215
                data.files = files;                                                                                    // 1216
                if (that.options.replaceFileInput) {                                                                   // 1217
                    that._replaceFileInput(data);                                                                      // 1218
                }                                                                                                      // 1219
                if (that._trigger(                                                                                     // 1220
                        'change',                                                                                      // 1221
                        $.Event('change', {delegatedEvent: e}),                                                        // 1222
                        data                                                                                           // 1223
                    ) !== false) {                                                                                     // 1224
                    that._onAdd(e, data);                                                                              // 1225
                }                                                                                                      // 1226
            });                                                                                                        // 1227
        },                                                                                                             // 1228
                                                                                                                       // 1229
        _onPaste: function (e) {                                                                                       // 1230
            var items = e.originalEvent && e.originalEvent.clipboardData &&                                            // 1231
                    e.originalEvent.clipboardData.items,                                                               // 1232
                data = {files: []};                                                                                    // 1233
            if (items && items.length) {                                                                               // 1234
                $.each(items, function (index, item) {                                                                 // 1235
                    var file = item.getAsFile && item.getAsFile();                                                     // 1236
                    if (file) {                                                                                        // 1237
                        data.files.push(file);                                                                         // 1238
                    }                                                                                                  // 1239
                });                                                                                                    // 1240
                if (this._trigger(                                                                                     // 1241
                        'paste',                                                                                       // 1242
                        $.Event('paste', {delegatedEvent: e}),                                                         // 1243
                        data                                                                                           // 1244
                    ) !== false) {                                                                                     // 1245
                    this._onAdd(e, data);                                                                              // 1246
                }                                                                                                      // 1247
            }                                                                                                          // 1248
        },                                                                                                             // 1249
                                                                                                                       // 1250
        _onDrop: function (e) {                                                                                        // 1251
            e.dataTransfer = e.originalEvent && e.originalEvent.dataTransfer;                                          // 1252
            var that = this,                                                                                           // 1253
                dataTransfer = e.dataTransfer,                                                                         // 1254
                data = {};                                                                                             // 1255
            if (dataTransfer && dataTransfer.files && dataTransfer.files.length) {                                     // 1256
                e.preventDefault();                                                                                    // 1257
                this._getDroppedFiles(dataTransfer).always(function (files) {                                          // 1258
                    data.files = files;                                                                                // 1259
                    if (that._trigger(                                                                                 // 1260
                            'drop',                                                                                    // 1261
                            $.Event('drop', {delegatedEvent: e}),                                                      // 1262
                            data                                                                                       // 1263
                        ) !== false) {                                                                                 // 1264
                        that._onAdd(e, data);                                                                          // 1265
                    }                                                                                                  // 1266
                });                                                                                                    // 1267
            }                                                                                                          // 1268
        },                                                                                                             // 1269
                                                                                                                       // 1270
        _onDragOver: getDragHandler('dragover'),                                                                       // 1271
                                                                                                                       // 1272
        _onDragEnter: getDragHandler('dragenter'),                                                                     // 1273
                                                                                                                       // 1274
        _onDragLeave: getDragHandler('dragleave'),                                                                     // 1275
                                                                                                                       // 1276
        _initEventHandlers: function () {                                                                              // 1277
            if (this._isXHRUpload(this.options)) {                                                                     // 1278
                this._on(this.options.dropZone, {                                                                      // 1279
                    dragover: this._onDragOver,                                                                        // 1280
                    drop: this._onDrop,                                                                                // 1281
                    // event.preventDefault() on dragenter is required for IE10+:                                      // 1282
                    dragenter: this._onDragEnter,                                                                      // 1283
                    // dragleave is not required, but added for completeness:                                          // 1284
                    dragleave: this._onDragLeave                                                                       // 1285
                });                                                                                                    // 1286
                this._on(this.options.pasteZone, {                                                                     // 1287
                    paste: this._onPaste                                                                               // 1288
                });                                                                                                    // 1289
            }                                                                                                          // 1290
            if ($.support.fileInput) {                                                                                 // 1291
                this._on(this.options.fileInput, {                                                                     // 1292
                    change: this._onChange                                                                             // 1293
                });                                                                                                    // 1294
            }                                                                                                          // 1295
        },                                                                                                             // 1296
                                                                                                                       // 1297
        _destroyEventHandlers: function () {                                                                           // 1298
            this._off(this.options.dropZone, 'dragenter dragleave dragover drop');                                     // 1299
            this._off(this.options.pasteZone, 'paste');                                                                // 1300
            this._off(this.options.fileInput, 'change');                                                               // 1301
        },                                                                                                             // 1302
                                                                                                                       // 1303
        _setOption: function (key, value) {                                                                            // 1304
            var reinit = $.inArray(key, this._specialOptions) !== -1;                                                  // 1305
            if (reinit) {                                                                                              // 1306
                this._destroyEventHandlers();                                                                          // 1307
            }                                                                                                          // 1308
            this._super(key, value);                                                                                   // 1309
            if (reinit) {                                                                                              // 1310
                this._initSpecialOptions();                                                                            // 1311
                this._initEventHandlers();                                                                             // 1312
            }                                                                                                          // 1313
        },                                                                                                             // 1314
                                                                                                                       // 1315
        _initSpecialOptions: function () {                                                                             // 1316
            var options = this.options;                                                                                // 1317
            if (options.fileInput === undefined) {                                                                     // 1318
                options.fileInput = this.element.is('input[type="file"]') ?                                            // 1319
                        this.element : this.element.find('input[type="file"]');                                        // 1320
            } else if (!(options.fileInput instanceof $)) {                                                            // 1321
                options.fileInput = $(options.fileInput);                                                              // 1322
            }                                                                                                          // 1323
            if (!(options.dropZone instanceof $)) {                                                                    // 1324
                options.dropZone = $(options.dropZone);                                                                // 1325
            }                                                                                                          // 1326
            if (!(options.pasteZone instanceof $)) {                                                                   // 1327
                options.pasteZone = $(options.pasteZone);                                                              // 1328
            }                                                                                                          // 1329
        },                                                                                                             // 1330
                                                                                                                       // 1331
        _getRegExp: function (str) {                                                                                   // 1332
            var parts = str.split('/'),                                                                                // 1333
                modifiers = parts.pop();                                                                               // 1334
            parts.shift();                                                                                             // 1335
            return new RegExp(parts.join('/'), modifiers);                                                             // 1336
        },                                                                                                             // 1337
                                                                                                                       // 1338
        _isRegExpOption: function (key, value) {                                                                       // 1339
            return key !== 'url' && $.type(value) === 'string' &&                                                      // 1340
                /^\/.*\/[igm]{0,3}$/.test(value);                                                                      // 1341
        },                                                                                                             // 1342
                                                                                                                       // 1343
        _initDataAttributes: function () {                                                                             // 1344
            var that = this,                                                                                           // 1345
                options = this.options,                                                                                // 1346
                data = this.element.data();                                                                            // 1347
            // Initialize options set via HTML5 data-attributes:                                                       // 1348
            $.each(                                                                                                    // 1349
                this.element[0].attributes,                                                                            // 1350
                function (index, attr) {                                                                               // 1351
                    var key = attr.name.toLowerCase(),                                                                 // 1352
                        value;                                                                                         // 1353
                    if (/^data-/.test(key)) {                                                                          // 1354
                        // Convert hyphen-ated key to camelCase:                                                       // 1355
                        key = key.slice(5).replace(/-[a-z]/g, function (str) {                                         // 1356
                            return str.charAt(1).toUpperCase();                                                        // 1357
                        });                                                                                            // 1358
                        value = data[key];                                                                             // 1359
                        if (that._isRegExpOption(key, value)) {                                                        // 1360
                            value = that._getRegExp(value);                                                            // 1361
                        }                                                                                              // 1362
                        options[key] = value;                                                                          // 1363
                    }                                                                                                  // 1364
                }                                                                                                      // 1365
            );                                                                                                         // 1366
        },                                                                                                             // 1367
                                                                                                                       // 1368
        _create: function () {                                                                                         // 1369
            this._initDataAttributes();                                                                                // 1370
            this._initSpecialOptions();                                                                                // 1371
            this._slots = [];                                                                                          // 1372
            this._sequence = this._getXHRPromise(true);                                                                // 1373
            this._sending = this._active = 0;                                                                          // 1374
            this._initProgressObject(this);                                                                            // 1375
            this._initEventHandlers();                                                                                 // 1376
        },                                                                                                             // 1377
                                                                                                                       // 1378
        // This method is exposed to the widget API and allows to query                                                // 1379
        // the number of active uploads:                                                                               // 1380
        active: function () {                                                                                          // 1381
            return this._active;                                                                                       // 1382
        },                                                                                                             // 1383
                                                                                                                       // 1384
        // This method is exposed to the widget API and allows to query                                                // 1385
        // the widget upload progress.                                                                                 // 1386
        // It returns an object with loaded, total and bitrate properties                                              // 1387
        // for the running uploads:                                                                                    // 1388
        progress: function () {                                                                                        // 1389
            return this._progress;                                                                                     // 1390
        },                                                                                                             // 1391
                                                                                                                       // 1392
        // This method is exposed to the widget API and allows adding files                                            // 1393
        // using the fileupload API. The data parameter accepts an object which                                        // 1394
        // must have a files property and can contain additional options:                                              // 1395
        // .fileupload('add', {files: filesList});                                                                     // 1396
        add: function (data) {                                                                                         // 1397
            var that = this;                                                                                           // 1398
            if (!data || this.options.disabled) {                                                                      // 1399
                return;                                                                                                // 1400
            }                                                                                                          // 1401
            if (data.fileInput && !data.files) {                                                                       // 1402
                this._getFileInputFiles(data.fileInput).always(function (files) {                                      // 1403
                    data.files = files;                                                                                // 1404
                    that._onAdd(null, data);                                                                           // 1405
                });                                                                                                    // 1406
            } else {                                                                                                   // 1407
                data.files = $.makeArray(data.files);                                                                  // 1408
                this._onAdd(null, data);                                                                               // 1409
            }                                                                                                          // 1410
        },                                                                                                             // 1411
                                                                                                                       // 1412
        // This method is exposed to the widget API and allows sending files                                           // 1413
        // using the fileupload API. The data parameter accepts an object which                                        // 1414
        // must have a files or fileInput property and can contain additional options:                                 // 1415
        // .fileupload('send', {files: filesList});                                                                    // 1416
        // The method returns a Promise object for the file upload call.                                               // 1417
        send: function (data) {                                                                                        // 1418
            if (data && !this.options.disabled) {                                                                      // 1419
                if (data.fileInput && !data.files) {                                                                   // 1420
                    var that = this,                                                                                   // 1421
                        dfd = $.Deferred(),                                                                            // 1422
                        promise = dfd.promise(),                                                                       // 1423
                        jqXHR,                                                                                         // 1424
                        aborted;                                                                                       // 1425
                    promise.abort = function () {                                                                      // 1426
                        aborted = true;                                                                                // 1427
                        if (jqXHR) {                                                                                   // 1428
                            return jqXHR.abort();                                                                      // 1429
                        }                                                                                              // 1430
                        dfd.reject(null, 'abort', 'abort');                                                            // 1431
                        return promise;                                                                                // 1432
                    };                                                                                                 // 1433
                    this._getFileInputFiles(data.fileInput).always(                                                    // 1434
                        function (files) {                                                                             // 1435
                            if (aborted) {                                                                             // 1436
                                return;                                                                                // 1437
                            }                                                                                          // 1438
                            if (!files.length) {                                                                       // 1439
                                dfd.reject();                                                                          // 1440
                                return;                                                                                // 1441
                            }                                                                                          // 1442
                            data.files = files;                                                                        // 1443
                            jqXHR = that._onSend(null, data);                                                          // 1444
                            jqXHR.then(                                                                                // 1445
                                function (result, textStatus, jqXHR) {                                                 // 1446
                                    dfd.resolve(result, textStatus, jqXHR);                                            // 1447
                                },                                                                                     // 1448
                                function (jqXHR, textStatus, errorThrown) {                                            // 1449
                                    dfd.reject(jqXHR, textStatus, errorThrown);                                        // 1450
                                }                                                                                      // 1451
                            );                                                                                         // 1452
                        }                                                                                              // 1453
                    );                                                                                                 // 1454
                    return this._enhancePromise(promise);                                                              // 1455
                }                                                                                                      // 1456
                data.files = $.makeArray(data.files);                                                                  // 1457
                if (data.files.length) {                                                                               // 1458
                    return this._onSend(null, data);                                                                   // 1459
                }                                                                                                      // 1460
            }                                                                                                          // 1461
            return this._getXHRPromise(false, data && data.context);                                                   // 1462
        }                                                                                                              // 1463
                                                                                                                       // 1464
    });                                                                                                                // 1465
                                                                                                                       // 1466
}));                                                                                                                   // 1467
                                                                                                                       // 1468
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/compatibility/bower_components/medium-editor-insert-plugin/dist/js/medium-editor-insert-pl //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
/*!                                                                                                                    // 1
 * medium-editor-insert-plugin v1.7.0 - jQuery insert plugin for MediumEditor                                          // 2
 *                                                                                                                     // 3
 * https://github.com/orthes/medium-editor-insert-plugin                                                               // 4
 *                                                                                                                     // 5
 * Copyright (c) 2014 Pavel Linkesch (http://linkesch.sk)                                                              // 6
 * Released under the MIT license                                                                                      // 7
 */                                                                                                                    // 8
                                                                                                                       // 9
this["MediumInsert"] = this["MediumInsert"] || {};                                                                     // 10
this["MediumInsert"]["Templates"] = this["MediumInsert"]["Templates"] || {};                                           // 11
                                                                                                                       // 12
this["MediumInsert"]["Templates"]["src/js/templates/core-buttons.hbs"] = Handlebars.template({"1":function(depth0,helpers,partials,data) {
  var stack1, helper, lambda=this.lambda, escapeExpression=this.escapeExpression, functionType="function", helperMissing=helpers.helperMissing, buffer = "            <li><a data-addon=\""
    + escapeExpression(lambda((data && data.key), depth0))                                                             // 15
    + "\" data-action=\"add\" class=\"medium-insert-action\">";                                                        // 16
  stack1 = ((helper = (helper = helpers.label || (depth0 != null ? depth0.label : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"label","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }                                                                            // 18
  return buffer + "</a></li>\n";                                                                                       // 19
},"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {                                     // 20
  var stack1, buffer = "<div class=\"medium-insert-buttons\" contenteditable=\"false\" style=\"display: none\">\n    <a class=\"medium-insert-buttons-show\">+</a>\n    <ul class=\"medium-insert-buttons-addons\" style=\"display: none\">\n";
  stack1 = helpers.each.call(depth0, (depth0 != null ? depth0.addons : depth0), {"name":"each","hash":{},"fn":this.program(1, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }                                                                            // 23
  return buffer + "    </ul>\n</div>\n";                                                                               // 24
},"useData":true});                                                                                                    // 25
                                                                                                                       // 26
this["MediumInsert"]["Templates"]["src/js/templates/core-caption.hbs"] = Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;    // 28
  return "<figcaption contenteditable=\"true\" class=\"medium-insert-caption-placeholder\" data-placeholder=\""        // 29
    + escapeExpression(((helper = (helper = helpers.placeholder || (depth0 != null ? depth0.placeholder : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"placeholder","hash":{},"data":data}) : helper)))
    + "\"></figcaption>";                                                                                              // 31
},"useData":true});                                                                                                    // 32
                                                                                                                       // 33
this["MediumInsert"]["Templates"]["src/js/templates/core-empty-line.hbs"] = Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  return "<p><br></p>\n";                                                                                              // 35
  },"useData":true});                                                                                                  // 36
                                                                                                                       // 37
this["MediumInsert"]["Templates"]["src/js/templates/embeds-toolbar.hbs"] = Handlebars.template({"1":function(depth0,helpers,partials,data) {
  var stack1, buffer = "    <div class=\"medium-insert-embeds-toolbar medium-editor-toolbar medium-toolbar-arrow-under medium-editor-toolbar-active\">\n        <ul class=\"medium-editor-toolbar-actions clearfix\">\n";
  stack1 = helpers.each.call(depth0, (depth0 != null ? depth0.styles : depth0), {"name":"each","hash":{},"fn":this.program(2, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }                                                                            // 41
  return buffer + "        </ul>\n    </div>\n";                                                                       // 42
},"2":function(depth0,helpers,partials,data) {                                                                         // 43
  var stack1, buffer = "";                                                                                             // 44
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.label : depth0), {"name":"if","hash":{},"fn":this.program(3, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }                                                                            // 46
  return buffer;                                                                                                       // 47
},"3":function(depth0,helpers,partials,data) {                                                                         // 48
  var stack1, helper, lambda=this.lambda, escapeExpression=this.escapeExpression, functionType="function", helperMissing=helpers.helperMissing, buffer = "                    <li>\n                        <button class=\"medium-editor-action\" data-action=\""
    + escapeExpression(lambda((data && data.key), depth0))                                                             // 50
    + "\">";                                                                                                           // 51
  stack1 = ((helper = (helper = helpers.label || (depth0 != null ? depth0.label : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"label","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }                                                                            // 53
  return buffer + "</button>\n                    </li>\n";                                                            // 54
},"5":function(depth0,helpers,partials,data) {                                                                         // 55
  var stack1, buffer = "    <div class=\"medium-insert-embeds-toolbar2 medium-editor-toolbar medium-editor-toolbar-active\">\n        <ul class=\"medium-editor-toolbar-actions clearfix\">\n";
  stack1 = helpers.each.call(depth0, (depth0 != null ? depth0.actions : depth0), {"name":"each","hash":{},"fn":this.program(2, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }                                                                            // 58
  return buffer + "        </ul>\n    </div>\n";                                                                       // 59
},"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {                                     // 60
  var stack1, buffer = "";                                                                                             // 61
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.styles : depth0), {"name":"if","hash":{},"fn":this.program(1, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }                                                                            // 63
  buffer += "\n";                                                                                                      // 64
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.actions : depth0), {"name":"if","hash":{},"fn":this.program(5, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }                                                                            // 66
  return buffer;                                                                                                       // 67
},"useData":true});                                                                                                    // 68
                                                                                                                       // 69
this["MediumInsert"]["Templates"]["src/js/templates/embeds-wrapper.hbs"] = Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, helper, functionType="function", helperMissing=helpers.helperMissing, buffer = "<div class=\"medium-insert-embeds\" contenteditable=\"false\">\n	<figure>\n		<div class=\"medium-insert-embed\">\n			";
  stack1 = ((helper = (helper = helpers.html || (depth0 != null ? depth0.html : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"html","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }                                                                            // 73
  return buffer + "\n		</div>\n	</figure>\n	<div class=\"medium-insert-embeds-overlay\"></div>\n</div>";               // 74
},"useData":true});                                                                                                    // 75
                                                                                                                       // 76
this["MediumInsert"]["Templates"]["src/js/templates/images-fileupload.hbs"] = Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  return "<input type=\"file\" multiple>";                                                                             // 78
  },"useData":true});                                                                                                  // 79
                                                                                                                       // 80
this["MediumInsert"]["Templates"]["src/js/templates/images-image.hbs"] = Handlebars.template({"1":function(depth0,helpers,partials,data) {
  return "        <div class=\"medium-insert-images-progress\"></div>\n";                                              // 82
  },"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {                                   // 83
  var stack1, helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, buffer = "<figure contenteditable=\"false\">\n    <img src=\""
    + escapeExpression(((helper = (helper = helpers.img || (depth0 != null ? depth0.img : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"img","hash":{},"data":data}) : helper)))
    + "\" alt=\"\">\n";                                                                                                // 86
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.progress : depth0), {"name":"if","hash":{},"fn":this.program(1, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }                                                                            // 88
  return buffer + "</figure>";                                                                                         // 89
},"useData":true});                                                                                                    // 90
                                                                                                                       // 91
this["MediumInsert"]["Templates"]["src/js/templates/images-progressbar.hbs"] = Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  return "<progress min=\"0\" max=\"100\" value=\"0\">0</progress>";                                                   // 93
  },"useData":true});                                                                                                  // 94
                                                                                                                       // 95
this["MediumInsert"]["Templates"]["src/js/templates/images-toolbar.hbs"] = Handlebars.template({"1":function(depth0,helpers,partials,data) {
  var stack1, buffer = "";                                                                                             // 97
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.label : depth0), {"name":"if","hash":{},"fn":this.program(2, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }                                                                            // 99
  return buffer;                                                                                                       // 100
},"2":function(depth0,helpers,partials,data) {                                                                         // 101
  var stack1, helper, lambda=this.lambda, escapeExpression=this.escapeExpression, functionType="function", helperMissing=helpers.helperMissing, buffer = "                <li>\n                    <button class=\"medium-editor-action\" data-action=\""
    + escapeExpression(lambda((data && data.key), depth0))                                                             // 103
    + "\">";                                                                                                           // 104
  stack1 = ((helper = (helper = helpers.label || (depth0 != null ? depth0.label : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"label","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }                                                                            // 106
  return buffer + "</button>\n                </li>\n";                                                                // 107
},"4":function(depth0,helpers,partials,data) {                                                                         // 108
  var stack1, buffer = "	<div class=\"medium-insert-images-toolbar2 medium-editor-toolbar medium-editor-toolbar-active\">\n		<ul class=\"medium-editor-toolbar-actions clearfix\">\n";
  stack1 = helpers.each.call(depth0, (depth0 != null ? depth0.actions : depth0), {"name":"each","hash":{},"fn":this.program(5, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }                                                                            // 111
  return buffer + "    	</ul>\n    </div>\n";                                                                          // 112
},"5":function(depth0,helpers,partials,data) {                                                                         // 113
  var stack1, buffer = "";                                                                                             // 114
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.label : depth0), {"name":"if","hash":{},"fn":this.program(6, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }                                                                            // 116
  return buffer;                                                                                                       // 117
},"6":function(depth0,helpers,partials,data) {                                                                         // 118
  var stack1, helper, lambda=this.lambda, escapeExpression=this.escapeExpression, functionType="function", helperMissing=helpers.helperMissing, buffer = "        	        <li>\n        	            <button class=\"medium-editor-action\" data-action=\""
    + escapeExpression(lambda((data && data.key), depth0))                                                             // 120
    + "\">";                                                                                                           // 121
  stack1 = ((helper = (helper = helpers.label || (depth0 != null ? depth0.label : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"label","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }                                                                            // 123
  return buffer + "</button>\n        	        </li>\n";                                                               // 124
},"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {                                     // 125
  var stack1, buffer = "<div class=\"medium-insert-images-toolbar medium-editor-toolbar medium-toolbar-arrow-under medium-editor-toolbar-active\">\n    <ul class=\"medium-editor-toolbar-actions clearfix\">\n";
  stack1 = helpers.each.call(depth0, (depth0 != null ? depth0.styles : depth0), {"name":"each","hash":{},"fn":this.program(1, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }                                                                            // 128
  buffer += "    </ul>\n</div>\n\n";                                                                                   // 129
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.actions : depth0), {"name":"if","hash":{},"fn":this.program(4, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }                                                                            // 131
  return buffer;                                                                                                       // 132
},"useData":true});                                                                                                    // 133
;(function ($, window, document, undefined) {                                                                          // 134
                                                                                                                       // 135
    'use strict';                                                                                                      // 136
                                                                                                                       // 137
    /** Default values */                                                                                              // 138
    var pluginName = 'mediumInsert',                                                                                   // 139
        defaults = {                                                                                                   // 140
            editor: null,                                                                                              // 141
            enabled: true,                                                                                             // 142
            addons: {                                                                                                  // 143
                images: true, // boolean or object containing configuration                                            // 144
                embeds: true                                                                                           // 145
            }                                                                                                          // 146
        };                                                                                                             // 147
                                                                                                                       // 148
    /**                                                                                                                // 149
     * Capitalize first character                                                                                      // 150
     *                                                                                                                 // 151
     * @param {string} str                                                                                             // 152
     * @return {string}                                                                                                // 153
     */                                                                                                                // 154
                                                                                                                       // 155
    function ucfirst (str) {                                                                                           // 156
        return str.charAt(0).toUpperCase() + str.slice(1);                                                             // 157
    }                                                                                                                  // 158
                                                                                                                       // 159
    /**                                                                                                                // 160
     * Core plugin's object                                                                                            // 161
     *                                                                                                                 // 162
     * Sets options, variables and calls init() function                                                               // 163
     *                                                                                                                 // 164
     * @constructor                                                                                                    // 165
     * @param {DOM} el - DOM element to init the plugin on                                                             // 166
     * @param {object} options - Options to override defaults                                                          // 167
     * @return {void}                                                                                                  // 168
     */                                                                                                                // 169
                                                                                                                       // 170
    function Core (el, options) {                                                                                      // 171
        var editor;                                                                                                    // 172
                                                                                                                       // 173
        this.el = el;                                                                                                  // 174
        this.$el = $(el);                                                                                              // 175
        this.templates = window.MediumInsert.Templates;                                                                // 176
                                                                                                                       // 177
        if (options) {                                                                                                 // 178
            // Fix #142                                                                                                // 179
            // Avoid deep copying editor object, because since v2.3.0 it contains circular references which causes jQuery.extend to break
            // Instead copy editor object to this.options manually                                                     // 181
            editor = options.editor;                                                                                   // 182
            options.editor = null;                                                                                     // 183
        }                                                                                                              // 184
        this.options = $.extend(true, {}, defaults, options);                                                          // 185
        this.options.editor = editor;                                                                                  // 186
                                                                                                                       // 187
        this._defaults = defaults;                                                                                     // 188
        this._name = pluginName;                                                                                       // 189
                                                                                                                       // 190
        // Extend editor's functions                                                                                   // 191
        if (this.options && this.options.editor) {                                                                     // 192
            // Deprecated in editor                                                                                    // 193
            this.options.editor._deactivate = this.options.editor.deactivate;                                          // 194
            this.options.editor._activate = this.options.editor.activate;                                              // 195
            this.options.editor.deactivate = this.editorDeactivate;                                                    // 196
            this.options.editor.activate = this.editorActivate;                                                        // 197
                                                                                                                       // 198
            this.options.editor._serialize = this.options.editor.serialize;                                            // 199
            this.options.editor._destroy = this.options.editor.destroy;                                                // 200
            this.options.editor._setup = this.options.editor.setup;                                                    // 201
            this.options.editor._hideInsertButtons = this.hideButtons;                                                 // 202
            this.options.editor.serialize = this.editorSerialize;                                                      // 203
            this.options.editor.destroy = this.editorDestroy;                                                          // 204
            this.options.editor.setup = this.editorSetup;                                                              // 205
            this.options.editor.placeholders.updatePlaceholder = this.editorUpdatePlaceholder;                         // 206
        }                                                                                                              // 207
    }                                                                                                                  // 208
                                                                                                                       // 209
    /**                                                                                                                // 210
     * Initialization                                                                                                  // 211
     *                                                                                                                 // 212
     * @return {void}                                                                                                  // 213
     */                                                                                                                // 214
                                                                                                                       // 215
    Core.prototype.init = function () {                                                                                // 216
        this.$el.addClass('medium-editor-insert-plugin');                                                              // 217
                                                                                                                       // 218
        if (typeof this.options.addons !== 'object' || Object.keys(this.options.addons).length === 0) {                // 219
            this.disable();                                                                                            // 220
        }                                                                                                              // 221
                                                                                                                       // 222
        this.initAddons();                                                                                             // 223
        this.clean();                                                                                                  // 224
        this.events();                                                                                                 // 225
    };                                                                                                                 // 226
                                                                                                                       // 227
    /**                                                                                                                // 228
     * Event listeners                                                                                                 // 229
     *                                                                                                                 // 230
     * @return {void}                                                                                                  // 231
     */                                                                                                                // 232
                                                                                                                       // 233
    Core.prototype.events = function () {                                                                              // 234
        var that = this;                                                                                               // 235
                                                                                                                       // 236
        this.$el                                                                                                       // 237
            .on('dragover drop', function (e) {                                                                        // 238
                e.preventDefault();                                                                                    // 239
            })                                                                                                         // 240
            .on('keyup click', $.proxy(this, 'toggleButtons'))                                                         // 241
            .on('selectstart mousedown', '.medium-insert, .medium-insert-buttons', $.proxy(this, 'disableSelection'))  // 242
            .on('click', '.medium-insert-buttons-show', $.proxy(this, 'toggleAddons'))                                 // 243
            .on('click', '.medium-insert-action', $.proxy(this, 'addonAction'))                                        // 244
            .on('paste', '.medium-insert-caption-placeholder', function (e) {                                          // 245
                $.proxy(that, 'removeCaptionPlaceholder')($(e.target));                                                // 246
            });                                                                                                        // 247
                                                                                                                       // 248
        $(window).on('resize', $.proxy(this, 'positionButtons', null));                                                // 249
    };                                                                                                                 // 250
                                                                                                                       // 251
    /**                                                                                                                // 252
     * Return editor instance                                                                                          // 253
     *                                                                                                                 // 254
     * @return {object} MediumEditor                                                                                   // 255
     */                                                                                                                // 256
                                                                                                                       // 257
    Core.prototype.getEditor = function () {                                                                           // 258
        return this.options.editor;                                                                                    // 259
    };                                                                                                                 // 260
                                                                                                                       // 261
    /**                                                                                                                // 262
     * Extend editor's serialize function                                                                              // 263
     *                                                                                                                 // 264
     * @return {object} Serialized data                                                                                // 265
     */                                                                                                                // 266
                                                                                                                       // 267
    Core.prototype.editorSerialize = function () {                                                                     // 268
        var data = this._serialize();                                                                                  // 269
                                                                                                                       // 270
        $.each(data, function (key) {                                                                                  // 271
            var $data = $('<div />').html(data[key].value);                                                            // 272
                                                                                                                       // 273
            $data.find('.medium-insert-buttons').remove();                                                             // 274
                                                                                                                       // 275
            data[key].value = $data.html();                                                                            // 276
        });                                                                                                            // 277
                                                                                                                       // 278
        return data;                                                                                                   // 279
    };                                                                                                                 // 280
                                                                                                                       // 281
    /**                                                                                                                // 282
     * Extend editor's deactivate function to deactivate this plugin too                                               // 283
     *                                                                                                                 // 284
     * @deprecated                                                                                                     // 285
     * @return {void}                                                                                                  // 286
     */                                                                                                                // 287
                                                                                                                       // 288
    Core.prototype.editorDeactivate = function () {                                                                    // 289
        $.each(this.elements, function (key, el) {                                                                     // 290
            $(el).data('plugin_' + pluginName).disable();                                                              // 291
        });                                                                                                            // 292
                                                                                                                       // 293
        this._deactivate();                                                                                            // 294
    };                                                                                                                 // 295
                                                                                                                       // 296
    /**                                                                                                                // 297
     * Extend editor's activate function to activate this plugin too                                                   // 298
     *                                                                                                                 // 299
     * @deprecated                                                                                                     // 300
     * @return {void}                                                                                                  // 301
     */                                                                                                                // 302
                                                                                                                       // 303
    Core.prototype.editorActivate = function () {                                                                      // 304
        this._activate();                                                                                              // 305
                                                                                                                       // 306
        $.each(this.elements, function (key, el) {                                                                     // 307
            $(el).data('plugin_' + pluginName).enable();                                                               // 308
        });                                                                                                            // 309
    };                                                                                                                 // 310
                                                                                                                       // 311
    /**                                                                                                                // 312
     * Extend editor's destroy function to deactivate this plugin too                                                  // 313
     *                                                                                                                 // 314
     * @return {void}                                                                                                  // 315
     */                                                                                                                // 316
                                                                                                                       // 317
    Core.prototype.editorDestroy = function () {                                                                       // 318
        $.each(this.elements, function (key, el) {                                                                     // 319
            $(el).data('plugin_' + pluginName).disable();                                                              // 320
        });                                                                                                            // 321
                                                                                                                       // 322
        this._destroy();                                                                                               // 323
    };                                                                                                                 // 324
                                                                                                                       // 325
    /**                                                                                                                // 326
     * Extend editor's setup function to activate this plugin too                                                      // 327
     *                                                                                                                 // 328
     * @return {void}                                                                                                  // 329
     */                                                                                                                // 330
                                                                                                                       // 331
    Core.prototype.editorSetup = function () {                                                                         // 332
        this._setup();                                                                                                 // 333
                                                                                                                       // 334
        $.each(this.elements, function (key, el) {                                                                     // 335
            $(el).data('plugin_' + pluginName).enable();                                                               // 336
        });                                                                                                            // 337
    };                                                                                                                 // 338
                                                                                                                       // 339
    /**                                                                                                                // 340
     * Extend editor's placeholder.updatePlaceholder function to show placeholder dispite of the plugin buttons        // 341
     *                                                                                                                 // 342
     * @return {void}                                                                                                  // 343
     */                                                                                                                // 344
                                                                                                                       // 345
    Core.prototype.editorUpdatePlaceholder = function (el) {                                                           // 346
        var $clone = $(el).clone(),                                                                                    // 347
            cloneHtml;                                                                                                 // 348
                                                                                                                       // 349
        $clone.find('.medium-insert-buttons').remove();                                                                // 350
        cloneHtml = $clone.html().replace(/^\s+|\s+$/g, '').replace(/^<p( class="medium-insert-active")?><br><\/p>$/, '');
                                                                                                                       // 352
        if (!(el.querySelector('img')) &&                                                                              // 353
            !(el.querySelector('blockquote')) &&                                                                       // 354
            cloneHtml === '') {                                                                                        // 355
                                                                                                                       // 356
            this.showPlaceholder(el);                                                                                  // 357
            this.base._hideInsertButtons($(el));                                                                       // 358
        } else {                                                                                                       // 359
            this.hidePlaceholder(el);                                                                                  // 360
        }                                                                                                              // 361
    };                                                                                                                 // 362
                                                                                                                       // 363
    /**                                                                                                                // 364
     * Deselects selected text                                                                                         // 365
     *                                                                                                                 // 366
     * @return {void}                                                                                                  // 367
     */                                                                                                                // 368
                                                                                                                       // 369
    Core.prototype.deselect = function () {                                                                            // 370
        document.getSelection().removeAllRanges();                                                                     // 371
    };                                                                                                                 // 372
                                                                                                                       // 373
    /**                                                                                                                // 374
     * Disables the plugin                                                                                             // 375
     *                                                                                                                 // 376
     * @return {void}                                                                                                  // 377
     */                                                                                                                // 378
                                                                                                                       // 379
    Core.prototype.disable = function () {                                                                             // 380
        this.options.enabled = false;                                                                                  // 381
                                                                                                                       // 382
        this.$el.find('.medium-insert-buttons').addClass('hide');                                                      // 383
    };                                                                                                                 // 384
                                                                                                                       // 385
    /**                                                                                                                // 386
     * Enables the plugin                                                                                              // 387
     *                                                                                                                 // 388
     * @return {void}                                                                                                  // 389
     */                                                                                                                // 390
                                                                                                                       // 391
    Core.prototype.enable = function () {                                                                              // 392
        this.options.enabled = true;                                                                                   // 393
                                                                                                                       // 394
        this.$el.find('.medium-insert-buttons').removeClass('hide');                                                   // 395
    };                                                                                                                 // 396
                                                                                                                       // 397
    /**                                                                                                                // 398
     * Disables selectstart mousedown events on plugin elements except images                                          // 399
     *                                                                                                                 // 400
     * @return {void}                                                                                                  // 401
     */                                                                                                                // 402
                                                                                                                       // 403
    Core.prototype.disableSelection = function (e) {                                                                   // 404
        var $el = $(e.target);                                                                                         // 405
                                                                                                                       // 406
        if ($el.is('img') === false || $el.hasClass('medium-insert-buttons-show')) {                                   // 407
            e.preventDefault();                                                                                        // 408
        }                                                                                                              // 409
    };                                                                                                                 // 410
                                                                                                                       // 411
    /**                                                                                                                // 412
     * Initialize addons                                                                                               // 413
     *                                                                                                                 // 414
     * @return {void}                                                                                                  // 415
     */                                                                                                                // 416
                                                                                                                       // 417
    Core.prototype.initAddons = function () {                                                                          // 418
        var that = this;                                                                                               // 419
                                                                                                                       // 420
        if (!this.options.addons || this.options.addons.length === 0) {                                                // 421
            return;                                                                                                    // 422
        }                                                                                                              // 423
                                                                                                                       // 424
        $.each(this.options.addons, function (addon, options) {                                                        // 425
            var addonName = pluginName + ucfirst(addon);                                                               // 426
                                                                                                                       // 427
            if (options === false) {                                                                                   // 428
                delete that.options.addons[addon];                                                                     // 429
                return;                                                                                                // 430
            }                                                                                                          // 431
                                                                                                                       // 432
            that.$el[addonName](options);                                                                              // 433
            that.options.addons[addon] = that.$el.data('plugin_'+ addonName).options;                                  // 434
        });                                                                                                            // 435
    };                                                                                                                 // 436
                                                                                                                       // 437
    /**                                                                                                                // 438
     * Cleans a content of the editor                                                                                  // 439
     *                                                                                                                 // 440
     * @return {void}                                                                                                  // 441
     */                                                                                                                // 442
                                                                                                                       // 443
    Core.prototype.clean = function () {                                                                               // 444
        var that = this,                                                                                               // 445
            $buttons, $lastEl, $text;                                                                                  // 446
                                                                                                                       // 447
        if (this.options.enabled === false) {                                                                          // 448
            return;                                                                                                    // 449
        }                                                                                                              // 450
                                                                                                                       // 451
        // Fix #39                                                                                                     // 452
        // After deleting all content (ctrl+A and delete) in Firefox, all content is deleted and only <br> appears     // 453
        // To force placeholder to appear, set <p><br></p> as content of the $el                                       // 454
                                                                                                                       // 455
        if (this.$el.html().trim() === '' || this.$el.html().trim() === '<br>') {                                      // 456
            this.$el.html(this.templates['src/js/templates/core-empty-line.hbs']().trim());                            // 457
        }                                                                                                              // 458
                                                                                                                       // 459
        // Fix #29                                                                                                     // 460
        // Wrap content text in <p></p> to avoid Firefox problems                                                      // 461
        $text = this.$el                                                                                               // 462
            .contents()                                                                                                // 463
            .filter(function () {                                                                                      // 464
                return this.nodeName === '#text' && $.trim($(this).text()) !== '';                                     // 465
            });                                                                                                        // 466
                                                                                                                       // 467
        $text.each(function () {                                                                                       // 468
            $(this).wrap('<p />');                                                                                     // 469
                                                                                                                       // 470
            // Fix #145                                                                                                // 471
            // Move caret at the end of the element that's being wrapped                                               // 472
            that.moveCaret($(this).parent(), $(this).text().length);                                                   // 473
        });                                                                                                            // 474
                                                                                                                       // 475
        this.addButtons();                                                                                             // 476
                                                                                                                       // 477
        $buttons = this.$el.find('.medium-insert-buttons');                                                            // 478
        $lastEl = $buttons.prev();                                                                                     // 479
        if ($lastEl.attr('class') && $lastEl.attr('class').match(/medium\-insert(?!\-active)/)) {                      // 480
            $buttons.before(this.templates['src/js/templates/core-empty-line.hbs']().trim());                          // 481
        }                                                                                                              // 482
    };                                                                                                                 // 483
                                                                                                                       // 484
    /**                                                                                                                // 485
     * Returns HTML template of buttons                                                                                // 486
     *                                                                                                                 // 487
     * @return {string} HTML template of buttons                                                                       // 488
     */                                                                                                                // 489
                                                                                                                       // 490
    Core.prototype.getButtons = function () {                                                                          // 491
        if (this.options.enabled === false) {                                                                          // 492
            return;                                                                                                    // 493
        }                                                                                                              // 494
                                                                                                                       // 495
        return this.templates['src/js/templates/core-buttons.hbs']({                                                   // 496
            addons: this.options.addons                                                                                // 497
        }).trim();                                                                                                     // 498
    };                                                                                                                 // 499
                                                                                                                       // 500
    /**                                                                                                                // 501
     * Appends buttons at the end of the $el                                                                           // 502
     *                                                                                                                 // 503
     * @return {void}                                                                                                  // 504
     */                                                                                                                // 505
                                                                                                                       // 506
    Core.prototype.addButtons = function () {                                                                          // 507
        if (this.$el.find('.medium-insert-buttons').length === 0) {                                                    // 508
            this.$el.append(this.getButtons());                                                                        // 509
        }                                                                                                              // 510
    };                                                                                                                 // 511
                                                                                                                       // 512
    /**                                                                                                                // 513
     * Move buttons to current active, empty paragraph and show them                                                   // 514
     *                                                                                                                 // 515
     * @return {void}                                                                                                  // 516
     */                                                                                                                // 517
                                                                                                                       // 518
    Core.prototype.toggleButtons = function (e) {                                                                      // 519
        var $el = $(e.target),                                                                                         // 520
            selection = window.getSelection(),                                                                         // 521
            that = this,                                                                                               // 522
            range, $current, $p, activeAddon;                                                                          // 523
                                                                                                                       // 524
        if (this.options.enabled === false) {                                                                          // 525
            return;                                                                                                    // 526
        }                                                                                                              // 527
                                                                                                                       // 528
        if (!selection || selection.rangeCount === 0) {                                                                // 529
            $current = $el;                                                                                            // 530
        } else {                                                                                                       // 531
            range = selection.getRangeAt(0);                                                                           // 532
            $current = $(range.commonAncestorContainer);                                                               // 533
        }                                                                                                              // 534
                                                                                                                       // 535
        // When user clicks on  editor's placeholder in FF, $current el is editor itself, not the first paragraph as it should
        if ($current.hasClass('medium-editor-insert-plugin')) {                                                        // 537
            $current = $current.find('p:first');                                                                       // 538
        }                                                                                                              // 539
                                                                                                                       // 540
        $p = $current.is('p') ? $current : $current.closest('p');                                                      // 541
                                                                                                                       // 542
        this.clean();                                                                                                  // 543
                                                                                                                       // 544
        if ($el.hasClass('medium-editor-placeholder') === false && $el.closest('.medium-insert-buttons').length === 0 && $current.closest('.medium-insert-buttons').length === 0) {
                                                                                                                       // 546
            this.$el.find('.medium-insert-active').removeClass('medium-insert-active');                                // 547
                                                                                                                       // 548
            $.each(this.options.addons, function (addon) {                                                             // 549
                if ($el.closest('.medium-insert-'+ addon).length) {                                                    // 550
                    $current = $el;                                                                                    // 551
                }                                                                                                      // 552
                                                                                                                       // 553
                if ($current.closest('.medium-insert-'+ addon).length) {                                               // 554
                    $p = $current.closest('.medium-insert-'+ addon);                                                   // 555
                    activeAddon = addon;                                                                               // 556
                    return;                                                                                            // 557
                }                                                                                                      // 558
            });                                                                                                        // 559
                                                                                                                       // 560
            if ($p.length && (($p.text().trim() === '' && !activeAddon) || activeAddon === 'images')) {                // 561
                $p.addClass('medium-insert-active');                                                                   // 562
                                                                                                                       // 563
                // If buttons are displayed on addon paragraph, wait 100ms for possible captions to display            // 564
                setTimeout(function () {                                                                               // 565
                    that.positionButtons(activeAddon);                                                                 // 566
                    that.showButtons(activeAddon);                                                                     // 567
                }, activeAddon ? 100 : 0);                                                                             // 568
            } else {                                                                                                   // 569
                this.hideButtons();                                                                                    // 570
            }                                                                                                          // 571
        }                                                                                                              // 572
    };                                                                                                                 // 573
                                                                                                                       // 574
    /**                                                                                                                // 575
     * Show buttons                                                                                                    // 576
     *                                                                                                                 // 577
     * @param {string} activeAddon - Name of active addon                                                              // 578
     * @returns {void}                                                                                                 // 579
     */                                                                                                                // 580
                                                                                                                       // 581
    Core.prototype.showButtons = function (activeAddon) {                                                              // 582
        var $buttons = this.$el.find('.medium-insert-buttons');                                                        // 583
                                                                                                                       // 584
        $buttons.show();                                                                                               // 585
        $buttons.find('li').show();                                                                                    // 586
                                                                                                                       // 587
        if (activeAddon) {                                                                                             // 588
            $buttons.find('li').hide();                                                                                // 589
            $buttons.find('a[data-addon="'+ activeAddon +'"]').parent().show();                                        // 590
        }                                                                                                              // 591
    };                                                                                                                 // 592
                                                                                                                       // 593
    /**                                                                                                                // 594
     * Hides buttons                                                                                                   // 595
     *                                                                                                                 // 596
     * @param {jQuery} $el - Editor element                                                                            // 597
     * @returns {void}                                                                                                 // 598
     */                                                                                                                // 599
                                                                                                                       // 600
    Core.prototype.hideButtons = function ($el) {                                                                      // 601
        $el = $el || this.$el;                                                                                         // 602
                                                                                                                       // 603
        $el.find('.medium-insert-buttons').hide();                                                                     // 604
        $el.find('.medium-insert-buttons-addons').hide();                                                              // 605
        $el.find('.medium-insert-buttons-show').removeClass('medium-insert-buttons-rotate');                           // 606
    };                                                                                                                 // 607
                                                                                                                       // 608
    /**                                                                                                                // 609
     * Position buttons                                                                                                // 610
     *                                                                                                                 // 611
     * @param {string} activeAddon - Name of active addon                                                              // 612
     * @return {void}                                                                                                  // 613
     */                                                                                                                // 614
                                                                                                                       // 615
    Core.prototype.positionButtons = function (activeAddon) {                                                          // 616
        var $buttons = this.$el.find('.medium-insert-buttons'),                                                        // 617
            $p = this.$el.find('.medium-insert-active'),                                                               // 618
            $first = $p.find('figure:first').length ? $p.find('figure:first') : $p,                                    // 619
            left, top;                                                                                                 // 620
                                                                                                                       // 621
        if ($p.length) {                                                                                               // 622
                                                                                                                       // 623
            left = $p.position().left - parseInt($buttons.find('.medium-insert-buttons-addons').css('left'), 10) - parseInt($buttons.find('.medium-insert-buttons-addons a:first').css('margin-left'), 10);
            left = left < 0 ? $p.position().left : left;                                                               // 625
            top = $p.position().top + parseInt($p.css('margin-top'), 10);                                              // 626
                                                                                                                       // 627
            if (activeAddon) {                                                                                         // 628
                if ($p.position().left !== $first.position().left) {                                                   // 629
                    left = $first.position().left;                                                                     // 630
                }                                                                                                      // 631
                                                                                                                       // 632
                top += $p.height() + 15; // 15px offset                                                                // 633
            }                                                                                                          // 634
                                                                                                                       // 635
            $buttons.css({                                                                                             // 636
                left: left,                                                                                            // 637
                top: top                                                                                               // 638
            });                                                                                                        // 639
        }                                                                                                              // 640
    };                                                                                                                 // 641
                                                                                                                       // 642
    /**                                                                                                                // 643
     * Toggles addons buttons                                                                                          // 644
     *                                                                                                                 // 645
     * @return {void}                                                                                                  // 646
     */                                                                                                                // 647
                                                                                                                       // 648
    Core.prototype.toggleAddons = function () {                                                                        // 649
        this.$el.find('.medium-insert-buttons-addons').fadeToggle();                                                   // 650
        this.$el.find('.medium-insert-buttons-show').toggleClass('medium-insert-buttons-rotate');                      // 651
    };                                                                                                                 // 652
                                                                                                                       // 653
    /**                                                                                                                // 654
     * Hide addons buttons                                                                                             // 655
     *                                                                                                                 // 656
     * @return {void}                                                                                                  // 657
     */                                                                                                                // 658
                                                                                                                       // 659
    Core.prototype.hideAddons = function () {                                                                          // 660
        this.$el.find('.medium-insert-buttons-addons').hide();                                                         // 661
        this.$el.find('.medium-insert-buttons-show').removeClass('medium-insert-buttons-rotate');                      // 662
    };                                                                                                                 // 663
                                                                                                                       // 664
    /**                                                                                                                // 665
     * Call addon's action                                                                                             // 666
     *                                                                                                                 // 667
     * @param {Event} e                                                                                                // 668
     * @return {void}                                                                                                  // 669
     */                                                                                                                // 670
                                                                                                                       // 671
    Core.prototype.addonAction = function (e) {                                                                        // 672
        var $a = $(e.target).is('a') ? $(e.target) : $(e.target).closest('a'),                                         // 673
            addon = $a.data('addon'),                                                                                  // 674
            action = $a.data('action');                                                                                // 675
                                                                                                                       // 676
        this.$el.data('plugin_'+ pluginName + ucfirst(addon))[action]();                                               // 677
    };                                                                                                                 // 678
                                                                                                                       // 679
    /**                                                                                                                // 680
     * Move caret at the beginning of the empty paragraph                                                              // 681
     *                                                                                                                 // 682
     * @param {jQuery} $el Element where to place the caret                                                            // 683
     * @param {integer} position Position where to move caret. Default: 0                                              // 684
     *                                                                                                                 // 685
     * @return {void}                                                                                                  // 686
     */                                                                                                                // 687
                                                                                                                       // 688
    Core.prototype.moveCaret = function ($el, position) {                                                              // 689
        var range, sel, el;                                                                                            // 690
                                                                                                                       // 691
        position = position || 0;                                                                                      // 692
        range = document.createRange();                                                                                // 693
        sel = window.getSelection();                                                                                   // 694
        el = $el.get(0);                                                                                               // 695
                                                                                                                       // 696
        if (!el.childNodes.length) {                                                                                   // 697
            var textEl = document.createTextNode(' ');                                                                 // 698
            el.appendChild(textEl);                                                                                    // 699
        }                                                                                                              // 700
                                                                                                                       // 701
        range.setStart(el.childNodes[0], position);                                                                    // 702
        range.collapse(true);                                                                                          // 703
        sel.removeAllRanges();                                                                                         // 704
        sel.addRange(range);                                                                                           // 705
    };                                                                                                                 // 706
                                                                                                                       // 707
    /**                                                                                                                // 708
     * Add caption                                                                                                     // 709
     *                                                                                                                 // 710
     * @param {jQuery Element} $el                                                                                     // 711
     * @param {string} placeholder                                                                                     // 712
     * @return {void}                                                                                                  // 713
     */                                                                                                                // 714
                                                                                                                       // 715
    Core.prototype.addCaption = function ($el, placeholder) {                                                          // 716
        var $caption = $el.find('figcaption');                                                                         // 717
                                                                                                                       // 718
        if ($caption.length === 0) {                                                                                   // 719
            $el.append(this.templates['src/js/templates/core-caption.hbs']({                                           // 720
                placeholder: placeholder                                                                               // 721
            }));                                                                                                       // 722
        }                                                                                                              // 723
    };                                                                                                                 // 724
                                                                                                                       // 725
    /**                                                                                                                // 726
     * Remove captions                                                                                                 // 727
     *                                                                                                                 // 728
     * @param {jQuery Element} $ignore                                                                                 // 729
     * @return {void}                                                                                                  // 730
     */                                                                                                                // 731
                                                                                                                       // 732
    Core.prototype.removeCaptions = function ($ignore) {                                                               // 733
        var $captions = this.$el.find('figcaption');                                                                   // 734
                                                                                                                       // 735
        if ($ignore) {                                                                                                 // 736
            $captions = $captions.not($ignore);                                                                        // 737
        }                                                                                                              // 738
                                                                                                                       // 739
        $captions.each(function () {                                                                                   // 740
            if ($(this).hasClass('medium-insert-caption-placeholder') || $(this).text().trim() === '') {               // 741
                $(this).remove();                                                                                      // 742
            }                                                                                                          // 743
        });                                                                                                            // 744
    };                                                                                                                 // 745
                                                                                                                       // 746
    /**                                                                                                                // 747
     * Remove caption placeholder                                                                                      // 748
     *                                                                                                                 // 749
     * @param {jQuery Element} $el                                                                                     // 750
     * @return {void}                                                                                                  // 751
     */                                                                                                                // 752
                                                                                                                       // 753
    Core.prototype.removeCaptionPlaceholder = function ($el) {                                                         // 754
        var $caption = $el.is('figcaption') ? $el : $el.find('figcaption');                                            // 755
                                                                                                                       // 756
        if ($caption.length) {                                                                                         // 757
            $caption                                                                                                   // 758
                .removeClass('medium-insert-caption-placeholder')                                                      // 759
                .removeAttr('data-placeholder');                                                                       // 760
        }                                                                                                              // 761
    };                                                                                                                 // 762
                                                                                                                       // 763
    /**                                                                                                                // 764
     * Show warning about deprecated options/methods                                                                   // 765
     *                                                                                                                 // 766
     * @param {string} oldName                                                                                         // 767
     * @param {string} newName                                                                                         // 768
     * @param {string} version                                                                                         // 769
     * @return {void}                                                                                                  // 770
     */                                                                                                                // 771
                                                                                                                       // 772
    Core.prototype.deprecated = function (oldName, newName, version) {                                                 // 773
        var m = oldName +" is deprecated, please use "+ newName +" instead.";                                          // 774
        if (version) {                                                                                                 // 775
            m += " Will be removed in "+ version;                                                                      // 776
        }                                                                                                              // 777
                                                                                                                       // 778
        if(window.console !== undefined){                                                                              // 779
            window.console.warn(m);                                                                                    // 780
        }                                                                                                              // 781
    };                                                                                                                 // 782
                                                                                                                       // 783
    /** Plugin initialization */                                                                                       // 784
                                                                                                                       // 785
    $.fn[pluginName] = function (options) {                                                                            // 786
        return this.each(function () {                                                                                 // 787
            if (!$.data(this, 'plugin_' + pluginName)) {                                                               // 788
                // Plugin initialization                                                                               // 789
                $.data(this, 'plugin_' + pluginName, new Core(this, options));                                         // 790
                $.data(this, 'plugin_' + pluginName).init();                                                           // 791
            } else if (typeof options === 'string' && $.data(this, 'plugin_' + pluginName)[options]) {                 // 792
                // Method call                                                                                         // 793
                $.data(this, 'plugin_' + pluginName)[options]();                                                       // 794
            }                                                                                                          // 795
        });                                                                                                            // 796
    };                                                                                                                 // 797
                                                                                                                       // 798
})(jQuery, window, document);                                                                                          // 799
                                                                                                                       // 800
;(function ($, window, document, undefined) {                                                                          // 801
                                                                                                                       // 802
    'use strict';                                                                                                      // 803
                                                                                                                       // 804
    /** Default values */                                                                                              // 805
    var pluginName = 'mediumInsert',                                                                                   // 806
        addonName = 'Embeds', // first char is uppercase                                                               // 807
        defaults = {                                                                                                   // 808
            label: '<span class="fa fa-youtube-play"></span>',                                                         // 809
            placeholder: 'Paste a YouTube, Vimeo, Facebook, Twitter or Instagram link and press Enter',                // 810
            oembedProxy: 'http://medium.iframe.ly/api/oembed?iframe=1',                                                // 811
            captions: true,                                                                                            // 812
            captionPlaceholder: 'Type caption (optional)',                                                             // 813
            styles: {                                                                                                  // 814
                wide: {                                                                                                // 815
                    label: '<span class="fa fa-align-justify"></span>',                                                // 816
                    // added: function ($el) {},                                                                       // 817
                    // removed: function ($el) {}                                                                      // 818
                },                                                                                                     // 819
                left: {                                                                                                // 820
                    label: '<span class="fa fa-align-left"></span>',                                                   // 821
                    // added: function ($el) {},                                                                       // 822
                    // removed: function ($el) {}                                                                      // 823
                },                                                                                                     // 824
                right: {                                                                                               // 825
                    label: '<span class="fa fa-align-right"></span>',                                                  // 826
                    // added: function ($el) {},                                                                       // 827
                    // removed: function ($el) {}                                                                      // 828
                }                                                                                                      // 829
            },                                                                                                         // 830
            actions: {                                                                                                 // 831
                remove: {                                                                                              // 832
                    label: '<span class="fa fa-times"></span>',                                                        // 833
                    clicked: function () {                                                                             // 834
                        var $event = $.Event('keydown');                                                               // 835
                                                                                                                       // 836
                        $event.which = 8;                                                                              // 837
                        $(document).trigger($event);                                                                   // 838
                    }                                                                                                  // 839
                }                                                                                                      // 840
            }                                                                                                          // 841
        };                                                                                                             // 842
                                                                                                                       // 843
    /**                                                                                                                // 844
     * Embeds object                                                                                                   // 845
     *                                                                                                                 // 846
     * Sets options, variables and calls init() function                                                               // 847
     *                                                                                                                 // 848
     * @constructor                                                                                                    // 849
     * @param {DOM} el - DOM element to init the plugin on                                                             // 850
     * @param {object} options - Options to override defaults                                                          // 851
     * @return {void}                                                                                                  // 852
     */                                                                                                                // 853
                                                                                                                       // 854
    function Embeds (el, options) {                                                                                    // 855
        this.el = el;                                                                                                  // 856
        this.$el = $(el);                                                                                              // 857
        this.templates = window.MediumInsert.Templates;                                                                // 858
        this.core = this.$el.data('plugin_'+ pluginName);                                                              // 859
                                                                                                                       // 860
        this.options = $.extend(true, {}, defaults, options);                                                          // 861
                                                                                                                       // 862
        this._defaults = defaults;                                                                                     // 863
        this._name = pluginName;                                                                                       // 864
                                                                                                                       // 865
        // Extend editor's functions                                                                                   // 866
        if (this.core.getEditor()) {                                                                                   // 867
            this.core.getEditor()._serializePreEmbeds = this.core.getEditor().serialize;                               // 868
            this.core.getEditor().serialize = this.editorSerialize;                                                    // 869
        }                                                                                                              // 870
                                                                                                                       // 871
        this.init();                                                                                                   // 872
    }                                                                                                                  // 873
                                                                                                                       // 874
    /**                                                                                                                // 875
     * Initialization                                                                                                  // 876
     *                                                                                                                 // 877
     * @return {void}                                                                                                  // 878
     */                                                                                                                // 879
                                                                                                                       // 880
    Embeds.prototype.init = function () {                                                                              // 881
        var $embeds = this.$el.find('.medium-insert-embeds');                                                          // 882
                                                                                                                       // 883
        $embeds.attr('contenteditable', false);                                                                        // 884
        $embeds.each(function () {                                                                                     // 885
            if ($(this).find('.medium-insert-embeds-overlay').length === 0) {                                          // 886
                $(this).append($('<div />').addClass('medium-insert-embeds-overlay'));                                 // 887
            }                                                                                                          // 888
        });                                                                                                            // 889
                                                                                                                       // 890
        this.events();                                                                                                 // 891
        this.backwardsCompatibility();                                                                                 // 892
    };                                                                                                                 // 893
                                                                                                                       // 894
    /**                                                                                                                // 895
     * Event listeners                                                                                                 // 896
     *                                                                                                                 // 897
     * @return {void}                                                                                                  // 898
     */                                                                                                                // 899
                                                                                                                       // 900
    Embeds.prototype.events = function () {                                                                            // 901
        $(document)                                                                                                    // 902
            .on('click', $.proxy(this, 'unselectEmbed'))                                                               // 903
            .on('keydown', $.proxy(this, 'removeEmbed'))                                                               // 904
            .on('click', '.medium-insert-embeds-toolbar .medium-editor-action', $.proxy(this, 'toolbarAction'))        // 905
            .on('click', '.medium-insert-embeds-toolbar2 .medium-editor-action', $.proxy(this, 'toolbar2Action'));     // 906
                                                                                                                       // 907
        this.$el                                                                                                       // 908
            .on('keyup click paste', $.proxy(this, 'togglePlaceholder'))                                               // 909
            .on('keydown', $.proxy(this, 'processLink'))                                                               // 910
            .on('click', '.medium-insert-embeds-overlay', $.proxy(this, 'selectEmbed'))                                // 911
            .on('contextmenu', '.medium-insert-embeds-placeholder', $.proxy(this, 'fixRightClickOnPlaceholder'));      // 912
    };                                                                                                                 // 913
                                                                                                                       // 914
    /**                                                                                                                // 915
     * Replace v0.* class names with new ones, wrap embedded content to new structure                                  // 916
     *                                                                                                                 // 917
     * @return {void}                                                                                                  // 918
     */                                                                                                                // 919
                                                                                                                       // 920
    Embeds.prototype.backwardsCompatibility = function () {                                                            // 921
        var that = this;                                                                                               // 922
                                                                                                                       // 923
        this.$el.find('.mediumInsert-embeds')                                                                          // 924
            .removeClass('mediumInsert-embeds')                                                                        // 925
            .addClass('medium-insert-embeds');                                                                         // 926
                                                                                                                       // 927
        this.$el.find('.medium-insert-embeds').each(function () {                                                      // 928
            if ($(this).find('.medium-insert-embed').length === 0) {                                                   // 929
                $(this).after(that.templates['src/js/templates/embeds-wrapper.hbs']({                                  // 930
                    html: $(this).html()                                                                               // 931
                }));                                                                                                   // 932
                $(this).remove();                                                                                      // 933
            }                                                                                                          // 934
        });                                                                                                            // 935
    };                                                                                                                 // 936
                                                                                                                       // 937
    /**                                                                                                                // 938
     * Get the Core object                                                                                             // 939
     *                                                                                                                 // 940
     * @return {object} Core object                                                                                    // 941
     */                                                                                                                // 942
                                                                                                                       // 943
    Embeds.prototype.getCore = function () {                                                                           // 944
        return this.core;                                                                                              // 945
    };                                                                                                                 // 946
                                                                                                                       // 947
    /**                                                                                                                // 948
     * Extend editor's serialize function                                                                              // 949
     *                                                                                                                 // 950
     * @return {object} Serialized data                                                                                // 951
     */                                                                                                                // 952
                                                                                                                       // 953
    Embeds.prototype.editorSerialize = function () {                                                                   // 954
        var data = this._serializePreEmbeds();                                                                         // 955
                                                                                                                       // 956
        $.each(data, function (key) {                                                                                  // 957
            var $data = $('<div />').html(data[key].value);                                                            // 958
                                                                                                                       // 959
            $data.find('.medium-insert-embeds').removeAttr('contenteditable');                                         // 960
            $data.find('.medium-insert-embeds-overlay').remove();                                                      // 961
                                                                                                                       // 962
            data[key].value = $data.html();                                                                            // 963
        });                                                                                                            // 964
                                                                                                                       // 965
        return data;                                                                                                   // 966
    };                                                                                                                 // 967
                                                                                                                       // 968
    /**                                                                                                                // 969
     * Add embedded element                                                                                            // 970
     *                                                                                                                 // 971
     * @return {void}                                                                                                  // 972
     */                                                                                                                // 973
                                                                                                                       // 974
    Embeds.prototype.add = function () {                                                                               // 975
        var $place = this.$el.find('.medium-insert-active');                                                           // 976
                                                                                                                       // 977
        // Fix #132                                                                                                    // 978
        // Make sure that the content of the paragraph is empty and <br> is wrapped in <p></p> to avoid Firefox problems
        $place.html(this.templates['src/js/templates/core-empty-line.hbs']().trim());                                  // 980
                                                                                                                       // 981
        // Replace paragraph with div to prevent #124 issue with pasting in Chrome,                                    // 982
        // because medium editor wraps inserted content into paragraph and paragraphs can't be nested                  // 983
        if ($place.is('p')) {                                                                                          // 984
            $place.replaceWith('<div class="medium-insert-active">'+ $place.html() +'</div>');                         // 985
            $place = this.$el.find('.medium-insert-active');                                                           // 986
            this.getCore().moveCaret($place);                                                                          // 987
        }                                                                                                              // 988
                                                                                                                       // 989
        $place.addClass('medium-insert-embeds medium-insert-embeds-input medium-insert-embeds-active');                // 990
                                                                                                                       // 991
        this.togglePlaceholder({ target: $place.get(0) });                                                             // 992
                                                                                                                       // 993
        $place.click();                                                                                                // 994
        this.getCore().hideButtons();                                                                                  // 995
    };                                                                                                                 // 996
                                                                                                                       // 997
    /**                                                                                                                // 998
     * Toggles placeholder                                                                                             // 999
     *                                                                                                                 // 1000
     * @param {Event} e                                                                                                // 1001
     * @return {void}                                                                                                  // 1002
     */                                                                                                                // 1003
                                                                                                                       // 1004
    Embeds.prototype.togglePlaceholder = function (e) {                                                                // 1005
        var $place = $(e.target),                                                                                      // 1006
            selection = window.getSelection(),                                                                         // 1007
            range, $current, text;                                                                                     // 1008
                                                                                                                       // 1009
        if (!selection || selection.rangeCount === 0) {                                                                // 1010
            return;                                                                                                    // 1011
        }                                                                                                              // 1012
                                                                                                                       // 1013
        range = selection.getRangeAt(0);                                                                               // 1014
        $current = $(range.commonAncestorContainer);                                                                   // 1015
                                                                                                                       // 1016
        if ($current.hasClass('medium-insert-embeds-active')) {                                                        // 1017
            $place = $current;                                                                                         // 1018
        } else if ($current.closest('.medium-insert-embeds-active').length) {                                          // 1019
            $place = $current.closest('.medium-insert-embeds-active');                                                 // 1020
        }                                                                                                              // 1021
                                                                                                                       // 1022
        if ($place.hasClass('medium-insert-embeds-active')) {                                                          // 1023
                                                                                                                       // 1024
            text = $place.text().trim();                                                                               // 1025
                                                                                                                       // 1026
            if (text === '' && $place.hasClass('medium-insert-embeds-placeholder') === false) {                        // 1027
                $place                                                                                                 // 1028
                    .addClass('medium-insert-embeds-placeholder')                                                      // 1029
                    .attr('data-placeholder', this.options.placeholder);                                               // 1030
            } else if (text !== '' && $place.hasClass('medium-insert-embeds-placeholder')) {                           // 1031
                $place                                                                                                 // 1032
                    .removeClass('medium-insert-embeds-placeholder')                                                   // 1033
                    .removeAttr('data-placeholder');                                                                   // 1034
            }                                                                                                          // 1035
                                                                                                                       // 1036
        } else {                                                                                                       // 1037
            this.$el.find('.medium-insert-embeds-active').remove();                                                    // 1038
        }                                                                                                              // 1039
    };                                                                                                                 // 1040
                                                                                                                       // 1041
    /**                                                                                                                // 1042
     * Right click on placeholder in Chrome selects whole line. Fix this by placing caret at the end of line           // 1043
     *                                                                                                                 // 1044
     * @param {Event} e                                                                                                // 1045
     * @return {void}                                                                                                  // 1046
     */                                                                                                                // 1047
                                                                                                                       // 1048
    Embeds.prototype.fixRightClickOnPlaceholder = function (e) {                                                       // 1049
        this.getCore().moveCaret($(e.target));                                                                         // 1050
    };                                                                                                                 // 1051
                                                                                                                       // 1052
    /**                                                                                                                // 1053
     * Process link                                                                                                    // 1054
     *                                                                                                                 // 1055
     * @param {Event} e                                                                                                // 1056
     * @return {void}                                                                                                  // 1057
     */                                                                                                                // 1058
                                                                                                                       // 1059
    Embeds.prototype.processLink = function (e) {                                                                      // 1060
        var $place = this.$el.find('.medium-insert-embeds-active'),                                                    // 1061
            url;                                                                                                       // 1062
                                                                                                                       // 1063
        if (!$place.length) {                                                                                          // 1064
            return;                                                                                                    // 1065
        }                                                                                                              // 1066
                                                                                                                       // 1067
        url = $place.text().trim();                                                                                    // 1068
                                                                                                                       // 1069
        // Return empty placeholder on backspace, delete or enter                                                      // 1070
        if (url === '' && [8, 46, 13].indexOf(e.which) !== -1) {                                                       // 1071
            $place.remove();                                                                                           // 1072
            return;                                                                                                    // 1073
        }                                                                                                              // 1074
                                                                                                                       // 1075
        if (e.which === 13) {                                                                                          // 1076
            e.preventDefault();                                                                                        // 1077
            e.stopPropagation();                                                                                       // 1078
                                                                                                                       // 1079
            if (this.options.oembedProxy) {                                                                            // 1080
                this.oembed(url);                                                                                      // 1081
            } else {                                                                                                   // 1082
                this.parseUrl(url);                                                                                    // 1083
            }                                                                                                          // 1084
        }                                                                                                              // 1085
    };                                                                                                                 // 1086
                                                                                                                       // 1087
    /**                                                                                                                // 1088
     * Get HTML via oEmbed proxy                                                                                       // 1089
     *                                                                                                                 // 1090
     * @param {string} url                                                                                             // 1091
     * @return {void}                                                                                                  // 1092
     */                                                                                                                // 1093
                                                                                                                       // 1094
    Embeds.prototype.oembed = function (url) {                                                                         // 1095
        var that = this;                                                                                               // 1096
                                                                                                                       // 1097
        $.support.cors = true;                                                                                         // 1098
                                                                                                                       // 1099
        $.ajax({                                                                                                       // 1100
            crossDomain: true,                                                                                         // 1101
            cache: false,                                                                                              // 1102
            url: this.options.oembedProxy,                                                                             // 1103
            dataType: 'json',                                                                                          // 1104
            data: {                                                                                                    // 1105
                url: url                                                                                               // 1106
            },                                                                                                         // 1107
            success: function(data) {                                                                                  // 1108
                var html = data && data.html;                                                                          // 1109
                                                                                                                       // 1110
                if (data && !data.html && data.type === 'photo' && data.url) {                                         // 1111
                    html = '<img src="' + data.url + '" alt="">';                                                      // 1112
                }                                                                                                      // 1113
                                                                                                                       // 1114
                $.proxy(that, 'embed', html)();                                                                        // 1115
            },                                                                                                         // 1116
            error: function(jqXHR, textStatus, errorThrown) {                                                          // 1117
                var responseJSON = (function() {                                                                       // 1118
                    try {                                                                                              // 1119
                        return JSON.parse(jqXHR.responseText);                                                         // 1120
                    } catch(e) {}                                                                                      // 1121
                })();                                                                                                  // 1122
                                                                                                                       // 1123
                if (typeof window.console !== 'undefined') {                                                           // 1124
                    window.console.log((responseJSON && responseJSON.error) || jqXHR.status || errorThrown.message);   // 1125
                } else {                                                                                               // 1126
                    window.alert('Error requesting media from ' + that.options.oembedProxy + ' to insert: ' + errorThrown + ' (response status: ' + jqXHR.status + ')');
                }                                                                                                      // 1128
                                                                                                                       // 1129
                $.proxy(that, 'convertBadEmbed', url)();                                                               // 1130
            }                                                                                                          // 1131
        });                                                                                                            // 1132
    };                                                                                                                 // 1133
                                                                                                                       // 1134
    /**                                                                                                                // 1135
     * Get HTML using regexp                                                                                           // 1136
     *                                                                                                                 // 1137
     * @param {string} url                                                                                             // 1138
     * @return {void}                                                                                                  // 1139
     */                                                                                                                // 1140
                                                                                                                       // 1141
    Embeds.prototype.parseUrl = function (url) {                                                                       // 1142
        var html;                                                                                                      // 1143
                                                                                                                       // 1144
        if (!(new RegExp(['youtube', 'youtu.be', 'vimeo', 'instagram'].join('|')).test(url))) {                        // 1145
            $.proxy(this, 'convertBadEmbed', url)();                                                                   // 1146
            return false;                                                                                              // 1147
        }                                                                                                              // 1148
                                                                                                                       // 1149
        html = url.replace(/\n?/g, '')                                                                                 // 1150
            .replace(/^((http(s)?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/(watch\?v=|v\/)?)([a-zA-Z0-9\-_]+)(.*)?$/, '<div class="video"><iframe width="420" height="315" src="//www.youtube.com/embed/$7" frameborder="0" allowfullscreen></iframe></div>')
            .replace(/^https?:\/\/vimeo\.com(\/.+)?\/([0-9]+)$/, '<iframe src="//player.vimeo.com/video/$2" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>')
            //.replace(/^https:\/\/twitter\.com\/(\w+)\/status\/(\d+)\/?$/, '<blockquote class="twitter-tweet" align="center" lang="en"><a href="https://twitter.com/$1/statuses/$2"></a></blockquote><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>')
            //.replace(/^https:\/\/www\.facebook\.com\/(video.php|photo.php)\?v=(\d+).+$/, '<div class="fb-post" data-href="https://www.facebook.com/photo.php?v=$2"><div class="fb-xfbml-parse-ignore"><a href="https://www.facebook.com/photo.php?v=$2">Post</a></div></div>')
            .replace(/^https?:\/\/instagram\.com\/p\/(.+)\/?$/, '<span class="instagram"><iframe src="//instagram.com/p/$1/embed/" width="612" height="710" frameborder="0" scrolling="no" allowtransparency="true"></iframe></span>');
                                                                                                                       // 1156
                                                                                                                       // 1157
        this.embed((/<("[^"]*"|'[^']*'|[^'">])*>/).test(html) ? html : false);                                         // 1158
    };                                                                                                                 // 1159
                                                                                                                       // 1160
    /**                                                                                                                // 1161
     * Add html to page                                                                                                // 1162
     *                                                                                                                 // 1163
     * @param {string} html                                                                                            // 1164
     * @return {void}                                                                                                  // 1165
     */                                                                                                                // 1166
                                                                                                                       // 1167
    Embeds.prototype.embed = function (html) {                                                                         // 1168
        var $place = this.$el.find('.medium-insert-embeds-active');                                                    // 1169
                                                                                                                       // 1170
        if (!html) {                                                                                                   // 1171
            alert('Incorrect URL format specified');                                                                   // 1172
            return false;                                                                                              // 1173
        } else {                                                                                                       // 1174
            $place.after(this.templates['src/js/templates/embeds-wrapper.hbs']({                                       // 1175
                html: html                                                                                             // 1176
            }));                                                                                                       // 1177
            $place.remove();                                                                                           // 1178
                                                                                                                       // 1179
            this.$el.trigger('input');                                                                                 // 1180
                                                                                                                       // 1181
            if (html.indexOf('facebook') !== -1) {                                                                     // 1182
                if (typeof(FB) !== 'undefined') {                                                                      // 1183
                    setTimeout(function () {                                                                           // 1184
                        FB.XFBML.parse();                                                                              // 1185
                    }, 2000);                                                                                          // 1186
                }                                                                                                      // 1187
            }                                                                                                          // 1188
        }                                                                                                              // 1189
    };                                                                                                                 // 1190
                                                                                                                       // 1191
    /**                                                                                                                // 1192
     * Convert bad oEmbed content to an actual line.                                                                   // 1193
     * Instead of displaying the error message we convert the bad embed                                                // 1194
     *                                                                                                                 // 1195
     * @param {string} content Bad content                                                                             // 1196
     *                                                                                                                 // 1197
     * @return {void}                                                                                                  // 1198
     */                                                                                                                // 1199
    Embeds.prototype.convertBadEmbed = function (content) {                                                            // 1200
        var $place, $empty, $content,                                                                                  // 1201
            emptyTemplate = this.templates['src/js/templates/core-empty-line.hbs']().trim();                           // 1202
                                                                                                                       // 1203
        $place = this.$el.find('.medium-insert-embeds-active');                                                        // 1204
                                                                                                                       // 1205
        // convert embed node to an empty node and insert the bad embed inside                                         // 1206
        $content = $(emptyTemplate);                                                                                   // 1207
        $place.before($content);                                                                                       // 1208
        $place.remove();                                                                                               // 1209
        $content.html(content);                                                                                        // 1210
                                                                                                                       // 1211
        // add an new empty node right after to simulate Enter press                                                   // 1212
        $empty = $(emptyTemplate);                                                                                     // 1213
        $content.after($empty);                                                                                        // 1214
                                                                                                                       // 1215
        this.$el.trigger('input');                                                                                     // 1216
                                                                                                                       // 1217
        this.getCore().moveCaret($place);                                                                              // 1218
    };                                                                                                                 // 1219
                                                                                                                       // 1220
    /**                                                                                                                // 1221
     * Select clicked embed                                                                                            // 1222
     *                                                                                                                 // 1223
     * @param {Event} e                                                                                                // 1224
     * @returns {void}                                                                                                 // 1225
     */                                                                                                                // 1226
                                                                                                                       // 1227
    Embeds.prototype.selectEmbed = function (e) {                                                                      // 1228
        if(this.getCore().options.enabled) {                                                                           // 1229
            var $embed = $(e.target).hasClass('medium-insert-embeds') ? $(e.target) : $(e.target).closest('.medium-insert-embeds'),
                that = this;                                                                                           // 1231
                                                                                                                       // 1232
            $embed.addClass('medium-insert-embeds-selected');                                                          // 1233
                                                                                                                       // 1234
            setTimeout(function () {                                                                                   // 1235
                that.addToolbar();                                                                                     // 1236
                                                                                                                       // 1237
                if (that.options.captions) {                                                                           // 1238
                    that.getCore().addCaption($embed.find('figure'), that.options.captionPlaceholder);                 // 1239
                }                                                                                                      // 1240
            }, 50);                                                                                                    // 1241
        }                                                                                                              // 1242
    };                                                                                                                 // 1243
                                                                                                                       // 1244
    /**                                                                                                                // 1245
     * Unselect selected embed                                                                                         // 1246
     *                                                                                                                 // 1247
     * @param {Event} e                                                                                                // 1248
     * @returns {void}                                                                                                 // 1249
     */                                                                                                                // 1250
                                                                                                                       // 1251
    Embeds.prototype.unselectEmbed = function (e) {                                                                    // 1252
        var $el = $(e.target).hasClass('medium-insert-embeds') ? $(e.target) : $(e.target).closest('.medium-insert-embeds'),
            $embed = this.$el.find('.medium-insert-embeds-selected');                                                  // 1254
                                                                                                                       // 1255
        if ($el.hasClass('medium-insert-embeds-selected')) {                                                           // 1256
            $embed.not($el).removeClass('medium-insert-embeds-selected');                                              // 1257
            $('.medium-insert-embeds-toolbar, .medium-insert-embeds-toolbar2').remove();                               // 1258
            this.getCore().removeCaptions($el.find('figcaption'));                                                     // 1259
                                                                                                                       // 1260
            if ($(e.target).is('.medium-insert-caption-placeholder') || $(e.target).is('figcaption')) {                // 1261
                $el.removeClass('medium-insert-embeds-selected');                                                      // 1262
                this.getCore().removeCaptionPlaceholder($el.find('figure'));                                           // 1263
            }                                                                                                          // 1264
            return;                                                                                                    // 1265
        }                                                                                                              // 1266
                                                                                                                       // 1267
        $embed.removeClass('medium-insert-embeds-selected');                                                           // 1268
        $('.medium-insert-embeds-toolbar, .medium-insert-embeds-toolbar2').remove();                                   // 1269
                                                                                                                       // 1270
        if ($(e.target).is('.medium-insert-caption-placeholder')) {                                                    // 1271
            this.getCore().removeCaptionPlaceholder($el.find('figure'));                                               // 1272
        } else if ($(e.target).is('figcaption') === false) {                                                           // 1273
            this.getCore().removeCaptions();                                                                           // 1274
        }                                                                                                              // 1275
    };                                                                                                                 // 1276
                                                                                                                       // 1277
    /**                                                                                                                // 1278
     * Remove embed                                                                                                    // 1279
     *                                                                                                                 // 1280
     * @param {Event} e                                                                                                // 1281
     * @returns {void}                                                                                                 // 1282
     */                                                                                                                // 1283
                                                                                                                       // 1284
    Embeds.prototype.removeEmbed = function (e) {                                                                      // 1285
        var $embed, $empty;                                                                                            // 1286
                                                                                                                       // 1287
        if (e.which === 8 || e.which === 46) {                                                                         // 1288
            $embed = this.$el.find('.medium-insert-embeds-selected');                                                  // 1289
                                                                                                                       // 1290
            if ($embed.length) {                                                                                       // 1291
                e.preventDefault();                                                                                    // 1292
                                                                                                                       // 1293
                $('.medium-insert-embeds-toolbar, .medium-insert-embeds-toolbar2').remove();                           // 1294
                                                                                                                       // 1295
                $empty = $(this.templates['src/js/templates/core-empty-line.hbs']().trim());                           // 1296
                $embed.before($empty);                                                                                 // 1297
                $embed.remove();                                                                                       // 1298
                                                                                                                       // 1299
                // Hide addons                                                                                         // 1300
                this.getCore().hideAddons();                                                                           // 1301
                                                                                                                       // 1302
                this.getCore().moveCaret($empty);                                                                      // 1303
                this.$el.trigger('input');                                                                             // 1304
            }                                                                                                          // 1305
        }                                                                                                              // 1306
    };                                                                                                                 // 1307
                                                                                                                       // 1308
    /**                                                                                                                // 1309
     * Adds embed toolbar to editor                                                                                    // 1310
     *                                                                                                                 // 1311
     * @returns {void}                                                                                                 // 1312
     */                                                                                                                // 1313
                                                                                                                       // 1314
    Embeds.prototype.addToolbar = function () {                                                                        // 1315
        var $embed = this.$el.find('.medium-insert-embeds-selected'),                                                  // 1316
            active = false,                                                                                            // 1317
            $toolbar, $toolbar2, top;                                                                                  // 1318
                                                                                                                       // 1319
        if ($embed.length === 0) {                                                                                     // 1320
            return;                                                                                                    // 1321
        }                                                                                                              // 1322
                                                                                                                       // 1323
        $('body').append(this.templates['src/js/templates/embeds-toolbar.hbs']({                                       // 1324
            styles: this.options.styles,                                                                               // 1325
            actions: this.options.actions                                                                              // 1326
        }).trim());                                                                                                    // 1327
                                                                                                                       // 1328
        $toolbar = $('.medium-insert-embeds-toolbar');                                                                 // 1329
        $toolbar2 = $('.medium-insert-embeds-toolbar2');                                                               // 1330
                                                                                                                       // 1331
        top = $embed.offset().top - $toolbar.height() - 8 - 2 - 5; // 8px - hight of an arrow under toolbar, 2px - height of an embed outset, 5px - distance from an embed
        if (top < 0) {                                                                                                 // 1333
            top = 0;                                                                                                   // 1334
        }                                                                                                              // 1335
                                                                                                                       // 1336
        $toolbar                                                                                                       // 1337
            .css({                                                                                                     // 1338
                top: top,                                                                                              // 1339
                left: $embed.offset().left + $embed.width() / 2 - $toolbar.width() / 2                                 // 1340
            })                                                                                                         // 1341
            .show();                                                                                                   // 1342
                                                                                                                       // 1343
        $toolbar2                                                                                                      // 1344
            .css({                                                                                                     // 1345
                top: $embed.offset().top + 2, // 2px - distance from a border                                          // 1346
                left: $embed.offset().left + $embed.width() - $toolbar2.width() - 4 // 4px - distance from a border    // 1347
            })                                                                                                         // 1348
            .show();                                                                                                   // 1349
                                                                                                                       // 1350
        $toolbar.find('button').each(function () {                                                                     // 1351
            if ($embed.hasClass('medium-insert-embeds-'+ $(this).data('action'))) {                                    // 1352
                $(this).addClass('medium-editor-button-active');                                                       // 1353
                active = true;                                                                                         // 1354
            }                                                                                                          // 1355
        });                                                                                                            // 1356
                                                                                                                       // 1357
        if (active === false) {                                                                                        // 1358
            $toolbar.find('button').first().addClass('medium-editor-button-active');                                   // 1359
        }                                                                                                              // 1360
    };                                                                                                                 // 1361
                                                                                                                       // 1362
    /**                                                                                                                // 1363
     * Fires toolbar action                                                                                            // 1364
     *                                                                                                                 // 1365
     * @param {Event} e                                                                                                // 1366
     * @returns {void}                                                                                                 // 1367
     */                                                                                                                // 1368
                                                                                                                       // 1369
    Embeds.prototype.toolbarAction = function (e) {                                                                    // 1370
        var $button = $(e.target).is('button') ? $(e.target) : $(e.target).closest('button'),                          // 1371
            $li = $button.closest('li'),                                                                               // 1372
            $ul = $li.closest('ul'),                                                                                   // 1373
            $lis = $ul.find('li'),                                                                                     // 1374
            $embed = this.$el.find('.medium-insert-embeds-selected'),                                                  // 1375
            that = this;                                                                                               // 1376
                                                                                                                       // 1377
        $button.addClass('medium-editor-button-active');                                                               // 1378
        $li.siblings().find('.medium-editor-button-active').removeClass('medium-editor-button-active');                // 1379
                                                                                                                       // 1380
        $lis.find('button').each(function () {                                                                         // 1381
            var className = 'medium-insert-embeds-'+ $(this).data('action');                                           // 1382
                                                                                                                       // 1383
            if ($(this).hasClass('medium-editor-button-active')) {                                                     // 1384
                $embed.addClass(className);                                                                            // 1385
                                                                                                                       // 1386
                if (that.options.styles[$(this).data('action')].added) {                                               // 1387
                    that.options.styles[$(this).data('action')].added($embed);                                         // 1388
                }                                                                                                      // 1389
            } else {                                                                                                   // 1390
                $embed.removeClass(className);                                                                         // 1391
                                                                                                                       // 1392
                if (that.options.styles[$(this).data('action')].removed) {                                             // 1393
                    that.options.styles[$(this).data('action')].removed($embed);                                       // 1394
                }                                                                                                      // 1395
            }                                                                                                          // 1396
        });                                                                                                            // 1397
                                                                                                                       // 1398
        this.$el.trigger('input');                                                                                     // 1399
    };                                                                                                                 // 1400
                                                                                                                       // 1401
    /**                                                                                                                // 1402
     * Fires toolbar2 action                                                                                           // 1403
     *                                                                                                                 // 1404
     * @param {Event} e                                                                                                // 1405
     * @returns {void}                                                                                                 // 1406
     */                                                                                                                // 1407
                                                                                                                       // 1408
    Embeds.prototype.toolbar2Action = function (e) {                                                                   // 1409
        var $button = $(e.target).is('button') ? $(e.target) : $(e.target).closest('button'),                          // 1410
            callback = this.options.actions[$button.data('action')].clicked;                                           // 1411
                                                                                                                       // 1412
        if (callback) {                                                                                                // 1413
            callback(this.$el.find('.medium-insert-embeds-selected'));                                                 // 1414
        }                                                                                                              // 1415
                                                                                                                       // 1416
        this.$el.trigger('input');                                                                                     // 1417
    };                                                                                                                 // 1418
                                                                                                                       // 1419
    /** Plugin initialization */                                                                                       // 1420
                                                                                                                       // 1421
    $.fn[pluginName + addonName] = function (options) {                                                                // 1422
        return this.each(function () {                                                                                 // 1423
            if (!$.data(this, 'plugin_' + pluginName + addonName)) {                                                   // 1424
                $.data(this, 'plugin_' + pluginName + addonName, new Embeds(this, options));                           // 1425
            }                                                                                                          // 1426
        });                                                                                                            // 1427
    };                                                                                                                 // 1428
                                                                                                                       // 1429
})(jQuery, window, document);                                                                                          // 1430
                                                                                                                       // 1431
;(function ($, window, document, undefined) {                                                                          // 1432
                                                                                                                       // 1433
    'use strict';                                                                                                      // 1434
                                                                                                                       // 1435
    /** Default values */                                                                                              // 1436
    var pluginName = 'mediumInsert',                                                                                   // 1437
        addonName = 'Images', // first char is uppercase                                                               // 1438
        defaults = {                                                                                                   // 1439
            label: '<span class="fa fa-camera"></span>',                                                               // 1440
            uploadScript: null, // DEPRECATED: Use fileUploadOptions instead                                           // 1441
            deleteScript: 'delete.php',                                                                                // 1442
            preview: true,                                                                                             // 1443
            captions: true,                                                                                            // 1444
            captionPlaceholder: 'Type caption for image (optional)',                                                   // 1445
            autoGrid: 3,                                                                                               // 1446
            formData: null, // DEPRECATED: Use fileUploadOptions instead                                               // 1447
            fileUploadOptions: { // See https://github.com/blueimp/jQuery-File-Upload/wiki/Options                     // 1448
                url: 'upload.php',                                                                                     // 1449
                acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i                                                            // 1450
            },                                                                                                         // 1451
            styles: {                                                                                                  // 1452
                wide: {                                                                                                // 1453
                    label: '<span class="fa fa-align-justify"></span>',                                                // 1454
                    // added: function ($el) {},                                                                       // 1455
                    // removed: function ($el) {}                                                                      // 1456
                },                                                                                                     // 1457
                left: {                                                                                                // 1458
                    label: '<span class="fa fa-align-left"></span>',                                                   // 1459
                    // added: function ($el) {},                                                                       // 1460
                    // removed: function ($el) {}                                                                      // 1461
                },                                                                                                     // 1462
                right: {                                                                                               // 1463
                    label: '<span class="fa fa-align-right"></span>',                                                  // 1464
                    // added: function ($el) {},                                                                       // 1465
                    // removed: function ($el) {}                                                                      // 1466
                },                                                                                                     // 1467
                grid: {                                                                                                // 1468
                    label: '<span class="fa fa-th"></span>',                                                           // 1469
                    // added: function ($el) {},                                                                       // 1470
                    // removed: function ($el) {}                                                                      // 1471
                }                                                                                                      // 1472
            },                                                                                                         // 1473
            actions: {                                                                                                 // 1474
                remove: {                                                                                              // 1475
                    label: '<span class="fa fa-times"></span>',                                                        // 1476
                    clicked: function () {                                                                             // 1477
                        var $event = $.Event('keydown');                                                               // 1478
                                                                                                                       // 1479
                        $event.which = 8;                                                                              // 1480
                        $(document).trigger($event);                                                                   // 1481
                    }                                                                                                  // 1482
                }                                                                                                      // 1483
            },                                                                                                         // 1484
            sorting: function () {                                                                                     // 1485
                var that = this;                                                                                       // 1486
                                                                                                                       // 1487
                $('.medium-insert-images').sortable({                                                                  // 1488
                    group: 'medium-insert-images',                                                                     // 1489
                    containerSelector: '.medium-insert-images',                                                        // 1490
                    itemSelector: 'figure',                                                                            // 1491
                    placeholder: '<figure class="placeholder">',                                                       // 1492
                    handle: 'img',                                                                                     // 1493
                    nested: false,                                                                                     // 1494
                    vertical: false,                                                                                   // 1495
                    afterMove: function () {                                                                           // 1496
                        that.$el.trigger('input');                                                                     // 1497
                    }                                                                                                  // 1498
                });                                                                                                    // 1499
            },                                                                                                         // 1500
            messages: {                                                                                                // 1501
                acceptFileTypesError: 'This file is not in a supported format: ',                                      // 1502
                maxFileSizeError: 'This file is too big: '                                                             // 1503
            }                                                                                                          // 1504
            // uploadCompleted: function ($el, data) {}                                                                // 1505
        };                                                                                                             // 1506
                                                                                                                       // 1507
    /**                                                                                                                // 1508
     * Images object                                                                                                   // 1509
     *                                                                                                                 // 1510
     * Sets options, variables and calls init() function                                                               // 1511
     *                                                                                                                 // 1512
     * @constructor                                                                                                    // 1513
     * @param {DOM} el - DOM element to init the plugin on                                                             // 1514
     * @param {object} options - Options to override defaults                                                          // 1515
     * @return {void}                                                                                                  // 1516
     */                                                                                                                // 1517
                                                                                                                       // 1518
    function Images (el, options) {                                                                                    // 1519
        this.el = el;                                                                                                  // 1520
        this.$el = $(el);                                                                                              // 1521
        this.templates = window.MediumInsert.Templates;                                                                // 1522
        this.core = this.$el.data('plugin_'+ pluginName);                                                              // 1523
                                                                                                                       // 1524
        this.options = $.extend(true, {}, defaults, options);                                                          // 1525
                                                                                                                       // 1526
        this._defaults = defaults;                                                                                     // 1527
        this._name = pluginName;                                                                                       // 1528
                                                                                                                       // 1529
        // Allow image preview only in browsers, that support's that                                                   // 1530
        if (this.options.preview && !window.FileReader) {                                                              // 1531
            this.options.preview = false;                                                                              // 1532
        }                                                                                                              // 1533
                                                                                                                       // 1534
        // Extend editor's functions                                                                                   // 1535
        if (this.core.getEditor()) {                                                                                   // 1536
            this.core.getEditor()._serializePreImages = this.core.getEditor().serialize;                               // 1537
            this.core.getEditor().serialize = this.editorSerialize;                                                    // 1538
        }                                                                                                              // 1539
                                                                                                                       // 1540
        this.init();                                                                                                   // 1541
    }                                                                                                                  // 1542
                                                                                                                       // 1543
    /**                                                                                                                // 1544
     * Initialization                                                                                                  // 1545
     *                                                                                                                 // 1546
     * @return {void}                                                                                                  // 1547
     */                                                                                                                // 1548
                                                                                                                       // 1549
    Images.prototype.init = function () {                                                                              // 1550
        var $images = this.$el.find('.medium-insert-images');                                                          // 1551
                                                                                                                       // 1552
        $images.find('figcaption').attr('contenteditable', true);                                                      // 1553
        $images.find('figure').attr('contenteditable', false);                                                         // 1554
                                                                                                                       // 1555
        this.events();                                                                                                 // 1556
        this.backwardsCompatibility();                                                                                 // 1557
        this.sorting();                                                                                                // 1558
    };                                                                                                                 // 1559
                                                                                                                       // 1560
    /**                                                                                                                // 1561
     * Event listeners                                                                                                 // 1562
     *                                                                                                                 // 1563
     * @return {void}                                                                                                  // 1564
     */                                                                                                                // 1565
                                                                                                                       // 1566
    Images.prototype.events = function () {                                                                            // 1567
        $(document)                                                                                                    // 1568
            .on('click', $.proxy(this, 'unselectImage'))                                                               // 1569
            .on('keydown', $.proxy(this, 'removeImage'))                                                               // 1570
            .on('click', '.medium-insert-images-toolbar .medium-editor-action', $.proxy(this, 'toolbarAction'))        // 1571
            .on('click', '.medium-insert-images-toolbar2 .medium-editor-action', $.proxy(this, 'toolbar2Action'));     // 1572
                                                                                                                       // 1573
        this.$el                                                                                                       // 1574
            .on('click', '.medium-insert-images img', $.proxy(this, 'selectImage'));                                   // 1575
    };                                                                                                                 // 1576
                                                                                                                       // 1577
    /**                                                                                                                // 1578
     * Replace v0.* class names with new ones                                                                          // 1579
     *                                                                                                                 // 1580
     * @return {void}                                                                                                  // 1581
     */                                                                                                                // 1582
                                                                                                                       // 1583
    Images.prototype.backwardsCompatibility = function () {                                                            // 1584
        this.$el.find('.mediumInsert')                                                                                 // 1585
            .removeClass('mediumInsert')                                                                               // 1586
            .addClass('medium-insert-images');                                                                         // 1587
                                                                                                                       // 1588
        this.$el.find('.medium-insert-images.small')                                                                   // 1589
            .removeClass('small')                                                                                      // 1590
            .addClass('medium-insert-images-left');                                                                    // 1591
    };                                                                                                                 // 1592
                                                                                                                       // 1593
    /**                                                                                                                // 1594
     * Get the Core object                                                                                             // 1595
     *                                                                                                                 // 1596
     * @return {object} Core object                                                                                    // 1597
     */                                                                                                                // 1598
    Images.prototype.getCore = function () {                                                                           // 1599
        return this.core;                                                                                              // 1600
    };                                                                                                                 // 1601
                                                                                                                       // 1602
    /**                                                                                                                // 1603
     * Extend editor's serialize function                                                                              // 1604
     *                                                                                                                 // 1605
     * @return {object} Serialized data                                                                                // 1606
     */                                                                                                                // 1607
                                                                                                                       // 1608
    Images.prototype.editorSerialize = function () {                                                                   // 1609
        var data = this._serializePreImages();                                                                         // 1610
                                                                                                                       // 1611
        $.each(data, function (key) {                                                                                  // 1612
            var $data = $('<div />').html(data[key].value);                                                            // 1613
                                                                                                                       // 1614
            $data.find('.medium-insert-images').find('figcaption, figure').removeAttr('contenteditable');              // 1615
                                                                                                                       // 1616
            data[key].value = $data.html();                                                                            // 1617
        });                                                                                                            // 1618
                                                                                                                       // 1619
        return data;                                                                                                   // 1620
    };                                                                                                                 // 1621
                                                                                                                       // 1622
    /**                                                                                                                // 1623
     * Add image                                                                                                       // 1624
     *                                                                                                                 // 1625
     * @return {void}                                                                                                  // 1626
     */                                                                                                                // 1627
                                                                                                                       // 1628
    Images.prototype.add = function () {                                                                               // 1629
        var that = this,                                                                                               // 1630
            $file = $(this.templates['src/js/templates/images-fileupload.hbs']()),                                     // 1631
            fileUploadOptions = {                                                                                      // 1632
                dataType: 'json',                                                                                      // 1633
                add: function (e, data) {                                                                              // 1634
                    $.proxy(that, 'uploadAdd', e, data)();                                                             // 1635
                },                                                                                                     // 1636
                done: function (e, data) {                                                                             // 1637
                    $.proxy(that, 'uploadDone', e, data)();                                                            // 1638
                }                                                                                                      // 1639
            };                                                                                                         // 1640
                                                                                                                       // 1641
        // Backwards compatibility                                                                                     // 1642
        if (this.options.uploadScript) {                                                                               // 1643
            fileUploadOptions.url = this.options.uploadScript;                                                         // 1644
            this.getCore().deprecated('uploadScript', 'fileUploadOptions', '2.0');                                     // 1645
        }                                                                                                              // 1646
        if (this.options.formData) {                                                                                   // 1647
            fileUploadOptions.formData = this.options.formData;                                                        // 1648
            this.getCore().deprecated('formData', 'fileUploadOptions', '2.0');                                         // 1649
        }                                                                                                              // 1650
                                                                                                                       // 1651
        // Only add progress callbacks for browsers that support XHR2,                                                 // 1652
        // and test for XHR2 per:                                                                                      // 1653
        // http://stackoverflow.com/questions/6767887/                                                                 // 1654
        // what-is-the-best-way-to-check-for-xhr2-file-upload-support                                                  // 1655
        if (new XMLHttpRequest().upload) {                                                                             // 1656
            fileUploadOptions.progress = function (e, data) {                                                          // 1657
                $.proxy(that, 'uploadProgress', e, data)();                                                            // 1658
            };                                                                                                         // 1659
                                                                                                                       // 1660
            fileUploadOptions.progressall = function (e, data) {                                                       // 1661
                $.proxy(that, 'uploadProgressall', e, data)();                                                         // 1662
            };                                                                                                         // 1663
        }                                                                                                              // 1664
                                                                                                                       // 1665
        $file.fileupload($.extend(true, {}, this.options.fileUploadOptions, fileUploadOptions));                       // 1666
                                                                                                                       // 1667
        $file.click();                                                                                                 // 1668
    };                                                                                                                 // 1669
                                                                                                                       // 1670
    /**                                                                                                                // 1671
     * Callback invoked as soon as files are added to the fileupload widget - via file input selection, drag & drop or add API call.
     * https://github.com/blueimp/jQuery-File-Upload/wiki/Options#add                                                  // 1673
     *                                                                                                                 // 1674
     * @param {Event} e                                                                                                // 1675
     * @param {object} data                                                                                            // 1676
     * @return {void}                                                                                                  // 1677
     */                                                                                                                // 1678
                                                                                                                       // 1679
    Images.prototype.uploadAdd = function (e, data) {                                                                  // 1680
        var $place = this.$el.find('.medium-insert-active'),                                                           // 1681
            that = this,                                                                                               // 1682
            uploadErrors = [],                                                                                         // 1683
            file = data.files[0],                                                                                      // 1684
            acceptFileTypes = this.options.fileUploadOptions.acceptFileTypes,                                          // 1685
            maxFileSize = this.options.fileUploadOptions.maxFileSize,                                                  // 1686
            reader;                                                                                                    // 1687
                                                                                                                       // 1688
        if (acceptFileTypes && !acceptFileTypes.test(file['type'])) {                                                  // 1689
            uploadErrors.push(this.options.messages.acceptFileTypesError + file['name']);                              // 1690
        } else if (maxFileSize && file['size'] > maxFileSize) {                                                        // 1691
            uploadErrors.push(this.options.messages.maxFileSizeError + file['name']);                                  // 1692
        }                                                                                                              // 1693
        if (uploadErrors.length > 0) {                                                                                 // 1694
            alert(uploadErrors.join("\n"));                                                                            // 1695
            return;                                                                                                    // 1696
        }                                                                                                              // 1697
                                                                                                                       // 1698
        this.getCore().hideButtons();                                                                                  // 1699
                                                                                                                       // 1700
        // Replace paragraph with div, because figure elements can't be inside paragraph                               // 1701
        if ($place.is('p')) {                                                                                          // 1702
            $place.replaceWith('<div class="medium-insert-active">'+ $place.html() +'</div>');                         // 1703
            $place = this.$el.find('.medium-insert-active');                                                           // 1704
            this.getCore().moveCaret($place);                                                                          // 1705
        }                                                                                                              // 1706
                                                                                                                       // 1707
        $place.addClass('medium-insert-images');                                                                       // 1708
                                                                                                                       // 1709
        if (this.options.preview === false && $place.find('progress').length === 0 && (new XMLHttpRequest().upload)) { // 1710
            $place.append(this.templates['src/js/templates/images-progressbar.hbs']());                                // 1711
        }                                                                                                              // 1712
                                                                                                                       // 1713
        if (data.autoUpload || (data.autoUpload !== false && $(e.target).fileupload('option', 'autoUpload'))) {        // 1714
            data.process().done(function () {                                                                          // 1715
                // If preview is set to true, let the showImage handle the upload start                                // 1716
                if (that.options.preview) {                                                                            // 1717
                    reader = new FileReader();                                                                         // 1718
                                                                                                                       // 1719
                    reader.onload = function (e) {                                                                     // 1720
                        $.proxy(that, 'showImage', e.target.result, data)();                                           // 1721
                    };                                                                                                 // 1722
                                                                                                                       // 1723
                    reader.readAsDataURL(data.files[0]);                                                               // 1724
                } else {                                                                                               // 1725
                    data.submit();                                                                                     // 1726
                }                                                                                                      // 1727
            });                                                                                                        // 1728
        }                                                                                                              // 1729
    };                                                                                                                 // 1730
                                                                                                                       // 1731
    /**                                                                                                                // 1732
     * Callback for global upload progress events                                                                      // 1733
     * https://github.com/blueimp/jQuery-File-Upload/wiki/Options#progressall                                          // 1734
     *                                                                                                                 // 1735
     * @param {Event} e                                                                                                // 1736
     * @param {object} data                                                                                            // 1737
     * @return {void}                                                                                                  // 1738
     */                                                                                                                // 1739
                                                                                                                       // 1740
    Images.prototype.uploadProgressall = function (e, data) {                                                          // 1741
        var progress, $progressbar;                                                                                    // 1742
                                                                                                                       // 1743
        if (this.options.preview === false) {                                                                          // 1744
            progress = parseInt(data.loaded / data.total * 100, 10);                                                   // 1745
            $progressbar = this.$el.find('.medium-insert-active').find('progress');                                    // 1746
                                                                                                                       // 1747
            $progressbar                                                                                               // 1748
                .attr('value', progress)                                                                               // 1749
                .text(progress);                                                                                       // 1750
                                                                                                                       // 1751
            if (progress === 100) {                                                                                    // 1752
                $progressbar.remove();                                                                                 // 1753
            }                                                                                                          // 1754
        }                                                                                                              // 1755
    };                                                                                                                 // 1756
                                                                                                                       // 1757
    /**                                                                                                                // 1758
     * Callback for upload progress events.                                                                            // 1759
     * https://github.com/blueimp/jQuery-File-Upload/wiki/Options#progress                                             // 1760
     *                                                                                                                 // 1761
     * @param {Event} e                                                                                                // 1762
     * @param {object} data                                                                                            // 1763
     * @return {void}                                                                                                  // 1764
     */                                                                                                                // 1765
                                                                                                                       // 1766
    Images.prototype.uploadProgress = function (e, data) {                                                             // 1767
        var progress, $progressbar;                                                                                    // 1768
                                                                                                                       // 1769
        if (this.options.preview) {                                                                                    // 1770
            progress = 100 - parseInt(data.loaded / data.total * 100, 10);                                             // 1771
            $progressbar = data.context.find('.medium-insert-images-progress');                                        // 1772
                                                                                                                       // 1773
            $progressbar.css('width', progress +'%');                                                                  // 1774
                                                                                                                       // 1775
            if (progress === 0) {                                                                                      // 1776
                $progressbar.remove();                                                                                 // 1777
            }                                                                                                          // 1778
        }                                                                                                              // 1779
    };                                                                                                                 // 1780
                                                                                                                       // 1781
    /**                                                                                                                // 1782
     * Callback for successful upload requests.                                                                        // 1783
     * https://github.com/blueimp/jQuery-File-Upload/wiki/Options#done                                                 // 1784
     *                                                                                                                 // 1785
     * @param {Event} e                                                                                                // 1786
     * @param {object} data                                                                                            // 1787
     * @return {void}                                                                                                  // 1788
     */                                                                                                                // 1789
                                                                                                                       // 1790
    Images.prototype.uploadDone = function (e, data) {                                                                 // 1791
        var $el = $.proxy(this, 'showImage', data.result.files[0].url, data)();                                        // 1792
                                                                                                                       // 1793
        this.getCore().clean();                                                                                        // 1794
        this.sorting();                                                                                                // 1795
                                                                                                                       // 1796
        if (this.options.uploadCompleted) {                                                                            // 1797
            this.options.uploadCompleted($el, data);                                                                   // 1798
        }                                                                                                              // 1799
    };                                                                                                                 // 1800
                                                                                                                       // 1801
    /**                                                                                                                // 1802
     * Add uploaded / preview image to DOM                                                                             // 1803
     *                                                                                                                 // 1804
     * @param {string} img                                                                                             // 1805
     * @returns {void}                                                                                                 // 1806
     */                                                                                                                // 1807
                                                                                                                       // 1808
    Images.prototype.showImage = function (img, data) {                                                                // 1809
        var $place = this.$el.find('.medium-insert-active'),                                                           // 1810
            domImage,                                                                                                  // 1811
            that;                                                                                                      // 1812
                                                                                                                       // 1813
        // Hide editor's placeholder                                                                                   // 1814
        $place.click();                                                                                                // 1815
                                                                                                                       // 1816
        // If preview is allowed and preview image already exists,                                                     // 1817
        // replace it with uploaded image                                                                              // 1818
        that = this;                                                                                                   // 1819
        if (this.options.preview && data.context) {                                                                    // 1820
            domImage = this.getDOMImage();                                                                             // 1821
            domImage.onload = function () {                                                                            // 1822
                data.context.find('img').attr('src', domImage.src);                                                    // 1823
                that.$el.trigger('input');                                                                             // 1824
            };                                                                                                         // 1825
            domImage.src = img;                                                                                        // 1826
        } else {                                                                                                       // 1827
            data.context = $(this.templates['src/js/templates/images-image.hbs']({                                     // 1828
                img: img,                                                                                              // 1829
                progress: this.options.preview                                                                         // 1830
            })).appendTo($place);                                                                                      // 1831
                                                                                                                       // 1832
            $place.find('br').remove();                                                                                // 1833
                                                                                                                       // 1834
            if (this.options.autoGrid && $place.find('figure').length >= this.options.autoGrid) {                      // 1835
                $.each(this.options.styles, function (style, options) {                                                // 1836
                    var className = 'medium-insert-images-'+ style;                                                    // 1837
                                                                                                                       // 1838
                    $place.removeClass(className);                                                                     // 1839
                                                                                                                       // 1840
                    if (options.removed) {                                                                             // 1841
                        options.removed($place);                                                                       // 1842
                    }                                                                                                  // 1843
                });                                                                                                    // 1844
                                                                                                                       // 1845
                $place.addClass('medium-insert-images-grid');                                                          // 1846
                                                                                                                       // 1847
                if (this.options.styles.grid.added) {                                                                  // 1848
                    this.options.styles.grid.added($place);                                                            // 1849
                }                                                                                                      // 1850
            }                                                                                                          // 1851
                                                                                                                       // 1852
            if (this.options.preview) {                                                                                // 1853
                data.submit();                                                                                         // 1854
            }                                                                                                          // 1855
        }                                                                                                              // 1856
                                                                                                                       // 1857
        this.$el.trigger('input');                                                                                     // 1858
                                                                                                                       // 1859
        return data.context;                                                                                           // 1860
    };                                                                                                                 // 1861
                                                                                                                       // 1862
    Images.prototype.getDOMImage = function () {                                                                       // 1863
        return new window.Image();                                                                                     // 1864
    };                                                                                                                 // 1865
                                                                                                                       // 1866
    /**                                                                                                                // 1867
     * Select clicked image                                                                                            // 1868
     *                                                                                                                 // 1869
     * @param {Event} e                                                                                                // 1870
     * @returns {void}                                                                                                 // 1871
     */                                                                                                                // 1872
                                                                                                                       // 1873
    Images.prototype.selectImage = function (e) {                                                                      // 1874
        if(this.getCore().options.enabled) {                                                                           // 1875
            var $image = $(e.target),                                                                                  // 1876
                that = this;                                                                                           // 1877
                                                                                                                       // 1878
            // Hide keyboard on mobile devices                                                                         // 1879
            this.$el.blur();                                                                                           // 1880
                                                                                                                       // 1881
            $image.addClass('medium-insert-image-active');                                                             // 1882
            $image.closest('.medium-insert-images').addClass('medium-insert-active');                                  // 1883
                                                                                                                       // 1884
            setTimeout(function () {                                                                                   // 1885
                that.addToolbar();                                                                                     // 1886
                                                                                                                       // 1887
                if (that.options.captions) {                                                                           // 1888
                    that.getCore().addCaption($image.closest('figure'), that.options.captionPlaceholder);              // 1889
                }                                                                                                      // 1890
            }, 50);                                                                                                    // 1891
        }                                                                                                              // 1892
    };                                                                                                                 // 1893
                                                                                                                       // 1894
    /**                                                                                                                // 1895
     * Unselect selected image                                                                                         // 1896
     *                                                                                                                 // 1897
     * @param {Event} e                                                                                                // 1898
     * @returns {void}                                                                                                 // 1899
     */                                                                                                                // 1900
                                                                                                                       // 1901
    Images.prototype.unselectImage = function (e) {                                                                    // 1902
        var $el = $(e.target),                                                                                         // 1903
            $image = this.$el.find('.medium-insert-image-active');                                                     // 1904
                                                                                                                       // 1905
        if ($el.is('img') && $el.hasClass('medium-insert-image-active')) {                                             // 1906
            $image.not($el).removeClass('medium-insert-image-active');                                                 // 1907
            $('.medium-insert-images-toolbar, .medium-insert-images-toolbar2').remove();                               // 1908
            this.getCore().removeCaptions($el);                                                                        // 1909
            return;                                                                                                    // 1910
        }                                                                                                              // 1911
                                                                                                                       // 1912
        $image.removeClass('medium-insert-image-active');                                                              // 1913
        $('.medium-insert-images-toolbar, .medium-insert-images-toolbar2').remove();                                   // 1914
                                                                                                                       // 1915
        if ($el.is('.medium-insert-caption-placeholder')) {                                                            // 1916
            this.getCore().removeCaptionPlaceholder($image.closest('figure'));                                         // 1917
        } else if ($el.is('figcaption') === false) {                                                                   // 1918
            this.getCore().removeCaptions();                                                                           // 1919
        }                                                                                                              // 1920
    };                                                                                                                 // 1921
                                                                                                                       // 1922
    /**                                                                                                                // 1923
     * Remove image                                                                                                    // 1924
     *                                                                                                                 // 1925
     * @param {Event} e                                                                                                // 1926
     * @returns {void}                                                                                                 // 1927
     */                                                                                                                // 1928
                                                                                                                       // 1929
    Images.prototype.removeImage = function (e) {                                                                      // 1930
        var $image, $parent, $empty;                                                                                   // 1931
                                                                                                                       // 1932
        if (e.which === 8 || e.which === 46) {                                                                         // 1933
            $image = this.$el.find('.medium-insert-image-active');                                                     // 1934
                                                                                                                       // 1935
            if ($image.length) {                                                                                       // 1936
                e.preventDefault();                                                                                    // 1937
                                                                                                                       // 1938
                this.deleteFile($image.attr('src'));                                                                   // 1939
                                                                                                                       // 1940
                $parent = $image.closest('.medium-insert-images');                                                     // 1941
                $image.closest('figure').remove();                                                                     // 1942
                                                                                                                       // 1943
                $('.medium-insert-images-toolbar, .medium-insert-images-toolbar2').remove();                           // 1944
                                                                                                                       // 1945
                if ($parent.find('figure').length === 0) {                                                             // 1946
                    $empty = $parent.next();                                                                           // 1947
                    if ($empty.is('p') === false || $empty.text() !== '') {                                            // 1948
                        $empty = $(this.templates['src/js/templates/core-empty-line.hbs']().trim());                   // 1949
                        $parent.before($empty);                                                                        // 1950
                    }                                                                                                  // 1951
                    $parent.remove();                                                                                  // 1952
                                                                                                                       // 1953
                    // Hide addons                                                                                     // 1954
                    this.getCore().hideAddons();                                                                       // 1955
                                                                                                                       // 1956
                    this.getCore().moveCaret($empty);                                                                  // 1957
                }                                                                                                      // 1958
                                                                                                                       // 1959
                this.$el.trigger('input');                                                                             // 1960
            }                                                                                                          // 1961
        }                                                                                                              // 1962
    };                                                                                                                 // 1963
                                                                                                                       // 1964
    /**                                                                                                                // 1965
     * Makes ajax call to deleteScript                                                                                 // 1966
     *                                                                                                                 // 1967
     * @param {String} file File name                                                                                  // 1968
     * @returns {void}                                                                                                 // 1969
     */                                                                                                                // 1970
                                                                                                                       // 1971
    Images.prototype.deleteFile = function (file) {                                                                    // 1972
        if (this.options.deleteScript) {                                                                               // 1973
            $.post(this.options.deleteScript, { file: file });                                                         // 1974
        }                                                                                                              // 1975
    };                                                                                                                 // 1976
                                                                                                                       // 1977
    /**                                                                                                                // 1978
     * Adds image toolbar to editor                                                                                    // 1979
     *                                                                                                                 // 1980
     * @returns {void}                                                                                                 // 1981
     */                                                                                                                // 1982
                                                                                                                       // 1983
    Images.prototype.addToolbar = function () {                                                                        // 1984
        var $image = this.$el.find('.medium-insert-image-active'),                                                     // 1985
            $p = $image.closest('.medium-insert-images'),                                                              // 1986
            active = false,                                                                                            // 1987
            $toolbar, $toolbar2, top;                                                                                  // 1988
                                                                                                                       // 1989
        $('body').append(this.templates['src/js/templates/images-toolbar.hbs']({                                       // 1990
            styles: this.options.styles,                                                                               // 1991
            actions: this.options.actions                                                                              // 1992
        }).trim());                                                                                                    // 1993
                                                                                                                       // 1994
        $toolbar = $('.medium-insert-images-toolbar');                                                                 // 1995
        $toolbar2 = $('.medium-insert-images-toolbar2');                                                               // 1996
                                                                                                                       // 1997
        top = $image.offset().top - $toolbar.height() - 8 - 2 - 5; // 8px - hight of an arrow under toolbar, 2px - height of an image outset, 5px - distance from an image
        if (top < 0) {                                                                                                 // 1999
            top = 0;                                                                                                   // 2000
        }                                                                                                              // 2001
                                                                                                                       // 2002
        $toolbar                                                                                                       // 2003
            .css({                                                                                                     // 2004
                top: top,                                                                                              // 2005
                left: $image.offset().left + $image.width() / 2 - $toolbar.width() / 2                                 // 2006
            })                                                                                                         // 2007
            .show();                                                                                                   // 2008
                                                                                                                       // 2009
        $toolbar2                                                                                                      // 2010
            .css({                                                                                                     // 2011
                top: $image.offset().top + 2, // 2px - distance from a border                                          // 2012
                left: $image.offset().left + $image.width() - $toolbar2.width() - 4 // 4px - distance from a border    // 2013
            })                                                                                                         // 2014
            .show();                                                                                                   // 2015
                                                                                                                       // 2016
        $toolbar.find('button').each(function () {                                                                     // 2017
            if ($p.hasClass('medium-insert-images-'+ $(this).data('action'))) {                                        // 2018
                $(this).addClass('medium-editor-button-active');                                                       // 2019
                active = true;                                                                                         // 2020
            }                                                                                                          // 2021
        });                                                                                                            // 2022
                                                                                                                       // 2023
        if (active === false) {                                                                                        // 2024
            $toolbar.find('button').first().addClass('medium-editor-button-active');                                   // 2025
        }                                                                                                              // 2026
    };                                                                                                                 // 2027
                                                                                                                       // 2028
    /**                                                                                                                // 2029
     * Fires toolbar action                                                                                            // 2030
     *                                                                                                                 // 2031
     * @param {Event} e                                                                                                // 2032
     * @returns {void}                                                                                                 // 2033
     */                                                                                                                // 2034
                                                                                                                       // 2035
    Images.prototype.toolbarAction = function (e) {                                                                    // 2036
        var $button = $(e.target).is('button') ? $(e.target) : $(e.target).closest('button'),                          // 2037
            $li = $button.closest('li'),                                                                               // 2038
            $ul = $li.closest('ul'),                                                                                   // 2039
            $lis = $ul.find('li'),                                                                                     // 2040
            $p = this.$el.find('.medium-insert-active'),                                                               // 2041
            that = this;                                                                                               // 2042
                                                                                                                       // 2043
        $button.addClass('medium-editor-button-active');                                                               // 2044
        $li.siblings().find('.medium-editor-button-active').removeClass('medium-editor-button-active');                // 2045
                                                                                                                       // 2046
        $lis.find('button').each(function () {                                                                         // 2047
            var className = 'medium-insert-images-'+ $(this).data('action');                                           // 2048
                                                                                                                       // 2049
            if ($(this).hasClass('medium-editor-button-active')) {                                                     // 2050
                $p.addClass(className);                                                                                // 2051
                                                                                                                       // 2052
                if (that.options.styles[$(this).data('action')].added) {                                               // 2053
                    that.options.styles[$(this).data('action')].added($p);                                             // 2054
                }                                                                                                      // 2055
            } else {                                                                                                   // 2056
                $p.removeClass(className);                                                                             // 2057
                                                                                                                       // 2058
                if (that.options.styles[$(this).data('action')].removed) {                                             // 2059
                    that.options.styles[$(this).data('action')].removed($p);                                           // 2060
                }                                                                                                      // 2061
            }                                                                                                          // 2062
        });                                                                                                            // 2063
                                                                                                                       // 2064
        this.getCore().hideButtons();                                                                                  // 2065
                                                                                                                       // 2066
        this.$el.trigger('input');                                                                                     // 2067
    };                                                                                                                 // 2068
                                                                                                                       // 2069
    /**                                                                                                                // 2070
     * Fires toolbar2 action                                                                                           // 2071
     *                                                                                                                 // 2072
     * @param {Event} e                                                                                                // 2073
     * @returns {void}                                                                                                 // 2074
     */                                                                                                                // 2075
                                                                                                                       // 2076
    Images.prototype.toolbar2Action = function (e) {                                                                   // 2077
        var $button = $(e.target).is('button') ? $(e.target) : $(e.target).closest('button'),                          // 2078
            callback = this.options.actions[$button.data('action')].clicked;                                           // 2079
                                                                                                                       // 2080
        if (callback) {                                                                                                // 2081
            callback(this.$el.find('.medium-insert-image-active'));                                                    // 2082
        }                                                                                                              // 2083
                                                                                                                       // 2084
        this.getCore().hideButtons();                                                                                  // 2085
                                                                                                                       // 2086
        this.$el.trigger('input');                                                                                     // 2087
    };                                                                                                                 // 2088
                                                                                                                       // 2089
    /**                                                                                                                // 2090
     * Initialize sorting                                                                                              // 2091
     *                                                                                                                 // 2092
     * @returns {void}                                                                                                 // 2093
     */                                                                                                                // 2094
                                                                                                                       // 2095
    Images.prototype.sorting = function () {                                                                           // 2096
        this.options.sorting();                                                                                        // 2097
    };                                                                                                                 // 2098
                                                                                                                       // 2099
    /** Plugin initialization */                                                                                       // 2100
                                                                                                                       // 2101
    $.fn[pluginName + addonName] = function (options) {                                                                // 2102
        return this.each(function () {                                                                                 // 2103
            if (!$.data(this, 'plugin_' + pluginName + addonName)) {                                                   // 2104
                $.data(this, 'plugin_' + pluginName + addonName, new Images(this, options));                           // 2105
            }                                                                                                          // 2106
        });                                                                                                            // 2107
    };                                                                                                                 // 2108
                                                                                                                       // 2109
})(jQuery, window, document);                                                                                          // 2110
                                                                                                                       // 2111
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/compatibility/bootstrap-tagsinput.js                                                       //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
(function ($) {                                                                                                        // 1
  "use strict";                                                                                                        // 2
                                                                                                                       // 3
  var defaultOptions = {                                                                                               // 4
    tagClass: function(item) {                                                                                         // 5
      return 'label label-info';                                                                                       // 6
    },                                                                                                                 // 7
    itemValue: function(item) {                                                                                        // 8
      return item ? item.toString() : item;                                                                            // 9
    },                                                                                                                 // 10
    itemText: function(item) {                                                                                         // 11
      return this.itemValue(item);                                                                                     // 12
    },                                                                                                                 // 13
    freeInput: true,                                                                                                   // 14
    maxTags: undefined,                                                                                                // 15
    confirmKeys: [13],                                                                                                 // 16
    onTagExists: function(item, $tag) {                                                                                // 17
      $tag.hide().fadeIn();                                                                                            // 18
    }                                                                                                                  // 19
  };                                                                                                                   // 20
                                                                                                                       // 21
  /**                                                                                                                  // 22
  * Constructor function                                                                                               // 23
  */                                                                                                                   // 24
  function TagsInput(element, options) {                                                                               // 25
    this.itemsArray = [];                                                                                              // 26
                                                                                                                       // 27
    this.$element = $(element);                                                                                        // 28
    this.$element.hide();                                                                                              // 29
                                                                                                                       // 30
    this.isSelect = (element.tagName === 'SELECT');                                                                    // 31
    this.multiple = (this.isSelect && element.hasAttribute('multiple'));                                               // 32
    this.objectItems = options && options.itemValue;                                                                   // 33
    this.placeholderText = element.hasAttribute('placeholder') ? this.$element.attr('placeholder') : '';               // 34
    this.inputSize = Math.max(1, this.placeholderText.length);                                                         // 35
                                                                                                                       // 36
    this.$container = $('<div class="bootstrap-tagsinput"></div>');                                                    // 37
    this.$input = $('<input size="' + this.inputSize + '" type="text" placeholder="' + this.placeholderText + '"/>').appendTo(this.$container);
                                                                                                                       // 39
    this.$element.after(this.$container);                                                                              // 40
                                                                                                                       // 41
    this.build(options);                                                                                               // 42
  }                                                                                                                    // 43
                                                                                                                       // 44
  TagsInput.prototype = {                                                                                              // 45
    constructor: TagsInput,                                                                                            // 46
                                                                                                                       // 47
    /**                                                                                                                // 48
    * Adds the given item as a new tag. Pass true to dontPushVal to prevent                                            // 49
    * updating the elements val()                                                                                      // 50
    */                                                                                                                 // 51
    add: function(item, dontPushVal) {                                                                                 // 52
      var self = this;                                                                                                 // 53
                                                                                                                       // 54
      if (self.options.maxTags && self.itemsArray.length >= self.options.maxTags)                                      // 55
        return;                                                                                                        // 56
                                                                                                                       // 57
        // Ignore falsey values, except false                                                                          // 58
        if (item !== false && !item)                                                                                   // 59
          return;                                                                                                      // 60
                                                                                                                       // 61
          // Throw an error when trying to add an object while the itemValue option was not set                        // 62
          if (typeof item === "object" && !self.objectItems)                                                           // 63
            throw("Can't add objects when itemValue option is not set");                                               // 64
                                                                                                                       // 65
            // Ignore strings only containg whitespace                                                                 // 66
            if (item.toString().match(/^\s*$/))                                                                        // 67
              return;                                                                                                  // 68
                                                                                                                       // 69
              // If SELECT but not multiple, remove current tag                                                        // 70
              if (self.isSelect && !self.multiple && self.itemsArray.length > 0)                                       // 71
                self.remove(self.itemsArray[0]);                                                                       // 72
                                                                                                                       // 73
                if (typeof item === "string" && this.$element[0].tagName === 'INPUT') {                                // 74
                  var items = item.split(',');                                                                         // 75
                  if (items.length > 1) {                                                                              // 76
                    for (var i = 0; i < items.length; i++) {                                                           // 77
                      this.add(items[i], true);                                                                        // 78
                    }                                                                                                  // 79
                                                                                                                       // 80
                    if (!dontPushVal)                                                                                  // 81
                      self.pushVal();                                                                                  // 82
                      return;                                                                                          // 83
                    }                                                                                                  // 84
                  }                                                                                                    // 85
                                                                                                                       // 86
                  var itemValue = self.options.itemValue(item),                                                        // 87
                  itemText = self.options.itemText(item),                                                              // 88
                  tagClass = self.options.tagClass(item);                                                              // 89
                                                                                                                       // 90
                  // Ignore items allready added                                                                       // 91
                  var existing = $.grep(self.itemsArray, function(item) { return self.options.itemValue(item) === itemValue; } )[0];
                  if (existing) {                                                                                      // 93
                    // Invoke onTagExists                                                                              // 94
                    if (self.options.onTagExists) {                                                                    // 95
                      var $existingTag = $(".tag", self.$container).filter(function() { return $(this).data("item") === existing; });
                      self.options.onTagExists(item, $existingTag);                                                    // 97
                    }                                                                                                  // 98
                    return;                                                                                            // 99
                  }                                                                                                    // 100
                                                                                                                       // 101
                  // register item in internal array and map                                                           // 102
                  self.itemsArray.push(item);                                                                          // 103
                                                                                                                       // 104
                  // add a tag element                                                                                 // 105
                  var $tag = $('<span class="tag ' + htmlEncode(tagClass) + '">' + htmlEncode(itemText) + '<span data-role="remove"></span></span>');
                  $tag.data('item', item);                                                                             // 107
                  self.findInputWrapper().before($tag);                                                                // 108
                  $tag.after(' ');                                                                                     // 109
                                                                                                                       // 110
                  // add <option /> if item represents a value not present in one of the <select />'s options          // 111
                  if (self.isSelect && !$('option[value="' + escape(itemValue) + '"]',self.$element)[0]) {             // 112
                    var $option = $('<option selected>' + htmlEncode(itemText) + '</option>');                         // 113
                    $option.data('item', item);                                                                        // 114
                    $option.attr('value', itemValue);                                                                  // 115
                    self.$element.append($option);                                                                     // 116
                  }                                                                                                    // 117
                                                                                                                       // 118
                  if (!dontPushVal)                                                                                    // 119
                    self.pushVal();                                                                                    // 120
                                                                                                                       // 121
                    // Add class when reached maxTags                                                                  // 122
                    if (self.options.maxTags === self.itemsArray.length)                                               // 123
                      self.$container.addClass('bootstrap-tagsinput-max');                                             // 124
                                                                                                                       // 125
                      self.$element.trigger($.Event('itemAdded', { item: item }));                                     // 126
                    },                                                                                                 // 127
                                                                                                                       // 128
                    /**                                                                                                // 129
                    * Removes the given item. Pass true to dontPushVal to prevent updating the                         // 130
                    * elements val()                                                                                   // 131
                    */                                                                                                 // 132
                    remove: function(item, dontPushVal) {                                                              // 133
                      var self = this;                                                                                 // 134
                                                                                                                       // 135
                      if (self.objectItems) {                                                                          // 136
                        if (typeof item === "object")                                                                  // 137
                          item = $.grep(self.itemsArray, function(other) { return self.options.itemValue(other) ==  self.options.itemValue(item); } )[0];
                        else                                                                                           // 139
                          item = $.grep(self.itemsArray, function(other) { return self.options.itemValue(other) ==  item; } )[0];
                        }                                                                                              // 141
                                                                                                                       // 142
                        if (item) {                                                                                    // 143
                          $('.tag', self.$container).filter(function() { return $(this).data('item') === item; }).remove();
                          $('option', self.$element).filter(function() { return $(this).data('item') === item; }).remove();
                          self.itemsArray.splice($.inArray(item, self.itemsArray), 1);                                 // 146
                        }                                                                                              // 147
                                                                                                                       // 148
                        if (!dontPushVal)                                                                              // 149
                          self.pushVal();                                                                              // 150
                                                                                                                       // 151
                          // Remove class when reached maxTags                                                         // 152
                          if (self.options.maxTags > self.itemsArray.length)                                           // 153
                            self.$container.removeClass('bootstrap-tagsinput-max');                                    // 154
                                                                                                                       // 155
                            self.$element.trigger($.Event('itemRemoved',  { item: item }));                            // 156
                          },                                                                                           // 157
                                                                                                                       // 158
                          /**                                                                                          // 159
                          * Removes all items                                                                          // 160
                          */                                                                                           // 161
                          removeAll: function() {                                                                      // 162
                            var self = this;                                                                           // 163
                                                                                                                       // 164
                            $('.tag', self.$container).remove();                                                       // 165
                            $('option', self.$element).remove();                                                       // 166
                                                                                                                       // 167
                            while(self.itemsArray.length > 0)                                                          // 168
                              self.itemsArray.pop();                                                                   // 169
                                                                                                                       // 170
                              self.pushVal();                                                                          // 171
                                                                                                                       // 172
                              if (self.options.maxTags && !this.isEnabled())                                           // 173
                                this.enable();                                                                         // 174
                              },                                                                                       // 175
                                                                                                                       // 176
                              /**                                                                                      // 177
                              * Refreshes the tags so they match the text/value of their corresponding                 // 178
                              * item.                                                                                  // 179
                              */                                                                                       // 180
                              refresh: function() {                                                                    // 181
                                var self = this;                                                                       // 182
                                $('.tag', self.$container).each(function() {                                           // 183
                                  var $tag = $(this),                                                                  // 184
                                  item = $tag.data('item'),                                                            // 185
                                  itemValue = self.options.itemValue(item),                                            // 186
                                  itemText = self.options.itemText(item),                                              // 187
                                  tagClass = self.options.tagClass(item);                                              // 188
                                                                                                                       // 189
                                  // Update tag's class and inner text                                                 // 190
                                  $tag.attr('class', null);                                                            // 191
                                  $tag.addClass('tag ' + htmlEncode(tagClass));                                        // 192
                                  $tag.contents().filter(function() {                                                  // 193
                                    return this.nodeType == 3;                                                         // 194
                                  })[0].nodeValue = htmlEncode(itemText);                                              // 195
                                                                                                                       // 196
                                  if (self.isSelect) {                                                                 // 197
                                    var option = $('option', self.$element).filter(function() { return $(this).data('item') === item; });
                                    option.attr('value', itemValue);                                                   // 199
                                  }                                                                                    // 200
                                });                                                                                    // 201
                              },                                                                                       // 202
                                                                                                                       // 203
                              /**                                                                                      // 204
                              * Returns the items added as tags                                                        // 205
                              */                                                                                       // 206
                              items: function() {                                                                      // 207
                                return this.itemsArray;                                                                // 208
                              },                                                                                       // 209
                                                                                                                       // 210
                              /**                                                                                      // 211
                              * Assembly value by retrieving the value of each item, and set it on the                 // 212
                              * element.                                                                               // 213
                              */                                                                                       // 214
                              pushVal: function() {                                                                    // 215
                                var self = this,                                                                       // 216
                                val = $.map(self.items(), function(item) {                                             // 217
                                  return self.options.itemValue(item).toString();                                      // 218
                                });                                                                                    // 219
                                                                                                                       // 220
                                self.$element.val(val, true).trigger('change');                                        // 221
                              },                                                                                       // 222
                                                                                                                       // 223
                              /**                                                                                      // 224
                              * Initializes the tags input behaviour on the element                                    // 225
                              */                                                                                       // 226
                              build: function(options) {                                                               // 227
                                var self = this;                                                                       // 228
                                                                                                                       // 229
                                self.options = $.extend({}, defaultOptions, options);                                  // 230
                                var typeahead = self.options.typeahead || {};                                          // 231
                                                                                                                       // 232
                                // When itemValue is set, freeInput should always be false                             // 233
                                if (self.objectItems)                                                                  // 234
                                  self.options.freeInput = false;                                                      // 235
                                                                                                                       // 236
                                  makeOptionItemFunction(self.options, 'itemValue');                                   // 237
                                  makeOptionItemFunction(self.options, 'itemText');                                    // 238
                                  makeOptionItemFunction(self.options, 'tagClass');                                    // 239
                                                                                                                       // 240
                                  // for backwards compatibility, self.options.source is deprecated                    // 241
                                  if (self.options.source)                                                             // 242
                                    typeahead.source = self.options.source;                                            // 243
                                                                                                                       // 244
                                    if (typeahead.source && $.fn.typeahead) {                                          // 245
                                      makeOptionFunction(typeahead, 'source');                                         // 246
                                                                                                                       // 247
                                      self.$input.typeahead({                                                          // 248
                                        source: function (query, process) {                                            // 249
                                          function processItems(items) {                                               // 250
                                            var texts = [];                                                            // 251
                                                                                                                       // 252
                                            for (var i = 0; i < items.length; i++) {                                   // 253
                                              var text = self.options.itemText(items[i]);                              // 254
                                              map[text] = items[i];                                                    // 255
                                              texts.push(text);                                                        // 256
                                            }                                                                          // 257
                                            process(texts);                                                            // 258
                                          }                                                                            // 259
                                                                                                                       // 260
                                          this.map = {};                                                               // 261
                                          var map = this.map,                                                          // 262
                                          data = typeahead.source(query);                                              // 263
                                                                                                                       // 264
                                          if ($.isFunction(data.success)) {                                            // 265
                                            // support for Angular promises                                            // 266
                                            data.success(processItems);                                                // 267
                                          } else {                                                                     // 268
                                            // support for functions and jquery promises                               // 269
                                            $.when(data)                                                               // 270
                                            .then(processItems);                                                       // 271
                                          }                                                                            // 272
                                        },                                                                             // 273
                                        updater: function (text) {                                                     // 274
                                          self.add(this.map[text]);                                                    // 275
                                        },                                                                             // 276
                                        matcher: function (text) {                                                     // 277
                                          return (text.toLowerCase().indexOf(this.query.trim().toLowerCase()) !== -1); // 278
                                        },                                                                             // 279
                                        sorter: function (texts) {                                                     // 280
                                          return texts.sort();                                                         // 281
                                        },                                                                             // 282
                                        highlighter: function (text) {                                                 // 283
                                          var regex = new RegExp( '(' + this.query + ')', 'gi' );                      // 284
                                          return text.replace( regex, "<strong>$1</strong>" );                         // 285
                                        }                                                                              // 286
                                      });                                                                              // 287
                                    }                                                                                  // 288
                                                                                                                       // 289
                                    self.$container.on('click', $.proxy(function(event) {                              // 290
                                      self.$input.focus();                                                             // 291
                                    }, self));                                                                         // 292
                                                                                                                       // 293
                                    self.$container.on('keydown', 'input', $.proxy(function(event) {                   // 294
                                      var $input = $(event.target),                                                    // 295
                                      $inputWrapper = self.findInputWrapper();                                         // 296
                                                                                                                       // 297
                                      switch (event.which) {                                                           // 298
                                        // BACKSPACE                                                                   // 299
                                      case 8:                                                                          // 300
                                        if (doGetCaretPosition($input[0]) === 0) {                                     // 301
                                          var prev = $inputWrapper.prev();                                             // 302
                                          if (prev) {                                                                  // 303
                                            self.remove(prev.data('item'));                                            // 304
                                          }                                                                            // 305
                                        }                                                                              // 306
                                        break;                                                                         // 307
                                                                                                                       // 308
                                        // DELETE                                                                      // 309
                                      case 46:                                                                         // 310
                                        if (doGetCaretPosition($input[0]) === 0) {                                     // 311
                                          var next = $inputWrapper.next();                                             // 312
                                          if (next) {                                                                  // 313
                                            self.remove(next.data('item'));                                            // 314
                                          }                                                                            // 315
                                        }                                                                              // 316
                                        break;                                                                         // 317
                                                                                                                       // 318
                                        // LEFT ARROW                                                                  // 319
                                      case 37:                                                                         // 320
                                        // Try to move the input before the previous tag                               // 321
                                        var $prevTag = $inputWrapper.prev();                                           // 322
                                        if ($input.val().length === 0 && $prevTag[0]) {                                // 323
                                          $prevTag.before($inputWrapper);                                              // 324
                                          $input.focus();                                                              // 325
                                        }                                                                              // 326
                                        break;                                                                         // 327
                                        // RIGHT ARROW                                                                 // 328
                                      case 39:                                                                         // 329
                                        // Try to move the input after the next tag                                    // 330
                                        var $nextTag = $inputWrapper.next();                                           // 331
                                        if ($input.val().length === 0 && $nextTag[0]) {                                // 332
                                          $nextTag.after($inputWrapper);                                               // 333
                                          $input.focus();                                                              // 334
                                        }                                                                              // 335
                                        break;                                                                         // 336
                                      default:                                                                         // 337
                                        // When key corresponds one of the confirmKeys, add current input              // 338
                                        // as a new tag                                                                // 339
                                        if (self.options.freeInput && $.inArray(event.which, self.options.confirmKeys) >= 0) {
                                          self.add($input.val());                                                      // 341
                                          $input.val('');                                                              // 342
                                          event.preventDefault();                                                      // 343
                                        }                                                                              // 344
                                      }                                                                                // 345
                                                                                                                       // 346
                                      // Reset internal input's size                                                   // 347
                                      $input.attr('size', Math.max(this.inputSize, $input.val().length));              // 348
                                    }, self));                                                                         // 349
                                                                                                                       // 350
                                    // Remove icon clicked                                                             // 351
                                    self.$container.on('click', '[data-role=remove]', $.proxy(function(event) {        // 352
                                      self.remove($(event.target).closest('.tag').data('item'));                       // 353
                                    }, self));                                                                         // 354
                                                                                                                       // 355
                                    // Only add existing value as tags when using strings as tags                      // 356
                                    if (self.options.itemValue === defaultOptions.itemValue) {                         // 357
                                      if (self.$element[0].tagName === 'INPUT') {                                      // 358
                                        self.add(self.$element.val());                                                 // 359
                                      } else {                                                                         // 360
                                        $('option', self.$element).each(function() {                                   // 361
                                          self.add($(this).attr('value'), true);                                       // 362
                                        });                                                                            // 363
                                      }                                                                                // 364
                                    }                                                                                  // 365
                                  },                                                                                   // 366
                                                                                                                       // 367
                                  /**                                                                                  // 368
                                  * Removes all tagsinput behaviour and unregsiter all event handlers                  // 369
                                  */                                                                                   // 370
                                  destroy: function() {                                                                // 371
                                    var self = this;                                                                   // 372
                                                                                                                       // 373
                                    // Unbind events                                                                   // 374
                                    self.$container.off('keypress', 'input');                                          // 375
                                    self.$container.off('click', '[role=remove]');                                     // 376
                                                                                                                       // 377
                                    self.$container.remove();                                                          // 378
                                    self.$element.removeData('tagsinput');                                             // 379
                                    self.$element.show();                                                              // 380
                                  },                                                                                   // 381
                                                                                                                       // 382
                                  /**                                                                                  // 383
                                  * Sets focus on the tagsinput                                                        // 384
                                  */                                                                                   // 385
                                  focus: function() {                                                                  // 386
                                    this.$input.focus();                                                               // 387
                                  },                                                                                   // 388
                                                                                                                       // 389
                                  /**                                                                                  // 390
                                  * Returns the internal input element                                                 // 391
                                  */                                                                                   // 392
                                  input: function() {                                                                  // 393
                                    return this.$input;                                                                // 394
                                  },                                                                                   // 395
                                                                                                                       // 396
                                  /**                                                                                  // 397
                                  * Returns the element which is wrapped around the internal input. This               // 398
                                  * is normally the $container, but typeahead.js moves the $input element.             // 399
                                  */                                                                                   // 400
                                  findInputWrapper: function() {                                                       // 401
                                    var elt = this.$input[0],                                                          // 402
                                    container = this.$container[0];                                                    // 403
                                    while(elt && elt.parentNode !== container)                                         // 404
                                      elt = elt.parentNode;                                                            // 405
                                                                                                                       // 406
                                      return $(elt);                                                                   // 407
                                    }                                                                                  // 408
                                  };                                                                                   // 409
                                                                                                                       // 410
                                  /**                                                                                  // 411
                                  * Register JQuery plugin                                                             // 412
                                  */                                                                                   // 413
                                  $.fn.tagsinput = function(arg1, arg2) {                                              // 414
                                    var results = [];                                                                  // 415
                                                                                                                       // 416
                                    this.each(function() {                                                             // 417
                                      var tagsinput = $(this).data('tagsinput');                                       // 418
                                                                                                                       // 419
                                      // Initialize a new tags input                                                   // 420
                                      if (!tagsinput) {                                                                // 421
                                        tagsinput = new TagsInput(this, arg1);                                         // 422
                                        $(this).data('tagsinput', tagsinput);                                          // 423
                                        results.push(tagsinput);                                                       // 424
                                                                                                                       // 425
                                        if (this.tagName === 'SELECT') {                                               // 426
                                          $('option', $(this)).attr('selected', 'selected');                           // 427
                                        }                                                                              // 428
                                                                                                                       // 429
                                        // Init tags from $(this).val()                                                // 430
                                        $(this).val($(this).val());                                                    // 431
                                      } else {                                                                         // 432
                                        // Invoke function on existing tags input                                      // 433
                                        var retVal = tagsinput[arg1](arg2);                                            // 434
                                        if (retVal !== undefined)                                                      // 435
                                          results.push(retVal);                                                        // 436
                                        }                                                                              // 437
                                      });                                                                              // 438
                                                                                                                       // 439
                                      if ( typeof arg1 == 'string') {                                                  // 440
                                        // Return the results from the invoked function calls                          // 441
                                        return results.length > 1 ? results : results[0];                              // 442
                                      } else {                                                                         // 443
                                        return results;                                                                // 444
                                      }                                                                                // 445
                                    };                                                                                 // 446
                                                                                                                       // 447
                                    $.fn.tagsinput.Constructor = TagsInput;                                            // 448
                                                                                                                       // 449
                                    /**                                                                                // 450
                                    * Most options support both a string or number as well as a function as            // 451
                                    * option value. This function makes sure that the option with the given            // 452
                                    * key in the given options is wrapped in a function                                // 453
                                    */                                                                                 // 454
                                    function makeOptionItemFunction(options, key) {                                    // 455
                                      if (typeof options[key] !== 'function') {                                        // 456
                                        var propertyName = options[key];                                               // 457
                                        options[key] = function(item) { return item[propertyName]; };                  // 458
                                      }                                                                                // 459
                                    }                                                                                  // 460
                                    function makeOptionFunction(options, key) {                                        // 461
                                      if (typeof options[key] !== 'function') {                                        // 462
                                        var value = options[key];                                                      // 463
                                        options[key] = function() { return value; };                                   // 464
                                      }                                                                                // 465
                                    }                                                                                  // 466
                                    /**                                                                                // 467
                                    * HtmlEncodes the given value                                                      // 468
                                    */                                                                                 // 469
                                    var htmlEncodeContainer = $('<div />');                                            // 470
                                    function htmlEncode(value) {                                                       // 471
                                      if (value) {                                                                     // 472
                                        return htmlEncodeContainer.text(value).html();                                 // 473
                                      } else {                                                                         // 474
                                        return '';                                                                     // 475
                                      }                                                                                // 476
                                    }                                                                                  // 477
                                                                                                                       // 478
                                    /**                                                                                // 479
                                    * Returns the position of the caret in the given input field                       // 480
                                    * http://flightschool.acylt.com/devnotes/caret-position-woes/                      // 481
                                    */                                                                                 // 482
                                    function doGetCaretPosition(oField) {                                              // 483
                                      var iCaretPos = 0;                                                               // 484
                                      if (document.selection) {                                                        // 485
                                        oField.focus ();                                                               // 486
                                        var oSel = document.selection.createRange();                                   // 487
                                        oSel.moveStart ('character', -oField.value.length);                            // 488
                                        iCaretPos = oSel.text.length;                                                  // 489
                                      } else if (oField.selectionStart || oField.selectionStart == '0') {              // 490
                                        iCaretPos = oField.selectionStart;                                             // 491
                                      }                                                                                // 492
                                      return (iCaretPos);                                                              // 493
                                    }                                                                                  // 494
                                                                                                                       // 495
                                    /**                                                                                // 496
                                    * Initialize tagsinput behaviour on inputs and selects which have                  // 497
                                    * data-role=tagsinput                                                              // 498
                                    */                                                                                 // 499
                                    $(function() {                                                                     // 500
                                      $("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput();
                                    });                                                                                // 502
                                  })(window.jQuery);                                                                   // 503
                                                                                                                       // 504
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/compatibility/typeahead.jquery.js                                                          //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
/*!                                                                                                                    // 1
 * typeahead.js 0.10.2                                                                                                 // 2
 * https://github.com/twitter/typeahead.js                                                                             // 3
 * Copyright 2013-2014 Twitter, Inc. and other contributors; Licensed MIT                                              // 4
 */                                                                                                                    // 5
                                                                                                                       // 6
(function($) {                                                                                                         // 7
    var _ = {                                                                                                          // 8
        isMsie: function() {                                                                                           // 9
            return /(msie|trident)/i.test(navigator.userAgent) ? navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2] : false;
        },                                                                                                             // 11
        isBlankString: function(str) {                                                                                 // 12
            return !str || /^\s*$/.test(str);                                                                          // 13
        },                                                                                                             // 14
        escapeRegExChars: function(str) {                                                                              // 15
            return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&");                                         // 16
        },                                                                                                             // 17
        isString: function(obj) {                                                                                      // 18
            return typeof obj === "string";                                                                            // 19
        },                                                                                                             // 20
        isNumber: function(obj) {                                                                                      // 21
            return typeof obj === "number";                                                                            // 22
        },                                                                                                             // 23
        isArray: $.isArray,                                                                                            // 24
        isFunction: $.isFunction,                                                                                      // 25
        isObject: $.isPlainObject,                                                                                     // 26
        isUndefined: function(obj) {                                                                                   // 27
            return typeof obj === "undefined";                                                                         // 28
        },                                                                                                             // 29
        bind: $.proxy,                                                                                                 // 30
        each: function(collection, cb) {                                                                               // 31
            $.each(collection, reverseArgs);                                                                           // 32
            function reverseArgs(index, value) {                                                                       // 33
                return cb(value, index);                                                                               // 34
            }                                                                                                          // 35
        },                                                                                                             // 36
        map: $.map,                                                                                                    // 37
        filter: $.grep,                                                                                                // 38
        every: function(obj, test) {                                                                                   // 39
            var result = true;                                                                                         // 40
            if (!obj) {                                                                                                // 41
                return result;                                                                                         // 42
            }                                                                                                          // 43
            $.each(obj, function(key, val) {                                                                           // 44
                if (!(result = test.call(null, val, key, obj))) {                                                      // 45
                    return false;                                                                                      // 46
                }                                                                                                      // 47
            });                                                                                                        // 48
            return !!result;                                                                                           // 49
        },                                                                                                             // 50
        some: function(obj, test) {                                                                                    // 51
            var result = false;                                                                                        // 52
            if (!obj) {                                                                                                // 53
                return result;                                                                                         // 54
            }                                                                                                          // 55
            $.each(obj, function(key, val) {                                                                           // 56
                if (result = test.call(null, val, key, obj)) {                                                         // 57
                    return false;                                                                                      // 58
                }                                                                                                      // 59
            });                                                                                                        // 60
            return !!result;                                                                                           // 61
        },                                                                                                             // 62
        mixin: $.extend,                                                                                               // 63
        getUniqueId: function() {                                                                                      // 64
            var counter = 0;                                                                                           // 65
            return function() {                                                                                        // 66
                return counter++;                                                                                      // 67
            };                                                                                                         // 68
        }(),                                                                                                           // 69
        templatify: function templatify(obj) {                                                                         // 70
            return $.isFunction(obj) ? obj : template;                                                                 // 71
            function template() {                                                                                      // 72
                return String(obj);                                                                                    // 73
            }                                                                                                          // 74
        },                                                                                                             // 75
        defer: function(fn) {                                                                                          // 76
            setTimeout(fn, 0);                                                                                         // 77
        },                                                                                                             // 78
        debounce: function(func, wait, immediate) {                                                                    // 79
            var timeout, result;                                                                                       // 80
            return function() {                                                                                        // 81
                var context = this, args = arguments, later, callNow;                                                  // 82
                later = function() {                                                                                   // 83
                    timeout = null;                                                                                    // 84
                    if (!immediate) {                                                                                  // 85
                        result = func.apply(context, args);                                                            // 86
                    }                                                                                                  // 87
                };                                                                                                     // 88
                callNow = immediate && !timeout;                                                                       // 89
                clearTimeout(timeout);                                                                                 // 90
                timeout = setTimeout(later, wait);                                                                     // 91
                if (callNow) {                                                                                         // 92
                    result = func.apply(context, args);                                                                // 93
                }                                                                                                      // 94
                return result;                                                                                         // 95
            };                                                                                                         // 96
        },                                                                                                             // 97
        throttle: function(func, wait) {                                                                               // 98
            var context, args, timeout, result, previous, later;                                                       // 99
            previous = 0;                                                                                              // 100
            later = function() {                                                                                       // 101
                previous = new Date();                                                                                 // 102
                timeout = null;                                                                                        // 103
                result = func.apply(context, args);                                                                    // 104
            };                                                                                                         // 105
            return function() {                                                                                        // 106
                var now = new Date(), remaining = wait - (now - previous);                                             // 107
                context = this;                                                                                        // 108
                args = arguments;                                                                                      // 109
                if (remaining <= 0) {                                                                                  // 110
                    clearTimeout(timeout);                                                                             // 111
                    timeout = null;                                                                                    // 112
                    previous = now;                                                                                    // 113
                    result = func.apply(context, args);                                                                // 114
                } else if (!timeout) {                                                                                 // 115
                    timeout = setTimeout(later, remaining);                                                            // 116
                }                                                                                                      // 117
                return result;                                                                                         // 118
            };                                                                                                         // 119
        },                                                                                                             // 120
        noop: function() {}                                                                                            // 121
    };                                                                                                                 // 122
    var html = {                                                                                                       // 123
        wrapper: '<span class="twitter-typeahead"></span>',                                                            // 124
        dropdown: '<span class="tt-dropdown-menu"></span>',                                                            // 125
        dataset: '<div class="tt-dataset-%CLASS%"></div>',                                                             // 126
        suggestions: '<span class="tt-suggestions"></span>',                                                           // 127
        suggestion: '<div class="tt-suggestion"></div>'                                                                // 128
    };                                                                                                                 // 129
    var css = {                                                                                                        // 130
        wrapper: {                                                                                                     // 131
            position: "relative",                                                                                      // 132
            display: "inline-block"                                                                                    // 133
        },                                                                                                             // 134
        hint: {                                                                                                        // 135
            position: "absolute",                                                                                      // 136
            top: "0",                                                                                                  // 137
            left: "0",                                                                                                 // 138
            borderColor: "transparent",                                                                                // 139
            boxShadow: "none"                                                                                          // 140
        },                                                                                                             // 141
        input: {                                                                                                       // 142
            position: "relative",                                                                                      // 143
            verticalAlign: "top",                                                                                      // 144
            backgroundColor: "transparent"                                                                             // 145
        },                                                                                                             // 146
        inputWithNoHint: {                                                                                             // 147
            position: "relative",                                                                                      // 148
            verticalAlign: "top"                                                                                       // 149
        },                                                                                                             // 150
        dropdown: {                                                                                                    // 151
            position: "absolute",                                                                                      // 152
            top: "100%",                                                                                               // 153
            left: "0",                                                                                                 // 154
            zIndex: "100",                                                                                             // 155
            display: "none"                                                                                            // 156
        },                                                                                                             // 157
        suggestions: {                                                                                                 // 158
            display: "block"                                                                                           // 159
        },                                                                                                             // 160
        suggestion: {                                                                                                  // 161
            whiteSpace: "nowrap",                                                                                      // 162
            cursor: "pointer"                                                                                          // 163
        },                                                                                                             // 164
        suggestionChild: {                                                                                             // 165
            whiteSpace: "normal"                                                                                       // 166
        },                                                                                                             // 167
        ltr: {                                                                                                         // 168
            left: "0",                                                                                                 // 169
            right: "auto"                                                                                              // 170
        },                                                                                                             // 171
        rtl: {                                                                                                         // 172
            left: "auto",                                                                                              // 173
            right: " 0"                                                                                                // 174
        }                                                                                                              // 175
    };                                                                                                                 // 176
    if (_.isMsie()) {                                                                                                  // 177
        _.mixin(css.input, {                                                                                           // 178
            backgroundImage: "url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"     // 179
        });                                                                                                            // 180
    }                                                                                                                  // 181
    if (_.isMsie() && _.isMsie() <= 7) {                                                                               // 182
        _.mixin(css.input, {                                                                                           // 183
            marginTop: "-1px"                                                                                          // 184
        });                                                                                                            // 185
    }                                                                                                                  // 186
    var EventBus = function() {                                                                                        // 187
        var namespace = "typeahead:";                                                                                  // 188
        function EventBus(o) {                                                                                         // 189
            if (!o || !o.el) {                                                                                         // 190
                $.error("EventBus initialized without el");                                                            // 191
            }                                                                                                          // 192
            this.$el = $(o.el);                                                                                        // 193
        }                                                                                                              // 194
        _.mixin(EventBus.prototype, {                                                                                  // 195
            trigger: function(type) {                                                                                  // 196
                var args = [].slice.call(arguments, 1);                                                                // 197
                this.$el.trigger(namespace + type, args);                                                              // 198
            }                                                                                                          // 199
        });                                                                                                            // 200
        return EventBus;                                                                                               // 201
    }();                                                                                                               // 202
    var EventEmitter = function() {                                                                                    // 203
        var splitter = /\s+/, nextTick = getNextTick();                                                                // 204
        return {                                                                                                       // 205
            onSync: onSync,                                                                                            // 206
            onAsync: onAsync,                                                                                          // 207
            off: off,                                                                                                  // 208
            trigger: trigger                                                                                           // 209
        };                                                                                                             // 210
        function on(method, types, cb, context) {                                                                      // 211
            var type;                                                                                                  // 212
            if (!cb) {                                                                                                 // 213
                return this;                                                                                           // 214
            }                                                                                                          // 215
            types = types.split(splitter);                                                                             // 216
            cb = context ? bindContext(cb, context) : cb;                                                              // 217
            this._callbacks = this._callbacks || {};                                                                   // 218
            while (type = types.shift()) {                                                                             // 219
                this._callbacks[type] = this._callbacks[type] || {                                                     // 220
                    sync: [],                                                                                          // 221
                    async: []                                                                                          // 222
                };                                                                                                     // 223
                this._callbacks[type][method].push(cb);                                                                // 224
            }                                                                                                          // 225
            return this;                                                                                               // 226
        }                                                                                                              // 227
        function onAsync(types, cb, context) {                                                                         // 228
            return on.call(this, "async", types, cb, context);                                                         // 229
        }                                                                                                              // 230
        function onSync(types, cb, context) {                                                                          // 231
            return on.call(this, "sync", types, cb, context);                                                          // 232
        }                                                                                                              // 233
        function off(types) {                                                                                          // 234
            var type;                                                                                                  // 235
            if (!this._callbacks) {                                                                                    // 236
                return this;                                                                                           // 237
            }                                                                                                          // 238
            types = types.split(splitter);                                                                             // 239
            while (type = types.shift()) {                                                                             // 240
                delete this._callbacks[type];                                                                          // 241
            }                                                                                                          // 242
            return this;                                                                                               // 243
        }                                                                                                              // 244
        function trigger(types) {                                                                                      // 245
            var type, callbacks, args, syncFlush, asyncFlush;                                                          // 246
            if (!this._callbacks) {                                                                                    // 247
                return this;                                                                                           // 248
            }                                                                                                          // 249
            types = types.split(splitter);                                                                             // 250
            args = [].slice.call(arguments, 1);                                                                        // 251
            while ((type = types.shift()) && (callbacks = this._callbacks[type])) {                                    // 252
                syncFlush = getFlush(callbacks.sync, this, [ type ].concat(args));                                     // 253
                asyncFlush = getFlush(callbacks.async, this, [ type ].concat(args));                                   // 254
                syncFlush() && nextTick(asyncFlush);                                                                   // 255
            }                                                                                                          // 256
            return this;                                                                                               // 257
        }                                                                                                              // 258
        function getFlush(callbacks, context, args) {                                                                  // 259
            return flush;                                                                                              // 260
            function flush() {                                                                                         // 261
                var cancelled;                                                                                         // 262
                for (var i = 0; !cancelled && i < callbacks.length; i += 1) {                                          // 263
                    cancelled = callbacks[i].apply(context, args) === false;                                           // 264
                }                                                                                                      // 265
                return !cancelled;                                                                                     // 266
            }                                                                                                          // 267
        }                                                                                                              // 268
        function getNextTick() {                                                                                       // 269
            var nextTickFn;                                                                                            // 270
            if (window.setImmediate) {                                                                                 // 271
                nextTickFn = function nextTickSetImmediate(fn) {                                                       // 272
                    setImmediate(function() {                                                                          // 273
                        fn();                                                                                          // 274
                    });                                                                                                // 275
                };                                                                                                     // 276
            } else {                                                                                                   // 277
                nextTickFn = function nextTickSetTimeout(fn) {                                                         // 278
                    setTimeout(function() {                                                                            // 279
                        fn();                                                                                          // 280
                    }, 0);                                                                                             // 281
                };                                                                                                     // 282
            }                                                                                                          // 283
            return nextTickFn;                                                                                         // 284
        }                                                                                                              // 285
        function bindContext(fn, context) {                                                                            // 286
            return fn.bind ? fn.bind(context) : function() {                                                           // 287
                fn.apply(context, [].slice.call(arguments, 0));                                                        // 288
            };                                                                                                         // 289
        }                                                                                                              // 290
    }();                                                                                                               // 291
    var highlight = function(doc) {                                                                                    // 292
        var defaults = {                                                                                               // 293
            node: null,                                                                                                // 294
            pattern: null,                                                                                             // 295
            tagName: "strong",                                                                                         // 296
            className: null,                                                                                           // 297
            wordsOnly: false,                                                                                          // 298
            caseSensitive: false                                                                                       // 299
        };                                                                                                             // 300
        return function hightlight(o) {                                                                                // 301
            var regex;                                                                                                 // 302
            o = _.mixin({}, defaults, o);                                                                              // 303
            if (!o.node || !o.pattern) {                                                                               // 304
                return;                                                                                                // 305
            }                                                                                                          // 306
            o.pattern = _.isArray(o.pattern) ? o.pattern : [ o.pattern ];                                              // 307
            regex = getRegex(o.pattern, o.caseSensitive, o.wordsOnly);                                                 // 308
            traverse(o.node, hightlightTextNode);                                                                      // 309
            function hightlightTextNode(textNode) {                                                                    // 310
                var match, patternNode;                                                                                // 311
                if (match = regex.exec(textNode.data)) {                                                               // 312
                    wrapperNode = doc.createElement(o.tagName);                                                        // 313
                    o.className && (wrapperNode.className = o.className);                                              // 314
                    patternNode = textNode.splitText(match.index);                                                     // 315
                    patternNode.splitText(match[0].length);                                                            // 316
                    wrapperNode.appendChild(patternNode.cloneNode(true));                                              // 317
                    textNode.parentNode.replaceChild(wrapperNode, patternNode);                                        // 318
                }                                                                                                      // 319
                return !!match;                                                                                        // 320
            }                                                                                                          // 321
            function traverse(el, hightlightTextNode) {                                                                // 322
                var childNode, TEXT_NODE_TYPE = 3;                                                                     // 323
                for (var i = 0; i < el.childNodes.length; i++) {                                                       // 324
                    childNode = el.childNodes[i];                                                                      // 325
                    if (childNode.nodeType === TEXT_NODE_TYPE) {                                                       // 326
                        i += hightlightTextNode(childNode) ? 1 : 0;                                                    // 327
                    } else {                                                                                           // 328
                        traverse(childNode, hightlightTextNode);                                                       // 329
                    }                                                                                                  // 330
                }                                                                                                      // 331
            }                                                                                                          // 332
        };                                                                                                             // 333
        function getRegex(patterns, caseSensitive, wordsOnly) {                                                        // 334
            var escapedPatterns = [], regexStr;                                                                        // 335
            for (var i = 0; i < patterns.length; i++) {                                                                // 336
                escapedPatterns.push(_.escapeRegExChars(patterns[i]));                                                 // 337
            }                                                                                                          // 338
            regexStr = wordsOnly ? "\\b(" + escapedPatterns.join("|") + ")\\b" : "(" + escapedPatterns.join("|") + ")";
            return caseSensitive ? new RegExp(regexStr) : new RegExp(regexStr, "i");                                   // 340
        }                                                                                                              // 341
    }(window.document);                                                                                                // 342
    var Input = function() {                                                                                           // 343
        var specialKeyCodeMap;                                                                                         // 344
        specialKeyCodeMap = {                                                                                          // 345
            9: "tab",                                                                                                  // 346
            27: "esc",                                                                                                 // 347
            37: "left",                                                                                                // 348
            39: "right",                                                                                               // 349
            13: "enter",                                                                                               // 350
            38: "up",                                                                                                  // 351
            40: "down"                                                                                                 // 352
        };                                                                                                             // 353
        function Input(o) {                                                                                            // 354
            var that = this, onBlur, onFocus, onKeydown, onInput;                                                      // 355
            o = o || {};                                                                                               // 356
            if (!o.input) {                                                                                            // 357
                $.error("input is missing");                                                                           // 358
            }                                                                                                          // 359
            onBlur = _.bind(this._onBlur, this);                                                                       // 360
            onFocus = _.bind(this._onFocus, this);                                                                     // 361
            onKeydown = _.bind(this._onKeydown, this);                                                                 // 362
            onInput = _.bind(this._onInput, this);                                                                     // 363
            this.$hint = $(o.hint);                                                                                    // 364
            this.$input = $(o.input).on("blur.tt", onBlur).on("focus.tt", onFocus).on("keydown.tt", onKeydown);        // 365
            if (this.$hint.length === 0) {                                                                             // 366
                this.setHint = this.getHint = this.clearHint = this.clearHintIfInvalid = _.noop;                       // 367
            }                                                                                                          // 368
            if (!_.isMsie()) {                                                                                         // 369
                this.$input.on("input.tt", onInput);                                                                   // 370
            } else {                                                                                                   // 371
                this.$input.on("keydown.tt keypress.tt cut.tt paste.tt", function($e) {                                // 372
                    if (specialKeyCodeMap[$e.which || $e.keyCode]) {                                                   // 373
                        return;                                                                                        // 374
                    }                                                                                                  // 375
                    _.defer(_.bind(that._onInput, that, $e));                                                          // 376
                });                                                                                                    // 377
            }                                                                                                          // 378
            this.query = this.$input.val();                                                                            // 379
            this.$overflowHelper = buildOverflowHelper(this.$input);                                                   // 380
        }                                                                                                              // 381
        Input.normalizeQuery = function(str) {                                                                         // 382
            return (str || "").replace(/^\s*/g, "").replace(/\s{2,}/g, " ");                                           // 383
        };                                                                                                             // 384
        _.mixin(Input.prototype, EventEmitter, {                                                                       // 385
            _onBlur: function onBlur() {                                                                               // 386
                this.resetInputValue();                                                                                // 387
                this.trigger("blurred");                                                                               // 388
            },                                                                                                         // 389
            _onFocus: function onFocus() {                                                                             // 390
                this.trigger("focused");                                                                               // 391
            },                                                                                                         // 392
            _onKeydown: function onKeydown($e) {                                                                       // 393
                var keyName = specialKeyCodeMap[$e.which || $e.keyCode];                                               // 394
                this._managePreventDefault(keyName, $e);                                                               // 395
                if (keyName && this._shouldTrigger(keyName, $e)) {                                                     // 396
                    this.trigger(keyName + "Keyed", $e);                                                               // 397
                }                                                                                                      // 398
            },                                                                                                         // 399
            _onInput: function onInput() {                                                                             // 400
                this._checkInputValue();                                                                               // 401
            },                                                                                                         // 402
            _managePreventDefault: function managePreventDefault(keyName, $e) {                                        // 403
                var preventDefault, hintValue, inputValue;                                                             // 404
                switch (keyName) {                                                                                     // 405
                  case "tab":                                                                                          // 406
                    hintValue = this.getHint();                                                                        // 407
                    inputValue = this.getInputValue();                                                                 // 408
                    preventDefault = hintValue && hintValue !== inputValue && !withModifier($e);                       // 409
                    break;                                                                                             // 410
                                                                                                                       // 411
                  case "up":                                                                                           // 412
                  case "down":                                                                                         // 413
                    preventDefault = !withModifier($e);                                                                // 414
                    break;                                                                                             // 415
                                                                                                                       // 416
                  default:                                                                                             // 417
                    preventDefault = false;                                                                            // 418
                }                                                                                                      // 419
                preventDefault && $e.preventDefault();                                                                 // 420
            },                                                                                                         // 421
            _shouldTrigger: function shouldTrigger(keyName, $e) {                                                      // 422
                var trigger;                                                                                           // 423
                switch (keyName) {                                                                                     // 424
                  case "tab":                                                                                          // 425
                    trigger = !withModifier($e);                                                                       // 426
                    break;                                                                                             // 427
                                                                                                                       // 428
                  default:                                                                                             // 429
                    trigger = true;                                                                                    // 430
                }                                                                                                      // 431
                return trigger;                                                                                        // 432
            },                                                                                                         // 433
            _checkInputValue: function checkInputValue() {                                                             // 434
                var inputValue, areEquivalent, hasDifferentWhitespace;                                                 // 435
                inputValue = this.getInputValue();                                                                     // 436
                areEquivalent = areQueriesEquivalent(inputValue, this.query);                                          // 437
                hasDifferentWhitespace = areEquivalent ? this.query.length !== inputValue.length : false;              // 438
                if (!areEquivalent) {                                                                                  // 439
                    this.trigger("queryChanged", this.query = inputValue);                                             // 440
                } else if (hasDifferentWhitespace) {                                                                   // 441
                    this.trigger("whitespaceChanged", this.query);                                                     // 442
                }                                                                                                      // 443
            },                                                                                                         // 444
            focus: function focus() {                                                                                  // 445
                this.$input.focus();                                                                                   // 446
            },                                                                                                         // 447
            blur: function blur() {                                                                                    // 448
                this.$input.blur();                                                                                    // 449
            },                                                                                                         // 450
            getQuery: function getQuery() {                                                                            // 451
                return this.query;                                                                                     // 452
            },                                                                                                         // 453
            setQuery: function setQuery(query) {                                                                       // 454
                this.query = query;                                                                                    // 455
            },                                                                                                         // 456
            getInputValue: function getInputValue() {                                                                  // 457
                return this.$input.val();                                                                              // 458
            },                                                                                                         // 459
            setInputValue: function setInputValue(value, silent) {                                                     // 460
                this.$input.val(value);                                                                                // 461
                silent ? this.clearHint() : this._checkInputValue();                                                   // 462
            },                                                                                                         // 463
            resetInputValue: function resetInputValue() {                                                              // 464
                this.setInputValue(this.query, true);                                                                  // 465
            },                                                                                                         // 466
            getHint: function getHint() {                                                                              // 467
                return this.$hint.val();                                                                               // 468
            },                                                                                                         // 469
            setHint: function setHint(value) {                                                                         // 470
                this.$hint.val(value);                                                                                 // 471
            },                                                                                                         // 472
            clearHint: function clearHint() {                                                                          // 473
                this.setHint("");                                                                                      // 474
            },                                                                                                         // 475
            clearHintIfInvalid: function clearHintIfInvalid() {                                                        // 476
                var val, hint, valIsPrefixOfHint, isValid;                                                             // 477
                val = this.getInputValue();                                                                            // 478
                hint = this.getHint();                                                                                 // 479
                valIsPrefixOfHint = val !== hint && hint.indexOf(val) === 0;                                           // 480
                isValid = val !== "" && valIsPrefixOfHint && !this.hasOverflow();                                      // 481
                !isValid && this.clearHint();                                                                          // 482
            },                                                                                                         // 483
            getLanguageDirection: function getLanguageDirection() {                                                    // 484
                return (this.$input.css("direction") || "ltr").toLowerCase();                                          // 485
            },                                                                                                         // 486
            hasOverflow: function hasOverflow() {                                                                      // 487
                var constraint = this.$input.width() - 2;                                                              // 488
                this.$overflowHelper.text(this.getInputValue());                                                       // 489
                return this.$overflowHelper.width() >= constraint;                                                     // 490
            },                                                                                                         // 491
            isCursorAtEnd: function() {                                                                                // 492
                var valueLength, selectionStart, range;                                                                // 493
                valueLength = this.$input.val().length;                                                                // 494
                selectionStart = this.$input[0].selectionStart;                                                        // 495
                if (_.isNumber(selectionStart)) {                                                                      // 496
                    return selectionStart === valueLength;                                                             // 497
                } else if (document.selection) {                                                                       // 498
                    range = document.selection.createRange();                                                          // 499
                    range.moveStart("character", -valueLength);                                                        // 500
                    return valueLength === range.text.length;                                                          // 501
                }                                                                                                      // 502
                return true;                                                                                           // 503
            },                                                                                                         // 504
            destroy: function destroy() {                                                                              // 505
                this.$hint.off(".tt");                                                                                 // 506
                this.$input.off(".tt");                                                                                // 507
                this.$hint = this.$input = this.$overflowHelper = null;                                                // 508
            }                                                                                                          // 509
        });                                                                                                            // 510
        return Input;                                                                                                  // 511
        function buildOverflowHelper($input) {                                                                         // 512
            return $('<pre aria-hidden="true"></pre>').css({                                                           // 513
                position: "absolute",                                                                                  // 514
                visibility: "hidden",                                                                                  // 515
                whiteSpace: "pre",                                                                                     // 516
                fontFamily: $input.css("font-family"),                                                                 // 517
                fontSize: $input.css("font-size"),                                                                     // 518
                fontStyle: $input.css("font-style"),                                                                   // 519
                fontVariant: $input.css("font-variant"),                                                               // 520
                fontWeight: $input.css("font-weight"),                                                                 // 521
                wordSpacing: $input.css("word-spacing"),                                                               // 522
                letterSpacing: $input.css("letter-spacing"),                                                           // 523
                textIndent: $input.css("text-indent"),                                                                 // 524
                textRendering: $input.css("text-rendering"),                                                           // 525
                textTransform: $input.css("text-transform")                                                            // 526
            }).insertAfter($input);                                                                                    // 527
        }                                                                                                              // 528
        function areQueriesEquivalent(a, b) {                                                                          // 529
            return Input.normalizeQuery(a) === Input.normalizeQuery(b);                                                // 530
        }                                                                                                              // 531
        function withModifier($e) {                                                                                    // 532
            return $e.altKey || $e.ctrlKey || $e.metaKey || $e.shiftKey;                                               // 533
        }                                                                                                              // 534
    }();                                                                                                               // 535
    var Dataset = function() {                                                                                         // 536
        var datasetKey = "ttDataset", valueKey = "ttValue", datumKey = "ttDatum";                                      // 537
        function Dataset(o) {                                                                                          // 538
            o = o || {};                                                                                               // 539
            o.templates = o.templates || {};                                                                           // 540
            if (!o.source) {                                                                                           // 541
                $.error("missing source");                                                                             // 542
            }                                                                                                          // 543
            if (o.name && !isValidName(o.name)) {                                                                      // 544
                $.error("invalid dataset name: " + o.name);                                                            // 545
            }                                                                                                          // 546
            this.query = null;                                                                                         // 547
            this.highlight = !!o.highlight;                                                                            // 548
            this.name = o.name || _.getUniqueId();                                                                     // 549
            this.source = o.source;                                                                                    // 550
            this.displayFn = getDisplayFn(o.display || o.displayKey);                                                  // 551
            this.templates = getTemplates(o.templates, this.displayFn);                                                // 552
            this.$el = $(html.dataset.replace("%CLASS%", this.name));                                                  // 553
        }                                                                                                              // 554
        Dataset.extractDatasetName = function extractDatasetName(el) {                                                 // 555
            return $(el).data(datasetKey);                                                                             // 556
        };                                                                                                             // 557
        Dataset.extractValue = function extractDatum(el) {                                                             // 558
            return $(el).data(valueKey);                                                                               // 559
        };                                                                                                             // 560
        Dataset.extractDatum = function extractDatum(el) {                                                             // 561
            return $(el).data(datumKey);                                                                               // 562
        };                                                                                                             // 563
        _.mixin(Dataset.prototype, EventEmitter, {                                                                     // 564
            _render: function render(query, suggestions) {                                                             // 565
                if (!this.$el) {                                                                                       // 566
                    return;                                                                                            // 567
                }                                                                                                      // 568
                var that = this, hasSuggestions;                                                                       // 569
                this.$el.empty();                                                                                      // 570
                hasSuggestions = suggestions && suggestions.length;                                                    // 571
                if (!hasSuggestions && this.templates.empty) {                                                         // 572
                    this.$el.html(getEmptyHtml()).prepend(that.templates.header ? getHeaderHtml() : null).append(that.templates.footer ? getFooterHtml() : null);
                } else if (hasSuggestions) {                                                                           // 574
                    this.$el.html(getSuggestionsHtml()).prepend(that.templates.header ? getHeaderHtml() : null).append(that.templates.footer ? getFooterHtml() : null);
                }                                                                                                      // 576
                this.trigger("rendered");                                                                              // 577
                function getEmptyHtml() {                                                                              // 578
                    return that.templates.empty({                                                                      // 579
                        query: query,                                                                                  // 580
                        isEmpty: true                                                                                  // 581
                    });                                                                                                // 582
                }                                                                                                      // 583
                function getSuggestionsHtml() {                                                                        // 584
                    var $suggestions, nodes;                                                                           // 585
                    $suggestions = $(html.suggestions).css(css.suggestions);                                           // 586
                    nodes = _.map(suggestions, getSuggestionNode);                                                     // 587
                    $suggestions.append.apply($suggestions, nodes);                                                    // 588
                    that.highlight && highlight({                                                                      // 589
                        node: $suggestions[0],                                                                         // 590
                        pattern: query                                                                                 // 591
                    });                                                                                                // 592
                    return $suggestions;                                                                               // 593
                    function getSuggestionNode(suggestion) {                                                           // 594
                        var $el;                                                                                       // 595
                        $el = $(html.suggestion).append(that.templates.suggestion(suggestion)).data(datasetKey, that.name).data(valueKey, that.displayFn(suggestion)).data(datumKey, suggestion);
                        $el.children().each(function() {                                                               // 597
                            $(this).css(css.suggestionChild);                                                          // 598
                        });                                                                                            // 599
                        return $el;                                                                                    // 600
                    }                                                                                                  // 601
                }                                                                                                      // 602
                function getHeaderHtml() {                                                                             // 603
                    return that.templates.header({                                                                     // 604
                        query: query,                                                                                  // 605
                        isEmpty: !hasSuggestions                                                                       // 606
                    });                                                                                                // 607
                }                                                                                                      // 608
                function getFooterHtml() {                                                                             // 609
                    return that.templates.footer({                                                                     // 610
                        query: query,                                                                                  // 611
                        isEmpty: !hasSuggestions                                                                       // 612
                    });                                                                                                // 613
                }                                                                                                      // 614
            },                                                                                                         // 615
            getRoot: function getRoot() {                                                                              // 616
                return this.$el;                                                                                       // 617
            },                                                                                                         // 618
            update: function update(query) {                                                                           // 619
                var that = this;                                                                                       // 620
                this.query = query;                                                                                    // 621
                this.canceled = false;                                                                                 // 622
                this.source(query, render);                                                                            // 623
                function render(suggestions) {                                                                         // 624
                    if (!that.canceled && query === that.query) {                                                      // 625
                        that._render(query, suggestions);                                                              // 626
                    }                                                                                                  // 627
                }                                                                                                      // 628
            },                                                                                                         // 629
            cancel: function cancel() {                                                                                // 630
                this.canceled = true;                                                                                  // 631
            },                                                                                                         // 632
            clear: function clear() {                                                                                  // 633
                this.cancel();                                                                                         // 634
                this.$el.empty();                                                                                      // 635
                this.trigger("rendered");                                                                              // 636
            },                                                                                                         // 637
            isEmpty: function isEmpty() {                                                                              // 638
                return this.$el.is(":empty");                                                                          // 639
            },                                                                                                         // 640
            destroy: function destroy() {                                                                              // 641
                this.$el = null;                                                                                       // 642
            }                                                                                                          // 643
        });                                                                                                            // 644
        return Dataset;                                                                                                // 645
        function getDisplayFn(display) {                                                                               // 646
            display = display || "value";                                                                              // 647
            return _.isFunction(display) ? display : displayFn;                                                        // 648
            function displayFn(obj) {                                                                                  // 649
                return obj[display];                                                                                   // 650
            }                                                                                                          // 651
        }                                                                                                              // 652
        function getTemplates(templates, displayFn) {                                                                  // 653
            return {                                                                                                   // 654
                empty: templates.empty && _.templatify(templates.empty),                                               // 655
                header: templates.header && _.templatify(templates.header),                                            // 656
                footer: templates.footer && _.templatify(templates.footer),                                            // 657
                suggestion: templates.suggestion || suggestionTemplate                                                 // 658
            };                                                                                                         // 659
            function suggestionTemplate(context) {                                                                     // 660
                return "<p>" + displayFn(context) + "</p>";                                                            // 661
            }                                                                                                          // 662
        }                                                                                                              // 663
        function isValidName(str) {                                                                                    // 664
            return /^[_a-zA-Z0-9-]+$/.test(str);                                                                       // 665
        }                                                                                                              // 666
    }();                                                                                                               // 667
    var Dropdown = function() {                                                                                        // 668
        function Dropdown(o) {                                                                                         // 669
            var that = this, onSuggestionClick, onSuggestionMouseEnter, onSuggestionMouseLeave;                        // 670
            o = o || {};                                                                                               // 671
            if (!o.menu) {                                                                                             // 672
                $.error("menu is required");                                                                           // 673
            }                                                                                                          // 674
            this.isOpen = false;                                                                                       // 675
            this.isEmpty = true;                                                                                       // 676
            this.datasets = _.map(o.datasets, initializeDataset);                                                      // 677
            onSuggestionClick = _.bind(this._onSuggestionClick, this);                                                 // 678
            onSuggestionMouseEnter = _.bind(this._onSuggestionMouseEnter, this);                                       // 679
            onSuggestionMouseLeave = _.bind(this._onSuggestionMouseLeave, this);                                       // 680
            this.$menu = $(o.menu).on("click.tt", ".tt-suggestion", onSuggestionClick).on("mouseenter.tt", ".tt-suggestion", onSuggestionMouseEnter).on("mouseleave.tt", ".tt-suggestion", onSuggestionMouseLeave);
            _.each(this.datasets, function(dataset) {                                                                  // 682
                that.$menu.append(dataset.getRoot());                                                                  // 683
                dataset.onSync("rendered", that._onRendered, that);                                                    // 684
            });                                                                                                        // 685
        }                                                                                                              // 686
        _.mixin(Dropdown.prototype, EventEmitter, {                                                                    // 687
            _onSuggestionClick: function onSuggestionClick($e) {                                                       // 688
                this.trigger("suggestionClicked", $($e.currentTarget));                                                // 689
            },                                                                                                         // 690
            _onSuggestionMouseEnter: function onSuggestionMouseEnter($e) {                                             // 691
                this._removeCursor();                                                                                  // 692
                this._setCursor($($e.currentTarget), true);                                                            // 693
            },                                                                                                         // 694
            _onSuggestionMouseLeave: function onSuggestionMouseLeave() {                                               // 695
                this._removeCursor();                                                                                  // 696
            },                                                                                                         // 697
            _onRendered: function onRendered() {                                                                       // 698
                this.isEmpty = _.every(this.datasets, isDatasetEmpty);                                                 // 699
                this.isEmpty ? this._hide() : this.isOpen && this._show();                                             // 700
                this.trigger("datasetRendered");                                                                       // 701
                function isDatasetEmpty(dataset) {                                                                     // 702
                    return dataset.isEmpty();                                                                          // 703
                }                                                                                                      // 704
            },                                                                                                         // 705
            _hide: function() {                                                                                        // 706
                this.$menu.hide();                                                                                     // 707
            },                                                                                                         // 708
            _show: function() {                                                                                        // 709
                this.$menu.css("display", "block");                                                                    // 710
            },                                                                                                         // 711
            _getSuggestions: function getSuggestions() {                                                               // 712
                return this.$menu.find(".tt-suggestion");                                                              // 713
            },                                                                                                         // 714
            _getCursor: function getCursor() {                                                                         // 715
                return this.$menu.find(".tt-cursor").first();                                                          // 716
            },                                                                                                         // 717
            _setCursor: function setCursor($el, silent) {                                                              // 718
                $el.first().addClass("tt-cursor");                                                                     // 719
                !silent && this.trigger("cursorMoved");                                                                // 720
            },                                                                                                         // 721
            _removeCursor: function removeCursor() {                                                                   // 722
                this._getCursor().removeClass("tt-cursor");                                                            // 723
            },                                                                                                         // 724
            _moveCursor: function moveCursor(increment) {                                                              // 725
                var $suggestions, $oldCursor, newCursorIndex, $newCursor;                                              // 726
                if (!this.isOpen) {                                                                                    // 727
                    return;                                                                                            // 728
                }                                                                                                      // 729
                $oldCursor = this._getCursor();                                                                        // 730
                $suggestions = this._getSuggestions();                                                                 // 731
                this._removeCursor();                                                                                  // 732
                newCursorIndex = $suggestions.index($oldCursor) + increment;                                           // 733
                newCursorIndex = (newCursorIndex + 1) % ($suggestions.length + 1) - 1;                                 // 734
                if (newCursorIndex === -1) {                                                                           // 735
                    this.trigger("cursorRemoved");                                                                     // 736
                    return;                                                                                            // 737
                } else if (newCursorIndex < -1) {                                                                      // 738
                    newCursorIndex = $suggestions.length - 1;                                                          // 739
                }                                                                                                      // 740
                this._setCursor($newCursor = $suggestions.eq(newCursorIndex));                                         // 741
                this._ensureVisible($newCursor);                                                                       // 742
            },                                                                                                         // 743
            _ensureVisible: function ensureVisible($el) {                                                              // 744
                var elTop, elBottom, menuScrollTop, menuHeight;                                                        // 745
                elTop = $el.position().top;                                                                            // 746
                elBottom = elTop + $el.outerHeight(true);                                                              // 747
                menuScrollTop = this.$menu.scrollTop();                                                                // 748
                menuHeight = this.$menu.height() + parseInt(this.$menu.css("paddingTop"), 10) + parseInt(this.$menu.css("paddingBottom"), 10);
                if (elTop < 0) {                                                                                       // 750
                    this.$menu.scrollTop(menuScrollTop + elTop);                                                       // 751
                } else if (menuHeight < elBottom) {                                                                    // 752
                    this.$menu.scrollTop(menuScrollTop + (elBottom - menuHeight));                                     // 753
                }                                                                                                      // 754
            },                                                                                                         // 755
            close: function close() {                                                                                  // 756
                if (this.isOpen) {                                                                                     // 757
                    this.isOpen = false;                                                                               // 758
                    this._removeCursor();                                                                              // 759
                    this._hide();                                                                                      // 760
                    this.trigger("closed");                                                                            // 761
                }                                                                                                      // 762
            },                                                                                                         // 763
            open: function open() {                                                                                    // 764
                if (!this.isOpen) {                                                                                    // 765
                    this.isOpen = true;                                                                                // 766
                    !this.isEmpty && this._show();                                                                     // 767
                    this.trigger("opened");                                                                            // 768
                }                                                                                                      // 769
            },                                                                                                         // 770
            setLanguageDirection: function setLanguageDirection(dir) {                                                 // 771
                this.$menu.css(dir === "ltr" ? css.ltr : css.rtl);                                                     // 772
            },                                                                                                         // 773
            moveCursorUp: function moveCursorUp() {                                                                    // 774
                this._moveCursor(-1);                                                                                  // 775
            },                                                                                                         // 776
            moveCursorDown: function moveCursorDown() {                                                                // 777
                this._moveCursor(+1);                                                                                  // 778
            },                                                                                                         // 779
            getDatumForSuggestion: function getDatumForSuggestion($el) {                                               // 780
                var datum = null;                                                                                      // 781
                if ($el.length) {                                                                                      // 782
                    datum = {                                                                                          // 783
                        raw: Dataset.extractDatum($el),                                                                // 784
                        value: Dataset.extractValue($el),                                                              // 785
                        datasetName: Dataset.extractDatasetName($el)                                                   // 786
                    };                                                                                                 // 787
                }                                                                                                      // 788
                return datum;                                                                                          // 789
            },                                                                                                         // 790
            getDatumForCursor: function getDatumForCursor() {                                                          // 791
                return this.getDatumForSuggestion(this._getCursor().first());                                          // 792
            },                                                                                                         // 793
            getDatumForTopSuggestion: function getDatumForTopSuggestion() {                                            // 794
                return this.getDatumForSuggestion(this._getSuggestions().first());                                     // 795
            },                                                                                                         // 796
            update: function update(query) {                                                                           // 797
                _.each(this.datasets, updateDataset);                                                                  // 798
                function updateDataset(dataset) {                                                                      // 799
                    dataset.update(query);                                                                             // 800
                }                                                                                                      // 801
            },                                                                                                         // 802
            empty: function empty() {                                                                                  // 803
                _.each(this.datasets, clearDataset);                                                                   // 804
                this.isEmpty = true;                                                                                   // 805
                function clearDataset(dataset) {                                                                       // 806
                    dataset.clear();                                                                                   // 807
                }                                                                                                      // 808
            },                                                                                                         // 809
            isVisible: function isVisible() {                                                                          // 810
                return this.isOpen && !this.isEmpty;                                                                   // 811
            },                                                                                                         // 812
            destroy: function destroy() {                                                                              // 813
                this.$menu.off(".tt");                                                                                 // 814
                this.$menu = null;                                                                                     // 815
                _.each(this.datasets, destroyDataset);                                                                 // 816
                function destroyDataset(dataset) {                                                                     // 817
                    dataset.destroy();                                                                                 // 818
                }                                                                                                      // 819
            }                                                                                                          // 820
        });                                                                                                            // 821
        return Dropdown;                                                                                               // 822
        function initializeDataset(oDataset) {                                                                         // 823
            return new Dataset(oDataset);                                                                              // 824
        }                                                                                                              // 825
    }();                                                                                                               // 826
    var Typeahead = function() {                                                                                       // 827
        var attrsKey = "ttAttrs";                                                                                      // 828
        function Typeahead(o) {                                                                                        // 829
            var $menu, $input, $hint;                                                                                  // 830
            o = o || {};                                                                                               // 831
            if (!o.input) {                                                                                            // 832
                $.error("missing input");                                                                              // 833
            }                                                                                                          // 834
            this.isActivated = false;                                                                                  // 835
            this.autoselect = !!o.autoselect;                                                                          // 836
            this.minLength = _.isNumber(o.minLength) ? o.minLength : 1;                                                // 837
            this.$node = buildDomStructure(o.input, o.withHint);                                                       // 838
            $menu = this.$node.find(".tt-dropdown-menu");                                                              // 839
            $input = this.$node.find(".tt-input");                                                                     // 840
            $hint = this.$node.find(".tt-hint");                                                                       // 841
            $input.on("blur.tt", function($e) {                                                                        // 842
                var active, isActive, hasActive;                                                                       // 843
                active = document.activeElement;                                                                       // 844
                isActive = $menu.is(active);                                                                           // 845
                hasActive = $menu.has(active).length > 0;                                                              // 846
                if (_.isMsie() && (isActive || hasActive)) {                                                           // 847
                    $e.preventDefault();                                                                               // 848
                    $e.stopImmediatePropagation();                                                                     // 849
                    _.defer(function() {                                                                               // 850
                        $input.focus();                                                                                // 851
                    });                                                                                                // 852
                }                                                                                                      // 853
            });                                                                                                        // 854
            $menu.on("mousedown.tt", function($e) {                                                                    // 855
                $e.preventDefault();                                                                                   // 856
            });                                                                                                        // 857
            this.eventBus = o.eventBus || new EventBus({                                                               // 858
                el: $input                                                                                             // 859
            });                                                                                                        // 860
            this.dropdown = new Dropdown({                                                                             // 861
                menu: $menu,                                                                                           // 862
                datasets: o.datasets                                                                                   // 863
            }).onSync("suggestionClicked", this._onSuggestionClicked, this).onSync("cursorMoved", this._onCursorMoved, this).onSync("cursorRemoved", this._onCursorRemoved, this).onSync("opened", this._onOpened, this).onSync("closed", this._onClosed, this).onAsync("datasetRendered", this._onDatasetRendered, this);
            this.input = new Input({                                                                                   // 865
                input: $input,                                                                                         // 866
                hint: $hint                                                                                            // 867
            }).onSync("focused", this._onFocused, this).onSync("blurred", this._onBlurred, this).onSync("enterKeyed", this._onEnterKeyed, this).onSync("tabKeyed", this._onTabKeyed, this).onSync("escKeyed", this._onEscKeyed, this).onSync("upKeyed", this._onUpKeyed, this).onSync("downKeyed", this._onDownKeyed, this).onSync("leftKeyed", this._onLeftKeyed, this).onSync("rightKeyed", this._onRightKeyed, this).onSync("queryChanged", this._onQueryChanged, this).onSync("whitespaceChanged", this._onWhitespaceChanged, this);
            this._setLanguageDirection();                                                                              // 869
        }                                                                                                              // 870
        _.mixin(Typeahead.prototype, {                                                                                 // 871
            _onSuggestionClicked: function onSuggestionClicked(type, $el) {                                            // 872
                var datum;                                                                                             // 873
                if (datum = this.dropdown.getDatumForSuggestion($el)) {                                                // 874
                    this._select(datum);                                                                               // 875
                }                                                                                                      // 876
            },                                                                                                         // 877
            _onCursorMoved: function onCursorMoved() {                                                                 // 878
                var datum = this.dropdown.getDatumForCursor();                                                         // 879
                this.input.setInputValue(datum.value, true);                                                           // 880
                this.eventBus.trigger("cursorchanged", datum.raw, datum.datasetName);                                  // 881
            },                                                                                                         // 882
            _onCursorRemoved: function onCursorRemoved() {                                                             // 883
                this.input.resetInputValue();                                                                          // 884
                this._updateHint();                                                                                    // 885
            },                                                                                                         // 886
            _onDatasetRendered: function onDatasetRendered() {                                                         // 887
                this._updateHint();                                                                                    // 888
            },                                                                                                         // 889
            _onOpened: function onOpened() {                                                                           // 890
                this._updateHint();                                                                                    // 891
                this.eventBus.trigger("opened");                                                                       // 892
            },                                                                                                         // 893
            _onClosed: function onClosed() {                                                                           // 894
                this.input.clearHint();                                                                                // 895
                this.eventBus.trigger("closed");                                                                       // 896
            },                                                                                                         // 897
            _onFocused: function onFocused() {                                                                         // 898
                this.isActivated = true;                                                                               // 899
                this.dropdown.open();                                                                                  // 900
            },                                                                                                         // 901
            _onBlurred: function onBlurred() {                                                                         // 902
                this.isActivated = false;                                                                              // 903
                this.dropdown.empty();                                                                                 // 904
                this.dropdown.close();                                                                                 // 905
            },                                                                                                         // 906
            _onEnterKeyed: function onEnterKeyed(type, $e) {                                                           // 907
                var cursorDatum, topSuggestionDatum;                                                                   // 908
                cursorDatum = this.dropdown.getDatumForCursor();                                                       // 909
                topSuggestionDatum = this.dropdown.getDatumForTopSuggestion();                                         // 910
                if (cursorDatum) {                                                                                     // 911
                    this._select(cursorDatum);                                                                         // 912
                    $e.preventDefault();                                                                               // 913
                } else if (this.autoselect && topSuggestionDatum) {                                                    // 914
                    this._select(topSuggestionDatum);                                                                  // 915
                    $e.preventDefault();                                                                               // 916
                }                                                                                                      // 917
            },                                                                                                         // 918
            _onTabKeyed: function onTabKeyed(type, $e) {                                                               // 919
                var datum;                                                                                             // 920
                if (datum = this.dropdown.getDatumForCursor()) {                                                       // 921
                    this._select(datum);                                                                               // 922
                    $e.preventDefault();                                                                               // 923
                } else {                                                                                               // 924
                    this._autocomplete(true);                                                                          // 925
                }                                                                                                      // 926
            },                                                                                                         // 927
            _onEscKeyed: function onEscKeyed() {                                                                       // 928
                this.dropdown.close();                                                                                 // 929
                this.input.resetInputValue();                                                                          // 930
            },                                                                                                         // 931
            _onUpKeyed: function onUpKeyed() {                                                                         // 932
                var query = this.input.getQuery();                                                                     // 933
                this.dropdown.isEmpty && query.length >= this.minLength ? this.dropdown.update(query) : this.dropdown.moveCursorUp();
                this.dropdown.open();                                                                                  // 935
            },                                                                                                         // 936
            _onDownKeyed: function onDownKeyed() {                                                                     // 937
                var query = this.input.getQuery();                                                                     // 938
                this.dropdown.isEmpty && query.length >= this.minLength ? this.dropdown.update(query) : this.dropdown.moveCursorDown();
                this.dropdown.open();                                                                                  // 940
            },                                                                                                         // 941
            _onLeftKeyed: function onLeftKeyed() {                                                                     // 942
                this.dir === "rtl" && this._autocomplete();                                                            // 943
            },                                                                                                         // 944
            _onRightKeyed: function onRightKeyed() {                                                                   // 945
                this.dir === "ltr" && this._autocomplete();                                                            // 946
            },                                                                                                         // 947
            _onQueryChanged: function onQueryChanged(e, query) {                                                       // 948
                this.input.clearHintIfInvalid();                                                                       // 949
                query.length >= this.minLength ? this.dropdown.update(query) : this.dropdown.empty();                  // 950
                this.dropdown.open();                                                                                  // 951
                this._setLanguageDirection();                                                                          // 952
            },                                                                                                         // 953
            _onWhitespaceChanged: function onWhitespaceChanged() {                                                     // 954
                this._updateHint();                                                                                    // 955
                this.dropdown.open();                                                                                  // 956
            },                                                                                                         // 957
            _setLanguageDirection: function setLanguageDirection() {                                                   // 958
                var dir;                                                                                               // 959
                if (this.dir !== (dir = this.input.getLanguageDirection())) {                                          // 960
                    this.dir = dir;                                                                                    // 961
                    this.$node.css("direction", dir);                                                                  // 962
                    this.dropdown.setLanguageDirection(dir);                                                           // 963
                }                                                                                                      // 964
            },                                                                                                         // 965
            _updateHint: function updateHint() {                                                                       // 966
                var datum, val, query, escapedQuery, frontMatchRegEx, match;                                           // 967
                datum = this.dropdown.getDatumForTopSuggestion();                                                      // 968
                if (datum && this.dropdown.isVisible() && !this.input.hasOverflow()) {                                 // 969
                    val = this.input.getInputValue();                                                                  // 970
                    query = Input.normalizeQuery(val);                                                                 // 971
                    escapedQuery = _.escapeRegExChars(query);                                                          // 972
                    frontMatchRegEx = new RegExp("^(?:" + escapedQuery + ")(.+$)", "i");                               // 973
                    match = frontMatchRegEx.exec(datum.value);                                                         // 974
                    match ? this.input.setHint(val + match[1]) : this.input.clearHint();                               // 975
                } else {                                                                                               // 976
                    this.input.clearHint();                                                                            // 977
                }                                                                                                      // 978
            },                                                                                                         // 979
            _autocomplete: function autocomplete(laxCursor) {                                                          // 980
                var hint, query, isCursorAtEnd, datum;                                                                 // 981
                hint = this.input.getHint();                                                                           // 982
                query = this.input.getQuery();                                                                         // 983
                isCursorAtEnd = laxCursor || this.input.isCursorAtEnd();                                               // 984
                if (hint && query !== hint && isCursorAtEnd) {                                                         // 985
                    datum = this.dropdown.getDatumForTopSuggestion();                                                  // 986
                    datum && this.input.setInputValue(datum.value);                                                    // 987
                    this.eventBus.trigger("autocompleted", datum.raw, datum.datasetName);                              // 988
                }                                                                                                      // 989
            },                                                                                                         // 990
            _select: function select(datum) {                                                                          // 991
                this.input.setQuery(datum.value);                                                                      // 992
                this.input.setInputValue(datum.value, true);                                                           // 993
                this._setLanguageDirection();                                                                          // 994
                this.eventBus.trigger("selected", datum.raw, datum.datasetName);                                       // 995
                this.dropdown.close();                                                                                 // 996
                _.defer(_.bind(this.dropdown.empty, this.dropdown));                                                   // 997
            },                                                                                                         // 998
            open: function open() {                                                                                    // 999
                this.dropdown.open();                                                                                  // 1000
            },                                                                                                         // 1001
            close: function close() {                                                                                  // 1002
                this.dropdown.close();                                                                                 // 1003
            },                                                                                                         // 1004
            setVal: function setVal(val) {                                                                             // 1005
                if (this.isActivated) {                                                                                // 1006
                    this.input.setInputValue(val);                                                                     // 1007
                } else {                                                                                               // 1008
                    this.input.setQuery(val);                                                                          // 1009
                    this.input.setInputValue(val, true);                                                               // 1010
                }                                                                                                      // 1011
                this._setLanguageDirection();                                                                          // 1012
            },                                                                                                         // 1013
            getVal: function getVal() {                                                                                // 1014
                return this.input.getQuery();                                                                          // 1015
            },                                                                                                         // 1016
            destroy: function destroy() {                                                                              // 1017
                this.input.destroy();                                                                                  // 1018
                this.dropdown.destroy();                                                                               // 1019
                destroyDomStructure(this.$node);                                                                       // 1020
                this.$node = null;                                                                                     // 1021
            }                                                                                                          // 1022
        });                                                                                                            // 1023
        return Typeahead;                                                                                              // 1024
        function buildDomStructure(input, withHint) {                                                                  // 1025
            var $input, $wrapper, $dropdown, $hint;                                                                    // 1026
            $input = $(input);                                                                                         // 1027
            $wrapper = $(html.wrapper).css(css.wrapper);                                                               // 1028
            $dropdown = $(html.dropdown).css(css.dropdown);                                                            // 1029
            $hint = $input.clone().css(css.hint).css(getBackgroundStyles($input));                                     // 1030
            $hint.val("").removeData().addClass("tt-hint").removeAttr("id name placeholder").prop("disabled", true).attr({
                autocomplete: "off",                                                                                   // 1032
                spellcheck: "false"                                                                                    // 1033
            });                                                                                                        // 1034
            $input.data(attrsKey, {                                                                                    // 1035
                dir: $input.attr("dir"),                                                                               // 1036
                autocomplete: $input.attr("autocomplete"),                                                             // 1037
                spellcheck: $input.attr("spellcheck"),                                                                 // 1038
                style: $input.attr("style")                                                                            // 1039
            });                                                                                                        // 1040
            $input.addClass("tt-input").attr({                                                                         // 1041
                autocomplete: "off",                                                                                   // 1042
                spellcheck: false                                                                                      // 1043
            }).css(withHint ? css.input : css.inputWithNoHint);                                                        // 1044
            try {                                                                                                      // 1045
                !$input.attr("dir") && $input.attr("dir", "auto");                                                     // 1046
            } catch (e) {}                                                                                             // 1047
            return $input.wrap($wrapper).parent().prepend(withHint ? $hint : null).append($dropdown);                  // 1048
        }                                                                                                              // 1049
        function getBackgroundStyles($el) {                                                                            // 1050
            return {                                                                                                   // 1051
                backgroundAttachment: $el.css("background-attachment"),                                                // 1052
                backgroundClip: $el.css("background-clip"),                                                            // 1053
                backgroundColor: $el.css("background-color"),                                                          // 1054
                backgroundImage: $el.css("background-image"),                                                          // 1055
                backgroundOrigin: $el.css("background-origin"),                                                        // 1056
                backgroundPosition: $el.css("background-position"),                                                    // 1057
                backgroundRepeat: $el.css("background-repeat"),                                                        // 1058
                backgroundSize: $el.css("background-size")                                                             // 1059
            };                                                                                                         // 1060
        }                                                                                                              // 1061
        function destroyDomStructure($node) {                                                                          // 1062
            var $input = $node.find(".tt-input");                                                                      // 1063
            _.each($input.data(attrsKey), function(val, key) {                                                         // 1064
                _.isUndefined(val) ? $input.removeAttr(key) : $input.attr(key, val);                                   // 1065
            });                                                                                                        // 1066
            $input.detach().removeData(attrsKey).removeClass("tt-input").insertAfter($node);                           // 1067
            $node.remove();                                                                                            // 1068
        }                                                                                                              // 1069
    }();                                                                                                               // 1070
    (function() {                                                                                                      // 1071
        var old, typeaheadKey, methods;                                                                                // 1072
        old = $.fn.typeahead;                                                                                          // 1073
        typeaheadKey = "ttTypeahead";                                                                                  // 1074
        methods = {                                                                                                    // 1075
            initialize: function initialize(o, datasets) {                                                             // 1076
                datasets = _.isArray(datasets) ? datasets : [].slice.call(arguments, 1);                               // 1077
                o = o || {};                                                                                           // 1078
                return this.each(attach);                                                                              // 1079
                function attach() {                                                                                    // 1080
                    var $input = $(this), eventBus, typeahead;                                                         // 1081
                    _.each(datasets, function(d) {                                                                     // 1082
                        d.highlight = !!o.highlight;                                                                   // 1083
                    });                                                                                                // 1084
                    typeahead = new Typeahead({                                                                        // 1085
                        input: $input,                                                                                 // 1086
                        eventBus: eventBus = new EventBus({                                                            // 1087
                            el: $input                                                                                 // 1088
                        }),                                                                                            // 1089
                        withHint: _.isUndefined(o.hint) ? true : !!o.hint,                                             // 1090
                        minLength: o.minLength,                                                                        // 1091
                        autoselect: o.autoselect,                                                                      // 1092
                        datasets: datasets                                                                             // 1093
                    });                                                                                                // 1094
                    $input.data(typeaheadKey, typeahead);                                                              // 1095
                }                                                                                                      // 1096
            },                                                                                                         // 1097
            open: function open() {                                                                                    // 1098
                return this.each(openTypeahead);                                                                       // 1099
                function openTypeahead() {                                                                             // 1100
                    var $input = $(this), typeahead;                                                                   // 1101
                    if (typeahead = $input.data(typeaheadKey)) {                                                       // 1102
                        typeahead.open();                                                                              // 1103
                    }                                                                                                  // 1104
                }                                                                                                      // 1105
            },                                                                                                         // 1106
            close: function close() {                                                                                  // 1107
                return this.each(closeTypeahead);                                                                      // 1108
                function closeTypeahead() {                                                                            // 1109
                    var $input = $(this), typeahead;                                                                   // 1110
                    if (typeahead = $input.data(typeaheadKey)) {                                                       // 1111
                        typeahead.close();                                                                             // 1112
                    }                                                                                                  // 1113
                }                                                                                                      // 1114
            },                                                                                                         // 1115
            val: function val(newVal) {                                                                                // 1116
                return !arguments.length ? getVal(this.first()) : this.each(setVal);                                   // 1117
                function setVal() {                                                                                    // 1118
                    var $input = $(this), typeahead;                                                                   // 1119
                    if (typeahead = $input.data(typeaheadKey)) {                                                       // 1120
                        typeahead.setVal(newVal);                                                                      // 1121
                    }                                                                                                  // 1122
                }                                                                                                      // 1123
                function getVal($input) {                                                                              // 1124
                    var typeahead, query;                                                                              // 1125
                    if (typeahead = $input.data(typeaheadKey)) {                                                       // 1126
                        query = typeahead.getVal();                                                                    // 1127
                    }                                                                                                  // 1128
                    return query;                                                                                      // 1129
                }                                                                                                      // 1130
            },                                                                                                         // 1131
            destroy: function destroy() {                                                                              // 1132
                return this.each(unattach);                                                                            // 1133
                function unattach() {                                                                                  // 1134
                    var $input = $(this), typeahead;                                                                   // 1135
                    if (typeahead = $input.data(typeaheadKey)) {                                                       // 1136
                        typeahead.destroy();                                                                           // 1137
                        $input.removeData(typeaheadKey);                                                               // 1138
                    }                                                                                                  // 1139
                }                                                                                                      // 1140
            }                                                                                                          // 1141
        };                                                                                                             // 1142
        $.fn.typeahead = function(method) {                                                                            // 1143
            if (methods[method]) {                                                                                     // 1144
                return methods[method].apply(this, [].slice.call(arguments, 1));                                       // 1145
            } else {                                                                                                   // 1146
                return methods.initialize.apply(this, arguments);                                                      // 1147
            }                                                                                                          // 1148
        };                                                                                                             // 1149
        $.fn.typeahead.noConflict = function noConflict() {                                                            // 1150
            $.fn.typeahead = old;                                                                                      // 1151
            return this;                                                                                               // 1152
        };                                                                                                             // 1153
    })();                                                                                                              // 1154
})(window.jQuery);                                                                                                     // 1155
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/compatibility/beautify-html.js                                                             //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
/*jshint curly:true, eqeqeq:true, laxbreak:true, noempty:false */                                                      // 1
/*                                                                                                                     // 2
                                                                                                                       // 3
  The MIT License (MIT)                                                                                                // 4
                                                                                                                       // 5
  Copyright (c) 2007-2013 Einar Lielmanis and contributors.                                                            // 6
                                                                                                                       // 7
  Permission is hereby granted, free of charge, to any person                                                          // 8
  obtaining a copy of this software and associated documentation files                                                 // 9
  (the "Software"), to deal in the Software without restriction,                                                       // 10
  including without limitation the rights to use, copy, modify, merge,                                                 // 11
  publish, distribute, sublicense, and/or sell copies of the Software,                                                 // 12
  and to permit persons to whom the Software is furnished to do so,                                                    // 13
  subject to the following conditions:                                                                                 // 14
                                                                                                                       // 15
  The above copyright notice and this permission notice shall be                                                       // 16
  included in all copies or substantial portions of the Software.                                                      // 17
                                                                                                                       // 18
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,                                                      // 19
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF                                                   // 20
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND                                                                // 21
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS                                                  // 22
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN                                                   // 23
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN                                                    // 24
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE                                                     // 25
  SOFTWARE.                                                                                                            // 26
                                                                                                                       // 27
                                                                                                                       // 28
 Style HTML                                                                                                            // 29
---------------                                                                                                        // 30
                                                                                                                       // 31
  Written by Nochum Sossonko, (nsossonko@hotmail.com)                                                                  // 32
                                                                                                                       // 33
  Based on code initially developed by: Einar Lielmanis, <einar@jsbeautifier.org>                                      // 34
    http://jsbeautifier.org/                                                                                           // 35
                                                                                                                       // 36
  Usage:                                                                                                               // 37
    style_html(html_source);                                                                                           // 38
                                                                                                                       // 39
    style_html(html_source, options);                                                                                  // 40
                                                                                                                       // 41
  The options are:                                                                                                     // 42
    indent_inner_html (default false)   indent <head> and <body> sections,                                            // 43
    indent_size (default 4)           indentation size,                                                               // 44
    indent_char (default space)       character to indent with,                                                       // 45
    wrap_line_length (default 250)            -  maximum amount of characters per line (0 = disable)                   // 46
    brace_style (default "collapse") - "collapse" | "expand" | "end-expand"                                            // 47
            put braces on the same line as control statements (default), or put braces on own line (Allman / ANSI style), or just put end braces on own line.
    unformatted (defaults to inline tags) - list of tags, that shouldn't be reformatted                                // 49
    indent_scripts (default normal)  - "keep"|"separate"|"normal"                                                      // 50
    preserve_newlines (default true) - whether existing line breaks before elements should be preserved                // 51
                                        Only works before elements, not inside tags or for text.                       // 52
    max_preserve_newlines (default unlimited) - maximum number of line breaks to be preserved in one chunk             // 53
    indent_handlebars (default false) - format and indent {{#foo}} and {{/foo}}                                        // 54
                                                                                                                       // 55
    e.g.                                                                                                               // 56
                                                                                                                       // 57
    style_html(html_source, {                                                                                          // 58
      'indent_inner_html': false,                                                                                      // 59
      'indent_size': 2,                                                                                                // 60
      'indent_char': ' ',                                                                                              // 61
      'wrap_line_length': 78,                                                                                          // 62
      'brace_style': 'expand',                                                                                         // 63
      'unformatted': ['a', 'sub', 'sup', 'b', 'i', 'u'],                                                               // 64
      'preserve_newlines': true,                                                                                       // 65
      'max_preserve_newlines': 5,                                                                                      // 66
      'indent_handlebars': false                                                                                       // 67
    });                                                                                                                // 68
*/                                                                                                                     // 69
                                                                                                                       // 70
(function() {                                                                                                          // 71
                                                                                                                       // 72
    function trim(s) {                                                                                                 // 73
        return s.replace(/^\s+|\s+$/g, '');                                                                            // 74
    }                                                                                                                  // 75
                                                                                                                       // 76
    function ltrim(s) {                                                                                                // 77
        return s.replace(/^\s+/g, '');                                                                                 // 78
    }                                                                                                                  // 79
                                                                                                                       // 80
    function style_html(html_source, options, js_beautify, css_beautify) {                                             // 81
        //Wrapper function to invoke all the necessary constructors and deal with the output.                          // 82
                                                                                                                       // 83
        var multi_parser,                                                                                              // 84
            indent_inner_html,                                                                                         // 85
            indent_size,                                                                                               // 86
            indent_character,                                                                                          // 87
            wrap_line_length,                                                                                          // 88
            brace_style,                                                                                               // 89
            unformatted,                                                                                               // 90
            preserve_newlines,                                                                                         // 91
            max_preserve_newlines,                                                                                     // 92
            indent_handlebars;                                                                                         // 93
                                                                                                                       // 94
        options = options || {};                                                                                       // 95
                                                                                                                       // 96
        // backwards compatibility to 1.3.4                                                                            // 97
        if ((options.wrap_line_length === undefined || parseInt(options.wrap_line_length, 10) === 0) &&                // 98
                (options.max_char !== undefined && parseInt(options.max_char, 10) !== 0)) {                            // 99
            options.wrap_line_length = options.max_char;                                                               // 100
        }                                                                                                              // 101
                                                                                                                       // 102
        indent_inner_html = (options.indent_inner_html === undefined) ? false : options.indent_inner_html;             // 103
        indent_size = (options.indent_size === undefined) ? 4 : parseInt(options.indent_size, 10);                     // 104
        indent_character = (options.indent_char === undefined) ? ' ' : options.indent_char;                            // 105
        brace_style = (options.brace_style === undefined) ? 'collapse' : options.brace_style;                          // 106
        wrap_line_length =  parseInt(options.wrap_line_length, 10) === 0 ? 32786 : parseInt(options.wrap_line_length || 250, 10);
        unformatted = options.unformatted || ['a', 'span', 'bdo', 'em', 'strong', 'dfn', 'code', 'samp', 'kbd', 'var', 'cite', 'abbr', 'acronym', 'q', 'sub', 'sup', 'tt', 'i', 'b', 'big', 'small', 'u', 's', 'strike', 'font', 'ins', 'del', 'pre', 'address', 'dt', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'];
        preserve_newlines = (options.preserve_newlines === undefined) ? true : options.preserve_newlines;              // 109
        max_preserve_newlines = preserve_newlines ?                                                                    // 110
            (isNaN(parseInt(options.max_preserve_newlines, 10)) ? 32786 : parseInt(options.max_preserve_newlines, 10)) // 111
            : 0;                                                                                                       // 112
        indent_handlebars = (options.indent_handlebars === undefined) ? false : options.indent_handlebars;             // 113
                                                                                                                       // 114
        function Parser() {                                                                                            // 115
                                                                                                                       // 116
            this.pos = 0; //Parser position                                                                            // 117
            this.token = '';                                                                                           // 118
            this.current_mode = 'CONTENT'; //reflects the current Parser mode: TAG/CONTENT                             // 119
            this.tags = { //An object to hold tags, their position, and their parent-tags, initiated with default values
                parent: 'parent1',                                                                                     // 121
                parentcount: 1,                                                                                        // 122
                parent1: ''                                                                                            // 123
            };                                                                                                         // 124
            this.tag_type = '';                                                                                        // 125
            this.token_text = this.last_token = this.last_text = this.token_type = '';                                 // 126
            this.newlines = 0;                                                                                         // 127
            this.indent_content = indent_inner_html;                                                                   // 128
                                                                                                                       // 129
            this.Utils = { //Uilities made available to the various functions                                          // 130
                whitespace: "\n\r\t ".split(''),                                                                       // 131
                single_token: 'br,input,link,meta,!doctype,basefont,base,area,hr,wbr,param,img,isindex,?xml,embed,?php,?,?='.split(','), //all the single tags for HTML
                extra_liners: 'head,body,/html'.split(','), //for tags that need a line of whitespace before them      // 133
                in_array: function(what, arr) {                                                                        // 134
                    for (var i = 0; i < arr.length; i++) {                                                             // 135
                        if (what === arr[i]) {                                                                         // 136
                            return true;                                                                               // 137
                        }                                                                                              // 138
                    }                                                                                                  // 139
                    return false;                                                                                      // 140
                }                                                                                                      // 141
            };                                                                                                         // 142
                                                                                                                       // 143
            this.traverse_whitespace = function() {                                                                    // 144
                var input_char = '';                                                                                   // 145
                                                                                                                       // 146
                input_char = this.input.charAt(this.pos);                                                              // 147
                if (this.Utils.in_array(input_char, this.Utils.whitespace)) {                                          // 148
                    this.newlines = 0;                                                                                 // 149
                    while (this.Utils.in_array(input_char, this.Utils.whitespace)) {                                   // 150
                        if (preserve_newlines && input_char === '\n' && this.newlines <= max_preserve_newlines) {      // 151
                            this.newlines += 1;                                                                        // 152
                        }                                                                                              // 153
                                                                                                                       // 154
                        this.pos++;                                                                                    // 155
                        input_char = this.input.charAt(this.pos);                                                      // 156
                    }                                                                                                  // 157
                    return true;                                                                                       // 158
                }                                                                                                      // 159
                return false;                                                                                          // 160
            };                                                                                                         // 161
                                                                                                                       // 162
            this.get_content = function() { //function to capture regular content between tags                         // 163
                                                                                                                       // 164
                var input_char = '',                                                                                   // 165
                    content = [],                                                                                      // 166
                    space = false; //if a space is needed                                                              // 167
                                                                                                                       // 168
                while (this.input.charAt(this.pos) !== '<') {                                                          // 169
                    if (this.pos >= this.input.length) {                                                               // 170
                        return content.length ? content.join('') : ['', 'TK_EOF'];                                     // 171
                    }                                                                                                  // 172
                                                                                                                       // 173
                    if (this.traverse_whitespace()) {                                                                  // 174
                        if (content.length) {                                                                          // 175
                            space = true;                                                                              // 176
                        }                                                                                              // 177
                        continue; //don't want to insert unnecessary space                                             // 178
                    }                                                                                                  // 179
                                                                                                                       // 180
                    if (indent_handlebars) {                                                                           // 181
                        // Handlebars parsing is complicated.                                                          // 182
                        // {{#foo}} and {{/foo}} are formatted tags.                                                   // 183
                        // {{something}} should get treated as content, except:                                        // 184
                        // {{else}} specifically behaves like {{#if}} and {{/if}}                                      // 185
                        var peek3 = this.input.substr(this.pos, 3);                                                    // 186
                        if (peek3 === '{{#' || peek3 === '{{/') {                                                      // 187
                            // These are tags and not content.                                                         // 188
                            break;                                                                                     // 189
                        } else if (this.input.substr(this.pos, 2) === '{{') {                                          // 190
                            if (this.get_tag(true) === '{{else}}') {                                                   // 191
                                break;                                                                                 // 192
                            }                                                                                          // 193
                        }                                                                                              // 194
                    }                                                                                                  // 195
                                                                                                                       // 196
                    input_char = this.input.charAt(this.pos);                                                          // 197
                    this.pos++;                                                                                        // 198
                                                                                                                       // 199
                    if (space) {                                                                                       // 200
                        if (this.line_char_count >= this.wrap_line_length) { //insert a line when the wrap_line_length is reached
                            this.print_newline(false, content);                                                        // 202
                            this.print_indentation(content);                                                           // 203
                        } else {                                                                                       // 204
                            this.line_char_count++;                                                                    // 205
                            content.push(' ');                                                                         // 206
                        }                                                                                              // 207
                        space = false;                                                                                 // 208
                    }                                                                                                  // 209
                    this.line_char_count++;                                                                            // 210
                    content.push(input_char); //letter at-a-time (or string) inserted to an array                      // 211
                }                                                                                                      // 212
                return content.length ? content.join('') : '';                                                         // 213
            };                                                                                                         // 214
                                                                                                                       // 215
            this.get_contents_to = function(name) { //get the full content of a script or style to pass to js_beautify // 216
                if (this.pos === this.input.length) {                                                                  // 217
                    return ['', 'TK_EOF'];                                                                             // 218
                }                                                                                                      // 219
                var input_char = '';                                                                                   // 220
                var content = '';                                                                                      // 221
                var reg_match = new RegExp('</' + name + '\\s*>', 'igm');                                              // 222
                reg_match.lastIndex = this.pos;                                                                        // 223
                var reg_array = reg_match.exec(this.input);                                                            // 224
                var end_script = reg_array ? reg_array.index : this.input.length; //absolute end of script             // 225
                if (this.pos < end_script) { //get everything in between the script tags                               // 226
                    content = this.input.substring(this.pos, end_script);                                              // 227
                    this.pos = end_script;                                                                             // 228
                }                                                                                                      // 229
                return content;                                                                                        // 230
            };                                                                                                         // 231
                                                                                                                       // 232
            this.record_tag = function(tag) { //function to record a tag and its parent in this.tags Object            // 233
                if (this.tags[tag + 'count']) { //check for the existence of this tag type                             // 234
                    this.tags[tag + 'count']++;                                                                        // 235
                    this.tags[tag + this.tags[tag + 'count']] = this.indent_level; //and record the present indent level
                } else { //otherwise initialize this tag type                                                          // 237
                    this.tags[tag + 'count'] = 1;                                                                      // 238
                    this.tags[tag + this.tags[tag + 'count']] = this.indent_level; //and record the present indent level
                }                                                                                                      // 240
                this.tags[tag + this.tags[tag + 'count'] + 'parent'] = this.tags.parent; //set the parent (i.e. in the case of a div this.tags.div1parent)
                this.tags.parent = tag + this.tags[tag + 'count']; //and make this the current parent (i.e. in the case of a div 'div1')
            };                                                                                                         // 243
                                                                                                                       // 244
            this.retrieve_tag = function(tag) { //function to retrieve the opening tag to the corresponding closer     // 245
                if (this.tags[tag + 'count']) { //if the openener is not in the Object we ignore it                    // 246
                    var temp_parent = this.tags.parent; //check to see if it's a closable tag.                         // 247
                    while (temp_parent) { //till we reach '' (the initial value);                                      // 248
                        if (tag + this.tags[tag + 'count'] === temp_parent) { //if this is it use it                   // 249
                            break;                                                                                     // 250
                        }                                                                                              // 251
                        temp_parent = this.tags[temp_parent + 'parent']; //otherwise keep on climbing up the DOM Tree  // 252
                    }                                                                                                  // 253
                    if (temp_parent) { //if we caught something                                                        // 254
                        this.indent_level = this.tags[tag + this.tags[tag + 'count']]; //set the indent_level accordingly
                        this.tags.parent = this.tags[temp_parent + 'parent']; //and set the current parent             // 256
                    }                                                                                                  // 257
                    delete this.tags[tag + this.tags[tag + 'count'] + 'parent']; //delete the closed tags parent reference...
                    delete this.tags[tag + this.tags[tag + 'count']]; //...and the tag itself                          // 259
                    if (this.tags[tag + 'count'] === 1) {                                                              // 260
                        delete this.tags[tag + 'count'];                                                               // 261
                    } else {                                                                                           // 262
                        this.tags[tag + 'count']--;                                                                    // 263
                    }                                                                                                  // 264
                }                                                                                                      // 265
            };                                                                                                         // 266
                                                                                                                       // 267
            this.indent_to_tag = function(tag) {                                                                       // 268
                // Match the indentation level to the last use of this tag, but don't remove it.                       // 269
                if (!this.tags[tag + 'count']) {                                                                       // 270
                    return;                                                                                            // 271
                }                                                                                                      // 272
                var temp_parent = this.tags.parent;                                                                    // 273
                while (temp_parent) {                                                                                  // 274
                    if (tag + this.tags[tag + 'count'] === temp_parent) {                                              // 275
                        break;                                                                                         // 276
                    }                                                                                                  // 277
                    temp_parent = this.tags[temp_parent + 'parent'];                                                   // 278
                }                                                                                                      // 279
                if (temp_parent) {                                                                                     // 280
                    this.indent_level = this.tags[tag + this.tags[tag + 'count']];                                     // 281
                }                                                                                                      // 282
            };                                                                                                         // 283
                                                                                                                       // 284
            this.get_tag = function(peek) { //function to get a full tag and parse its type                            // 285
                var input_char = '',                                                                                   // 286
                    content = [],                                                                                      // 287
                    comment = '',                                                                                      // 288
                    space = false,                                                                                     // 289
                    tag_start, tag_end,                                                                                // 290
                    tag_start_char,                                                                                    // 291
                    orig_pos = this.pos,                                                                               // 292
                    orig_line_char_count = this.line_char_count;                                                       // 293
                                                                                                                       // 294
                peek = peek !== undefined ? peek : false;                                                              // 295
                                                                                                                       // 296
                do {                                                                                                   // 297
                    if (this.pos >= this.input.length) {                                                               // 298
                        if (peek) {                                                                                    // 299
                            this.pos = orig_pos;                                                                       // 300
                            this.line_char_count = orig_line_char_count;                                               // 301
                        }                                                                                              // 302
                        return content.length ? content.join('') : ['', 'TK_EOF'];                                     // 303
                    }                                                                                                  // 304
                                                                                                                       // 305
                    input_char = this.input.charAt(this.pos);                                                          // 306
                    this.pos++;                                                                                        // 307
                                                                                                                       // 308
                    if (this.Utils.in_array(input_char, this.Utils.whitespace)) { //don't want to insert unnecessary space
                        space = true;                                                                                  // 310
                        continue;                                                                                      // 311
                    }                                                                                                  // 312
                                                                                                                       // 313
                    if (input_char === "'" || input_char === '"') {                                                    // 314
                        input_char += this.get_unformatted(input_char);                                                // 315
                        space = true;                                                                                  // 316
                                                                                                                       // 317
                    }                                                                                                  // 318
                                                                                                                       // 319
                    if (input_char === '=') { //no space before =                                                      // 320
                        space = false;                                                                                 // 321
                    }                                                                                                  // 322
                                                                                                                       // 323
                    if (content.length && content[content.length - 1] !== '=' && input_char !== '>' && space) {        // 324
                        //no space after = or before >                                                                 // 325
                        if (this.line_char_count >= this.wrap_line_length) {                                           // 326
                            this.print_newline(false, content);                                                        // 327
                            this.print_indentation(content);                                                           // 328
                        } else {                                                                                       // 329
                            content.push(' ');                                                                         // 330
                            this.line_char_count++;                                                                    // 331
                        }                                                                                              // 332
                        space = false;                                                                                 // 333
                    }                                                                                                  // 334
                                                                                                                       // 335
                    if (indent_handlebars && tag_start_char === '<') {                                                 // 336
                        // When inside an angle-bracket tag, put spaces around                                         // 337
                        // handlebars not inside of strings.                                                           // 338
                        if ((input_char + this.input.charAt(this.pos)) === '{{') {                                     // 339
                            input_char += this.get_unformatted('}}');                                                  // 340
                            if (content.length && content[content.length - 1] !== ' ' && content[content.length - 1] !== '<') {
                                input_char = ' ' + input_char;                                                         // 342
                            }                                                                                          // 343
                            space = true;                                                                              // 344
                        }                                                                                              // 345
                    }                                                                                                  // 346
                                                                                                                       // 347
                    if (input_char === '<' && !tag_start_char) {                                                       // 348
                        tag_start = this.pos - 1;                                                                      // 349
                        tag_start_char = '<';                                                                          // 350
                    }                                                                                                  // 351
                                                                                                                       // 352
                    if (indent_handlebars && !tag_start_char) {                                                        // 353
                        if (content.length >= 2 && content[content.length - 1] === '{' && content[content.length - 2] == '{') {
                            if (input_char === '#' || input_char === '/') {                                            // 355
                                tag_start = this.pos - 3;                                                              // 356
                            } else {                                                                                   // 357
                                tag_start = this.pos - 2;                                                              // 358
                            }                                                                                          // 359
                            tag_start_char = '{';                                                                      // 360
                        }                                                                                              // 361
                    }                                                                                                  // 362
                                                                                                                       // 363
                    this.line_char_count++;                                                                            // 364
                    content.push(input_char); //inserts character at-a-time (or string)                                // 365
                                                                                                                       // 366
                    if (content[1] && content[1] === '!') { //if we're in a comment, do something special              // 367
                        // We treat all comments as literals, even more than preformatted tags                         // 368
                        // we just look for the appropriate close tag                                                  // 369
                        content = [this.get_comment(tag_start)];                                                       // 370
                        break;                                                                                         // 371
                    }                                                                                                  // 372
                                                                                                                       // 373
                    if (indent_handlebars && tag_start_char === '{' && content.length > 2 && content[content.length - 2] === '}' && content[content.length - 1] === '}') {
                        break;                                                                                         // 375
                    }                                                                                                  // 376
                } while (input_char !== '>');                                                                          // 377
                                                                                                                       // 378
                var tag_complete = content.join('');                                                                   // 379
                var tag_index;                                                                                         // 380
                var tag_offset;                                                                                        // 381
                                                                                                                       // 382
                if (tag_complete.indexOf(' ') !== -1) { //if there's whitespace, thats where the tag name ends         // 383
                    tag_index = tag_complete.indexOf(' ');                                                             // 384
                } else if (tag_complete[0] === '{') {                                                                  // 385
                    tag_index = tag_complete.indexOf('}');                                                             // 386
                } else { //otherwise go with the tag ending                                                            // 387
                    tag_index = tag_complete.indexOf('>');                                                             // 388
                }                                                                                                      // 389
                if (tag_complete[0] === '<' || !indent_handlebars) {                                                   // 390
                    tag_offset = 1;                                                                                    // 391
                } else {                                                                                               // 392
                    tag_offset = tag_complete[2] === '#' ? 3 : 2;                                                      // 393
                }                                                                                                      // 394
                var tag_check = tag_complete.substring(tag_offset, tag_index).toLowerCase();                           // 395
                if (tag_complete.charAt(tag_complete.length - 2) === '/' ||                                            // 396
                    this.Utils.in_array(tag_check, this.Utils.single_token)) { //if this tag name is a single tag type (either in the list or has a closing /)
                    if (!peek) {                                                                                       // 398
                        this.tag_type = 'SINGLE';                                                                      // 399
                    }                                                                                                  // 400
                } else if (indent_handlebars && tag_complete[0] === '{' && tag_check === 'else') {                     // 401
                    if (!peek) {                                                                                       // 402
                        this.indent_to_tag('if');                                                                      // 403
                        this.tag_type = 'HANDLEBARS_ELSE';                                                             // 404
                        this.indent_content = true;                                                                    // 405
                        this.traverse_whitespace();                                                                    // 406
                    }                                                                                                  // 407
                } else if (tag_check === 'script' &&                                                                   // 408
                    (tag_complete.search('type') === -1 ||                                                             // 409
                    (tag_complete.search('type') > -1 &&                                                               // 410
                    tag_complete.search(/\b(text|application)\/(x-)?(javascript|ecmascript|jscript|livescript)/) > -1))) {
                    if (!peek) {                                                                                       // 412
                        this.record_tag(tag_check);                                                                    // 413
                        this.tag_type = 'SCRIPT';                                                                      // 414
                    }                                                                                                  // 415
                } else if (tag_check === 'style' &&                                                                    // 416
                    (tag_complete.search('type') === -1 ||                                                             // 417
                    (tag_complete.search('type') > -1 && tag_complete.search('text/css') > -1))) {                     // 418
                    if (!peek) {                                                                                       // 419
                        this.record_tag(tag_check);                                                                    // 420
                        this.tag_type = 'STYLE';                                                                       // 421
                    }                                                                                                  // 422
                } else if (this.is_unformatted(tag_check, unformatted)) { // do not reformat the "unformatted" tags    // 423
                    comment = this.get_unformatted('</' + tag_check + '>', tag_complete); //...delegate to get_unformatted function
                    content.push(comment);                                                                             // 425
                    // Preserve collapsed whitespace either before or after this tag.                                  // 426
                    if (tag_start > 0 && this.Utils.in_array(this.input.charAt(tag_start - 1), this.Utils.whitespace)) {
                        content.splice(0, 0, this.input.charAt(tag_start - 1));                                        // 428
                    }                                                                                                  // 429
                    tag_end = this.pos - 1;                                                                            // 430
                    if (this.Utils.in_array(this.input.charAt(tag_end + 1), this.Utils.whitespace)) {                  // 431
                        content.push(this.input.charAt(tag_end + 1));                                                  // 432
                    }                                                                                                  // 433
                    this.tag_type = 'SINGLE';                                                                          // 434
                } else if (tag_check.charAt(0) === '!') { //peek for <! comment                                        // 435
                    // for comments content is already correct.                                                        // 436
                    if (!peek) {                                                                                       // 437
                        this.tag_type = 'SINGLE';                                                                      // 438
                        this.traverse_whitespace();                                                                    // 439
                    }                                                                                                  // 440
                } else if (!peek) {                                                                                    // 441
                    if (tag_check.charAt(0) === '/') { //this tag is a double tag so check for tag-ending              // 442
                        this.retrieve_tag(tag_check.substring(1)); //remove it and all ancestors                       // 443
                        this.tag_type = 'END';                                                                         // 444
                        this.traverse_whitespace();                                                                    // 445
                    } else { //otherwise it's a start-tag                                                              // 446
                        this.record_tag(tag_check); //push it on the tag stack                                         // 447
                        if (tag_check.toLowerCase() !== 'html') {                                                      // 448
                            this.indent_content = true;                                                                // 449
                        }                                                                                              // 450
                        this.tag_type = 'START';                                                                       // 451
                                                                                                                       // 452
                        // Allow preserving of newlines after a start tag                                              // 453
                        this.traverse_whitespace();                                                                    // 454
                    }                                                                                                  // 455
                    if (this.Utils.in_array(tag_check, this.Utils.extra_liners)) { //check if this double needs an extra line
                        this.print_newline(false, this.output);                                                        // 457
                        if (this.output.length && this.output[this.output.length - 2] !== '\n') {                      // 458
                            this.print_newline(true, this.output);                                                     // 459
                        }                                                                                              // 460
                    }                                                                                                  // 461
                }                                                                                                      // 462
                                                                                                                       // 463
                if (peek) {                                                                                            // 464
                    this.pos = orig_pos;                                                                               // 465
                    this.line_char_count = orig_line_char_count;                                                       // 466
                }                                                                                                      // 467
                                                                                                                       // 468
                return content.join(''); //returns fully formatted tag                                                 // 469
            };                                                                                                         // 470
                                                                                                                       // 471
            this.get_comment = function(start_pos) { //function to return comment content in its entirety              // 472
                // this is will have very poor perf, but will work for now.                                            // 473
                var comment = '',                                                                                      // 474
                    delimiter = '>',                                                                                   // 475
                    matched = false;                                                                                   // 476
                                                                                                                       // 477
                this.pos = start_pos;                                                                                  // 478
                input_char = this.input.charAt(this.pos);                                                              // 479
                this.pos++;                                                                                            // 480
                                                                                                                       // 481
                while (this.pos <= this.input.length) {                                                                // 482
                    comment += input_char;                                                                             // 483
                                                                                                                       // 484
                    // only need to check for the delimiter if the last chars match                                    // 485
                    if (comment[comment.length - 1] === delimiter[delimiter.length - 1] &&                             // 486
                        comment.indexOf(delimiter) !== -1) {                                                           // 487
                        break;                                                                                         // 488
                    }                                                                                                  // 489
                                                                                                                       // 490
                    // only need to search for custom delimiter for the first few characters                           // 491
                    if (!matched && comment.length < 10) {                                                             // 492
                        if (comment.indexOf('<![if') === 0) { //peek for <![if conditional comment                     // 493
                            delimiter = '<![endif]>';                                                                  // 494
                            matched = true;                                                                            // 495
                        } else if (comment.indexOf('<![cdata[') === 0) { //if it's a <[cdata[ comment...               // 496
                            delimiter = ']]>';                                                                         // 497
                            matched = true;                                                                            // 498
                        } else if (comment.indexOf('<![') === 0) { // some other ![ comment? ...                       // 499
                            delimiter = ']>';                                                                          // 500
                            matched = true;                                                                            // 501
                        } else if (comment.indexOf('<!--') === 0) { // <!-- comment ...                                // 502
                            delimiter = '-->';                                                                         // 503
                            matched = true;                                                                            // 504
                        }                                                                                              // 505
                    }                                                                                                  // 506
                                                                                                                       // 507
                    input_char = this.input.charAt(this.pos);                                                          // 508
                    this.pos++;                                                                                        // 509
                }                                                                                                      // 510
                                                                                                                       // 511
                return comment;                                                                                        // 512
            };                                                                                                         // 513
                                                                                                                       // 514
            this.get_unformatted = function(delimiter, orig_tag) { //function to return unformatted content in its entirety
                                                                                                                       // 516
                if (orig_tag && orig_tag.toLowerCase().indexOf(delimiter) !== -1) {                                    // 517
                    return '';                                                                                         // 518
                }                                                                                                      // 519
                var input_char = '';                                                                                   // 520
                var content = '';                                                                                      // 521
                var min_index = 0;                                                                                     // 522
                var space = true;                                                                                      // 523
                do {                                                                                                   // 524
                                                                                                                       // 525
                    if (this.pos >= this.input.length) {                                                               // 526
                        return content;                                                                                // 527
                    }                                                                                                  // 528
                                                                                                                       // 529
                    input_char = this.input.charAt(this.pos);                                                          // 530
                    this.pos++;                                                                                        // 531
                                                                                                                       // 532
                    if (this.Utils.in_array(input_char, this.Utils.whitespace)) {                                      // 533
                        if (!space) {                                                                                  // 534
                            this.line_char_count--;                                                                    // 535
                            continue;                                                                                  // 536
                        }                                                                                              // 537
                        if (input_char === '\n' || input_char === '\r') {                                              // 538
                            content += '\n';                                                                           // 539
                            /*  Don't change tab indention for unformatted blocks.  If using code for html editing, this will greatly affect <pre> tags if they are specified in the 'unformatted array'
                for (var i=0; i<this.indent_level; i++) {                                                              // 541
                  content += this.indent_string;                                                                       // 542
                }                                                                                                      // 543
                space = false; //...and make sure other indentation is erased                                          // 544
                */                                                                                                     // 545
                            this.line_char_count = 0;                                                                  // 546
                            continue;                                                                                  // 547
                        }                                                                                              // 548
                    }                                                                                                  // 549
                    content += input_char;                                                                             // 550
                    this.line_char_count++;                                                                            // 551
                    space = true;                                                                                      // 552
                                                                                                                       // 553
                    if (indent_handlebars && input_char === '{' && content.length && content[content.length - 2] === '{') {
                        // Handlebars expressions in strings should also be unformatted.                               // 555
                        content += this.get_unformatted('}}');                                                         // 556
                        // These expressions are opaque.  Ignore delimiters found in them.                             // 557
                        min_index = content.length;                                                                    // 558
                    }                                                                                                  // 559
                } while (content.toLowerCase().indexOf(delimiter, min_index) === -1);                                  // 560
                return content;                                                                                        // 561
            };                                                                                                         // 562
                                                                                                                       // 563
            this.get_token = function() { //initial handler for token-retrieval                                        // 564
                var token;                                                                                             // 565
                                                                                                                       // 566
                if (this.last_token === 'TK_TAG_SCRIPT' || this.last_token === 'TK_TAG_STYLE') { //check if we need to format javascript
                    var type = this.last_token.substr(7);                                                              // 568
                    token = this.get_contents_to(type);                                                                // 569
                    if (typeof token !== 'string') {                                                                   // 570
                        return token;                                                                                  // 571
                    }                                                                                                  // 572
                    return [token, 'TK_' + type];                                                                      // 573
                }                                                                                                      // 574
                if (this.current_mode === 'CONTENT') {                                                                 // 575
                    token = this.get_content();                                                                        // 576
                    if (typeof token !== 'string') {                                                                   // 577
                        return token;                                                                                  // 578
                    } else {                                                                                           // 579
                        return [token, 'TK_CONTENT'];                                                                  // 580
                    }                                                                                                  // 581
                }                                                                                                      // 582
                                                                                                                       // 583
                if (this.current_mode === 'TAG') {                                                                     // 584
                    token = this.get_tag();                                                                            // 585
                    if (typeof token !== 'string') {                                                                   // 586
                        return token;                                                                                  // 587
                    } else {                                                                                           // 588
                        var tag_name_type = 'TK_TAG_' + this.tag_type;                                                 // 589
                        return [token, tag_name_type];                                                                 // 590
                    }                                                                                                  // 591
                }                                                                                                      // 592
            };                                                                                                         // 593
                                                                                                                       // 594
            this.get_full_indent = function(level) {                                                                   // 595
                level = this.indent_level + level || 0;                                                                // 596
                if (level < 1) {                                                                                       // 597
                    return '';                                                                                         // 598
                }                                                                                                      // 599
                                                                                                                       // 600
                return Array(level + 1).join(this.indent_string);                                                      // 601
            };                                                                                                         // 602
                                                                                                                       // 603
            this.is_unformatted = function(tag_check, unformatted) {                                                   // 604
                //is this an HTML5 block-level link?                                                                   // 605
                if (!this.Utils.in_array(tag_check, unformatted)) {                                                    // 606
                    return false;                                                                                      // 607
                }                                                                                                      // 608
                                                                                                                       // 609
                if (tag_check.toLowerCase() !== 'a' || !this.Utils.in_array('a', unformatted)) {                       // 610
                    return true;                                                                                       // 611
                }                                                                                                      // 612
                                                                                                                       // 613
                //at this point we have an  tag; is its first child something we want to remain                        // 614
                //unformatted?                                                                                         // 615
                var next_tag = this.get_tag(true /* peek. */ );                                                        // 616
                                                                                                                       // 617
                // test next_tag to see if it is just html tag (no external content)                                   // 618
                var tag = (next_tag || "").match(/^\s*<\s*\/?([a-z]*)\s*[^>]*>\s*$/);                                  // 619
                                                                                                                       // 620
                // if next_tag comes back but is not an isolated tag, then                                             // 621
                // let's treat the 'a' tag as having content                                                           // 622
                // and respect the unformatted option                                                                  // 623
                if (!tag || this.Utils.in_array(tag, unformatted)) {                                                   // 624
                    return true;                                                                                       // 625
                } else {                                                                                               // 626
                    return false;                                                                                      // 627
                }                                                                                                      // 628
            };                                                                                                         // 629
                                                                                                                       // 630
            this.printer = function(js_source, indent_character, indent_size, wrap_line_length, brace_style) { //handles input/output and some other printing functions
                                                                                                                       // 632
                this.input = js_source || ''; //gets the input for the Parser                                          // 633
                this.output = [];                                                                                      // 634
                this.indent_character = indent_character;                                                              // 635
                this.indent_string = '';                                                                               // 636
                this.indent_size = indent_size;                                                                        // 637
                this.brace_style = brace_style;                                                                        // 638
                this.indent_level = 0;                                                                                 // 639
                this.wrap_line_length = wrap_line_length;                                                              // 640
                this.line_char_count = 0; //count to see if wrap_line_length was exceeded                              // 641
                                                                                                                       // 642
                for (var i = 0; i < this.indent_size; i++) {                                                           // 643
                    this.indent_string += this.indent_character;                                                       // 644
                }                                                                                                      // 645
                                                                                                                       // 646
                this.print_newline = function(force, arr) {                                                            // 647
                    this.line_char_count = 0;                                                                          // 648
                    if (!arr || !arr.length) {                                                                         // 649
                        return;                                                                                        // 650
                    }                                                                                                  // 651
                    if (force || (arr[arr.length - 1] !== '\n')) { //we might want the extra line                      // 652
                        arr.push('\n');                                                                                // 653
                    }                                                                                                  // 654
                };                                                                                                     // 655
                                                                                                                       // 656
                this.print_indentation = function(arr) {                                                               // 657
                    for (var i = 0; i < this.indent_level; i++) {                                                      // 658
                        arr.push(this.indent_string);                                                                  // 659
                        this.line_char_count += this.indent_string.length;                                             // 660
                    }                                                                                                  // 661
                };                                                                                                     // 662
                                                                                                                       // 663
                this.print_token = function(text) {                                                                    // 664
                    if (text || text !== '') {                                                                         // 665
                        if (this.output.length && this.output[this.output.length - 1] === '\n') {                      // 666
                            this.print_indentation(this.output);                                                       // 667
                            text = ltrim(text);                                                                        // 668
                        }                                                                                              // 669
                    }                                                                                                  // 670
                    this.print_token_raw(text);                                                                        // 671
                };                                                                                                     // 672
                                                                                                                       // 673
                this.print_token_raw = function(text) {                                                                // 674
                    if (text && text !== '') {                                                                         // 675
                        if (text.length > 1 && text[text.length - 1] === '\n') {                                       // 676
                            // unformatted tags can grab newlines as their last character                              // 677
                            this.output.push(text.slice(0, -1));                                                       // 678
                            this.print_newline(false, this.output);                                                    // 679
                        } else {                                                                                       // 680
                            this.output.push(text);                                                                    // 681
                        }                                                                                              // 682
                    }                                                                                                  // 683
                                                                                                                       // 684
                    for (var n = 0; n < this.newlines; n++) {                                                          // 685
                        this.print_newline(n > 0, this.output);                                                        // 686
                    }                                                                                                  // 687
                    this.newlines = 0;                                                                                 // 688
                };                                                                                                     // 689
                                                                                                                       // 690
                this.indent = function() {                                                                             // 691
                    this.indent_level++;                                                                               // 692
                };                                                                                                     // 693
                                                                                                                       // 694
                this.unindent = function() {                                                                           // 695
                    if (this.indent_level > 0) {                                                                       // 696
                        this.indent_level--;                                                                           // 697
                    }                                                                                                  // 698
                };                                                                                                     // 699
            };                                                                                                         // 700
            return this;                                                                                               // 701
        }                                                                                                              // 702
                                                                                                                       // 703
        /*_____________________--------------------_____________________*/                                             // 704
                                                                                                                       // 705
        multi_parser = new Parser(); //wrapping functions Parser                                                       // 706
        multi_parser.printer(html_source, indent_character, indent_size, wrap_line_length, brace_style); //initialize starting values
                                                                                                                       // 708
        while (true) {                                                                                                 // 709
            var t = multi_parser.get_token();                                                                          // 710
            multi_parser.token_text = t[0];                                                                            // 711
            multi_parser.token_type = t[1];                                                                            // 712
                                                                                                                       // 713
            if (multi_parser.token_type === 'TK_EOF') {                                                                // 714
                break;                                                                                                 // 715
            }                                                                                                          // 716
                                                                                                                       // 717
            switch (multi_parser.token_type) {                                                                         // 718
                case 'TK_TAG_START':                                                                                   // 719
                    multi_parser.print_newline(false, multi_parser.output);                                            // 720
                    multi_parser.print_token(multi_parser.token_text);                                                 // 721
                    if (multi_parser.indent_content) {                                                                 // 722
                        multi_parser.indent();                                                                         // 723
                        multi_parser.indent_content = false;                                                           // 724
                    }                                                                                                  // 725
                    multi_parser.current_mode = 'CONTENT';                                                             // 726
                    break;                                                                                             // 727
                case 'TK_TAG_STYLE':                                                                                   // 728
                case 'TK_TAG_SCRIPT':                                                                                  // 729
                    multi_parser.print_newline(false, multi_parser.output);                                            // 730
                    multi_parser.print_token(multi_parser.token_text);                                                 // 731
                    multi_parser.current_mode = 'CONTENT';                                                             // 732
                    break;                                                                                             // 733
                case 'TK_TAG_END':                                                                                     // 734
                    //Print new line only if the tag has no content and has child                                      // 735
                    if (multi_parser.last_token === 'TK_CONTENT' && multi_parser.last_text === '') {                   // 736
                        var tag_name = multi_parser.token_text.match(/\w+/)[0];                                        // 737
                        var tag_extracted_from_last_output = null;                                                     // 738
                        if (multi_parser.output.length) {                                                              // 739
                            tag_extracted_from_last_output = multi_parser.output[multi_parser.output.length - 1].match(/(?:<|{{#)\s*(\w+)/);
                        }                                                                                              // 741
                        if (tag_extracted_from_last_output === null ||                                                 // 742
                            tag_extracted_from_last_output[1] !== tag_name) {                                          // 743
                            multi_parser.print_newline(false, multi_parser.output);                                    // 744
                        }                                                                                              // 745
                    }                                                                                                  // 746
                    multi_parser.print_token(multi_parser.token_text);                                                 // 747
                    multi_parser.current_mode = 'CONTENT';                                                             // 748
                    break;                                                                                             // 749
                case 'TK_TAG_SINGLE':                                                                                  // 750
                    // Don't add a newline before elements that should remain unformatted.                             // 751
                    var tag_check = multi_parser.token_text.match(/^\s*<([a-z]+)/i);                                   // 752
                    if (!tag_check || !multi_parser.Utils.in_array(tag_check[1], unformatted)) {                       // 753
                        multi_parser.print_newline(false, multi_parser.output);                                        // 754
                    }                                                                                                  // 755
                    multi_parser.print_token(multi_parser.token_text);                                                 // 756
                    multi_parser.current_mode = 'CONTENT';                                                             // 757
                    break;                                                                                             // 758
                case 'TK_TAG_HANDLEBARS_ELSE':                                                                         // 759
                    multi_parser.print_token(multi_parser.token_text);                                                 // 760
                    if (multi_parser.indent_content) {                                                                 // 761
                        multi_parser.indent();                                                                         // 762
                        multi_parser.indent_content = false;                                                           // 763
                    }                                                                                                  // 764
                    multi_parser.current_mode = 'CONTENT';                                                             // 765
                    break;                                                                                             // 766
                case 'TK_CONTENT':                                                                                     // 767
                    multi_parser.print_token(multi_parser.token_text);                                                 // 768
                    multi_parser.current_mode = 'TAG';                                                                 // 769
                    break;                                                                                             // 770
                case 'TK_STYLE':                                                                                       // 771
                case 'TK_SCRIPT':                                                                                      // 772
                    if (multi_parser.token_text !== '') {                                                              // 773
                        multi_parser.print_newline(false, multi_parser.output);                                        // 774
                        var text = multi_parser.token_text,                                                            // 775
                            _beautifier,                                                                               // 776
                            script_indent_level = 1;                                                                   // 777
                        if (multi_parser.token_type === 'TK_SCRIPT') {                                                 // 778
                            _beautifier = typeof js_beautify === 'function' && js_beautify;                            // 779
                        } else if (multi_parser.token_type === 'TK_STYLE') {                                           // 780
                            _beautifier = typeof css_beautify === 'function' && css_beautify;                          // 781
                        }                                                                                              // 782
                                                                                                                       // 783
                        if (options.indent_scripts === "keep") {                                                       // 784
                            script_indent_level = 0;                                                                   // 785
                        } else if (options.indent_scripts === "separate") {                                            // 786
                            script_indent_level = -multi_parser.indent_level;                                          // 787
                        }                                                                                              // 788
                                                                                                                       // 789
                        var indentation = multi_parser.get_full_indent(script_indent_level);                           // 790
                        if (_beautifier) {                                                                             // 791
                            // call the Beautifier if avaliable                                                        // 792
                            text = _beautifier(text.replace(/^\s*/, indentation), options);                            // 793
                        } else {                                                                                       // 794
                            // simply indent the string otherwise                                                      // 795
                            var white = text.match(/^\s*/)[0];                                                         // 796
                            var _level = white.match(/[^\n\r]*$/)[0].split(multi_parser.indent_string).length - 1;     // 797
                            var reindent = multi_parser.get_full_indent(script_indent_level - _level);                 // 798
                            text = text.replace(/^\s*/, indentation)                                                   // 799
                                .replace(/\r\n|\r|\n/g, '\n' + reindent)                                               // 800
                                .replace(/\s+$/, '');                                                                  // 801
                        }                                                                                              // 802
                        if (text) {                                                                                    // 803
                            multi_parser.print_token_raw(indentation + trim(text));                                    // 804
                            multi_parser.print_newline(false, multi_parser.output);                                    // 805
                        }                                                                                              // 806
                    }                                                                                                  // 807
                    multi_parser.current_mode = 'TAG';                                                                 // 808
                    break;                                                                                             // 809
            }                                                                                                          // 810
            multi_parser.last_token = multi_parser.token_type;                                                         // 811
            multi_parser.last_text = multi_parser.token_text;                                                          // 812
        }                                                                                                              // 813
        return multi_parser.output.join('');                                                                           // 814
    }                                                                                                                  // 815
                                                                                                                       // 816
    if (typeof define === "function" && define.amd) {                                                                  // 817
        // Add support for AMD ( https://github.com/amdjs/amdjs-api/wiki/AMD#defineamd-property- )                     // 818
        define(["require", "./beautify", "./beautify-css"], function(requireamd) {                                     // 819
            var js_beautify =  requireamd("./beautify");                                                               // 820
            var css_beautify =  requireamd("./beautify-css");                                                          // 821
                                                                                                                       // 822
            return {                                                                                                   // 823
              html_beautify: function(html_source, options) {                                                          // 824
                return style_html(html_source, options, js_beautify.js_beautify, css_beautify.css_beautify);           // 825
              }                                                                                                        // 826
            };                                                                                                         // 827
        });                                                                                                            // 828
    } else if (typeof exports !== "undefined") {                                                                       // 829
        // Add support for CommonJS. Just put this file somewhere on your require.paths                                // 830
        // and you will be able to `var html_beautify = require("beautify").html_beautify`.                            // 831
        var js_beautify = require('./beautify.js');                                                                    // 832
        var css_beautify = require('./beautify-css.js');                                                               // 833
                                                                                                                       // 834
        exports.html_beautify = function(html_source, options) {                                                       // 835
            return style_html(html_source, options, js_beautify.js_beautify, css_beautify.css_beautify);               // 836
        };                                                                                                             // 837
    } else if (typeof window !== "undefined") {                                                                        // 838
        // If we're running a web page and don't have either of the above, add our one global                          // 839
        window.html_beautify = function(html_source, options) {                                                        // 840
            return style_html(html_source, options, window.js_beautify, window.css_beautify);                          // 841
        };                                                                                                             // 842
    } else if (typeof global !== "undefined") {                                                                        // 843
        // If we don't even have window, try global.                                                                   // 844
        global.html_beautify = function(html_source, options) {                                                        // 845
            return style_html(html_source, options, global.js_beautify, global.css_beautify);                          // 846
        };                                                                                                             // 847
    }                                                                                                                  // 848
                                                                                                                       // 849
}());                                                                                                                  // 850
                                                                                                                       // 851
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/compatibility/highlight.pack.js                                                            //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
!function(e){"undefined"!=typeof exports?e(exports):(window.hljs=e({}),"function"==typeof define&&define.amd&&define("hljs",[],function(){return window.hljs}))}(function(e){function n(e){return e.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;")}function t(e){return e.nodeName.toLowerCase()}function r(e,n){var t=e&&e.exec(n);return t&&0==t.index}function a(e){return/no-?highlight|plain|text/.test(e)}function i(e){var n,t,r,i=e.className+" ";if(i+=e.parentNode?e.parentNode.className:"",t=/\blang(?:uage)?-([\w-]+)\b/.exec(i))return E(t[1])?t[1]:"no-highlight";for(i=i.split(/\s+/),n=0,r=i.length;r>n;n++)if(E(i[n])||a(i[n]))return i[n]}function o(e,n){var t,r={};for(t in e)r[t]=e[t];if(n)for(t in n)r[t]=n[t];return r}function u(e){var n=[];return function r(e,a){for(var i=e.firstChild;i;i=i.nextSibling)3==i.nodeType?a+=i.nodeValue.length:1==i.nodeType&&(n.push({event:"start",offset:a,node:i}),a=r(i,a),t(i).match(/br|hr|img|input/)||n.push({event:"stop",offset:a,node:i}));return a}(e,0),n}function c(e,r,a){function i(){return e.length&&r.length?e[0].offset!=r[0].offset?e[0].offset<r[0].offset?e:r:"start"==r[0].event?e:r:e.length?e:r}function o(e){function r(e){return" "+e.nodeName+'="'+n(e.value)+'"'}f+="<"+t(e)+Array.prototype.map.call(e.attributes,r).join("")+">"}function u(e){f+="</"+t(e)+">"}function c(e){("start"==e.event?o:u)(e.node)}for(var s=0,f="",l=[];e.length||r.length;){var g=i();if(f+=n(a.substr(s,g[0].offset-s)),s=g[0].offset,g==e){l.reverse().forEach(u);do c(g.splice(0,1)[0]),g=i();while(g==e&&g.length&&g[0].offset==s);l.reverse().forEach(o)}else"start"==g[0].event?l.push(g[0].node):l.pop(),c(g.splice(0,1)[0])}return f+n(a.substr(s))}function s(e){function n(e){return e&&e.source||e}function t(t,r){return new RegExp(n(t),"m"+(e.cI?"i":"")+(r?"g":""))}function r(a,i){if(!a.compiled){if(a.compiled=!0,a.k=a.k||a.bK,a.k){var u={},c=function(n,t){e.cI&&(t=t.toLowerCase()),t.split(" ").forEach(function(e){var t=e.split("|");u[t[0]]=[n,t[1]?Number(t[1]):1]})};"string"==typeof a.k?c("keyword",a.k):Object.keys(a.k).forEach(function(e){c(e,a.k[e])}),a.k=u}a.lR=t(a.l||/\b\w+\b/,!0),i&&(a.bK&&(a.b="\\b("+a.bK.split(" ").join("|")+")\\b"),a.b||(a.b=/\B|\b/),a.bR=t(a.b),a.e||a.eW||(a.e=/\B|\b/),a.e&&(a.eR=t(a.e)),a.tE=n(a.e)||"",a.eW&&i.tE&&(a.tE+=(a.e?"|":"")+i.tE)),a.i&&(a.iR=t(a.i)),void 0===a.r&&(a.r=1),a.c||(a.c=[]);var s=[];a.c.forEach(function(e){e.v?e.v.forEach(function(n){s.push(o(e,n))}):s.push("self"==e?a:e)}),a.c=s,a.c.forEach(function(e){r(e,a)}),a.starts&&r(a.starts,i);var f=a.c.map(function(e){return e.bK?"\\.?("+e.b+")\\.?":e.b}).concat([a.tE,a.i]).map(n).filter(Boolean);a.t=f.length?t(f.join("|"),!0):{exec:function(){return null}}}}r(e)}function f(e,t,a,i){function o(e,n){for(var t=0;t<n.c.length;t++)if(r(n.c[t].bR,e))return n.c[t]}function u(e,n){if(r(e.eR,n)){for(;e.endsParent&&e.parent;)e=e.parent;return e}return e.eW?u(e.parent,n):void 0}function c(e,n){return!a&&r(n.iR,e)}function g(e,n){var t=N.cI?n[0].toLowerCase():n[0];return e.k.hasOwnProperty(t)&&e.k[t]}function h(e,n,t,r){var a=r?"":w.classPrefix,i='<span class="'+a,o=t?"":"</span>";return i+=e+'">',i+n+o}function p(){if(!L.k)return n(B);var e="",t=0;L.lR.lastIndex=0;for(var r=L.lR.exec(B);r;){e+=n(B.substr(t,r.index-t));var a=g(L,r);a?(y+=a[1],e+=h(a[0],n(r[0]))):e+=n(r[0]),t=L.lR.lastIndex,r=L.lR.exec(B)}return e+n(B.substr(t))}function d(){if(L.sL&&!x[L.sL])return n(B);var e=L.sL?f(L.sL,B,!0,M[L.sL]):l(B);return L.r>0&&(y+=e.r),"continuous"==L.subLanguageMode&&(M[L.sL]=e.top),h(e.language,e.value,!1,!0)}function b(){return void 0!==L.sL?d():p()}function v(e,t){var r=e.cN?h(e.cN,"",!0):"";e.rB?(k+=r,B=""):e.eB?(k+=n(t)+r,B=""):(k+=r,B=t),L=Object.create(e,{parent:{value:L}})}function m(e,t){if(B+=e,void 0===t)return k+=b(),0;var r=o(t,L);if(r)return k+=b(),v(r,t),r.rB?0:t.length;var a=u(L,t);if(a){var i=L;i.rE||i.eE||(B+=t),k+=b();do L.cN&&(k+="</span>"),y+=L.r,L=L.parent;while(L!=a.parent);return i.eE&&(k+=n(t)),B="",a.starts&&v(a.starts,""),i.rE?0:t.length}if(c(t,L))throw new Error('Illegal lexeme "'+t+'" for mode "'+(L.cN||"<unnamed>")+'"');return B+=t,t.length||1}var N=E(e);if(!N)throw new Error('Unknown language: "'+e+'"');s(N);var R,L=i||N,M={},k="";for(R=L;R!=N;R=R.parent)R.cN&&(k=h(R.cN,"",!0)+k);var B="",y=0;try{for(var C,j,I=0;;){if(L.t.lastIndex=I,C=L.t.exec(t),!C)break;j=m(t.substr(I,C.index-I),C[0]),I=C.index+j}for(m(t.substr(I)),R=L;R.parent;R=R.parent)R.cN&&(k+="</span>");return{r:y,value:k,language:e,top:L}}catch(O){if(-1!=O.message.indexOf("Illegal"))return{r:0,value:n(t)};throw O}}function l(e,t){t=t||w.languages||Object.keys(x);var r={r:0,value:n(e)},a=r;return t.forEach(function(n){if(E(n)){var t=f(n,e,!1);t.language=n,t.r>a.r&&(a=t),t.r>r.r&&(a=r,r=t)}}),a.language&&(r.second_best=a),r}function g(e){return w.tabReplace&&(e=e.replace(/^((<[^>]+>|\t)+)/gm,function(e,n){return n.replace(/\t/g,w.tabReplace)})),w.useBR&&(e=e.replace(/\n/g,"<br>")),e}function h(e,n,t){var r=n?R[n]:t,a=[e.trim()];return e.match(/\bhljs\b/)||a.push("hljs"),-1===e.indexOf(r)&&a.push(r),a.join(" ").trim()}function p(e){var n=i(e);if(!a(n)){var t;w.useBR?(t=document.createElementNS("http://www.w3.org/1999/xhtml","div"),t.innerHTML=e.innerHTML.replace(/\n/g,"").replace(/<br[ \/]*>/g,"\n")):t=e;var r=t.textContent,o=n?f(n,r,!0):l(r),s=u(t);if(s.length){var p=document.createElementNS("http://www.w3.org/1999/xhtml","div");p.innerHTML=o.value,o.value=c(s,u(p),r)}o.value=g(o.value),e.innerHTML=o.value,e.className=h(e.className,n,o.language),e.result={language:o.language,re:o.r},o.second_best&&(e.second_best={language:o.second_best.language,re:o.second_best.r})}}function d(e){w=o(w,e)}function b(){if(!b.called){b.called=!0;var e=document.querySelectorAll("pre code");Array.prototype.forEach.call(e,p)}}function v(){addEventListener("DOMContentLoaded",b,!1),addEventListener("load",b,!1)}function m(n,t){var r=x[n]=t(e);r.aliases&&r.aliases.forEach(function(e){R[e]=n})}function N(){return Object.keys(x)}function E(e){return x[e]||x[R[e]]}var w={classPrefix:"hljs-",tabReplace:null,useBR:!1,languages:void 0},x={},R={};return e.highlight=f,e.highlightAuto=l,e.fixMarkup=g,e.highlightBlock=p,e.configure=d,e.initHighlighting=b,e.initHighlightingOnLoad=v,e.registerLanguage=m,e.listLanguages=N,e.getLanguage=E,e.inherit=o,e.IR="[a-zA-Z]\\w*",e.UIR="[a-zA-Z_]\\w*",e.NR="\\b\\d+(\\.\\d+)?",e.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",e.BNR="\\b(0b[01]+)",e.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",e.BE={b:"\\\\[\\s\\S]",r:0},e.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[e.BE]},e.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[e.BE]},e.PWM={b:/\b(a|an|the|are|I|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such)\b/},e.C=function(n,t,r){var a=e.inherit({cN:"comment",b:n,e:t,c:[]},r||{});return a.c.push(e.PWM),a.c.push({cN:"doctag",bK:"TODO FIXME NOTE BUG XXX",r:0}),a},e.CLCM=e.C("//","$"),e.CBCM=e.C("/\\*","\\*/"),e.HCM=e.C("#","$"),e.NM={cN:"number",b:e.NR,r:0},e.CNM={cN:"number",b:e.CNR,r:0},e.BNM={cN:"number",b:e.BNR,r:0},e.CSSNM={cN:"number",b:e.NR+"(%|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?",r:0},e.RM={cN:"regexp",b:/\//,e:/\/[gimuy]*/,i:/\n/,c:[e.BE,{b:/\[/,e:/\]/,r:0,c:[e.BE]}]},e.TM={cN:"title",b:e.IR,r:0},e.UTM={cN:"title",b:e.UIR,r:0},e});hljs.registerLanguage("coffeescript",function(e){var c={keyword:"in if for while finally new do return else break catch instanceof throw try this switch continue typeof delete debugger super then unless until loop of by when and or is isnt not",literal:"true false null undefined yes no on off",reserved:"case default function var void with const let enum export import native __hasProp __extends __slice __bind __indexOf",built_in:"npm require console print module global window document"},n="[A-Za-z$_][0-9A-Za-z$_]*",t={cN:"subst",b:/#\{/,e:/}/,k:c},r=[e.BNM,e.inherit(e.CNM,{starts:{e:"(\\s*/)?",r:0}}),{cN:"string",v:[{b:/'''/,e:/'''/,c:[e.BE]},{b:/'/,e:/'/,c:[e.BE]},{b:/"""/,e:/"""/,c:[e.BE,t]},{b:/"/,e:/"/,c:[e.BE,t]}]},{cN:"regexp",v:[{b:"///",e:"///",c:[t,e.HCM]},{b:"//[gim]*",r:0},{b:/\/(?![ *])(\\\/|.)*?\/[gim]*(?=\W|$)/}]},{cN:"property",b:"@"+n},{b:"`",e:"`",eB:!0,eE:!0,sL:"javascript"}];t.c=r;var i=e.inherit(e.TM,{b:n}),s="(\\(.*\\))?\\s*\\B[-=]>",o={cN:"params",b:"\\([^\\(]",rB:!0,c:[{b:/\(/,e:/\)/,k:c,c:["self"].concat(r)}]};return{aliases:["coffee","cson","iced"],k:c,i:/\/\*/,c:r.concat([e.C("###","###"),e.HCM,{cN:"function",b:"^\\s*"+n+"\\s*=\\s*"+s,e:"[-=]>",rB:!0,c:[i,o]},{b:/[:\(,=]\s*/,r:0,c:[{cN:"function",b:s,e:"[-=]>",rB:!0,c:[o]}]},{cN:"class",bK:"class",e:"$",i:/[:="\[\]]/,c:[{bK:"extends",eW:!0,i:/[:="\[\]]/,c:[i]},i]},{cN:"attribute",b:n+":",e:":",rB:!0,rE:!0,r:0}])}});hljs.registerLanguage("cpp",function(t){var e={cN:"keyword",b:"[a-z\\d_]*_t"},r={keyword:"false int float while private char catch export virtual operator sizeof dynamic_cast|10 typedef const_cast|10 const struct for static_cast|10 union namespace unsigned long volatile static protected bool template mutable if public friend do goto auto void enum else break extern using true class asm case typeid short reinterpret_cast|10 default double register explicit signed typename try this switch continue inline delete alignof constexpr decltype noexcept nullptr static_assert thread_local restrict _Bool complex _Complex _Imaginary atomic_bool atomic_char atomic_schar atomic_uchar atomic_short atomic_ushort atomic_int atomic_uint atomic_long atomic_ulong atomic_llong atomic_ullong",built_in:"std string cin cout cerr clog stringstream istringstream ostringstream auto_ptr deque list queue stack vector map set bitset multiset multimap unordered_set unordered_map unordered_multiset unordered_multimap array shared_ptr abort abs acos asin atan2 atan calloc ceil cosh cos exit exp fabs floor fmod fprintf fputs free frexp fscanf isalnum isalpha iscntrl isdigit isgraph islower isprint ispunct isspace isupper isxdigit tolower toupper labs ldexp log10 log malloc memchr memcmp memcpy memset modf pow printf putchar puts scanf sinh sin snprintf sprintf sqrt sscanf strcat strchr strcmp strcpy strcspn strlen strncat strncmp strncpy strpbrk strrchr strspn strstr tanh tan vfprintf vprintf vsprintf"};return{aliases:["c","cc","h","c++","h++","hpp"],k:r,i:"</",c:[e,t.CLCM,t.CBCM,{cN:"string",v:[t.inherit(t.QSM,{b:'((u8?|U)|L)?"'}),{b:'(u8?|U)?R"',e:'"',c:[t.BE]},{b:"'\\\\?.",e:"'",i:"."}]},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},t.CNM,{cN:"preprocessor",b:"#",e:"$",k:"if else elif endif define undef warning error line pragma",c:[{b:/\\\n/,r:0},{b:'include\\s*[<"]',e:'[>"]',k:"include",i:"\\n"},t.CLCM]},{b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:r,c:["self",e]},{b:t.IR+"::",k:r},{bK:"new throw return else",r:0},{cN:"function",b:"("+t.IR+"\\s+)+"+t.IR+"\\s*\\(",rB:!0,e:/[{;=]/,eE:!0,k:r,c:[{b:t.IR+"\\s*\\(",rB:!0,c:[t.TM],r:0},{cN:"params",b:/\(/,e:/\)/,k:r,r:0,c:[t.CBCM]},t.CLCM,t.CBCM]}]}});hljs.registerLanguage("swift",function(e){var i={keyword:"class deinit enum extension func import init let protocol static struct subscript typealias var break case continue default do else fallthrough if in for return switch where while as dynamicType is new super self Self Type __COLUMN__ __FILE__ __FUNCTION__ __LINE__ associativity didSet get infix inout left mutating none nonmutating operator override postfix precedence prefix right set unowned unowned safe unsafe weak willSet",literal:"true false nil",built_in:"abs advance alignof alignofValue assert bridgeFromObjectiveC bridgeFromObjectiveCUnconditional bridgeToObjectiveC bridgeToObjectiveCUnconditional c contains count countElements countLeadingZeros debugPrint debugPrintln distance dropFirst dropLast dump encodeBitsAsWords enumerate equal filter find getBridgedObjectiveCType getVaList indices insertionSort isBridgedToObjectiveC isBridgedVerbatimToObjectiveC isUniquelyReferenced join lexicographicalCompare map max maxElement min minElement numericCast partition posix print println quickSort reduce reflect reinterpretCast reverse roundUpToAlignment sizeof sizeofValue sort split startsWith strideof strideofValue swap swift toString transcode underestimateCount unsafeReflect withExtendedLifetime withObjectAtPlusZero withUnsafePointer withUnsafePointerToObject withUnsafePointers withVaList"},t={cN:"type",b:"\\b[A-Z][\\w']*",r:0},n=e.C("/\\*","\\*/",{c:["self"]}),r={cN:"subst",b:/\\\(/,e:"\\)",k:i,c:[]},s={cN:"number",b:"\\b([\\d_]+(\\.[\\deE_]+)?|0x[a-fA-F0-9_]+(\\.[a-fA-F0-9p_]+)?|0b[01_]+|0o[0-7_]+)\\b",r:0},o=e.inherit(e.QSM,{c:[r,e.BE]});return r.c=[s],{k:i,c:[o,e.CLCM,n,t,s,{cN:"func",bK:"func",e:"{",eE:!0,c:[e.inherit(e.TM,{b:/[A-Za-z$_][0-9A-Za-z$_]*/,i:/\(/}),{cN:"generics",b:/</,e:/>/,i:/>/},{cN:"params",b:/\(/,e:/\)/,endsParent:!0,k:i,c:["self",s,o,e.CBCM,{b:":"}],i:/["']/}],i:/\[|%/},{cN:"class",bK:"struct protocol class extension enum",k:i,e:"\\{",eE:!0,c:[e.inherit(e.TM,{b:/[A-Za-z$_][0-9A-Za-z$_]*/})]},{cN:"preprocessor",b:"(@assignment|@class_protocol|@exported|@final|@lazy|@noreturn|@NSCopying|@NSManaged|@objc|@optional|@required|@auto_closure|@noreturn|@IBAction|@IBDesignable|@IBInspectable|@IBOutlet|@infix|@prefix|@postfix)"}]}});hljs.registerLanguage("python",function(e){var r={cN:"prompt",b:/^(>>>|\.\.\.) /},b={cN:"string",c:[e.BE],v:[{b:/(u|b)?r?'''/,e:/'''/,c:[r],r:10},{b:/(u|b)?r?"""/,e:/"""/,c:[r],r:10},{b:/(u|r|ur)'/,e:/'/,r:10},{b:/(u|r|ur)"/,e:/"/,r:10},{b:/(b|br)'/,e:/'/},{b:/(b|br)"/,e:/"/},e.ASM,e.QSM]},l={cN:"number",r:0,v:[{b:e.BNR+"[lLjJ]?"},{b:"\\b(0o[0-7]+)[lLjJ]?"},{b:e.CNR+"[lLjJ]?"}]},c={cN:"params",b:/\(/,e:/\)/,c:["self",r,l,b]};return{aliases:["py","gyp"],k:{keyword:"and elif is global as in if from raise for except finally print import pass return exec else break not with class assert yield try while continue del or def lambda nonlocal|10 None True False",built_in:"Ellipsis NotImplemented"},i:/(<\/|->|\?)/,c:[r,l,b,e.HCM,{v:[{cN:"function",bK:"def",r:10},{cN:"class",bK:"class"}],e:/:/,i:/[${=;\n,]/,c:[e.UTM,c]},{cN:"decorator",b:/@/,e:/$/},{b:/\b(print|exec)\(/}]}});hljs.registerLanguage("sql",function(e){var t=e.C("--","$");return{cI:!0,i:/[<>]/,c:[{cN:"operator",bK:"begin end start commit rollback savepoint lock alter create drop rename call delete do handler insert load replace select truncate update set show pragma grant merge describe use explain help declare prepare execute deallocate savepoint release unlock purge reset change stop analyze cache flush optimize repair kill install uninstall checksum restore check backup revoke",e:/;/,eW:!0,k:{keyword:"abs absolute acos action add adddate addtime aes_decrypt aes_encrypt after aggregate all allocate alter analyze and any are as asc ascii asin assertion at atan atan2 atn2 authorization authors avg backup before begin benchmark between bin binlog bit_and bit_count bit_length bit_or bit_xor both by cache call cascade cascaded case cast catalog ceil ceiling chain change changed char_length character_length charindex charset check checksum checksum_agg choose close coalesce coercibility collate collation collationproperty column columns columns_updated commit compress concat concat_ws concurrent connect connection connection_id consistent constraint constraints continue contributors conv convert convert_tz corresponding cos cot count count_big crc32 create cross cume_dist curdate current current_date current_time current_timestamp current_user cursor curtime data database databases datalength date_add date_format date_sub dateadd datediff datefromparts datename datepart datetime2fromparts datetimeoffsetfromparts day dayname dayofmonth dayofweek dayofyear deallocate declare decode default deferrable deferred degrees delayed delete des_decrypt des_encrypt des_key_file desc describe descriptor diagnostics difference disconnect distinct distinctrow div do domain double drop dumpfile each else elt enclosed encode encrypt end end-exec engine engines eomonth errors escape escaped event eventdata events except exception exec execute exists exp explain export_set extended external extract fast fetch field fields find_in_set first first_value floor flush for force foreign format found found_rows from from_base64 from_days from_unixtime full function get get_format get_lock getdate getutcdate global go goto grant grants greatest group group_concat grouping grouping_id gtid_subset gtid_subtract handler having help hex high_priority hosts hour ident_current ident_incr ident_seed identified identity if ifnull ignore iif ilike immediate in index indicator inet6_aton inet6_ntoa inet_aton inet_ntoa infile initially inner innodb input insert install instr intersect into is is_free_lock is_ipv4 is_ipv4_compat is_ipv4_mapped is_not is_not_null is_used_lock isdate isnull isolation join key kill language last last_day last_insert_id last_value lcase lead leading least leaves left len lenght level like limit lines ln load load_file local localtime localtimestamp locate lock log log10 log2 logfile logs low_priority lower lpad ltrim make_set makedate maketime master master_pos_wait match matched max md5 medium merge microsecond mid min minute mod mode module month monthname mutex name_const names national natural nchar next no no_write_to_binlog not now nullif nvarchar oct octet_length of old_password on only open optimize option optionally or ord order outer outfile output pad parse partial partition password patindex percent_rank percentile_cont percentile_disc period_add period_diff pi plugin position pow power pragma precision prepare preserve primary prior privileges procedure procedure_analyze processlist profile profiles public publishingservername purge quarter query quick quote quotename radians rand read references regexp relative relaylog release release_lock rename repair repeat replace replicate reset restore restrict return returns reverse revoke right rlike rollback rollup round row row_count rows rpad rtrim savepoint schema scroll sec_to_time second section select serializable server session session_user set sha sha1 sha2 share show sign sin size slave sleep smalldatetimefromparts snapshot some soname soundex sounds_like space sql sql_big_result sql_buffer_result sql_cache sql_calc_found_rows sql_no_cache sql_small_result sql_variant_property sqlstate sqrt square start starting status std stddev stddev_pop stddev_samp stdev stdevp stop str str_to_date straight_join strcmp string stuff subdate substr substring subtime subtring_index sum switchoffset sysdate sysdatetime sysdatetimeoffset system_user sysutcdatetime table tables tablespace tan temporary terminated tertiary_weights then time time_format time_to_sec timediff timefromparts timestamp timestampadd timestampdiff timezone_hour timezone_minute to to_base64 to_days to_seconds todatetimeoffset trailing transaction translation trigger trigger_nestlevel triggers trim truncate try_cast try_convert try_parse ucase uncompress uncompressed_length unhex unicode uninstall union unique unix_timestamp unknown unlock update upgrade upped upper usage use user user_resources using utc_date utc_time utc_timestamp uuid uuid_short validate_password_strength value values var var_pop var_samp variables variance varp version view warnings week weekday weekofyear weight_string when whenever where with work write xml xor year yearweek zon",literal:"true false null",built_in:"array bigint binary bit blob boolean char character date dec decimal float int integer interval number numeric real serial smallint varchar varying int8 serial8 text"},c:[{cN:"string",b:"'",e:"'",c:[e.BE,{b:"''"}]},{cN:"string",b:'"',e:'"',c:[e.BE,{b:'""'}]},{cN:"string",b:"`",e:"`",c:[e.BE]},e.CNM,e.CBCM,t]},e.CBCM,t]}});hljs.registerLanguage("java",function(e){var a=e.UIR+"(<"+e.UIR+">)?",t="false synchronized int abstract float private char boolean static null if const for true while long strictfp finally protected import native final void enum else break transient catch instanceof byte super volatile case assert short package default double public try this switch continue throws protected public private",c="\\b(0[bB]([01]+[01_]+[01]+|[01]+)|0[xX]([a-fA-F0-9]+[a-fA-F0-9_]+[a-fA-F0-9]+|[a-fA-F0-9]+)|(([\\d]+[\\d_]+[\\d]+|[\\d]+)(\\.([\\d]+[\\d_]+[\\d]+|[\\d]+))?|\\.([\\d]+[\\d_]+[\\d]+|[\\d]+))([eE][-+]?\\d+)?)[lLfF]?",r={cN:"number",b:c,r:0};return{aliases:["jsp"],k:t,i:/<\//,c:[e.C("/\\*\\*","\\*/",{r:0,c:[{cN:"doctag",b:"@[A-Za-z]+"}]}),e.CLCM,e.CBCM,e.ASM,e.QSM,{cN:"class",bK:"class interface",e:/[{;=]/,eE:!0,k:"class interface",i:/[:"\[\]]/,c:[{bK:"extends implements"},e.UTM]},{bK:"new throw return else",r:0},{cN:"function",b:"("+a+"\\s+)+"+e.UIR+"\\s*\\(",rB:!0,e:/[{;=]/,eE:!0,k:t,c:[{b:e.UIR+"\\s*\\(",rB:!0,r:0,c:[e.UTM]},{cN:"params",b:/\(/,e:/\)/,k:t,r:0,c:[e.ASM,e.QSM,e.CNM,e.CBCM]},e.CLCM,e.CBCM]},r,{cN:"annotation",b:"@[A-Za-z]+"}]}});hljs.registerLanguage("ruby",function(e){var c="[a-zA-Z_]\\w*[!?=]?|[-+~]\\@|<<|>>|=~|===?|<=>|[<>]=?|\\*\\*|[-/+%^&*~`|]|\\[\\]=?",r="and false then defined module in return redo if BEGIN retry end for true self when next until do begin unless END rescue nil else break undef not super class case require yield alias while ensure elsif or include attr_reader attr_writer attr_accessor",b={cN:"doctag",b:"@[A-Za-z]+"},a={cN:"value",b:"#<",e:">"},n=[e.C("#","$",{c:[b]}),e.C("^\\=begin","^\\=end",{c:[b],r:10}),e.C("^__END__","\\n$")],s={cN:"subst",b:"#\\{",e:"}",k:r},t={cN:"string",c:[e.BE,s],v:[{b:/'/,e:/'/},{b:/"/,e:/"/},{b:/`/,e:/`/},{b:"%[qQwWx]?\\(",e:"\\)"},{b:"%[qQwWx]?\\[",e:"\\]"},{b:"%[qQwWx]?{",e:"}"},{b:"%[qQwWx]?<",e:">"},{b:"%[qQwWx]?/",e:"/"},{b:"%[qQwWx]?%",e:"%"},{b:"%[qQwWx]?-",e:"-"},{b:"%[qQwWx]?\\|",e:"\\|"},{b:/\B\?(\\\d{1,3}|\\x[A-Fa-f0-9]{1,2}|\\u[A-Fa-f0-9]{4}|\\?\S)\b/}]},i={cN:"params",b:"\\(",e:"\\)",k:r},d=[t,a,{cN:"class",bK:"class module",e:"$|;",i:/=/,c:[e.inherit(e.TM,{b:"[A-Za-z_]\\w*(::\\w+)*(\\?|\\!)?"}),{cN:"inheritance",b:"<\\s*",c:[{cN:"parent",b:"("+e.IR+"::)?"+e.IR}]}].concat(n)},{cN:"function",bK:"def",e:" |$|;",r:0,c:[e.inherit(e.TM,{b:c}),i].concat(n)},{cN:"constant",b:"(::)?(\\b[A-Z]\\w*(::)?)+",r:0},{cN:"symbol",b:e.UIR+"(\\!|\\?)?:",r:0},{cN:"symbol",b:":",c:[t,{b:c}],r:0},{cN:"number",b:"(\\b0[0-7_]+)|(\\b0x[0-9a-fA-F_]+)|(\\b[1-9][0-9_]*(\\.[0-9_]+)?)|[0_]\\b",r:0},{cN:"variable",b:"(\\$\\W)|((\\$|\\@\\@?)(\\w+))"},{b:"("+e.RSR+")\\s*",c:[a,{cN:"regexp",c:[e.BE,s],i:/\n/,v:[{b:"/",e:"/[a-z]*"},{b:"%r{",e:"}[a-z]*"},{b:"%r\\(",e:"\\)[a-z]*"},{b:"%r!",e:"![a-z]*"},{b:"%r\\[",e:"\\][a-z]*"}]}].concat(n),r:0}].concat(n);s.c=d,i.c=d;var o="[>?]>",l="[\\w#]+\\(\\w+\\):\\d+:\\d+>",u="(\\w+-)?\\d+\\.\\d+\\.\\d(p\\d+)?[^>]+>",N=[{b:/^\s*=>/,cN:"status",starts:{e:"$",c:d}},{cN:"prompt",b:"^("+o+"|"+l+"|"+u+")",starts:{e:"$",c:d}}];return{aliases:["rb","gemspec","podspec","thor","irb"],k:r,c:n.concat(N).concat(d)}});hljs.registerLanguage("objectivec",function(e){var t={cN:"built_in",b:"(AV|CA|CF|CG|CI|MK|MP|NS|UI)\\w+"},i={keyword:"int float while char export sizeof typedef const struct for union unsigned long volatile static bool mutable if do return goto void enum else break extern asm case short default double register explicit signed typename this switch continue wchar_t inline readonly assign readwrite self @synchronized id typeof nonatomic super unichar IBOutlet IBAction strong weak copy in out inout bycopy byref oneway __strong __weak __block __autoreleasing @private @protected @public @try @property @end @throw @catch @finally @autoreleasepool @synthesize @dynamic @selector @optional @required",literal:"false true FALSE TRUE nil YES NO NULL",built_in:"BOOL dispatch_once_t dispatch_queue_t dispatch_sync dispatch_async dispatch_once"},o=/[a-zA-Z@][a-zA-Z0-9_]*/,n="@interface @class @protocol @implementation";return{aliases:["mm","objc","obj-c"],k:i,l:o,i:"</",c:[t,e.CLCM,e.CBCM,e.CNM,e.QSM,{cN:"string",v:[{b:'@"',e:'"',i:"\\n",c:[e.BE]},{b:"'",e:"[^\\\\]'",i:"[^\\\\][^']"}]},{cN:"preprocessor",b:"#",e:"$",c:[{cN:"title",v:[{b:'"',e:'"'},{b:"<",e:">"}]}]},{cN:"class",b:"("+n.split(" ").join("|")+")\\b",e:"({|$)",eE:!0,k:n,l:o,c:[e.UTM]},{cN:"variable",b:"\\."+e.UIR,r:0}]}});hljs.registerLanguage("javascript",function(e){return{aliases:["js"],k:{keyword:"in of if for while finally var new function do return void else break catch instanceof with throw case default try this switch continue typeof delete let yield const export super debugger as async await",literal:"true false null undefined NaN Infinity",built_in:"eval isFinite isNaN parseFloat parseInt decodeURI decodeURIComponent encodeURI encodeURIComponent escape unescape Object Function Boolean Error EvalError InternalError RangeError ReferenceError StopIteration SyntaxError TypeError URIError Number Math Date String RegExp Array Float32Array Float64Array Int16Array Int32Array Int8Array Uint16Array Uint32Array Uint8Array Uint8ClampedArray ArrayBuffer DataView JSON Intl arguments require module console window document Symbol Set Map WeakSet WeakMap Proxy Reflect Promise"},c:[{cN:"pi",r:10,b:/^\s*['"]use (strict|asm)['"]/},e.ASM,e.QSM,{cN:"string",b:"`",e:"`",c:[e.BE,{cN:"subst",b:"\\$\\{",e:"\\}"}]},e.CLCM,e.CBCM,{cN:"number",v:[{b:"\\b(0[bB][01]+)"},{b:"\\b(0[oO][0-7]+)"},{b:e.CNR}],r:0},{b:"("+e.RSR+"|\\b(case|return|throw)\\b)\\s*",k:"return throw case",c:[e.CLCM,e.CBCM,e.RM,{b:/</,e:/>\s*[);\]]/,r:0,sL:"xml"}],r:0},{cN:"function",bK:"function",e:/\{/,eE:!0,c:[e.inherit(e.TM,{b:/[A-Za-z$_][0-9A-Za-z$_]*/}),{cN:"params",b:/\(/,e:/\)/,eB:!0,eE:!0,c:[e.CLCM,e.CBCM],i:/["'\(]/}],i:/\[|%/},{b:/\$[(.]/},{b:"\\."+e.IR,r:0},{bK:"import",e:"[;$]",k:"import from as",c:[e.ASM,e.QSM]},{cN:"class",bK:"class",e:/[{;=]/,eE:!0,i:/[:"\[\]]/,c:[{bK:"extends"},e.UTM]}]}});hljs.registerLanguage("nginx",function(e){var r={cN:"variable",v:[{b:/\$\d+/},{b:/\$\{/,e:/}/},{b:"[\\$\\@]"+e.UIR}]},b={eW:!0,l:"[a-z/_]+",k:{built_in:"on off yes no true false none blocked debug info notice warn error crit select break last permanent redirect kqueue rtsig epoll poll /dev/poll"},r:0,i:"=>",c:[e.HCM,{cN:"string",c:[e.BE,r],v:[{b:/"/,e:/"/},{b:/'/,e:/'/}]},{cN:"url",b:"([a-z]+):/",e:"\\s",eW:!0,eE:!0,c:[r]},{cN:"regexp",c:[e.BE,r],v:[{b:"\\s\\^",e:"\\s|{|;",rE:!0},{b:"~\\*?\\s+",e:"\\s|{|;",rE:!0},{b:"\\*(\\.[a-z\\-]+)+"},{b:"([a-z\\-]+\\.)+\\*"}]},{cN:"number",b:"\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}(:\\d{1,5})?\\b"},{cN:"number",b:"\\b\\d+[kKmMgGdshdwy]*\\b",r:0},r]};return{aliases:["nginxconf"],c:[e.HCM,{b:e.UIR+"\\s",e:";|{",rB:!0,c:[{cN:"title",b:e.UIR,starts:b}],r:0}],i:"[^\\s\\}]"}});hljs.registerLanguage("markdown",function(e){return{aliases:["md","mkdown","mkd"],c:[{cN:"header",v:[{b:"^#{1,6}",e:"$"},{b:"^.+?\\n[=-]{2,}$"}]},{b:"<",e:">",sL:"xml",r:0},{cN:"bullet",b:"^([*+-]|(\\d+\\.))\\s+"},{cN:"strong",b:"[*_]{2}.+?[*_]{2}"},{cN:"emphasis",v:[{b:"\\*.+?\\*"},{b:"_.+?_",r:0}]},{cN:"blockquote",b:"^>\\s+",e:"$"},{cN:"code",v:[{b:"`.+?`"},{b:"^( {4}|	)",e:"$",r:0}]},{cN:"horizontal_rule",b:"^[-\\*]{3,}",e:"$"},{b:"\\[.+?\\][\\(\\[].*?[\\)\\]]",rB:!0,c:[{cN:"link_label",b:"\\[",e:"\\]",eB:!0,rE:!0,r:0},{cN:"link_url",b:"\\]\\(",e:"\\)",eB:!0,eE:!0},{cN:"link_reference",b:"\\]\\[",e:"\\]",eB:!0,eE:!0}],r:10},{b:"^\\[.+\\]:",rB:!0,c:[{cN:"link_reference",b:"\\[",e:"\\]:",eB:!0,eE:!0,starts:{cN:"link_url",e:"$"}}]}]}});hljs.registerLanguage("json",function(e){var t={literal:"true false null"},i=[e.QSM,e.CNM],l={cN:"value",e:",",eW:!0,eE:!0,c:i,k:t},c={b:"{",e:"}",c:[{cN:"attribute",b:'\\s*"',e:'"\\s*:\\s*',eB:!0,eE:!0,c:[e.BE],i:"\\n",starts:l}],i:"\\S"},n={b:"\\[",e:"\\]",c:[e.inherit(l,{cN:null})],i:"\\S"};return i.splice(i.length,0,c,n),{c:i,k:t,i:"\\S"}});hljs.registerLanguage("php",function(e){var c={cN:"variable",b:"\\$+[a-zA-Z_-][a-zA-Z0-9_-]*"},a={cN:"preprocessor",b:/<\?(php)?|\?>/},i={cN:"string",c:[e.BE,a],v:[{b:'b"',e:'"'},{b:"b'",e:"'"},e.inherit(e.ASM,{i:null}),e.inherit(e.QSM,{i:null})]},n={v:[e.BNM,e.CNM]};return{aliases:["php3","php4","php5","php6"],cI:!0,k:"and include_once list abstract global private echo interface as static endswitch array null if endwhile or const for endforeach self var while isset public protected exit foreach throw elseif include __FILE__ empty require_once do xor return parent clone use __CLASS__ __LINE__ else break print eval new catch __METHOD__ case exception default die require __FUNCTION__ enddeclare final try switch continue endfor endif declare unset true false trait goto instanceof insteadof __DIR__ __NAMESPACE__ yield finally",c:[e.CLCM,e.HCM,e.C("/\\*","\\*/",{c:[{cN:"doctag",b:"@[A-Za-z]+"},a]}),e.C("__halt_compiler.+?;",!1,{eW:!0,k:"__halt_compiler",l:e.UIR}),{cN:"string",b:"<<<['\"]?\\w+['\"]?$",e:"^\\w+;",c:[e.BE]},a,c,{b:/(::|->)+[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*/},{cN:"function",bK:"function",e:/[;{]/,eE:!0,i:"\\$|\\[|%",c:[e.UTM,{cN:"params",b:"\\(",e:"\\)",c:["self",c,e.CBCM,i,n]}]},{cN:"class",bK:"class interface",e:"{",eE:!0,i:/[:\(\$"]/,c:[{bK:"extends implements"},e.UTM]},{bK:"namespace",e:";",i:/[\.']/,c:[e.UTM]},{bK:"use",e:";",c:[e.UTM]},{b:"=>"},i,n]}});hljs.registerLanguage("diff",function(e){return{aliases:["patch"],c:[{cN:"chunk",r:10,v:[{b:/^@@ +\-\d+,\d+ +\+\d+,\d+ +@@$/},{b:/^\*\*\* +\d+,\d+ +\*\*\*\*$/},{b:/^\-\-\- +\d+,\d+ +\-\-\-\-$/}]},{cN:"header",v:[{b:/Index: /,e:/$/},{b:/=====/,e:/=====$/},{b:/^\-\-\-/,e:/$/},{b:/^\*{3} /,e:/$/},{b:/^\+\+\+/,e:/$/},{b:/\*{5}/,e:/\*{5}$/}]},{cN:"addition",b:"^\\+",e:"$"},{cN:"deletion",b:"^\\-",e:"$"},{cN:"change",b:"^\\!",e:"$"}]}});hljs.registerLanguage("apache",function(e){var r={cN:"number",b:"[\\$%]\\d+"};return{aliases:["apacheconf"],cI:!0,c:[e.HCM,{cN:"tag",b:"</?",e:">"},{cN:"keyword",b:/\w+/,r:0,k:{common:"order deny allow setenv rewriterule rewriteengine rewritecond documentroot sethandler errordocument loadmodule options header listen serverroot servername"},starts:{e:/$/,r:0,k:{literal:"on off all"},c:[{cN:"sqbracket",b:"\\s\\[",e:"\\]$"},{cN:"cbracket",b:"[\\$%]\\{",e:"\\}",c:["self",r]},r,e.QSM]}}],i:/\S/}});hljs.registerLanguage("http",function(t){return{aliases:["https"],i:"\\S",c:[{cN:"status",b:"^HTTP/[0-9\\.]+",e:"$",c:[{cN:"number",b:"\\b\\d{3}\\b"}]},{cN:"request",b:"^[A-Z]+ (.*?) HTTP/[0-9\\.]+$",rB:!0,e:"$",c:[{cN:"string",b:" ",e:" ",eB:!0,eE:!0}]},{cN:"attribute",b:"^\\w",e:": ",eE:!0,i:"\\n|\\s|=",starts:{cN:"string",e:"$"}},{b:"\\n\\n",starts:{sL:"",eW:!0}}]}});hljs.registerLanguage("css",function(e){var c="[a-zA-Z-][a-zA-Z0-9_-]*",a={cN:"function",b:c+"\\(",rB:!0,eE:!0,e:"\\("},r={cN:"rule",b:/[A-Z\_\.\-]+\s*:/,rB:!0,e:";",eW:!0,c:[{cN:"attribute",b:/\S/,e:":",eE:!0,starts:{cN:"value",eW:!0,eE:!0,c:[a,e.CSSNM,e.QSM,e.ASM,e.CBCM,{cN:"hexcolor",b:"#[0-9A-Fa-f]+"},{cN:"important",b:"!important"}]}}]};return{cI:!0,i:/[=\/|'\$]/,c:[e.CBCM,r,{cN:"id",b:/\#[A-Za-z0-9_-]+/},{cN:"class",b:/\.[A-Za-z0-9_-]+/},{cN:"attr_selector",b:/\[/,e:/\]/,i:"$"},{cN:"pseudo",b:/:(:)?[a-zA-Z0-9\_\-\+\(\)"']+/},{cN:"at_rule",b:"@(font-face|page)",l:"[a-z-]+",k:"font-face page"},{cN:"at_rule",b:"@",e:"[{;]",c:[{cN:"keyword",b:/\S+/},{b:/\s/,eW:!0,eE:!0,r:0,c:[a,e.ASM,e.QSM,e.CSSNM]}]},{cN:"tag",b:c,r:0},{cN:"rules",b:"{",e:"}",i:/\S/,c:[e.CBCM,r]}]}});hljs.registerLanguage("cs",function(e){var r="abstract as base bool break byte case catch char checked const continue decimal dynamic default delegate do double else enum event explicit extern false finally fixed float for foreach goto if implicit in int interface internal is lock long null when object operator out override params private protected public readonly ref sbyte sealed short sizeof stackalloc static string struct switch this true try typeof uint ulong unchecked unsafe ushort using virtual volatile void while async protected public private internal ascending descending from get group into join let orderby partial select set value var where yield",t=e.IR+"(<"+e.IR+">)?";return{aliases:["csharp"],k:r,i:/::/,c:[e.C("///","$",{rB:!0,c:[{cN:"xmlDocTag",v:[{b:"///",r:0},{b:"<!--|-->"},{b:"</?",e:">"}]}]}),e.CLCM,e.CBCM,{cN:"preprocessor",b:"#",e:"$",k:"if else elif endif define undef warning error line region endregion pragma checksum"},{cN:"string",b:'@"',e:'"',c:[{b:'""'}]},e.ASM,e.QSM,e.CNM,{bK:"class interface",e:/[{;=]/,i:/[^\s:]/,c:[e.TM,e.CLCM,e.CBCM]},{bK:"namespace",e:/[{;=]/,i:/[^\s:]/,c:[{cN:"title",b:"[a-zA-Z](\\.?\\w)*",r:0},e.CLCM,e.CBCM]},{bK:"new return throw await",r:0},{cN:"function",b:"("+t+"\\s+)+"+e.IR+"\\s*\\(",rB:!0,e:/[{;=]/,eE:!0,k:r,c:[{b:e.IR+"\\s*\\(",rB:!0,c:[e.TM],r:0},{cN:"params",b:/\(/,e:/\)/,eB:!0,eE:!0,k:r,r:0,c:[e.ASM,e.QSM,e.CNM,e.CBCM]},e.CLCM,e.CBCM]}]}});hljs.registerLanguage("xml",function(t){var e="[A-Za-z0-9\\._:-]+",s={b:/<\?(php)?(?!\w)/,e:/\?>/,sL:"php",subLanguageMode:"continuous"},c={eW:!0,i:/</,r:0,c:[s,{cN:"attribute",b:e,r:0},{b:"=",r:0,c:[{cN:"value",c:[s],v:[{b:/"/,e:/"/},{b:/'/,e:/'/},{b:/[^\s\/>]+/}]}]}]};return{aliases:["html","xhtml","rss","atom","xsl","plist"],cI:!0,c:[{cN:"doctype",b:"<!DOCTYPE",e:">",r:10,c:[{b:"\\[",e:"\\]"}]},t.C("<!--","-->",{r:10}),{cN:"cdata",b:"<\\!\\[CDATA\\[",e:"\\]\\]>",r:10},{cN:"tag",b:"<style(?=\\s|>|$)",e:">",k:{title:"style"},c:[c],starts:{e:"</style>",rE:!0,sL:"css"}},{cN:"tag",b:"<script(?=\\s|>|$)",e:">",k:{title:"script"},c:[c],starts:{e:"</script>",rE:!0,sL:""}},s,{cN:"pi",b:/<\?\w+/,e:/\?>/,r:10},{cN:"tag",b:"</?",e:"/?>",c:[{cN:"title",b:/[^ \/><\n\t]+/,r:0},c]}]}});hljs.registerLanguage("makefile",function(e){var a={cN:"variable",b:/\$\(/,e:/\)/,c:[e.BE]};return{aliases:["mk","mak"],c:[e.HCM,{b:/^\w+\s*\W*=/,rB:!0,r:0,starts:{cN:"constant",e:/\s*\W*=/,eE:!0,starts:{e:/$/,r:0,c:[a]}}},{cN:"title",b:/^[\w]+:\s*$/},{cN:"phony",b:/^\.PHONY:/,e:/$/,k:".PHONY",l:/[\.\w]+/},{b:/^\t+/,e:/$/,r:0,c:[e.QSM,a]}]}});hljs.registerLanguage("ini",function(e){return{cI:!0,i:/\S/,c:[e.C(";","$"),{cN:"title",b:"^\\[",e:"\\]"},{cN:"setting",b:"^[a-z0-9\\[\\]_-]+[ \\t]*=[ \\t]*",e:"$",c:[{cN:"value",eW:!0,k:"on off true false yes no",c:[e.QSM,e.NM],r:0}]}]}});hljs.registerLanguage("perl",function(e){var t="getpwent getservent quotemeta msgrcv scalar kill dbmclose undef lc ma syswrite tr send umask sysopen shmwrite vec qx utime local oct semctl localtime readpipe do return format read sprintf dbmopen pop getpgrp not getpwnam rewinddir qqfileno qw endprotoent wait sethostent bless s|0 opendir continue each sleep endgrent shutdown dump chomp connect getsockname die socketpair close flock exists index shmgetsub for endpwent redo lstat msgctl setpgrp abs exit select print ref gethostbyaddr unshift fcntl syscall goto getnetbyaddr join gmtime symlink semget splice x|0 getpeername recv log setsockopt cos last reverse gethostbyname getgrnam study formline endhostent times chop length gethostent getnetent pack getprotoent getservbyname rand mkdir pos chmod y|0 substr endnetent printf next open msgsnd readdir use unlink getsockopt getpriority rindex wantarray hex system getservbyport endservent int chr untie rmdir prototype tell listen fork shmread ucfirst setprotoent else sysseek link getgrgid shmctl waitpid unpack getnetbyname reset chdir grep split require caller lcfirst until warn while values shift telldir getpwuid my getprotobynumber delete and sort uc defined srand accept package seekdir getprotobyname semop our rename seek if q|0 chroot sysread setpwent no crypt getc chown sqrt write setnetent setpriority foreach tie sin msgget map stat getlogin unless elsif truncate exec keys glob tied closedirioctl socket readlink eval xor readline binmode setservent eof ord bind alarm pipe atan2 getgrent exp time push setgrent gt lt or ne m|0 break given say state when",r={cN:"subst",b:"[$@]\\{",e:"\\}",k:t},s={b:"->{",e:"}"},n={cN:"variable",v:[{b:/\$\d/},{b:/[\$%@](\^\w\b|#\w+(::\w+)*|{\w+}|\w+(::\w*)*)/},{b:/[\$%@][^\s\w{]/,r:0}]},i=e.C("^(__END__|__DATA__)","\\n$",{r:5}),o=[e.BE,r,n],a=[n,e.HCM,i,e.C("^\\=\\w","\\=cut",{eW:!0}),s,{cN:"string",c:o,v:[{b:"q[qwxr]?\\s*\\(",e:"\\)",r:5},{b:"q[qwxr]?\\s*\\[",e:"\\]",r:5},{b:"q[qwxr]?\\s*\\{",e:"\\}",r:5},{b:"q[qwxr]?\\s*\\|",e:"\\|",r:5},{b:"q[qwxr]?\\s*\\<",e:"\\>",r:5},{b:"qw\\s+q",e:"q",r:5},{b:"'",e:"'",c:[e.BE]},{b:'"',e:'"'},{b:"`",e:"`",c:[e.BE]},{b:"{\\w+}",c:[],r:0},{b:"-?\\w+\\s*\\=\\>",c:[],r:0}]},{cN:"number",b:"(\\b0[0-7_]+)|(\\b0x[0-9a-fA-F_]+)|(\\b[1-9][0-9_]*(\\.[0-9_]+)?)|[0_]\\b",r:0},{b:"(\\/\\/|"+e.RSR+"|\\b(split|return|print|reverse|grep)\\b)\\s*",k:"split return print reverse grep",r:0,c:[e.HCM,i,{cN:"regexp",b:"(s|tr|y)/(\\\\.|[^/])*/(\\\\.|[^/])*/[a-z]*",r:10},{cN:"regexp",b:"(m|qr)?/",e:"/[a-z]*",c:[e.BE],r:0}]},{cN:"sub",bK:"sub",e:"(\\s*\\(.*?\\))?[;{]",r:5},{cN:"operator",b:"-\\w\\b",r:0}];return r.c=a,s.c=a,{aliases:["pl"],k:t,c:a}});hljs.registerLanguage("bash",function(e){var t={cN:"variable",v:[{b:/\$[\w\d#@][\w\d_]*/},{b:/\$\{(.*?)}/}]},s={cN:"string",b:/"/,e:/"/,c:[e.BE,t,{cN:"variable",b:/\$\(/,e:/\)/,c:[e.BE]}]},a={cN:"string",b:/'/,e:/'/};return{aliases:["sh","zsh"],l:/-?[a-z\.]+/,k:{keyword:"if then else elif fi for while in do done case esac function",literal:"true false",built_in:"break cd continue eval exec exit export getopts hash pwd readonly return shift test times trap umask unset alias bind builtin caller command declare echo enable help let local logout mapfile printf read readarray source type typeset ulimit unalias set shopt autoload bg bindkey bye cap chdir clone comparguments compcall compctl compdescribe compfiles compgroups compquote comptags comptry compvalues dirs disable disown echotc echoti emulate fc fg float functions getcap getln history integer jobs kill limit log noglob popd print pushd pushln rehash sched setcap setopt stat suspend ttyctl unfunction unhash unlimit unsetopt vared wait whence where which zcompile zformat zftp zle zmodload zparseopts zprof zpty zregexparse zsocket zstyle ztcp",operator:"-ne -eq -lt -gt -f -d -e -s -l -a"},c:[{cN:"shebang",b:/^#![^\n]+sh\s*$/,r:10},{cN:"function",b:/\w[\w\d_]*\s*\(\s*\)\s*\{/,rB:!0,c:[e.inherit(e.TM,{b:/\w[\w\d_]*/})],r:0},e.HCM,e.NM,s,a,t]}});
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/views/template.404.js                                                                      //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
                                                                                                                       // 1
Template.__checkName("blogNotFound");                                                                                  // 2
Template["blogNotFound"] = new Template("Template.blogNotFound", (function() {                                         // 3
  var view = this;                                                                                                     // 4
  return "";                                                                                                           // 5
}));                                                                                                                   // 6
                                                                                                                       // 7
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/views/template.custom.js                                                                   //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
                                                                                                                       // 1
Template.__checkName("custom");                                                                                        // 2
Template["custom"] = new Template("Template.custom", (function() {                                                     // 3
  var view = this;                                                                                                     // 4
  return Blaze._TemplateWith(function() {                                                                              // 5
    return {                                                                                                           // 6
      template: Spacebars.call(view.lookup("template"))                                                                // 7
    };                                                                                                                 // 8
  }, function() {                                                                                                      // 9
    return Spacebars.include(function() {                                                                              // 10
      return Spacebars.call(Template.__dynamic);                                                                       // 11
    });                                                                                                                // 12
  });                                                                                                                  // 13
}));                                                                                                                   // 14
                                                                                                                       // 15
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/views/custom.coffee.js                                                                     //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
Template.custom.helpers({
  template: function() {
    var name;
    name = Router.current().route.getName();
    if (name === 'blogTagged') {
      name = 'blogIndex';
    }
    if (Blog.settings["" + name + "Template"]) {
      return Blog.settings["" + name + "Template"];
    }
    return name;
  }
});
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/views/admin/template.admin.js                                                              //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
                                                                                                                       // 1
Template.__checkName("blogAdmin");                                                                                     // 2
Template["blogAdmin"] = new Template("Template.blogAdmin", (function() {                                               // 3
  var view = this;                                                                                                     // 4
  return HTML.DIV({                                                                                                    // 5
    id: "blog-admin"                                                                                                   // 6
  }, "\n    ", HTML.DIV({                                                                                              // 7
    "class": "container blog-admin-index"                                                                              // 8
  }, "\n      ", HTML.Raw('<div class="row">\n        <div class="col-md-3">\n          <h1>Blog Admin</h1>\n        </div>\n        <div class="col-md-9">\n          <a href="#" class="for-new-blog btn btn-default">\n            <i class="fa fa-plus"></i> Add Blog Post\n          </a>\n          <select class="for-filtering form-control">\n            <option value="all">All Posts</option>\n            <option value="mine">My Posts</option>\n          </select>\n        </div>\n      </div>'), "\n      ", HTML.DIV({
    "class": "row"                                                                                                     // 10
  }, "\n        ", HTML.DIV({                                                                                          // 11
    "class": "col-md-12"                                                                                               // 12
  }, "\n          ", Blaze.If(function() {                                                                             // 13
    return Spacebars.call(view.lookup("posts"));                                                                       // 14
  }, function() {                                                                                                      // 15
    return [ "\n            ", Blaze._TemplateWith(function() {                                                        // 16
      return {                                                                                                         // 17
        collection: Spacebars.call(view.lookup("posts")),                                                              // 18
        settings: Spacebars.call(view.lookup("table"))                                                                 // 19
      };                                                                                                               // 20
    }, function() {                                                                                                    // 21
      return Spacebars.include(view.lookupTemplate("reactiveTable"));                                                  // 22
    }), "\n          " ];                                                                                              // 23
  }, function() {                                                                                                      // 24
    return [ "\n            ", HTML.A({                                                                                // 25
      href: "#",                                                                                                       // 26
      "class": "for-new-blog"                                                                                          // 27
    }, "Create the first blog"), "\n          " ];                                                                     // 28
  }), "\n        "), "\n      "), "\n    "), "\n  ");                                                                  // 29
}));                                                                                                                   // 30
                                                                                                                       // 31
Template.__checkName("blogAdminTitleColumn");                                                                          // 32
Template["blogAdminTitleColumn"] = new Template("Template.blogAdminTitleColumn", (function() {                         // 33
  var view = this;                                                                                                     // 34
  return [ HTML.H4(HTML.A({                                                                                            // 35
    target: "_blank",                                                                                                  // 36
    href: function() {                                                                                                 // 37
      return Spacebars.mustache(view.lookup("pathFor"), "blogShow");                                                   // 38
    }                                                                                                                  // 39
  }, Blaze.View("lookup:title", function() {                                                                           // 40
    return Spacebars.mustache(view.lookup("title"));                                                                   // 41
  }))), "\n  ", HTML.P(Blaze.View("lookup:excerpt", function() {                                                       // 42
    return Spacebars.makeRaw(Spacebars.mustache(view.lookup("excerpt")));                                              // 43
  })) ];                                                                                                               // 44
}));                                                                                                                   // 45
                                                                                                                       // 46
Template.__checkName("blogAdminAuthorColumn");                                                                         // 47
Template["blogAdminAuthorColumn"] = new Template("Template.blogAdminAuthorColumn", (function() {                       // 48
  var view = this;                                                                                                     // 49
  return Blaze.View("lookup:authorName", function() {                                                                  // 50
    return Spacebars.mustache(view.lookup("authorName"));                                                              // 51
  });                                                                                                                  // 52
}));                                                                                                                   // 53
                                                                                                                       // 54
Template.__checkName("blogAdminUpdatedColumn");                                                                        // 55
Template["blogAdminUpdatedColumn"] = new Template("Template.blogAdminUpdatedColumn", (function() {                     // 56
  var view = this;                                                                                                     // 57
  return Blaze.View("lookup:blogFormatDate", function() {                                                              // 58
    return Spacebars.mustache(view.lookup("blogFormatDate"), view.lookup("updatedAt"));                                // 59
  });                                                                                                                  // 60
}));                                                                                                                   // 61
                                                                                                                       // 62
Template.__checkName("blogAdminPublishedColumn");                                                                      // 63
Template["blogAdminPublishedColumn"] = new Template("Template.blogAdminPublishedColumn", (function() {                 // 64
  var view = this;                                                                                                     // 65
  return Blaze.If(function() {                                                                                         // 66
    return Spacebars.call(view.lookup("published"));                                                                   // 67
  }, function() {                                                                                                      // 68
    return [ "\n    ", Blaze.View("lookup:blogFormatDate", function() {                                                // 69
      return Spacebars.mustache(view.lookup("blogFormatDate"), view.lookup("publishedAt"));                            // 70
    }), "\n  " ];                                                                                                      // 71
  }, function() {                                                                                                      // 72
    return [ "\n    ", HTML.I({                                                                                        // 73
      "class": "fa fa-ban"                                                                                             // 74
    }), "\n  " ];                                                                                                      // 75
  });                                                                                                                  // 76
}));                                                                                                                   // 77
                                                                                                                       // 78
Template.__checkName("blogAdminStatusColumn");                                                                         // 79
Template["blogAdminStatusColumn"] = new Template("Template.blogAdminStatusColumn", (function() {                       // 80
  var view = this;                                                                                                     // 81
  return Blaze.If(function() {                                                                                         // 82
    return Spacebars.call(view.lookup("published"));                                                                   // 83
  }, function() {                                                                                                      // 84
    return [ "\n    ", HTML.A({                                                                                        // 85
      "class": "for-unpublish",                                                                                        // 86
      href: "#"                                                                                                        // 87
    }, "Draft"), " | ", HTML.SPAN({                                                                                    // 88
      "class": "selected"                                                                                              // 89
    }, "Published"), "\n  " ];                                                                                         // 90
  }, function() {                                                                                                      // 91
    return [ "\n    ", HTML.SPAN({                                                                                     // 92
      "class": "selected"                                                                                              // 93
    }, "Draft"), " | ", HTML.A({                                                                                       // 94
      "class": "for-publish",                                                                                          // 95
      href: "#"                                                                                                        // 96
    }, "Published"), "\n  " ];                                                                                         // 97
  });                                                                                                                  // 98
}));                                                                                                                   // 99
                                                                                                                       // 100
Template.__checkName("blogAdminEditColumn");                                                                           // 101
Template["blogAdminEditColumn"] = new Template("Template.blogAdminEditColumn", (function() {                           // 102
  var view = this;                                                                                                     // 103
  return HTML.A({                                                                                                      // 104
    href: function() {                                                                                                 // 105
      return Spacebars.mustache(view.lookup("pathFor"), "blogAdminEdit");                                              // 106
    }                                                                                                                  // 107
  }, HTML.Raw('<i class="fa fa-edit"></i>'));                                                                          // 108
}));                                                                                                                   // 109
                                                                                                                       // 110
Template.__checkName("blogAdminDeleteColumn");                                                                         // 111
Template["blogAdminDeleteColumn"] = new Template("Template.blogAdminDeleteColumn", (function() {                       // 112
  var view = this;                                                                                                     // 113
  return HTML.Raw('<a href="#" class="delete"><i class="fa fa-trash-o"></i></a>');                                     // 114
}));                                                                                                                   // 115
                                                                                                                       // 116
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/views/admin/admin.coffee.js                                                                //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
Template.blogAdmin.rendered = function() {
  return $(this.find('.reactive-table')).addClass('table-bordered');
};

Template.blogAdmin.helpers({
  posts: function() {
    var results;
    results = Post.all({
      sort: {
        updatedAt: -1
      }
    }).toArray();
    if (_.size(Session.get('filters'))) {
      results = _(results).where(Session.get('filters'));
    }
    return results;
  },
  table: function() {
    return {
      rowsPerPage: 20,
      showFilter: false,
      showNavigation: 'auto',
      useFontAwesome: true,
      fields: [
        {
          key: 'title',
          label: 'Title',
          tmpl: Template.blogAdminTitleColumn
        }, {
          key: 'userId',
          label: 'Author',
          tmpl: Template.blogAdminAuthorColumn
        }, {
          key: 'updatedAt',
          label: 'Updated At',
          tmpl: Template.blogAdminUpdatedColumn,
          sort: 'descending',
          sortByValue: true
        }, {
          key: 'publishedAt',
          label: 'Published At',
          tmpl: Template.blogAdminPublishedColumn,
          sortByValue: true
        }, {
          key: 'published',
          label: 'Status',
          tmpl: Template.blogAdminStatusColumn
        }, {
          key: 'id',
          label: 'Edit',
          tmpl: Template.blogAdminEditColumn
        }, {
          key: 'id',
          label: 'Delete',
          tmpl: Template.blogAdminDeleteColumn
        }
      ]
    };
  }
});

Template.blogAdmin.events({
  'click .for-new-blog': function(e, tpl) {
    e.preventDefault();
    return Router.go('blogAdminEdit', {
      id: Random.id()
    });
  },
  'change .for-filtering': function(e) {
    var filters;
    e.preventDefault();
    filters = {};
    if ($(e.currentTarget).val() === 'mine') {
      filters.userId = Meteor.userId();
    }
    return Session.set('filters', filters);
  }
});

Template.blogAdminStatusColumn.events({
  'click .for-publish': function(e, tpl) {
    e.preventDefault();
    return this.update({
      published: true,
      publishedAt: new Date()
    });
  },
  'click .for-unpublish': function(e, tpl) {
    e.preventDefault();
    return this.update({
      published: false,
      publishedAt: null
    });
  }
});

Template.blogAdminDeleteColumn.events({
  'click .delete': function(e, tpl) {
    e.preventDefault();
    if (confirm('Are you sure?')) {
      return $(e.currentTarget).parents('tr').fadeOut((function(_this) {
        return function() {
          return _this.destroy();
        };
      })(this));
    }
  }
});
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/views/admin/template.edit.js                                                               //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
                                                                                                                       // 1
Template.__checkName("blogAdminEdit");                                                                                 // 2
Template["blogAdminEdit"] = new Template("Template.blogAdminEdit", (function() {                                       // 3
  var view = this;                                                                                                     // 4
  return [ Spacebars.include(view.lookupTemplate("notifications")), "\n  ", HTML.DIV({                                 // 5
    id: "blog-admin"                                                                                                   // 6
  }, "\n    ", HTML.DIV({                                                                                              // 7
    "class": "container blog-admin-edit"                                                                               // 8
  }, "\n      ", HTML.DIV({                                                                                            // 9
    "class": "row"                                                                                                     // 10
  }, "\n        ", HTML.DIV({                                                                                          // 11
    "class": "col-md-8 col-md-offset-2"                                                                                // 12
  }, "\n          ", HTML.Raw("<h1>\n            <strong>Edit Post</strong>\n          </h1>"), "\n\n          ", Spacebars.With(function() {
    return Spacebars.call(view.lookup("post"));                                                                        // 14
  }, function() {                                                                                                      // 15
    return [ "\n            ", HTML.FORM("\n              ", HTML.DIV({                                                // 16
      "class": "row form-group"                                                                                        // 17
    }, "\n                ", HTML.DIV({                                                                                // 18
      "class": "col-md-9"                                                                                              // 19
    }, "\n                  ", HTML.LABEL("Title"), "\n                  ", HTML.INPUT({                               // 20
      tabindex: "1",                                                                                                   // 21
      type: "text",                                                                                                    // 22
      "class": "form-control",                                                                                         // 23
      name: "title",                                                                                                   // 24
      placeholder: "Title",                                                                                            // 25
      value: function() {                                                                                              // 26
        return Spacebars.mustache(view.lookup("title"));                                                               // 27
      }                                                                                                                // 28
    }), "\n                "), "\n                ", HTML.DIV({                                                        // 29
      "class": "col-md-3"                                                                                              // 30
    }, "\n                ", HTML.LABEL({                                                                              // 31
      "for": "featured-image"                                                                                          // 32
    }, "Featured Image"), "\n                  ", HTML.INPUT({                                                         // 33
      type: "file",                                                                                                    // 34
      id: "input-featured-image",                                                                                      // 35
      name: "featured-image",                                                                                          // 36
      "class": "hidden"                                                                                                // 37
    }), "\n                  ", HTML.LABEL({                                                                           // 38
      "class": "btn btn-info",                                                                                         // 39
      "for": "input-featured-image"                                                                                    // 40
    }, "\n                    ", Blaze.If(function() {                                                                 // 41
      return Spacebars.call(view.lookup("featuredImage"));                                                             // 42
    }, function() {                                                                                                    // 43
      return [ "\n                      ", Blaze.View("lookup:featuredImageName", function() {                         // 44
        return Spacebars.mustache(view.lookup("featuredImageName"));                                                   // 45
      }), "\n                    " ];                                                                                  // 46
    }, function() {                                                                                                    // 47
      return "\n                      Select File\n                    ";                                              // 48
    }), "\n                  "), "\n                  ", Blaze.If(function() {                                         // 49
      return Spacebars.call(view.lookup("featuredImage"));                                                             // 50
    }, function() {                                                                                                    // 51
      return [ "\n                    ", HTML.CharRef({                                                                // 52
        html: "&nbsp;",                                                                                                // 53
        str: ""                                                                                                       // 54
      }), HTML.A({                                                                                                     // 55
        href: "#",                                                                                                     // 56
        "data-action": "delete-featured"                                                                               // 57
      }, HTML.I({                                                                                                      // 58
        "class": "fa fa-trash-o"                                                                                       // 59
      })), "\n                  " ];                                                                                   // 60
    }), "\n                  ", HTML.P({                                                                               // 61
      "class": "help-block"                                                                                            // 62
    }, "\n                    ", HTML.DIV({                                                                            // 63
      "class": "checkbox"                                                                                              // 64
    }, "\n                      ", HTML.LABEL({                                                                        // 65
      "for": "background-title"                                                                                        // 66
    }, "\n                        ", HTML.INPUT({                                                                      // 67
      type: "checkbox",                                                                                                // 68
      name: "background-title",                                                                                        // 69
      checked: function() {                                                                                            // 70
        return Blaze.If(function() {                                                                                   // 71
          return Spacebars.call(view.lookup("titleBackground"));                                                       // 72
        }, function() {                                                                                                // 73
          return "checked";                                                                                            // 74
        });                                                                                                            // 75
      }                                                                                                                // 76
    }), " Use as background for title\n                      "), "\n                    "), "\n                  "), "\n                "), "\n              "), "\n              ", HTML.DIV({
      "class": "row form-group"                                                                                        // 78
    }, "\n                ", HTML.DIV({                                                                                // 79
      "class": "col-md-4"                                                                                              // 80
    }, "\n                  ", HTML.LABEL("Tags"), "\n                  ", HTML.INPUT({                                // 81
      tabindex: "2",                                                                                                   // 82
      type: "text",                                                                                                    // 83
      "class": "form-control",                                                                                         // 84
      name: "tags",                                                                                                    // 85
      placeholder: "Type in a tag & hit enter",                                                                        // 86
      value: function() {                                                                                              // 87
        return Spacebars.mustache(view.lookup("joinTags"), view.lookup("tags"));                                       // 88
      },                                                                                                               // 89
      "data-role": "tagsinput"                                                                                         // 90
    }), "\n                "), "\n                ", HTML.DIV({                                                        // 91
      "class": "col-md-4"                                                                                              // 92
    }, "\n                  ", HTML.LABEL("Slug"), "\n                  ", HTML.INPUT({                                // 93
      type: "text",                                                                                                    // 94
      "class": "form-control",                                                                                         // 95
      name: "slug",                                                                                                    // 96
      placeholder: "Slug",                                                                                             // 97
      value: function() {                                                                                              // 98
        return Spacebars.mustache(view.lookup("slug"));                                                                // 99
      }                                                                                                                // 100
    }), "\n                "), "\n                ", HTML.DIV({                                                        // 101
      "class": "col-md-4"                                                                                              // 102
    }, "\n                  ", HTML.LABEL("Meta Description"), "\n                  ", HTML.INPUT({                    // 103
      type: "text",                                                                                                    // 104
      "class": "form-control",                                                                                         // 105
      name: "description",                                                                                             // 106
      placeholder: "Meta Description",                                                                                 // 107
      value: function() {                                                                                              // 108
        return Spacebars.mustache(view.lookup("description"));                                                         // 109
      }                                                                                                                // 110
    }), "\n                "), "\n              "), "\n              ", HTML.DIV({                                     // 111
      "class": "row form-group"                                                                                        // 112
    }, "\n                ", HTML.DIV({                                                                                // 113
      "class": "col-md-12"                                                                                             // 114
    }, "\n                  ", HTML.LABEL("Body"), "\n                  ", HTML.DIV({                                  // 115
      "class": "edit-mode"                                                                                             // 116
    }, "\n                    ", HTML.A({                                                                              // 117
      href: "#",                                                                                                       // 118
      "class": "selected visual-toggle"                                                                                // 119
    }, "Visual"), "\n                    -\n                    ", HTML.A({                                            // 120
      href: "#",                                                                                                       // 121
      "class": "html-toggle"                                                                                           // 122
    }, "HTML"), "\n                  "), "\n                  ", HTML.TEXTAREA({                                       // 123
      hidden: "",                                                                                                      // 124
      "class": "html-editor col-xs-12"                                                                                 // 125
    }), "\n                  ", HTML.DIV({                                                                             // 126
      "class": "editable",                                                                                             // 127
      tabindex: "3"                                                                                                    // 128
    }), "\n                  ", HTML.BUTTON({                                                                          // 129
      type: "submit",                                                                                                  // 130
      "class": "btn btn-default"                                                                                       // 131
    }, "\n                    ", HTML.I({                                                                              // 132
      "class": "fa fa-save"                                                                                            // 133
    }), " Save\n                  "), "\n                  ", HTML.A({                                                 // 134
      href: function() {                                                                                               // 135
        return Spacebars.mustache(view.lookup("pathFor"), "blogAdmin");                                                // 136
      },                                                                                                               // 137
      "class": "btn btn-default"                                                                                       // 138
    }, "\n                    ", HTML.I({                                                                              // 139
      "class": "fa fa-ban"                                                                                             // 140
    }), " Cancel\n                  "), "\n                "), "\n              "), "\n            "), "\n          " ];
  }), "\n\n        "), "\n      "), "\n    "), "\n  ") ];                                                              // 142
}));                                                                                                                   // 143
                                                                                                                       // 144
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/views/admin/editor.coffee.js                                                               //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
var __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

this.BlogEditor = (function(_super) {
  __extends(BlogEditor, _super);

  BlogEditor.make = function(tpl) {
    var $editable, editor;
    $editable = $('.editable');
    if ($editable.data('mediumEditor')) {
      return $editable.data('mediumEditor');
    }
    editor = new BlogEditor($editable[0], {
      placeholder: '',
      firstHeader: 'h1',
      secondHeader: 'h2',
      buttonLabels: 'fontawesome',
      buttons: ['bold', 'italic', 'underline', 'anchor', 'pre', 'header1', 'header2', 'orderedlist', 'unorderedlist', 'quote', 'image'],
      onShowToolbar: (function(_this) {
        return function() {
          if (_this.inPreformatted()) {
            return editor.toolbar.hideToolbar();
          }
        };
      })(this)
    });
    tpl.$('.editable').mediumInsert({
      editor: editor,
      enabled: true,
      addons: {
        images: {
          uploadFile: function($placeholder, file, that) {
            var id, _ref, _ref1, _ref2;
            if ((_ref = Meteor.settings) != null ? (_ref1 = _ref["public"]) != null ? (_ref2 = _ref1.blog) != null ? _ref2.useS3 : void 0 : void 0 : void 0) {
              return FS.Utility.eachFile(event, function(file) {
                return S3Files.insert(file, function(err, fileObj) {
                  return Tracker.autorun(function(c) {
                    var $progress, complete, theFile, _ref3;
                    theFile = S3Files.find({
                      _id: fileObj._id
                    }).fetch()[0];
                    if (theFile.isUploaded() && (typeof theFile.url === "function" ? theFile.url() : void 0)) {
                      that.uploadCompleted({
                        responseText: theFile.url()
                      }, $placeholder);
                      c.stop();
                    } else {
                      $progress = $('.progress:first', this.$el);
                      complete = (_ref3 = theFile.uploadProgress()) != null ? _ref3 : 0;
                      $progress.attr('value', complete);
                      return $progress.html(complete);
                    }
                  });
                });
              });
            } else {
              id = FilesLocal.insert({
                _id: Random.id(),
                contentType: 'image/jpeg'
              });
              return $.ajax({
                type: "post",
                url: "/fs/" + id,
                xhr: function() {
                  var xhr;
                  xhr = new XMLHttpRequest();
                  xhr.upload.onprogress = that.updateProgressBar;
                  return xhr;
                },
                cache: false,
                contentType: false,
                complete: function(jqxhr) {
                  that.uploadCompleted({
                    responseText: "/fs/" + id
                  }, $placeholder);
                },
                processData: false,
                data: that.options.formatData(file)
              });
            }
          }
        }
      }
    });
    $editable.data('mediumEditor', editor);
    return editor;
  };

  function BlogEditor() {
    this.init.apply(this, arguments);
  }

  BlogEditor.prototype.contents = function() {
    return this.serialize()['element-0'].value;
  };

  BlogEditor.prototype.pretty = function() {
    return html_beautify(this.contents(), {
      preserve_newlines: false,
      indent_size: 2,
      wrap_line_length: 0
    });
  };

  BlogEditor.prototype.highlightSyntax = function() {
    var br2nl;
    hljs.configure({
      userBR: true
    });
    br2nl = function(i, html) {
      return html.replace(/<br>/g, "\n").replace(/<[^>]+>/g, '');
    };
    return $(this.elements[0]).find('pre').removeClass('hljs').html(br2nl).each(function(i, block) {
      return hljs.highlightBlock(block);
    });
  };

  BlogEditor.inPreformatted = function() {
    var current, node;
    node = document.getSelection().anchorNode;
    current = node && node.nodeType === 3 ? node.parentNode : node;
    while (true) {
      if (current.nodeType === 1) {
        if (current.tagName.toLowerCase() === 'pre') {
          return true;
        }
        if (current.getAttribute('data-medium-element')) {
          return false;
        }
      }
      current = current.parentNode;
      if (!current) {
        break;
      }
    }
    return false;
  };

  return BlogEditor;

})(MediumEditor);
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/views/admin/edit.coffee.js                                                                 //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
var getPost, readImageDimensions, save, setEditMode, substringMatcher;

getPost = function(id) {
  return (Post.first({
    _id: id
  })) || {};
};

readImageDimensions = function(file, cb) {
  var image, reader;
  reader = new FileReader;
  image = new Image;
  reader.readAsDataURL(file);
  return reader.onload = function(_file) {
    image.src = _file.target.result;
    image.onload = function() {
      var h, n, w;
      w = this.width;
      h = this.height;
      n = file.name;
      cb(w, h, n);
    };
    return image.onerror = function() {
      return alert('Invalid file type: ' + file.type);
    };
  };
};

substringMatcher = function(strs) {
  return function(q, cb) {
    var matches, pattern;
    matches = [];
    pattern = new RegExp(q, 'i');
    _.each(strs, function(ele) {
      if (pattern.test(ele)) {
        return matches.push({
          val: ele
        });
      }
    });
    return cb(matches);
  };
};

setEditMode = function(tpl, mode) {
  tpl.$('.editable').toggle();
  tpl.$('.html-editor').toggle();
  tpl.$('.edit-mode a').removeClass('selected');
  return tpl.$("." + mode + "-toggle").addClass('selected');
};

save = function(tpl, cb) {
  var $editable, $form, attrs, body, description, editor, i, post, slug;
  $form = tpl.$('form');
  $editable = $('.editable', $form);
  editor = BlogEditor.make(tpl);
  $editable.find('p[data-section-id]').each(function() {
    var sec_id;
    sec_id = $(this).attr('data-section-id');
    if ($editable.find("p[data-section-id=" + sec_id + "]").length > 1) {
      return $editable.find("p[data-section-id=" + sec_id + "]:gt(0)").removeAttr('data-section-id');
    }
  });
  i = $editable.find('p[data-section-id]').length + 1;
  $editable.find('p:not([data-section-id])').each(function() {
    $(this).addClass('commentable-section').attr('data-section-id', i);
    return i++;
  });
  editor.highlightSyntax();
  if ($editable.is(':visible')) {
    body = editor.contents();
  } else {
    body = $('.html-editor', $form).val().trim();
  }
  if (!body) {
    return cb(null, new Error('Blog body is required'));
  }
  slug = $('[name=slug]', $form).val();
  description = $('[name=description]', $form).val();
  attrs = {
    title: $('[name=title]', $form).val(),
    tags: $('[name=tags]', $form).val(),
    slug: slug,
    description: description,
    body: body,
    updatedAt: new Date()
  };
  if (getPost(Session.get('postId')).id) {
    post = getPost(Session.get('postId')).update(attrs);
    if (post.errors) {
      return cb(null, new Error(_(post.errors[0]).values()[0]));
    }
    return cb(null);
  } else {
    return Meteor.call('doesBlogExist', slug, function(err, exists) {
      if (!exists) {
        attrs.userId = Meteor.userId();
        post = Post.create(attrs);
        if (post.errors) {
          return cb(null, new Error(_(post.errors[0]).values()[0]));
        }
        return cb(post.id);
      } else {
        return cb(null, new Error('Blog with this slug already exists'));
      }
    });
  }
};

Template.blogAdminEdit.rendered = function() {
  var ranOnce;
  ranOnce = false;
  return this.autorun((function(_this) {
    return function() {
      var $tags, post, sub;
      sub = Meteor.subscribe('singlePostById', Session.get('postId'));
      if (sub.ready() && !ranOnce) {
        ranOnce = true;
        post = getPost(Session.get('postId'));
        if (post != null ? post.body : void 0) {
          _this.$('.editable').html(post.body);
          _this.$('.html-editor').html(post.body);
        }
        $tags = _this.$('[data-role=tagsinput]');
        $tags.tagsinput({
          confirmKeys: [13, 44, 9]
        });
        $tags.tagsinput('input').typeahead({
          highlight: true,
          hint: false
        }, {
          name: 'tags',
          displayKey: 'val',
          source: substringMatcher(Tag.first().tags)
        }).bind('typeahead:selected', function(obj, datum) {
          $tags.tagsinput('add', datum.val);
          return $tags.tagsinput('input').typeahead('val', '');
        });
        return BlogEditor.make(_this);
      }
    };
  })(this));
};

Template.blogAdminEdit.helpers({
  post: function() {
    return getPost(Session.get('postId'));
  }
});

Template.blogAdminEdit.events({
  'click .visual-toggle': function(e, tpl) {
    if (tpl.$('.editable').is(':visible')) {
      return;
    }
    BlogEditor.make(tpl).highlightSyntax();
    return setEditMode(tpl, 'visual');
  },
  'click .html-toggle': function(e, tpl) {
    var $editable, $html;
    $editable = tpl.$('.editable');
    $html = tpl.$('.html-editor');
    if ($html.is(':visible')) {
      return;
    }
    if ($editable.find('.medium-insert-images').length === 0) {
      $html.val(BlogEditor.make(tpl).pretty());
    }
    setEditMode(tpl, 'html');
    return $html.height($editable.height());
  },
  'keyup .html-editor': function(e, tpl) {
    var $editable, $html, _ref;
    $editable = tpl.$('.editable');
    $html = tpl.$('.html-editor');
    $editable.html((_ref = $html.val()) != null ? _ref.trim() : void 0);
    return $html.height($editable.height());
  },
  'input .editable, keydown .editable, keydown .html-editor': _.debounce(function(e, tpl) {
    return save(tpl, function(id, err) {
      var path;
      if (err) {
        return Notifications.error('', err.message);
      }
      if (id) {
        Session.set('postId', id);
        path = Router.path('blogAdminEdit', {
          id: id
        });
        Iron.Location.go(path, {
          replaceState: true,
          skipReactive: true
        });
      }
      return Notifications.success('', 'Saved');
    });
  }, 8000),
  'blur [name=title]': function(e, tpl) {
    var slug, title;
    slug = tpl.$('[name=slug]');
    title = $(e.currentTarget).val();
    if (!slug.val()) {
      return slug.val(Post.slugify(title));
    }
  },
  'click [data-action=delete-featured]': function(e, tpl) {
    var post;
    e.preventDefault();
    post = getPost(Session.get('postId'));
    return post.update({
      featuredImageWidth: null,
      featuredImageHeight: null,
      featuredImageName: null,
      featuredImage: null,
      titleBackground: null
    });
  },
  'change [name=featured-image]': function(e, tpl) {
    var formdata, id, post, the_file, _ref, _ref1, _ref2;
    the_file = $(e.currentTarget)[0].files[0];
    post = getPost(Session.get('postId'));
    readImageDimensions(the_file, function(width, height, name) {
      return post.update({
        featuredImageWidth: width,
        featuredImageHeight: height,
        featuredImageName: name
      });
    });
    if ((_ref = Meteor.settings) != null ? (_ref1 = _ref["public"]) != null ? (_ref2 = _ref1.blog) != null ? _ref2.useS3 : void 0 : void 0 : void 0) {
      return S3Files.insert(the_file, function(err, fileObj) {
        return Tracker.autorun(function(c) {
          var theFile;
          theFile = S3Files.find({
            _id: fileObj._id
          }).fetch()[0];
          if (theFile.isUploaded() && (typeof theFile.url === "function" ? theFile.url() : void 0)) {
            if (post.id != null) {
              post.update({
                featuredImage: theFile.url()
              });
              return c.stop();
            }
          }
        });
      });
    } else {
      id = FilesLocal.insert({
        _id: Random.id(),
        contentType: 'image/jpeg'
      });
      formdata = new FormData();
      formdata.append('file', the_file);
      return $.ajax({
        type: "post",
        url: "/fs/" + id,
        xhr: function() {
          var xhr;
          xhr = new XMLHttpRequest();
          xhr.upload.onprogress = function(data) {};
          return xhr;
        },
        cache: false,
        contentType: false,
        processData: false,
        data: formdata,
        complete: function(jqxhr) {
          if (post.id != null) {
            post.update({
              featuredImage: "/fs/" + id
            });
            return Notifications.success('', 'Featured image saved!');
          }
        }
      });
    }
  },
  'change [name=background-title]': function(e, tpl) {
    var $checkbox;
    $checkbox = $(e.currentTarget);
    return getPost(Session.get("postId")).update({
      titleBackground: $checkbox.is(':checked')
    });
  },
  'submit form': function(e, tpl) {
    e.preventDefault();
    return save(tpl, function(id, err) {
      if (err) {
        return Notifications.error('', err.message);
      }
      return Router.go('blogAdmin');
    });
  }
});
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/views/blog/template.blog.js                                                                //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
                                                                                                                       // 1
Template.__checkName("blogIndex");                                                                                     // 2
Template["blogIndex"] = new Template("Template.blogIndex", (function() {                                               // 3
  var view = this;                                                                                                     // 4
  return HTML.DIV({                                                                                                    // 5
    id: "meteor-blog",                                                                                                 // 6
    "class": "blog-list"                                                                                               // 7
  }, "\n    ", HTML.DIV({                                                                                              // 8
    "class": "container"                                                                                               // 9
  }, "\n      ", HTML.DIV({                                                                                            // 10
    "class": "row"                                                                                                     // 11
  }, "\n        ", HTML.DIV({                                                                                          // 12
    "class": "col-md-8 col-md-offset-2"                                                                                // 13
  }, "\n          ", Spacebars.include(view.lookupTemplate("blogIndexLoop")), "\n          ", Blaze.View("lookup:blogPager", function() {
    return Spacebars.mustache(view.lookup("blogPager"));                                                               // 15
  }), "\n        "), "\n      "), "\n    "), "\n  ");                                                                  // 16
}));                                                                                                                   // 17
                                                                                                                       // 18
Template.__checkName("blogIndexLoop");                                                                                 // 19
Template["blogIndexLoop"] = new Template("Template.blogIndexLoop", (function() {                                       // 20
  var view = this;                                                                                                     // 21
  return Blaze.Each(function() {                                                                                       // 22
    return Spacebars.call(view.lookup("posts"));                                                                       // 23
  }, function() {                                                                                                      // 24
    return [ "\n    ", HTML.ARTICLE({                                                                                  // 25
      "class": "post"                                                                                                  // 26
    }, "\n      ", HTML.DIV({                                                                                          // 27
      "class": "row"                                                                                                   // 28
    }, "\n        ", Blaze.If(function() {                                                                             // 29
      return Spacebars.call(view.lookup("featuredImage"));                                                             // 30
    }, function() {                                                                                                    // 31
      return [ "\n          ", HTML.DIV({                                                                              // 32
        "class": "col-md-3"                                                                                            // 33
      }, "\n            ", HTML.A({                                                                                    // 34
        href: function() {                                                                                             // 35
          return Spacebars.mustache(view.lookup("pathFor"), "blogShow");                                               // 36
        },                                                                                                             // 37
        "class": "thumbnail"                                                                                           // 38
      }, "\n              ", HTML.IMG({                                                                                // 39
        src: function() {                                                                                              // 40
          return Spacebars.mustache(view.lookup("featuredImage"));                                                     // 41
        },                                                                                                             // 42
        alt: "",                                                                                                       // 43
        "class": "img-responsive"                                                                                      // 44
      }), "\n            "), "\n          "), "\n        " ];                                                          // 45
    }), "\n        ", HTML.DIV({                                                                                       // 46
      "class": function() {                                                                                            // 47
        return Blaze.If(function() {                                                                                   // 48
          return Spacebars.call(view.lookup("featuredImage"));                                                         // 49
        }, function() {                                                                                                // 50
          return "col-md-9";                                                                                           // 51
        }, function() {                                                                                                // 52
          return "col-md-12";                                                                                          // 53
        });                                                                                                            // 54
      }                                                                                                                // 55
    }, "\n          ", HTML.H2("\n            ", HTML.A({                                                              // 56
      href: function() {                                                                                               // 57
        return Spacebars.mustache(view.lookup("pathFor"), "blogShow");                                                 // 58
      }                                                                                                                // 59
    }, Blaze.View("lookup:title", function() {                                                                         // 60
      return Spacebars.mustache(view.lookup("title"));                                                                 // 61
    })), "\n          "), "\n          ", HTML.DIV({                                                                   // 62
      "class": "post-meta"                                                                                             // 63
    }, "\n            By ", Blaze.View("lookup:authorName", function() {                                               // 64
      return Spacebars.mustache(view.lookup("authorName"));                                                            // 65
    }), " on ", Blaze.View("lookup:blogFormatDate", function() {                                                       // 66
      return Spacebars.mustache(view.lookup("blogFormatDate"), view.lookup("publishedAt"));                            // 67
    }), "\n            ", Spacebars.include(view.lookupTemplate("blogTags")), "\n          "), "\n          ", HTML.DIV({
      "class": "the-content"                                                                                           // 69
    }, "\n            ", HTML.SMALL(Blaze.View("lookup:excerpt", function() {                                          // 70
      return Spacebars.makeRaw(Spacebars.mustache(view.lookup("excerpt")));                                            // 71
    })), "\n          "), "\n        "), "\n        "), "\n    "), "\n  " ];                                           // 72
  }, function() {                                                                                                      // 73
    return "\n    This blog is looking pretty empty...\n  ";                                                           // 74
  });                                                                                                                  // 75
}));                                                                                                                   // 76
                                                                                                                       // 77
Template.__checkName("blogTags");                                                                                      // 78
Template["blogTags"] = new Template("Template.blogTags", (function() {                                                 // 79
  var view = this;                                                                                                     // 80
  return Blaze.If(function() {                                                                                         // 81
    return Spacebars.call(view.lookup("tags"));                                                                        // 82
  }, function() {                                                                                                      // 83
    return [ "\n    ", HTML.DIV({                                                                                      // 84
      "class": "post-tags"                                                                                             // 85
    }, "\n      ", HTML.P(" ", HTML.CharRef({                                                                          // 86
      html: "&ndash;",                                                                                                 // 87
      str: ""                                                                                                         // 88
    }), " Tags: ", Blaze.View("lookup:blogFormatTags", function() {                                                    // 89
      return Spacebars.mustache(view.lookup("blogFormatTags"), view.lookup("tags"));                                   // 90
    })), "\n    "), "\n  " ];                                                                                          // 91
  });                                                                                                                  // 92
}));                                                                                                                   // 93
                                                                                                                       // 94
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/views/blog/template.show.js                                                                //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
                                                                                                                       // 1
Template.__checkName("blogShow");                                                                                      // 2
Template["blogShow"] = new Template("Template.blogShow", (function() {                                                 // 3
  var view = this;                                                                                                     // 4
  return HTML.DIV({                                                                                                    // 5
    id: "meteor-blog",                                                                                                 // 6
    "class": "blog-single"                                                                                             // 7
  }, "\n    ", Blaze.If(function() {                                                                                   // 8
    return Spacebars.dataMustache(view.lookup("session"), "postHasFeaturedImage");                                     // 9
  }, function() {                                                                                                      // 10
    return [ "\n      ", Spacebars.include(view.lookupTemplate("blogShowFeaturedImage")), "\n    " ];                  // 11
  }), "\n    ", HTML.DIV({                                                                                             // 12
    "class": "container"                                                                                               // 13
  }, "\n      ", HTML.DIV({                                                                                            // 14
    "class": "row"                                                                                                     // 15
  }, "\n        ", HTML.DIV({                                                                                          // 16
    "class": "col-xs-12 col-sm-11 col-md-8 col-md-offset-2"                                                            // 17
  }, "\n          ", Spacebars.include(view.lookupTemplate("blogShowBody")), "\n        "), "\n      "), "\n    "), "\n  ");
}));                                                                                                                   // 19
                                                                                                                       // 20
Template.__checkName("blogShowBody");                                                                                  // 21
Template["blogShowBody"] = new Template("Template.blogShowBody", (function() {                                         // 22
  var view = this;                                                                                                     // 23
  return [ HTML.ARTICLE({                                                                                              // 24
    "class": "post"                                                                                                    // 25
  }, "\n    ", Blaze.Unless(function() {                                                                               // 26
    return Spacebars.call(view.lookup("titleBackground"));                                                             // 27
  }, function() {                                                                                                      // 28
    return [ "\n      ", HTML.H1({                                                                                     // 29
      "class": "mb-title text-center"                                                                                  // 30
    }, "\n        ", Blaze.View("lookup:title", function() {                                                           // 31
      return Spacebars.mustache(view.lookup("title"));                                                                 // 32
    }), "\n      "), "\n      ", HTML.DIV({                                                                            // 33
      "class": "post-meta text-center"                                                                                 // 34
    }, "\n        ", Blaze.If(function() {                                                                             // 35
      return Spacebars.call(view.lookup("isAdmin"));                                                                   // 36
    }, function() {                                                                                                    // 37
      return [ "\n           ", HTML.SMALL(HTML.A({                                                                    // 38
        href: "#",                                                                                                     // 39
        id: "edit-post"                                                                                                // 40
      }, "edit")), "\n           --\n        " ];                                                                      // 41
    }), "\n        By ", Blaze.View("lookup:authorName", function() {                                                  // 42
      return Spacebars.mustache(view.lookup("authorName"));                                                            // 43
    }), " on ", Blaze.View("lookup:blogFormatDate", function() {                                                       // 44
      return Spacebars.mustache(view.lookup("blogFormatDate"), view.lookup("publishedAt"));                            // 45
    }), "\n        ", Spacebars.include(view.lookupTemplate("blogTags")), "\n      "), "\n    " ];                     // 46
  }), "\n    ", HTML.DIV({                                                                                             // 47
    id: "commentable-area",                                                                                            // 48
    "class": "the-content"                                                                                             // 49
  }, "\n      ", Blaze.View("lookup:html", function() {                                                                // 50
    return Spacebars.makeRaw(Spacebars.mustache(view.lookup("html")));                                                 // 51
  }), "\n    "), "\n  "), "\n  ", HTML.DIV({                                                                           // 52
    "class": "blog-back-link pull-left"                                                                                // 53
  }, "\n    ", HTML.A({                                                                                                // 54
    href: function() {                                                                                                 // 55
      return Spacebars.mustache(view.lookup("pathFor"), "blogIndex");                                                  // 56
    }                                                                                                                  // 57
  }, HTML.Raw('<i class="fa fa-caret-left"></i>'), "Back to the Blog"), "\n  "), "\n  ", Blaze._TemplateWith(function() {
    return Spacebars.call(view.lookup("shareData"));                                                                   // 59
  }, function() {                                                                                                      // 60
    return Spacebars.include(view.lookupTemplate("shareit"));                                                          // 61
  }), "\n  ", Blaze._TemplateWith(function() {                                                                         // 62
    return Spacebars.call(view.lookup("."));                                                                           // 63
  }, function() {                                                                                                      // 64
    return Spacebars.include(view.lookupTemplate("disqus"));                                                           // 65
  }) ];                                                                                                                // 66
}));                                                                                                                   // 67
                                                                                                                       // 68
Template.__checkName("blogShowFeaturedImage");                                                                         // 69
Template["blogShowFeaturedImage"] = new Template("Template.blogShowFeaturedImage", (function() {                       // 70
  var view = this;                                                                                                     // 71
  return HTML.DIV({                                                                                                    // 72
    "class": "row"                                                                                                     // 73
  }, "\n    ", HTML.DIV({                                                                                              // 74
    "class": "mb-featured-image-container"                                                                             // 75
  }, "\n      ", HTML.FIGURE({                                                                                         // 76
    "class": function() {                                                                                              // 77
      return Blaze.If(function() {                                                                                     // 78
        return Spacebars.dataMustache(view.lookup("session"), "fullWidthFeaturedImage");                               // 79
      }, function() {                                                                                                  // 80
        return "mb-fillWidthImage";                                                                                    // 81
      }, function() {                                                                                                  // 82
        return "mb-scaleImage";                                                                                        // 83
      });                                                                                                              // 84
    }                                                                                                                  // 85
  }, "\n        ", HTML.DIV({                                                                                          // 86
    "class": "mg-aspectRatioPlaceholder",                                                                              // 87
    style: function() {                                                                                                // 88
      return Blaze.Unless(function() {                                                                                 // 89
        return Spacebars.dataMustache(view.lookup("session"), "fullWidthFeaturedImage");                               // 90
      }, function() {                                                                                                  // 91
        return [ "width: ", Blaze.View("lookup:featuredImageWidth", function() {                                       // 92
          return Spacebars.mustache(view.lookup("featuredImageWidth"));                                                // 93
        }), "px; height: ", Blaze.View("lookup:featuredImageHeight", function() {                                      // 94
          return Spacebars.mustache(view.lookup("featuredImageHeight"));                                               // 95
        }), "px;" ];                                                                                                   // 96
      });                                                                                                              // 97
    }                                                                                                                  // 98
  }, "\n          ", HTML.Raw('<!-- <div class="mb-aspect-ratio-fill"></div> -->'), "\n          ", HTML.IMG({         // 99
    src: function() {                                                                                                  // 100
      return Spacebars.mustache(view.lookup("featuredImage"));                                                         // 101
    },                                                                                                                 // 102
    alt: "",                                                                                                           // 103
    "class": "img-responsive center-block"                                                                             // 104
  }), "\n          ", Blaze.If(function() {                                                                            // 105
    return Spacebars.call(view.lookup("titleBackground"));                                                             // 106
  }, function() {                                                                                                      // 107
    return [ "\n            ", HTML.DIV({                                                                              // 108
      "class": "mb-background-title"                                                                                   // 109
    }, "\n              ", HTML.DIV({                                                                                  // 110
      "class": "container"                                                                                             // 111
    }, "\n                ", HTML.DIV({                                                                                // 112
      "class": "row"                                                                                                   // 113
    }, "\n                  ", HTML.DIV({                                                                              // 114
      "class": "center-block"                                                                                          // 115
    }, "\n                    ", HTML.H1({                                                                             // 116
      "class": "text-center"                                                                                           // 117
    }, "\n                      ", Blaze.View("lookup:title", function() {                                             // 118
      return Spacebars.mustache(view.lookup("title"));                                                                 // 119
    }), "\n                      ", Blaze.If(function() {                                                              // 120
      return Spacebars.call(view.lookup("isAdmin"));                                                                   // 121
    }, function() {                                                                                                    // 122
      return [ "\n                         ", HTML.SMALL(HTML.A({                                                      // 123
        href: "#",                                                                                                     // 124
        id: "edit-post"                                                                                                // 125
      }, "edit")), "\n                      " ];                                                                       // 126
    }), "\n                    "), "\n                    ", HTML.DIV({                                                // 127
      "class": "post-meta text-center"                                                                                 // 128
    }, "\n                      By ", Blaze.View("lookup:authorName", function() {                                     // 129
      return Spacebars.mustache(view.lookup("authorName"));                                                            // 130
    }), " on ", Blaze.View("lookup:blogFormatDate", function() {                                                       // 131
      return Spacebars.mustache(view.lookup("blogFormatDate"), view.lookup("publishedAt"));                            // 132
    }), "\n                      ", Spacebars.include(view.lookupTemplate("blogTags")), "\n                    "), "\n                  "), "\n                "), "\n              "), "\n            "), "\n          " ];
  }), "\n        "), "\n      "), "\n    "), "\n  ");                                                                  // 134
}));                                                                                                                   // 135
                                                                                                                       // 136
Template.__checkName("disqus");                                                                                        // 137
Template["disqus"] = new Template("Template.disqus", (function() {                                                     // 138
  var view = this;                                                                                                     // 139
  return Blaze.If(function() {                                                                                         // 140
    return Spacebars.call(view.lookup("useDisqus"));                                                                   // 141
  }, function() {                                                                                                      // 142
    return [ "\n    ", HTML.DIV({                                                                                      // 143
      id: "disqus_thread"                                                                                              // 144
    }), "\n    ", HTML.NOSCRIPT("Please enable JavaScript to view the ", HTML.A({                                      // 145
      href: "http://disqus.com/?ref_noscript"                                                                          // 146
    }, "comments powered by Disqus.")), "\n    ", HTML.A({                                                             // 147
      href: "http://disqus.com",                                                                                       // 148
      "class": "dsq-brlink"                                                                                            // 149
    }, "comments powered by ", HTML.SPAN({                                                                             // 150
      "class": "logo-disqus"                                                                                           // 151
    }, "Disqus")), "\n  " ];                                                                                           // 152
  });                                                                                                                  // 153
}));                                                                                                                   // 154
                                                                                                                       // 155
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/views/blog/blog.coffee.js                                                                  //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
Template.blogIndex.rendered = function() {
  document.title = "Blog";
  if (Blog.settings.title) {
    return document.title += " | " + Blog.settings.title;
  }
};

Template.blogShowBody.rendered = function() {
  var SideComments, avatar, chosen_name, commentUser, existingComments, possible_names, post, settings, sideComments, the_user, _ref, _ref1, _ref2, _ref3, _ref4;
  Meteor.call('isBlogAuthorized', this.id, (function(_this) {
    return function(err, authorized) {
      if (authorized) {
        return Session.set('canEditPost', authorized);
      }
    };
  })(this));
  settings = Blog.settings.comments;
  if (settings.useSideComments) {
    SideComments = require('side-comments');
    if (settings.allowAnonymous && !Meteor.user()) {
      commentUser = {
        name: 'Anonymous',
        avatarUrl: settings.defaultImg,
        id: 0
      };
    } else if (Meteor.user()) {
      the_user = Meteor.user();
      possible_names = [the_user.username, (_ref = the_user.services) != null ? (_ref1 = _ref.google) != null ? _ref1.name : void 0 : void 0, (_ref2 = the_user.profile) != null ? _ref2.name : void 0, (_ref3 = the_user.emails) != null ? _ref3[0].address : void 0];
      chosen_name = null;
      possible_names.every(function(name) {
        if (name != null) {
          if (typeof name === "string" && name.length > 0) {
            chosen_name = name;
            return false;
          }
        } else {
          return true;
        }
      });
      if ((_ref4 = Meteor.user().profile) != null ? _ref4[settings.userImg] : void 0) {
        avatar = Meteor.user().profile[settings.userImg];
      } else {
        avatar = settings.defaultImg;
      }
      commentUser = {
        name: chosen_name,
        avatarUrl: avatar,
        id: Meteor.userId()
      };
    } else {
      commentUser = {
        name: 'Login to Comment',
        avatarUrl: settings.defaultImg,
        id: 0
      };
    }
    existingComments = [];
    Comment.where({
      slug: Session.get('slug')
    }).forEach(function(comment) {
      var sec;
      comment.comment.id = comment._id;
      sec = _(existingComments).findWhere({
        sectionId: comment.sectionId.toString()
      });
      if (sec) {
        return sec.comments.push(comment.comment);
      } else {
        return existingComments.push({
          sectionId: comment.sectionId.toString(),
          comments: [comment.comment]
        });
      }
    });
    sideComments = new SideComments('#commentable-area', commentUser, existingComments);
    sideComments.on('commentPosted', function(comment) {
      var attrs, commentId;
      if (settings.allowAnonymous || Meteor.user()) {
        attrs = {
          slug: Session.get('slug'),
          sectionId: comment.sectionId,
          comment: {
            authorAvatarUrl: comment.authorAvatarUrl,
            authorName: comment.authorName,
            authorId: comment.authorId,
            comment: comment.comment
          }
        };
        commentId = Comment.create(attrs);
        comment.id = commentId;
        return sideComments.insertComment(comment);
      } else {
        comment.id = -1;
        return sideComments.insertComment({
          sectionId: comment.sectionId,
          authorName: comment.authorName,
          comment: 'Please login to post comments'
        });
      }
    });
    sideComments.on('commentDeleted', function(comment) {
      if (Meteor.user()) {
        Comment.destroyAll(comment.id);
        return sideComments.removeComment(comment.sectionId, comment.id);
      }
    });
  }
  document.title = "" + this.data.title;
  if (Blog.settings.title) {
    document.title += " | " + Blog.settings.title;
  }
  if (!this.data.published) {
    $('<meta>', {
      name: 'robots',
      content: 'noindex,nofollow'
    }).appendTo('head');
  }
  if (Session.get("postHasFeaturedImage")) {
    post = Post.first({
      slug: Router.current().params.slug
    });
    $(window).resize(function() {
      return Session.set("fullWidthFeaturedImage", $(window).width() < post.featuredImageWidth);
    });
    return $(window).trigger("resize");
  }
};

Template.blogShowBody.events({
  'click a#edit-post': function(event, template) {
    var postId;
    event.preventDefault();
    postId = Post.first({
      slug: Router.current().params.slug
    })._id;
    return Router.go('blogAdminEdit', {
      id: postId
    });
  }
});

Template.blogShowBody.helpers({
  isAdmin: function() {
    return Session.get("canEditPost");
  },
  shareData: function() {
    var post;
    post = Post.first({
      slug: Session.get('slug')
    });
    return {
      title: post.title,
      excerpt: post.excerpt,
      description: post.description,
      author: post.authorName(),
      thumbnail: post.thumbnail()
    };
  }
});

Template.disqus.rendered = function() {
  var disqus_developer, disqus_identifier, disqus_shortname, disqus_title, disqus_url, dsq, post;
  if (Blog.settings.comments.disqusShortname) {
    if (window.DISQUS) {
      post = this.data;
      return window.DISQUS.reset({
        reload: true,
        config: function() {
          this.page.identifier = post.id;
          this.page.title = post.title;
          return this.page.url = window.location.href;
        }
      });
    } else {
      disqus_shortname = Blog.settings.comments.disqusShortname;
      disqus_identifier = this.data.id;
      disqus_title = this.data.title;
      disqus_url = window.location.href;
      disqus_developer = 1;
      dsq = document.createElement("script");
      dsq.type = "text/javascript";
      dsq.async = true;
      dsq.src = "//" + disqus_shortname + ".disqus.com/embed.js";
      return (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(dsq);
    }
  }
};

Template.disqus.helpers({
  useDisqus: function() {
    return Blog.settings.comments.disqusShortname;
  }
});
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/views/widget/template.latest.js                                                            //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
                                                                                                                       // 1
Template.__checkName("blogLatest");                                                                                    // 2
Template["blogLatest"] = new Template("Template.blogLatest", (function() {                                             // 3
  var view = this;                                                                                                     // 4
  return HTML.DIV({                                                                                                    // 5
    id: "blog-latest-widget"                                                                                           // 6
  }, HTML.Raw('\n    <div class="blog-latest-title">\n      <span>Latest Posts</span>\n    </div>\n    '), HTML.UL({   // 7
    "class": "blog-latest-posts"                                                                                       // 8
  }, "\n      ", Blaze.Each(function() {                                                                               // 9
    return Spacebars.call(view.lookup("latest"));                                                                      // 10
  }, function() {                                                                                                      // 11
    return [ "\n        ", HTML.LI("\n          ", HTML.A({                                                            // 12
      href: function() {                                                                                               // 13
        return Spacebars.mustache(view.lookup("pathFor"), "blogShow");                                                 // 14
      }                                                                                                                // 15
    }, "\n            ", HTML.DIV({                                                                                    // 16
      "class": "blog-meta"                                                                                             // 17
    }, "\n              ", HTML.DIV({                                                                                  // 18
      "class": "blog-title"                                                                                            // 19
    }, "\n                ", Blaze.View("lookup:title", function() {                                                   // 20
      return Spacebars.makeRaw(Spacebars.mustache(view.lookup("title")));                                              // 21
    }), "\n              "), "\n              ", HTML.DIV({                                                            // 22
      "class": "blog-date"                                                                                             // 23
    }, "\n                ", HTML.TIME({                                                                               // 24
      datetime: function() {                                                                                           // 25
        return Spacebars.mustache(view.lookup("publishedAt"));                                                         // 26
      }                                                                                                                // 27
    }, Blaze.View("lookup:date", function() {                                                                          // 28
      return Spacebars.mustache(view.lookup("date"), view.lookup("publishedAt"));                                      // 29
    })), "\n              "), "\n            "), "\n          "), "\n        "), "\n      " ];                         // 30
  }, function() {                                                                                                      // 31
    return [ "\n        ", HTML.LI("Loading..."), "\n      " ];                                                        // 32
  }), "\n    "), "\n    ", HTML.A({                                                                                    // 33
    href: function() {                                                                                                 // 34
      return Spacebars.mustache(view.lookup("pathFor"), "blogIndex");                                                  // 35
    }                                                                                                                  // 36
  }, "View all posts", HTML.Raw("&nbsp;"), " ", HTML.Raw("&rsaquo;")), "\n  ");                                        // 37
}));                                                                                                                   // 38
                                                                                                                       // 39
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/client/views/widget/latest.coffee.js                                                              //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
Template.blogLatest.rendered = function() {
  var num, _ref;
  num = ((_ref = this.data) != null ? _ref.num : void 0) ? this.data.num : 3;
  return this.autorun(function() {
    return Meteor.subscribe('posts', num);
  });
};

Template.blogLatest.helpers({
  latest: function() {
    return Post.all();
  },
  date: function(date) {
    if (date) {
      date = new Date(date);
      return moment(date).format('MMMM Do, YYYY');
    }
  }
});
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/collections/author.coffee.js                                                                      //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
var __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

this.Author = (function(_super) {
  __extends(Author, _super);

  function Author() {
    return Author.__super__.constructor.apply(this, arguments);
  }

  Author._collection = Meteor.users;

  Author.has_many = [
    {
      name: 'posts',
      foreign_key: 'userId'
    }
  ];

  Author.current = function() {
    if (Meteor.userId()) {
      return Author.init(Meteor.user());
    }
  };

  return Author;

})(Minimongoid);
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/collections/post.coffee.js                                                                        //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
var __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

this.Post = (function(_super) {
  __extends(Post, _super);

  function Post() {
    return Post.__super__.constructor.apply(this, arguments);
  }

  Post._collection = new Meteor.Collection('blog_posts');

  Post.belongs_to = [
    {
      name: 'author',
      identifier: 'userId'
    }
  ];

  Post.after_save = function(post) {
    post.tags = Post.splitTags(post.tags);
    if (post.body) {
      post.excerpt = Post.excerpt(post.body);
    }
    return this._collection.update({
      _id: post.id
    }, {
      $set: {
        tags: post.tags,
        excerpt: post.excerpt
      }
    });
  };

  Post.slugify = function(str) {
    return str.toLowerCase().replace(/[^\w ]+/g, "").replace(RegExp(" +", "g"), "-");
  };

  Post.splitTags = function(str) {
    if (str && typeof str === 'string') {
      return str.split(/,\s*/);
    }
    return str;
  };

  Post.prototype.validate = function() {
    if (!this.title) {
      this.error('title', "Blog title is required");
    }
    if (!this.slug) {
      return this.error('slug', "Blog slug is required");
    }
  };

  Post.prototype.html = function() {
    return this.body;
  };

  Post.prototype.thumbnail = function() {
    var match, regex, _ref, _ref1, _ref2;
    if (this.featuredImage != null) {
      if ((_ref = Meteor.settings) != null ? (_ref1 = _ref["public"]) != null ? (_ref2 = _ref1.blog) != null ? _ref2.useS3 : void 0 : void 0 : void 0) {
        return this.featuredImage;
      } else {
        return Meteor.absoluteUrl() + this.featuredImage;
      }
    } else {
      regex = new RegExp(/img src=[\'"]([^\'"]+)/ig);
      while (match = regex.exec(this.body)) {
        return match[1];
      }
    }
  };

  Post.excerpt = function(html) {
    var i, matches, ret;
    if (Blog.settings.excerptFunction != null) {
      return Blog.settings.excerptFunction(html);
    } else {
      matches = html != null ? html.split(/<\/div>|<\/p>|<\/blockquote>|<br><br>|\\n\\n|\\r\\n\\r\\n/m) : void 0;
      i = 0;
      ret = '';
      while (!ret && (matches != null ? matches[i] : void 0)) {
        ret += matches[i++].replace(/(<([^>]+)>)/ig, ' ').replace(/(\s\.)/, '.').replace('&nbsp;', ' ').trim();
      }
      return ret;
    }
  };

  Post.prototype.authorName = function() {
    var author;
    author = this.author();
    if (author) {
      if (author.profile && author.profile.name) {
        return author.profile.name;
      } else if (author.profile && author.profile.firstName && author.profile.lastName) {
        return "" + author.profile.firstName + " " + author.profile.lastName;
      } else if (author.profile && author.profile.twitter) {
        return "<a href=\"http://twitter.com/" + author.profile.twitter + "\">" + author.profile.twitter + "</a>";
      } else if (author.username) {
        return author.username;
      } else if (author.emails && author.emails[0]) {
        return author.emails[0].address;
      }
    }
    return 'Mystery blogger';
  };

  return Post;

})(Minimongoid);

if (Meteor.isServer) {
  Meteor.methods({
    doesBlogExist: function(slug) {
      check(slug, String);
      return !!Post.first({
        slug: slug
      });
    },
    isBlogAuthorized: function() {
      var post;
      check(arguments[0], Match.OneOf(Object, Number, String, null, void 0));
      if (!Meteor.user()) {
        return false;
      }
      if (!Blog.settings.adminRole && !Blog.settings.authorRole) {
        return true;
      }
      if (Blog.settings.adminRole) {
        if (Blog.settings.adminGroup) {
          if (Roles.userIsInRole(this.userId, Blog.settings.adminRole, Blog.settings.adminGroup)) {
            return true;
          }
        } else if (Roles.userIsInRole(this.userId, Blog.settings.adminRole)) {
          return true;
        }
      }
      if (Blog.settings.authorRole) {
        if (_.isObject(arguments[0])) {
          post = arguments[0];
        } else if (_.isNumber(arguments[0]) || _.isString(arguments[0])) {
          post = Post.first(arguments[0]);
        } else {
          post = null;
        }
        if (Blog.settings.authorGroup) {
          if (Roles.userIsInRole(this.userId, Blog.settings.authorRole, Blog.settings.authorGroup)) {
            if (post) {
              if (Meteor.userId() === post.userId) {
                return true;
              }
            } else {
              return true;
            }
          }
        } else if (Roles.userIsInRole(this.userId, Blog.settings.authorRole)) {
          if (post) {
            if (Meteor.userId() === post.userId) {
              return true;
            }
          } else {
            return true;
          }
        }
      }
      return false;
    }
  });
}

Post._collection.allow({
  insert: function(userId, item) {
    return Meteor.call('isBlogAuthorized', item);
  },
  update: function(userId, item, fields) {
    return Meteor.call('isBlogAuthorized', item);
  },
  remove: function(userId, item) {
    return Meteor.call('isBlogAuthorized', item);
  }
});
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/collections/comment.coffee.js                                                                     //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
var __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

this.Comment = (function(_super) {
  __extends(Comment, _super);

  function Comment() {
    return Comment.__super__.constructor.apply(this, arguments);
  }

  Comment._collection = new Meteor.Collection('blog_comments');

  Comment.belongs_to = [
    {
      name: 'post',
      identifier: 'postId'
    }
  ];

  return Comment;

})(Minimongoid);

Comment._collection.allow({
  insert: function(userId, doc) {
    return !!userId;
  },
  update: function(userId, doc, fields, modifier) {
    return doc.comment.authorId === userId;
  },
  remove: function(userId, doc) {
    return doc.comment.authorId === userId;
  }
});
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/collections/tag.coffee.js                                                                         //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
var __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

this.Tag = (function(_super) {
  __extends(Tag, _super);

  function Tag() {
    return Tag.__super__.constructor.apply(this, arguments);
  }

  Tag._collection = new Meteor.Collection('blog_tags');

  return Tag;

})(Minimongoid);
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/collections/files.coffee.js                                                                       //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
var s3Config, useS3, _ref, _ref1, _ref2, _ref3, _ref4, _ref5;

this.FilesLocal = FileCollection({
  resumable: false,
  baseURL: '/fs',
  http: [
    {
      method: 'get',
      path: '/:id',
      lookup: function(params, query) {
        return {
          _id: new Meteor.Collection.ObjectID(params.id)
        };
      }
    }, {
      method: 'post',
      path: '/:id',
      lookup: function(params, query) {
        return {
          _id: new Meteor.Collection.ObjectID(params.id)
        };
      }
    }
  ]
});

if (Meteor.isServer) {
  FilesLocal.allow({
    insert: function(userId, file) {
      return !!userId;
    },
    remove: function(userId, file) {
      return file.metadata && file.metadata.userId && file.metadata.userId === userId;
    },
    write: function() {
      return true;
    },
    read: function(userId, file) {
      return true;
    }
  });
}

useS3 = (_ref = Meteor.settings) != null ? (_ref1 = _ref["public"]) != null ? (_ref2 = _ref1.blog) != null ? _ref2.useS3 : void 0 : void 0 : void 0;

if (Meteor.isClient && useS3) {
  this.s3ImportStore = new FS.Store.S3("s3Imports");
  this.S3Files = new FS.Collection("s3Imports", {
    stores: [s3ImportStore],
    filter: {
      allow: {
        contentTypes: ['image/*']
      }
    },
    onInvalid: function(message) {
      return console.log(message);
    }
  });
  Meteor.subscribe("s3Imports");
}

if (Meteor.isServer && useS3) {
  s3Config = (_ref3 = Meteor.settings) != null ? (_ref4 = _ref3["private"]) != null ? (_ref5 = _ref4.blog) != null ? _ref5.s3Config : void 0 : void 0 : void 0;
  this.s3ImportStore = new FS.Store.S3("s3Imports", {
    accessKeyId: s3Config.accessKeyId,
    secretAccessKey: s3Config.secretAccessKey,
    bucket: s3Config.bucket,
    ACL: s3Config.s3ACL,
    maxTries: s3Config.s3MaxTries,
    region: s3Config.region
  });
  this.S3Files = new FS.Collection("s3Imports", {
    stores: [s3ImportStore],
    filter: {
      allow: {
        contentTypes: ['image/*']
      }
    },
    onInvalid: function(message) {
      return console.log(message);
    }
  });
  Meteor.publish('s3Imports', function() {
    return S3Files.find();
  });
  S3Files.allow({
    insert: function(userId, file) {
      return userId;
    },
    remove: function(userId, file) {
      return file.metadata && file.metadata.userId && file.metadata.userId === userId;
    },
    update: function() {
      return true;
    },
    download: function(userId, file) {
      return true;
    }
  });
}
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function () {

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw:blog/router.coffee.js                                                                                  //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
var subs;

subs = new SubsManager({
  cacheLimit: 10,
  expireIn: 5
});

if (Meteor.isClient) {
  Router.onBeforeAction(function() {
    this.notFoundTemplate = Blog.settings.blogNotFoundTemplate ? Blog.settings.blogNotFoundTemplate : 'blogNotFound';
    return Iron.Router.hooks.dataNotFound.call(this);
  }, {
    only: ['blogShow']
  });
}

Router.route('/rss/posts', {
  name: 'rss',
  where: 'server',
  action: function() {
    this.response.write(Meteor.call('serveRSS'));
    return this.response.end();
  }
});

Router.route('/blog', {
  name: 'blogIndex',
  template: 'custom',
  onRun: function() {
    if (!Session.get('postLimit') && Blog.settings.pageSize) {
      Session.set('postLimit', Blog.settings.pageSize);
    }
    return this.next();
  },
  waitOn: function() {
    if (typeof Session !== 'undefined') {
      return [subs.subscribe('posts', Session.get('postLimit')), subs.subscribe('authors')];
    }
  },
  fastRender: true,
  data: function() {
    return {
      posts: Post.where({}, {
        sort: {
          publishedAt: -1
        }
      })
    };
  }
});

Router.route('/blog/tag/:tag', {
  name: 'blogTagged',
  template: 'custom',
  waitOn: function() {
    return [subs.subscribe('taggedPosts', this.params.tag), subs.subscribe('authors')];
  },
  fastRender: true,
  data: function() {
    return {
      posts: Post.where({
        tags: this.params.tag
      }, {
        sort: {
          publishedAt: -1
        }
      })
    };
  }
});

Router.route('/blog/:slug', {
  name: 'blogShow',
  template: 'custom',
  onRun: function() {
    Session.set('slug', this.params.slug);
    return this.next();
  },
  onBeforeAction: function() {
    var pkgFunc, tpl, userFunc, _ref;
    if (Blog.settings.blogShowTemplate) {
      tpl = Blog.settings.blogShowTemplate;
      pkgFunc = Template.blogShowBody.rendered;
      userFunc = Template[tpl].rendered;
      if (userFunc) {
        Template[tpl].rendered = function() {
          pkgFunc.call(this);
          return userFunc.call(this);
        };
      } else {
        Template[tpl].rendered = pkgFunc;
      }
    }
    if (!Blog.settings.publicDrafts && !Post.first().published) {
      Meteor.call('isBlogAuthorized', (function(_this) {
        return function(err, authorized) {
          if (!authorized) {
            return _this.redirect('/blog');
          }
        };
      })(this));
    }
    Session.set('postHasFeaturedImage', ((_ref = Post.first({
      slug: this.params.slug
    }).featuredImage) != null ? _ref.length : void 0) > 0);
    return this.next();
  },
  action: function() {
    if (this.ready()) {
      return this.render();
    }
  },
  waitOn: function() {
    return [Meteor.subscribe('singlePostBySlug', this.params.slug), subs.subscribe('commentsBySlug', this.params.slug), subs.subscribe('authors')];
  },
  data: function() {
    return Post.first({
      slug: this.params.slug
    });
  }
});

Router.route('/admin/blog', {
  name: 'blogAdmin',
  template: 'custom',
  onBeforeAction: function() {
    if (Meteor.loggingIn()) {
      return;
    }
    Deps.autorun(function() {
      if (!Meteor.userId()) {
        return Router.go('blogIndex');
      }
    });
    Meteor.call('isBlogAuthorized', (function(_this) {
      return function(err, authorized) {
        if (!authorized) {
          return _this.redirect('/blog');
        }
      };
    })(this));
    return this.next();
  },
  waitOn: function() {
    return [Meteor.subscribe('postForAdmin'), Meteor.subscribe('authors')];
  }
});

Router.route('/admin/blog/edit/:id', {
  name: 'blogAdminEdit',
  template: 'custom',
  onBeforeAction: function() {
    if (Meteor.loggingIn()) {
      return;
    }
    Deps.autorun(function() {
      if (!Meteor.userId()) {
        return Router.go('blogIndex');
      }
    });
    Meteor.call('isBlogAuthorized', this.params.id, (function(_this) {
      return function(err, authorized) {
        if (!authorized) {
          return _this.redirect('/blog');
        }
      };
    })(this));
    Session.set('postId', this.params.id);
    if (Session.get("postId").length != null) {
      return this.next();
    }
  },
  action: function() {
    if (this.ready()) {
      return this.render();
    }
  },
  waitOn: function() {
    return [Meteor.subscribe('singlePostById', this.params.id), Meteor.subscribe('authors'), Meteor.subscribe('postTags')];
  }
});
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);


/* Exports */
if (typeof Package === 'undefined') Package = {};
Package['ryw:blog'] = {};

})();
